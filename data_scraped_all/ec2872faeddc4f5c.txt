Note
Access to this page requires authorization. You can trysigning inorchanging directories.
Access to this page requires authorization. You can trychanging directories.
Manage NAT gateway
Article
2024-10-08
4 contributors
In this article
Learn how to create and remove a NAT gateway resource from a virtual network subnet. A NAT gateway enables outbound connectivity for resources in an Azure Virtual Network. You can change the public IP addresses and public IP address prefixes associated with the NAT gateway changed after deployment.
This article explains how to manage the following aspects of NAT gateway:
Create a NAT gateway and associate it with an existing subnet.
Create a NAT gateway and associate it with an existing subnet.
Remove a NAT gateway from an existing subnet and delete the NAT gateway.
Remove a NAT gateway from an existing subnet and delete the NAT gateway.
Add or remove a public IP address or public IP prefix.
Add or remove a public IP address or public IP prefix.
Prerequisites
Azure portal
Azure PowerShell
Azure CLI
Bicep
An Azure account with an active subscription.Create an account for free.
An Azure account with an active subscription.Create an account for free.
An existing Azure Virtual Network and subnet. For more information, seeQuickstart: Create a virtual network using the Azure portal.The example virtual network that is used in this article is namedvnet-1.The example subnet is namedsubnet-1.The example NAT gateway is namednat-gateway.
An existing Azure Virtual Network and subnet. For more information, seeQuickstart: Create a virtual network using the Azure portal.
The example virtual network that is used in this article is namedvnet-1.
The example virtual network that is used in this article is namedvnet-1.
The example subnet is namedsubnet-1.
The example subnet is namedsubnet-1.
The example NAT gateway is namednat-gateway.
The example NAT gateway is namednat-gateway.
An Azure account with an active subscription.Create an account for free.
An Azure account with an active subscription.Create an account for free.
An existing Azure Virtual Network and subnet. For more information, seeQuickstart: Create a virtual network using the Azure portal.The example virtual network that is used in this article is namedvnet-1.The example subnet is namedsubnet-1.The example NAT gateway is namednat-gateway.
An existing Azure Virtual Network and subnet. For more information, seeQuickstart: Create a virtual network using the Azure portal.
The example virtual network that is used in this article is namedvnet-1.
The example virtual network that is used in this article is namedvnet-1.
The example subnet is namedsubnet-1.
The example subnet is namedsubnet-1.
The example NAT gateway is namednat-gateway.
The example NAT gateway is namednat-gateway.
To use Azure PowerShell for this article, you need:
Azure PowerShell installed locally or Azure Cloud Shell.If you choose to install and use PowerShell locally, this article requires the Azure PowerShell module version 5.4.1 or later. RunGet-Module -ListAvailable Azto find the installed version. If you need to upgrade, seeInstall Azure PowerShell module.If you run PowerShell locally, you also need to runConnect-AzAccountto create a connection with Azure.
Azure PowerShell installed locally or Azure Cloud Shell.
If you choose to install and use PowerShell locally, this article requires the Azure PowerShell module version 5.4.1 or later. RunGet-Module -ListAvailable Azto find the installed version. If you need to upgrade, seeInstall Azure PowerShell module.
Get-Module -ListAvailable Az
If you run PowerShell locally, you also need to runConnect-AzAccountto create a connection with Azure.
Connect-AzAccount
Ensure that yourAz.Networkmodule is 4.3.0 or later. To verify the installed module, use the commandGet-InstalledModule -Name "Az.Network". If the module requires an update, use the commandUpdate-Module -Name Az.Network.
Ensure that yourAz.Networkmodule is 4.3.0 or later. To verify the installed module, use the commandGet-InstalledModule -Name "Az.Network". If the module requires an update, use the commandUpdate-Module -Name Az.Network.
Az.Network
Get-InstalledModule -Name "Az.Network"
Update-Module -Name Az.Network
Sign in to Azure PowerShell and select the subscription that you want to use. For more information, seeSign in with Azure PowerShell.
Sign in to Azure PowerShell and select the subscription that you want to use. For more information, seeSign in with Azure PowerShell.
An Azure account with an active subscription.Create an account for free.
An Azure account with an active subscription.Create an account for free.
An existing Azure Virtual Network and subnet. For more information, seeQuickstart: Create a virtual network using the Azure portal.The example virtual network that is used in this article is namedvnet-1.The example subnet is namedsubnet-1.The example NAT gateway is namednat-gateway.
An existing Azure Virtual Network and subnet. For more information, seeQuickstart: Create a virtual network using the Azure portal.
The example virtual network that is used in this article is namedvnet-1.
The example virtual network that is used in this article is namedvnet-1.
The example subnet is namedsubnet-1.
The example subnet is namedsubnet-1.
The example NAT gateway is namednat-gateway.
The example NAT gateway is namednat-gateway.
To use Azure CLI for this article, you need:
Azure CLI version 2.31.0 or later. Azure Cloud Shell uses the latest version.
Use the Bash environment inAzure Cloud Shell. For more information, seeGet started with Azure Cloud Shell.
Use the Bash environment inAzure Cloud Shell. For more information, seeGet started with Azure Cloud Shell.

If you prefer to run CLI reference commands locally,installthe Azure CLI. If you're running on Windows or macOS, consider running Azure CLI in a Docker container. For more information, seeHow to run the Azure CLI in a Docker container.If you're using a local installation, sign in to the Azure CLI by using theaz logincommand. To finish the authentication process, follow the steps displayed in your terminal. For other sign-in options, seeAuthenticate to Azure using Azure CLI.When you're prompted, install the Azure CLI extension on first use. For more information about extensions, seeUse and manage extensions with the Azure CLI.Runaz versionto find the version and dependent libraries that are installed. To upgrade to the latest version, runaz upgrade.
If you prefer to run CLI reference commands locally,installthe Azure CLI. If you're running on Windows or macOS, consider running Azure CLI in a Docker container. For more information, seeHow to run the Azure CLI in a Docker container.
If you're using a local installation, sign in to the Azure CLI by using theaz logincommand. To finish the authentication process, follow the steps displayed in your terminal. For other sign-in options, seeAuthenticate to Azure using Azure CLI.
If you're using a local installation, sign in to the Azure CLI by using theaz logincommand. To finish the authentication process, follow the steps displayed in your terminal. For other sign-in options, seeAuthenticate to Azure using Azure CLI.
When you're prompted, install the Azure CLI extension on first use. For more information about extensions, seeUse and manage extensions with the Azure CLI.
When you're prompted, install the Azure CLI extension on first use. For more information about extensions, seeUse and manage extensions with the Azure CLI.
Runaz versionto find the version and dependent libraries that are installed. To upgrade to the latest version, runaz upgrade.
Runaz versionto find the version and dependent libraries that are installed. To upgrade to the latest version, runaz upgrade.
An Azure account with an active subscription.Create an account for free.
An Azure account with an active subscription.Create an account for free.
An existing Azure Virtual Network a subnet. For more information, seeQuickstart: Create a virtual network using the Azure portal.The example virtual network that is used in this article is namedvnet-1.The example subnet is namedsubnet-1.The example NAT gateway is namednat-gateway.
An existing Azure Virtual Network a subnet. For more information, seeQuickstart: Create a virtual network using the Azure portal.
The example virtual network that is used in this article is namedvnet-1.
The example virtual network that is used in this article is namedvnet-1.
The example subnet is namedsubnet-1.
The example subnet is namedsubnet-1.
The example NAT gateway is namednat-gateway.
The example NAT gateway is namednat-gateway.
Create a NAT gateway and associate it with an existing subnet
You can create a NAT gateway resource and add it to an existing subnet by using the Azure portal, Azure PowerShell, Azure CLI, or Bicep.
Azure portal
Azure PowerShell
Azure CLI
Bicep
Sign in to theAzure portal.
Sign in to theAzure portal.
In the search box at the top of the Azure portal, enterNAT gateway. SelectNAT gatewaysin the search results.
In the search box at the top of the Azure portal, enterNAT gateway. SelectNAT gatewaysin the search results.
Select+ Create.
Select+ Create.
Enter or select the following information in theBasicstab ofCreate network address translation (NAT) gateway.SettingValueProject detailsSubscriptionSelect your subscription.Resource groupSelect your resource group or selectCreate newto create a new resource group.Instance detailsNAT gateway nameEnternat-gateway.RegionSelect your region. This example usesEast US 2.Availability zoneSelectNo Zone. For more information about NAT gateway availability, seeNAT gateway and availability zones.TCP idle timeout (minutes)Select the default of4.
Enter or select the following information in theBasicstab ofCreate network address translation (NAT) gateway.
Select theOutbound IPtab, or selectNext: Outbound IP.
Select theOutbound IPtab, or selectNext: Outbound IP.
You can select an existing public IP address or prefix or both to associate with the NAT gateway and enable outbound connectivity.To create a new public IP for the NAT gateway, selectCreate a new public IP address. Enterpublic-ip-natinName. SelectOK.To create a new public IP prefix for the NAT gateway, selectCreate a new public IP prefix. Enterpublic-ip-prefix-natinName. Select aPrefix size. SelectOK.
You can select an existing public IP address or prefix or both to associate with the NAT gateway and enable outbound connectivity.
To create a new public IP for the NAT gateway, selectCreate a new public IP address. Enterpublic-ip-natinName. SelectOK.
To create a new public IP for the NAT gateway, selectCreate a new public IP address. Enterpublic-ip-natinName. SelectOK.
To create a new public IP prefix for the NAT gateway, selectCreate a new public IP prefix. Enterpublic-ip-prefix-natinName. Select aPrefix size. SelectOK.
To create a new public IP prefix for the NAT gateway, selectCreate a new public IP prefix. Enterpublic-ip-prefix-natinName. Select aPrefix size. SelectOK.
Select theSubnettab, or selectNext: Subnet.
Select theSubnettab, or selectNext: Subnet.
Select your virtual network. In this example, selectvnet-1in the dropdown list.
Select your virtual network. In this example, selectvnet-1in the dropdown list.
Select the checkbox next tosubnet-1.
Select the checkbox next tosubnet-1.
SelectReview + create.
SelectReview + create.
SelectCreate.
SelectCreate.
Public IP address
To create a NAT gateway with a public IP address, run the following PowerShell commands.
Use theNew-AzPublicIpAddresscmdlet to create a public IP address for the NAT gateway.
## Create public IP address for NAT gateway ##
$ip = @{
    Name = 'public-ip-nat'
    ResourceGroupName = 'test-rg'
    Location = 'eastus2'
    Sku = 'Standard'
    AllocationMethod = 'Static'
}
New-AzPublicIpAddress @ip
## Create public IP address for NAT gateway ##
$ip = @{
    Name = 'public-ip-nat'
    ResourceGroupName = 'test-rg'
    Location = 'eastus2'
    Sku = 'Standard'
    AllocationMethod = 'Static'
}
New-AzPublicIpAddress @ip
Use theNew-AzNatGatewaycmdlet to create a NAT gateway resource and associate the public IP address that you created. Use theSet-AzVirtualNetworkSubnetConfigcmdlet to configure the NAT gateway for your virtual network subnet.
## Place the virtual network into a variable. ##
$net = @{
    Name = 'vnet-1'
    ResourceGroupName = 'test-rg'
}
$vnet = Get-AzVirtualNetwork @net

## Place the public IP address you created previously into a variable. ##
$pip = @{
    Name = 'public-ip-nat'
    ResourceGroupName = 'test-rg'
}
$publicIP = Get-AzPublicIPAddress @pip

## Create NAT gateway resource ##
$nat = @{
    ResourceGroupName = 'test-rg'
    Name = 'nat-gateway'
    IdleTimeoutInMinutes = '4'
    Sku = 'Standard'
    Location = 'eastus2'
    PublicIpAddress = $publicIP
}
$natGateway = New-AzNatGateway @nat

## Create the subnet configuration. ##
$sub = @{
    Name = 'subnet-1'
    VirtualNetwork = $vnet
    NatGateway = $natGateway
    AddressPrefix = '10.0.0.0/24'
}
Set-AzVirtualNetworkSubnetConfig @sub

## Save the configuration to the virtual network. ##
$vnet | Set-AzVirtualNetwork
## Place the virtual network into a variable. ##
$net = @{
    Name = 'vnet-1'
    ResourceGroupName = 'test-rg'
}
$vnet = Get-AzVirtualNetwork @net

## Place the public IP address you created previously into a variable. ##
$pip = @{
    Name = 'public-ip-nat'
    ResourceGroupName = 'test-rg'
}
$publicIP = Get-AzPublicIPAddress @pip

## Create NAT gateway resource ##
$nat = @{
    ResourceGroupName = 'test-rg'
    Name = 'nat-gateway'
    IdleTimeoutInMinutes = '4'
    Sku = 'Standard'
    Location = 'eastus2'
    PublicIpAddress = $publicIP
}
$natGateway = New-AzNatGateway @nat

## Create the subnet configuration. ##
$sub = @{
    Name = 'subnet-1'
    VirtualNetwork = $vnet
    NatGateway = $natGateway
    AddressPrefix = '10.0.0.0/24'
}
Set-AzVirtualNetworkSubnetConfig @sub

## Save the configuration to the virtual network. ##
$vnet | Set-AzVirtualNetwork
Public IP prefix
To create a NAT gateway with a public IP prefix, use these commands.
Use theNew-AzPublicIpPrefixcmdlet to create a public IP prefix for the NAT gateway.
## Create public IP prefix for NAT gateway ##
$ip = @{
    Name = 'public-ip-prefix-nat'
    ResourceGroupName = 'test-rg'
    Location = 'eastus2'
    Sku = 'Standard'
    PrefixLength ='29'
}
New-AzPublicIpPrefix @ip
## Create public IP prefix for NAT gateway ##
$ip = @{
    Name = 'public-ip-prefix-nat'
    ResourceGroupName = 'test-rg'
    Location = 'eastus2'
    Sku = 'Standard'
    PrefixLength ='29'
}
New-AzPublicIpPrefix @ip
Use theNew-AzNatGatewaycmdlet to create a NAT gateway resource and associate the public IP prefix you created. Use theSet-AzVirtualNetworkSubnetConfigcmdlet to configure the NAT gateway for your virtual network subnet.
## Place the virtual network into a variable. ##
$net = @{
    Name = 'vnet-1'
    ResourceGroupName = 'test-rg'
}
$vnet = Get-AzVirtualNetwork @net

## Place the public IP prefix you created previously into a variable. ##
$pip = @{
    Name = 'public-ip-prefix-nat'
    ResourceGroupName = 'test-rg'
}
$publicIPprefix = Get-AzPublicIPPrefix @pip

## Create NAT gateway resource ##
$nat = @{
    ResourceGroupName = 'test-rgNAT'
    Name = 'nat-gateway'
    IdleTimeoutInMinutes = '4'
    Sku = 'Standard'
    Location = 'eastus2'
    PublicIpPrefix = $publicIPprefix
}
$natGateway = New-AzNatGateway @nat

## Create the subnet configuration. ##
$sub = @{
    Name = 'subnet-1'
    VirtualNetwork = $vnet
    NatGateway = $natGateway
    AddressPrefix = '10.0.0.0/24'
}
Set-AzVirtualNetworkSubnetConfig @sub

## Save the configuration to the virtual network. ##
$vnet | Set-AzVirtualNetwork
## Place the virtual network into a variable. ##
$net = @{
    Name = 'vnet-1'
    ResourceGroupName = 'test-rg'
}
$vnet = Get-AzVirtualNetwork @net

## Place the public IP prefix you created previously into a variable. ##
$pip = @{
    Name = 'public-ip-prefix-nat'
    ResourceGroupName = 'test-rg'
}
$publicIPprefix = Get-AzPublicIPPrefix @pip

## Create NAT gateway resource ##
$nat = @{
    ResourceGroupName = 'test-rgNAT'
    Name = 'nat-gateway'
    IdleTimeoutInMinutes = '4'
    Sku = 'Standard'
    Location = 'eastus2'
    PublicIpPrefix = $publicIPprefix
}
$natGateway = New-AzNatGateway @nat

## Create the subnet configuration. ##
$sub = @{
    Name = 'subnet-1'
    VirtualNetwork = $vnet
    NatGateway = $natGateway
    AddressPrefix = '10.0.0.0/24'
}
Set-AzVirtualNetworkSubnetConfig @sub

## Save the configuration to the virtual network. ##
$vnet | Set-AzVirtualNetwork
Public IP address
To create a NAT gateway with a public IP address, use the following commands.
Useaz network public-ip createto create a public IP address for the NAT gateway.
az network public-ip create \
    --resource-group test-rg \
    --location eastus2 \
    --name public-ip-nat \
    --sku standard
az network public-ip create \
    --resource-group test-rg \
    --location eastus2 \
    --name public-ip-nat \
    --sku standard
Useaz network nat gateway createto create a NAT gateway resource and associate the public IP address that you created.
az network nat gateway create \
    --resource-group test-rg \
    --name nat-gateway \
    --public-ip-addresses public-ip-nat \
    --idle-timeout 4
az network nat gateway create \
    --resource-group test-rg \
    --name nat-gateway \
    --public-ip-addresses public-ip-nat \
    --idle-timeout 4
Useaz network vnet subnet updateto associate the NAT gateway with your virtual network subnet.
az network vnet subnet update \
    --resource-group test-rg \
    --vnet-name vnet-1 \
    --name subnet-1 \
    --nat-gateway nat-gateway
az network vnet subnet update \
    --resource-group test-rg \
    --vnet-name vnet-1 \
    --name subnet-1 \
    --nat-gateway nat-gateway
Public IP prefix
To create a NAT gateway with a public IP prefix, use the following commands.
Useaz network public-ip prefix createto create a public IP prefix for the NAT gateway.
az network public-ip prefix create \
    --length 29 \
    --resource-group test-rg \
    --location eastus2 \
    --name public-ip-prefix-nat
az network public-ip prefix create \
    --length 29 \
    --resource-group test-rg \
    --location eastus2 \
    --name public-ip-prefix-nat
Useaz network nat gateway createto create a NAT gateway resource and associate the public IP prefix that you created.
az network nat gateway create \
    --resource-group test-rg \
    --name nat-gateway \
    --public-ip-prefixes public-ip-prefix-nat \
    --idle-timeout 10
az network nat gateway create \
    --resource-group test-rg \
    --name nat-gateway \
    --public-ip-prefixes public-ip-prefix-nat \
    --idle-timeout 10
Useaz network vnet subnet updateto associate the NAT gateway with your virtual network subnet.
az network vnet subnet update \
    --resource-group test-rg \
    --vnet-name vnet-1 \
    --name subnet-1 \
    --nat-gateway nat-gateway
az network vnet subnet update \
    --resource-group test-rg \
    --vnet-name vnet-1 \
    --name subnet-1 \
    --nat-gateway nat-gateway
@description('Name of the NAT gateway')
param natgatewayname string = 'nat-gateway'

@description('Name of the NAT gateway public IP')
param publicipname string = 'public-ip-nat'

@description('Name of resource group')
param location string = resourceGroup().location

var existingVNetName = 'vnet-1'
var existingSubnetName = 'subnet-1'

resource vnet 'Microsoft.Network/virtualNetworks@2023-05-01' existing = {
  name: existingVNetName
}
output vnetid string = vnet.id

resource publicip 'Microsoft.Network/publicIPAddresses@2023-06-01' = {
  name: publicipname
  location: location
  sku: {
    name: 'Standard'
  }
  properties: {
    publicIPAddressVersion: 'IPv4'
    publicIPAllocationMethod: 'Static'
    idleTimeoutInMinutes: 4
  }
}

resource natgateway 'Microsoft.Network/natGateways@2023-06-01' = {
  name: natgatewayname
  location: location
  sku: {
    name: 'Standard'
  }
  properties: {
    idleTimeoutInMinutes: 4
    publicIpAddresses: [
      {
        id: publicip.id
      }
    ]
  }
}
output natgatewayid string = natgateway.id

resource updatedsubnet01 'Microsoft.Network/virtualNetworks/subnets@2023-06-01' = {
  parent: vnet
  name: existingSubnetName
  properties: {
    addressPrefix: vnet.properties.subnets[0].properties.addressPrefix
    natGateway: {
      id: natgateway.id
    }
  }
}
@description('Name of the NAT gateway')
param natgatewayname string = 'nat-gateway'

@description('Name of the NAT gateway public IP')
param publicipname string = 'public-ip-nat'

@description('Name of resource group')
param location string = resourceGroup().location

var existingVNetName = 'vnet-1'
var existingSubnetName = 'subnet-1'

resource vnet 'Microsoft.Network/virtualNetworks@2023-05-01' existing = {
  name: existingVNetName
}
output vnetid string = vnet.id

resource publicip 'Microsoft.Network/publicIPAddresses@2023-06-01' = {
  name: publicipname
  location: location
  sku: {
    name: 'Standard'
  }
  properties: {
    publicIPAddressVersion: 'IPv4'
    publicIPAllocationMethod: 'Static'
    idleTimeoutInMinutes: 4
  }
}

resource natgateway 'Microsoft.Network/natGateways@2023-06-01' = {
  name: natgatewayname
  location: location
  sku: {
    name: 'Standard'
  }
  properties: {
    idleTimeoutInMinutes: 4
    publicIpAddresses: [
      {
        id: publicip.id
      }
    ]
  }
}
output natgatewayid string = natgateway.id

resource updatedsubnet01 'Microsoft.Network/virtualNetworks/subnets@2023-06-01' = {
  parent: vnet
  name: existingSubnetName
  properties: {
    addressPrefix: vnet.properties.subnets[0].properties.addressPrefix
    natGateway: {
      id: natgateway.id
    }
  }
}
Remove a NAT gateway from an existing subnet and delete the resource
To remove a NAT gateway from an existing subnet, complete the following steps.
Azure portal
Azure PowerShell
Azure CLI
Bicep
Sign in to theAzure portal.
Sign in to theAzure portal.
In the search box at the top of the Azure portal, enterNAT gateway. SelectNAT gatewaysin the search results.
In the search box at the top of the Azure portal, enterNAT gateway. SelectNAT gatewaysin the search results.
Selectnat-gateway.
Selectnat-gateway.
UnderSettings, selectSubnets.
UnderSettings, selectSubnets.
To remove NAT gateway fromallsubnets, selectDisassociate.
To remove NAT gateway fromallsubnets, selectDisassociate.
To remove NAT gateway from only one of multiple subnets, unselect the checkbox next to the subnet and selectSave.
To remove NAT gateway from only one of multiple subnets, unselect the checkbox next to the subnet and selectSave.
You can now associate the NAT gateway with a different subnet or virtual network in your subscription. To delete the NAT gateway resource, complete the following steps.
In the search box at the top of the Azure portal, enterNAT gateway. SelectNAT gatewaysin the search results.
In the search box at the top of the Azure portal, enterNAT gateway. SelectNAT gatewaysin the search results.
Selectnat-gateway.
Selectnat-gateway.
SelectDelete.
SelectDelete.
SelectYes.
SelectYes.
UseSet-AzVirtualNetworkSubnetConfigto remove the NAT gateway association from the subnet by setting the value to $null. UseSet-AzVirtualNetworkto update the virtual network configuration.
# Specify the resource group and NAT gateway name
$resourceGroupName = "test-rg"

# Specify the virtual network name and subnet name
$virtualNetworkName = "vnet-1"
$subnetName = "subnet-1"

# Get the virtual network
$vnet = @{
    Name = $virtualNetworkName
    ResourceGroupName = $resourceGroupName
}
$virtualNetwork = Get-AzVirtualNetwork @vnet

# Get the subnet
$subnet = $virtualNetwork.Subnets | Where-Object {$_.Name -eq $subnetName}

# Remove the NAT gateway association from the subnet
$subnet.NatGateway = $null

# Update the subnet configuration
$subConfig = @{
    Name = $subnetName
    VirtualNetwork = $virtualNetwork
    AddressPrefix = $subnet.AddressPrefix         
}
Set-AzVirtualNetworkSubnetConfig @subConfig

# Update the virtual network
Set-AzVirtualNetwork -VirtualNetwork $virtualNetwork
# Specify the resource group and NAT gateway name
$resourceGroupName = "test-rg"

# Specify the virtual network name and subnet name
$virtualNetworkName = "vnet-1"
$subnetName = "subnet-1"

# Get the virtual network
$vnet = @{
    Name = $virtualNetworkName
    ResourceGroupName = $resourceGroupName
}
$virtualNetwork = Get-AzVirtualNetwork @vnet

# Get the subnet
$subnet = $virtualNetwork.Subnets | Where-Object {$_.Name -eq $subnetName}

# Remove the NAT gateway association from the subnet
$subnet.NatGateway = $null

# Update the subnet configuration
$subConfig = @{
    Name = $subnetName
    VirtualNetwork = $virtualNetwork
    AddressPrefix = $subnet.AddressPrefix         
}
Set-AzVirtualNetworkSubnetConfig @subConfig

# Update the virtual network
Set-AzVirtualNetwork -VirtualNetwork $virtualNetwork
UseRemove-AzNatGatewayto delete the NAT gateway resource.
# Specify the resource group and NAT gateway name
$resourceGroupName = "test-rg"
$natGatewayName = "nat-gateway"

$nat = @{
    Name = $natGatewayName
    ResourceGroupName = $resourceGroupName
}
Remove-AzNatGateway @nat
# Specify the resource group and NAT gateway name
$resourceGroupName = "test-rg"
$natGatewayName = "nat-gateway"

$nat = @{
    Name = $natGatewayName
    ResourceGroupName = $resourceGroupName
}
Remove-AzNatGateway @nat
Useaz network vnet subnet updateto remove the NAT gateway from the subnet.
az network vnet subnet update \
ââââââ--resource-group test-rg \
ââââââ--vnet-name vnet-1 \
ââââââ--name subnet-1 \
ââââââ--remove natGateway
az network vnet subnet update \
ââââââ--resource-group test-rg \
ââââââ--vnet-name vnet-1 \
ââââââ--name subnet-1 \
ââââââ--remove natGateway
Useaz network nat gateway deleteto delete the NAT gateway resource.
az network nat gateway delete \
    --name nat-gateway \
    --resource-group test-rg
az network nat gateway delete \
    --name nat-gateway \
    --resource-group test-rg
@description('Name of resource group')
param location string = resourceGroup().location

var existingVNetName = 'vnet-1'
var existingSubnetName = 'subnet-1'

resource vnet 'Microsoft.Network/virtualNetworks@2023-05-01' existing = {
  name: existingVNetName
}
output vnetid string = vnet.id

resource updatedsubnet01 'Microsoft.Network/virtualNetworks/subnets@2023-06-01' = {
  parent: vnet
  name: existingSubnetName
  properties: {
    addressPrefix: vnet.properties.subnets[0].properties.addressPrefix
  }
}
@description('Name of resource group')
param location string = resourceGroup().location

var existingVNetName = 'vnet-1'
var existingSubnetName = 'subnet-1'

resource vnet 'Microsoft.Network/virtualNetworks@2023-05-01' existing = {
  name: existingVNetName
}
output vnetid string = vnet.id

resource updatedsubnet01 'Microsoft.Network/virtualNetworks/subnets@2023-06-01' = {
  parent: vnet
  name: existingSubnetName
  properties: {
    addressPrefix: vnet.properties.subnets[0].properties.addressPrefix
  }
}
Note
When you delete a NAT gateway, the public IP address or prefix associated with it isn't deleted.
Add or remove a public IP address
Complete the following steps to add or remove a public IP address from a NAT gateway.
Azure portal
PowerShell
Azure CLI
Bicep
Sign in to theAzure portal.
Sign in to theAzure portal.
In the search box at the top of the Azure portal, enterPublic IP address. SelectPublic IP addressesin the search results.
In the search box at the top of the Azure portal, enterPublic IP address. SelectPublic IP addressesin the search results.
SelectCreate.
SelectCreate.
Enter the following information inCreate public IP address.SettingValueSubscriptionSelect your subscription.Resource groupSelect your resource group. The example usestest-rg.RegionSelect a region. This example usesEast US 2.NameEnterpublic-ip-nat2.IP versionSelectIPv4.SKUSelectStandard.Availability zoneSelect the default ofZone-redundant.TierSelectRegional.
Enter the following information inCreate public IP address.
SelectReview + createand then selectCreate.
SelectReview + createand then selectCreate.
In the search box at the top of the Azure portal, enterNAT gateway. SelectNAT gatewaysin the search results.
In the search box at the top of the Azure portal, enterNAT gateway. SelectNAT gatewaysin the search results.
Selectnat-gateway.
Selectnat-gateway.
UnderSettings, selectOutbound IP.
UnderSettings, selectOutbound IP.
The IP addresses and prefixes associated with the NAT gateway are displayed. Next toPublic IP addresses, selectChange.
The IP addresses and prefixes associated with the NAT gateway are displayed. Next toPublic IP addresses, selectChange.
Next toPublic IP addresses, select the dropdown for IP addresses. Select the IP address that you created to add to the NAT gateway. To remove an address, unselect it.
Next toPublic IP addresses, select the dropdown for IP addresses. Select the IP address that you created to add to the NAT gateway. To remove an address, unselect it.
SelectOK.
SelectOK.
SelectSave.
SelectSave.
Add public IP address
To add a public IP address to the NAT gateway, add it to an array object along with the current IP addresses. The PowerShell cmdlets replace all the addresses.
In this example, the existing IP address associated with the NAT gateway is namedpublic-ip-nat. Replace this value with an array that contains both public-ip-nat and a new IP address. If you have multiple IP addresses already configured, you must also add them to the array.
UseNew-AzPublicIpAddressto create a new IP address for the NAT gateway.
## Create public IP address for NAT gateway ##
$ip = @{
    Name = 'public-ip-nat2'
    ResourceGroupName = 'test-rg'
    Location = 'eastus2'
    Sku = 'Standard'
    AllocationMethod = 'Static'
}
New-AzPublicIpAddress @ip
## Create public IP address for NAT gateway ##
$ip = @{
    Name = 'public-ip-nat2'
    ResourceGroupName = 'test-rg'
    Location = 'eastus2'
    Sku = 'Standard'
    AllocationMethod = 'Static'
}
New-AzPublicIpAddress @ip
UseSet-AzNatGatewayto add the public IP address to the NAT gateway.
## Place NAT gateway into a variable. ##
$ng = @{
    Name = 'nat-gateway'
    ResourceGroupName = 'test-rg'
}
$nat = Get-AzNatGateway @ng

## Place the existing public IP address associated with the NAT gateway into a variable. ##
$ip = @{
    Name = 'public-ip-nat'
    ResourceGroupName = 'test-rg'
}
$publicIP1 = Get-AzPublicIPaddress @ip

## Place the public IP address you created previously into a variable. ##
$ip = @{
    Name = 'public-ip-nat2'
    ResourceGroupName = 'test-rg'
}
$publicIP2 = Get-AzPublicIPaddress @ip

## Place the public IP address variables into an array. ##
$pipArray = $publicIP1,$publicIP2

## Add the IP address to the NAT gateway. ##
$nt = @{
    NatGateway = $nat
    PublicIpAddress = $pipArray
}
Set-AzNatGateway @nt
## Place NAT gateway into a variable. ##
$ng = @{
    Name = 'nat-gateway'
    ResourceGroupName = 'test-rg'
}
$nat = Get-AzNatGateway @ng

## Place the existing public IP address associated with the NAT gateway into a variable. ##
$ip = @{
    Name = 'public-ip-nat'
    ResourceGroupName = 'test-rg'
}
$publicIP1 = Get-AzPublicIPaddress @ip

## Place the public IP address you created previously into a variable. ##
$ip = @{
    Name = 'public-ip-nat2'
    ResourceGroupName = 'test-rg'
}
$publicIP2 = Get-AzPublicIPaddress @ip

## Place the public IP address variables into an array. ##
$pipArray = $publicIP1,$publicIP2

## Add the IP address to the NAT gateway. ##
$nt = @{
    NatGateway = $nat
    PublicIpAddress = $pipArray
}
Set-AzNatGateway @nt
Remove public IP address
To remove a public IP from a NAT gateway, create an array object thatdoesn'tcontain the IP address you want to remove. For example, you have a NAT gateway configured with two public IP addresses. You want to remove one of the IP addresses. The IP addresses associated with the NAT gateway are named public-ip-nat and public-ip-nat2. To remove public-ip-nat2, create an array object for the PowerShell command that containsonlypublic-ip-nat. When you apply the command, the array is reapplied to the NAT gateway, and public-ip-nat is the only associated public IP address.
UseSet-AzNatGatewayto remove a public IP address from the NAT gateway.
## Place NAT gateway into a variable. ##
$ng = @{
    Name = 'nat-gateway'
    ResourceGroupName = 'test-rg'
}
$nat = Get-AzNatGateway @ng

## Place the existing public IP address associated with the NAT gateway into a variable. ##
$ip = @{
    Name = 'public-ip-nat'
    ResourceGroupName = 'test-rg'
}
$publicIP1 = Get-AzPublicIPaddress @ip

## Place the second public IP address into a variable. ##
$ip = @{
    Name = 'public-ip-nat2'
    ResourceGroupName = 'test-rg'
}
$publicIP2 = Get-AzPublicIPAddress @ip

## Place ONLY the public IP you wish to keep in the array. ##
$pipArray = $publicIP1

## Add the public IP address to the NAT gateway. ##
$nt = @{
    NatGateway = $nat
    PublicIpAddress = $pipArray
}
Set-AzNatGateway @nt
## Place NAT gateway into a variable. ##
$ng = @{
    Name = 'nat-gateway'
    ResourceGroupName = 'test-rg'
}
$nat = Get-AzNatGateway @ng

## Place the existing public IP address associated with the NAT gateway into a variable. ##
$ip = @{
    Name = 'public-ip-nat'
    ResourceGroupName = 'test-rg'
}
$publicIP1 = Get-AzPublicIPaddress @ip

## Place the second public IP address into a variable. ##
$ip = @{
    Name = 'public-ip-nat2'
    ResourceGroupName = 'test-rg'
}
$publicIP2 = Get-AzPublicIPAddress @ip

## Place ONLY the public IP you wish to keep in the array. ##
$pipArray = $publicIP1

## Add the public IP address to the NAT gateway. ##
$nt = @{
    NatGateway = $nat
    PublicIpAddress = $pipArray
}
Set-AzNatGateway @nt
Add public IP address
In this example, the existing public IP address associated with the NAT gateway is namedpublic-ip-nat.
Useaz network public-ip createto create a new IP address for the NAT gateway.
az network public-ip create \
    --resource-group test-rg \
    --location eastus2 \
    --name public-ip-nat2 \
    --sku standard
az network public-ip create \
    --resource-group test-rg \
    --location eastus2 \
    --name public-ip-nat2 \
    --sku standard
Useaz network nat gateway updateto add the public IP address that you created to the NAT gateway. The Azure CLI command replaces the values. It doesn't add a new value. To add the new IP address to the NAT gateway, you must also include any other IP addresses associated to the NAT gateway.
az network nat gateway update \
    --name nat-gateway \
    --resource-group test-rg \
    --public-ip-addresses public-ip-nat public-ip-nat2
az network nat gateway update \
    --name nat-gateway \
    --resource-group test-rg \
    --public-ip-addresses public-ip-nat public-ip-nat2
Remove public IP address
Useaz network nat gateway updateto remove a public IP address from the NAT gateway. The Azure CLI command replaces the values. It doesn't remove a value. To remove a public IP address, include any IP address in the command that you want to keep. Omit the value that you want to remove. For example, you have a NAT gateway configured with two public IP addresses. You want to remove one of the IP addresses. The IP addresses associated with the NAT gateway are named public-ip-nat and public-ip-nat2. To remove public-ip-nat2, omit the name of the IP address from the command. The command reapplies the IP addresses listed in the command to the NAT gateway. It removes any IP address not listed.
az network nat gateway update \
    --name nat-gateway \
    --resource-group test-rg \
    --public-ip-addresses public-ip-nat
az network nat gateway update \
    --name nat-gateway \
    --resource-group test-rg \
    --public-ip-addresses public-ip-nat
Use the Azure portal, Azure PowerShell, or Azure CLI to add or remove a public IP address from a NAT gateway.
Add or remove a public IP prefix
Complete the following steps to add or remove a public IP prefix from a NAT gateway.
Azure portal
Azure PowerShell
Azure CLI
Bicep
Sign in to theAzure portal.
Sign in to theAzure portal.
In the search box at the top of the Azure portal, enterPublic IP prefix. SelectPublic IP Prefixesin the search results.
In the search box at the top of the Azure portal, enterPublic IP prefix. SelectPublic IP Prefixesin the search results.
SelectCreate.
SelectCreate.
Enter the following information in theBasicstab ofCreate a public IP prefix.SettingValueProject detailsSubscriptionSelect your subscription.Resource groupSelect your resource group. This example usestest-rg.Instance detailsNameEnterpublic-ip-prefix-nat.RegionSelect your region. This example usesEast US 2.IP versionSelectIPv4.Prefix ownershipSelectMicrosoft owned.Prefix sizeSelect a prefix size. This example uses/28 (16 addresses).
Enter the following information in theBasicstab ofCreate a public IP prefix.
SelectReview + create, then selectCreate.
SelectReview + create, then selectCreate.
In the search box at the top of the Azure portal, enterNAT gateway. SelectNAT gatewaysin the search results.
In the search box at the top of the Azure portal, enterNAT gateway. SelectNAT gatewaysin the search results.
Selectnat-gateway.
Selectnat-gateway.
UnderSettings, selectOutbound IP.
UnderSettings, selectOutbound IP.
The page displays the IP addresses and prefixes associated with the NAT gateway. Next toPublic IP prefixes, selectChange.
The page displays the IP addresses and prefixes associated with the NAT gateway. Next toPublic IP prefixes, selectChange.
Next toPublic IP Prefixes, select the dropdown box. Select the IP address prefix that you created to add the prefix to the NAT gateway. To remove a prefix, unselect it.
Next toPublic IP Prefixes, select the dropdown box. Select the IP address prefix that you created to add the prefix to the NAT gateway. To remove a prefix, unselect it.
SelectOK.
SelectOK.
SelectSave.
SelectSave.
Add public IP prefix
To add a public IP prefix to the NAT gateway, add it to an array object along with the current IP prefixes. The PowerShell cmdlets replace all the IP prefixes.
In this example, the existing public IP prefix associated with the NAT gateway is namedpublic-ip-prefix-nat. Replace this value with an array that contains both public-ip-prefix-nat and a new IP address prefix. If you have multiple IP prefixes already configured, you must also add them to the array.
UseNew-AzPublicIpPrefixto create a new public IP prefix for the NAT gateway.
## Create public IP prefix for NAT gateway ##
$ip = @{
    Name = 'public-ip-prefix-nat2'
    ResourceGroupName = 'test-rg'
    Location = 'eastus2'
    Sku = 'Standard'
    PrefixLength = '29'
}
New-AzPublicIpPrefix @ip
## Create public IP prefix for NAT gateway ##
$ip = @{
    Name = 'public-ip-prefix-nat2'
    ResourceGroupName = 'test-rg'
    Location = 'eastus2'
    Sku = 'Standard'
    PrefixLength = '29'
}
New-AzPublicIpPrefix @ip
UseSet-AzNatGatewayto add the public IP prefix to the NAT gateway.
## Place NAT gateway into a variable. ##
$ng = @{
    Name = 'nat-gateway'
    ResourceGroupName = 'test-rg'
}
$nat = Get-AzNatGateway @ng

## Place the existing public IP prefix associated with the NAT gateway into a variable. ##
$ip = @{
    Name = 'public-ip-prefix-nat'
    ResourceGroupName = 'test-rg'
}
$prefixIP1 = Get-AzPublicIPPrefix @ip

## Place the public IP prefix you created previously into a variable. ##
$ip = @{
    Name = 'public-ip-prefix-nat2'
    ResourceGroupName = 'test-rg'
}
$prefixIP2 = Get-AzPublicIPprefix @ip

## Place the public IP address variables into an array. ##
$preArray = $prefixIP1,$prefixIP2

## Add the IP address prefix to the NAT gateway. ##
$nt = @{
    NatGateway = $nat
    PublicIpPrefix = $preArray
}
Set-AzNatGateway @nt
## Place NAT gateway into a variable. ##
$ng = @{
    Name = 'nat-gateway'
    ResourceGroupName = 'test-rg'
}
$nat = Get-AzNatGateway @ng

## Place the existing public IP prefix associated with the NAT gateway into a variable. ##
$ip = @{
    Name = 'public-ip-prefix-nat'
    ResourceGroupName = 'test-rg'
}
$prefixIP1 = Get-AzPublicIPPrefix @ip

## Place the public IP prefix you created previously into a variable. ##
$ip = @{
    Name = 'public-ip-prefix-nat2'
    ResourceGroupName = 'test-rg'
}
$prefixIP2 = Get-AzPublicIPprefix @ip

## Place the public IP address variables into an array. ##
$preArray = $prefixIP1,$prefixIP2

## Add the IP address prefix to the NAT gateway. ##
$nt = @{
    NatGateway = $nat
    PublicIpPrefix = $preArray
}
Set-AzNatGateway @nt
Remove public IP prefix
To remove a public IP prefix from a NAT gateway, create an array object thatdoesn'tcontain the IP address prefix that you want to remove. For example, you have a NAT gateway configured with two public IP prefixes. You want to remove one of the IP prefixes. The IP prefixes associated with the NAT gateway are named public-ip-prefix-nat and public-ip-prefix-nat2. To remove public-ip-prefix-nat2, create an array object for the PowerShell command that containsonlypublic-ip-prefix-nat. When you apply the command, the array is reapplied to the NAT gateway, and public-ip-prefix-nat is the only prefix associated.
Use theSet-AzNatGatewaycmdlet to remove a public IP prefix from the NAT gateway.
## Place NAT gateway into a variable. ##
$ng = @{
    Name = 'nat-gateway'
    ResourceGroupName = 'test-rg'
}
$nat = Get-AzNatGateway @ng

## Place the existing public IP prefix associated with the NAT gateway into a variable. ##
$ip = @{
    Name = 'public-ip-prefix-nat'
    ResourceGroupName = 'test-rg'
}
$prefixIP1 = Get-AzPublicIPPrefix @ip

## Place the secondary public IP prefix into a variable. ##
$ip = @{
    Name = 'public-ip-prefix-nat2'
    ResourceGroupName = 'test-rg'
}
$prefixIP2 = Get-AzPublicIPprefix @ip

## Place ONLY the prefix you wish to keep in the array. DO NOT ADD THE SECONDARY VARIABLE ##
$preArray = $prefixIP1

## Add the IP address prefix to the NAT gateway. ##
$nt = @{
    NatGateway = $nat
    PublicIpPrefix = $preArray
}
Set-AzNatGateway @nt
## Place NAT gateway into a variable. ##
$ng = @{
    Name = 'nat-gateway'
    ResourceGroupName = 'test-rg'
}
$nat = Get-AzNatGateway @ng

## Place the existing public IP prefix associated with the NAT gateway into a variable. ##
$ip = @{
    Name = 'public-ip-prefix-nat'
    ResourceGroupName = 'test-rg'
}
$prefixIP1 = Get-AzPublicIPPrefix @ip

## Place the secondary public IP prefix into a variable. ##
$ip = @{
    Name = 'public-ip-prefix-nat2'
    ResourceGroupName = 'test-rg'
}
$prefixIP2 = Get-AzPublicIPprefix @ip

## Place ONLY the prefix you wish to keep in the array. DO NOT ADD THE SECONDARY VARIABLE ##
$preArray = $prefixIP1

## Add the IP address prefix to the NAT gateway. ##
$nt = @{
    NatGateway = $nat
    PublicIpPrefix = $preArray
}
Set-AzNatGateway @nt
Add public IP prefix
In this example, the existing public IP prefix associated with the NAT gateway is namedpublic-ip-prefix-nat.
Useaz network public-ip prefix createto create a public IP prefix for the NAT gateway.
az network public-ip prefix create \
    --length 29 \
    --resource-group test-rg \
    --location eastus2 \
    --name public-ip-prefix-nat2
az network public-ip prefix create \
    --length 29 \
    --resource-group test-rg \
    --location eastus2 \
    --name public-ip-prefix-nat2
Useaz network nat gateway updateto add the public IP prefix that you created to the NAT gateway. The Azure CLI command replaces values. It doesn't add a value. To add the new IP address prefix to the NAT gateway, you must also include any other IP prefixes associated to the NAT gateway.
az network nat gateway update \
    --name nat-gateway \
    --resource-group test-rg \
    --public-ip-prefixes public-ip-prefix-nat public-ip-prefix-nat2
az network nat gateway update \
    --name nat-gateway \
    --resource-group test-rg \
    --public-ip-prefixes public-ip-prefix-nat public-ip-prefix-nat2
Remove public IP prefix
Useaz network nat gateway updateto remove a public IP prefix from the NAT gateway. The Azure CLI command replaces the values. It doesn't remove a value. To remove a public IP prefix, include any prefix in the command that you wish to keep. Omit the one you want to remove. For example, you have a NAT gateway configured with two public IP prefixes. You want to remove one of the prefixes. The IP prefixes associated with the NAT gateway are named public-ip-prefix-nat and public-ip-prefix-nat2. To remove public-ip-prefix-nat2, omit the name of the IP prefix from the command. The command reapplies the IP prefixes listed in the command to the NAT gateway. It removes any IP address not listed.
az network nat gateway update \
    --name nat-gateway \
    --resource-group test-rg \
    --public-ip-prefixes public-ip-prefix-nat
az network nat gateway update \
    --name nat-gateway \
    --resource-group test-rg \
    --public-ip-prefixes public-ip-prefix-nat
Use the Azure portal, Azure PowerShell, or Azure CLI to add or remove a public IP prefix from a NAT gateway.
Next steps
To learn more about Azure Virtual Network NAT and its capabilities, see the following articles:
What is Azure NAT Gateway?
NAT gateway and availability zones
Design virtual networks with NAT gateway
Feedback
Was this page helpful?
Additional resources