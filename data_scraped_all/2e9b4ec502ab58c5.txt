Note
Access to this page requires authorization. You can trysigning inorchanging directories.
Access to this page requires authorization. You can trychanging directories.
Deploy VMs and scale sets to dedicated hosts
Article
2024-08-22
9 contributors
In this article
Applies to:âï¸ Linux VMs âï¸ Windows VMs âï¸ Uniform scale sets
This article guides you through how to create an Azurededicated hostto host your virtual machines (VMs) and scale set instances.
Limitations
The sizes and hardware types available for dedicated hosts vary by region. Refer to the hostpricing pageto learn more.
Not all Azure VM SKUs, regions and availability zones support ultra disks, for more information about this topic, seeAzure ultra disks.
Additionallimitationswould apply when using ultra disks on the following VM sizes: LSv2, M, Mv2, Msv2, Mdsv2, NVv3, NVv4 on a dedicated host.
The fault domain count of the virtual machine scale set can't exceed the fault domain count of the host group.
Users can not select hardware capabilities like accelerated networking when creating a dedicated host.
Users would not be able to create VMs/VMSS with accelerated networking enabled on a dedicated host.
Create a host group
Ahost groupis a resource that represents a collection of dedicated hosts. You create a host group in a region and an availability zone, and add hosts to it. You can use one or both of the following options with your dedicated hosts to ensure high availability:
Span across multiple availability zones. In this case, you're required to have a host group in each of the zones you wish to use.
Span across multiple fault domains, which are mapped to physical racks.
In either case, you need to provide the fault domain count for your host group. If you don't want to span fault domains in your group, use a fault domain count of 1.
You can also decide to use both availability zones and fault domains.
Enabling ultra disks is a host group level setting and can't be changed after a host group is created.
Portal
CLI
PowerShell
In this example, we'll create a host group using one availability zone and two fault domains.
Open the Azureportal.
SelectCreate a resourcein the upper left corner.
Search forHost groupand then selectHost Groupsfrom the results.
In theHost Groupspage, selectCreate.
Select the subscription you would like to use, and then selectCreate newto create a new resource group.
TypemyDedicatedHostsRGas theNameand then selectOK.
ForHost group name, typemyHostGroup.
ForLocation, selectEast US.
ForAvailability Zone, select1.
SelectEnable Ultra SSDto use ultra disks with supported Virtual Machines.
ForFault domain count, select2.
SelectAutomatic placementto automatically assign VMs and scale set instances to an available host in this group.
SelectReview + createand then wait for validation.
Once you see theValidation passedmessage, selectCreateto create the host group.
It should only take a few moments to create the host group.
Not all host SKUs are available in all regions, and availability zones. You can list host availability, and any offer restrictions before you start provisioning dedicated hosts.
az vm list-skus -l eastus2  -r hostGroups/hosts  -o table
az vm list-skus -l eastus2  -r hostGroups/hosts  -o table
You can also verify if a VM series supports ultra disks.
subscription="<mySubID>"
# example value is southeastasia
region="<myLocation>"
# example value is Standard_E64s_v3
vmSize="<myVMSize>"

az vm list-skus --resource-type virtualMachines  --location $region --query "[?name=='$vmSize'].locationInfo[0].zoneDetails[0].Name" --subscription $subscription
subscription="<mySubID>"
# example value is southeastasia
region="<myLocation>"
# example value is Standard_E64s_v3
vmSize="<myVMSize>"

az vm list-skus --resource-type virtualMachines  --location $region --query "[?name=='$vmSize'].locationInfo[0].zoneDetails[0].Name" --subscription $subscription
In this example, we'll useaz vm host group createto create a host group using both availability zones and fault domains.
az vm host group create \
   --name myHostGroup \
   -g myDHResourceGroup \
   -z 1 \
   --platform-fault-domain-count 2
az vm host group create \
   --name myHostGroup \
   -g myDHResourceGroup \
   -z 1 \
   --platform-fault-domain-count 2
Add the--automatic-placement trueparameter to have your VMs and scale set instances automatically placed on hosts, within a host group. For more information, seeManual vs. automatic placement.
--automatic-placement true
Add the--ultra-ssd-enabled trueparameter to enable creation of VMs that can support ultra disks.
--ultra-ssd-enabled true
Other examples
You can also useaz vm host group createto create a host group in availability zone 1 (and no fault domains).
az vm host group create \
   --name myAZHostGroup \
   -g myDHResourceGroup \
   -z 1 \
   --platform-fault-domain-count 1
az vm host group create \
   --name myAZHostGroup \
   -g myDHResourceGroup \
   -z 1 \
   --platform-fault-domain-count 1
The following code snippet usesaz vm host group createto create a host group by using fault domains only (to be used in regions where availability zones aren't supported).
az vm host group create \
   --name myFDHostGroup \
   -g myDHResourceGroup \
   --platform-fault-domain-count 2
az vm host group create \
   --name myFDHostGroup \
   -g myDHResourceGroup \
   --platform-fault-domain-count 2
The following code snippet usesaz vm host group createto create a host group that supports ultra disks and auto placement of VMs enabled.
az vm host group create \
   --name myFDHostGroup \
   -g myDHResourceGroup \
   -z 1 \
   --ultra-ssd-enabled true \
   --platform-fault-domain-count 2 \
   --automatic-placement true
az vm host group create \
   --name myFDHostGroup \
   -g myDHResourceGroup \
   -z 1 \
   --ultra-ssd-enabled true \
   --platform-fault-domain-count 2 \
   --automatic-placement true
This example usesNew-AzHostGroupto create a host group in zone 1, with 2 fault domains.
$rgName = "myDHResourceGroup"
$location = "EastUS"

New-AzResourceGroup -Location $location -Name $rgName
$hostGroup = New-AzHostGroup `
   -Name myHostGroup `
   -ResourceGroupName $rgName `
   -Location $location `
   -Zone 1 `
   -EnableUltraSSD `
   -PlatformFaultDomain 2 `
   -SupportAutomaticPlacement true
$rgName = "myDHResourceGroup"
$location = "EastUS"

New-AzResourceGroup -Location $location -Name $rgName
$hostGroup = New-AzHostGroup `
   -Name myHostGroup `
   -ResourceGroupName $rgName `
   -Location $location `
   -Zone 1 `
   -EnableUltraSSD `
   -PlatformFaultDomain 2 `
   -SupportAutomaticPlacement true
Add the-SupportAutomaticPlacement trueparameter to have your VMs and scale set instances automatically placed on hosts, within a host group. For more information about this topic, seeManual vs. automatic placement.
-SupportAutomaticPlacement true
Add the-EnableUltraSSDparameter to enable creation of VMs that can support ultra disks.
-EnableUltraSSD
Create a dedicated host
Now create a dedicated host in the host group. In addition to a name for the host, you're required to provide the SKU for the host. Host SKU captures the supported VM series and the hardware generation for your dedicated host.
For more information about the host SKUs and pricing, seeAzure Dedicated Host pricing.
If you set a fault domain count for your host group, you'll need to specify the fault domain for your host.
Portal
CLI
PowerShell
SelectCreate a resourcein the upper left corner.
Search forDedicated hostand then selectDedicated hostsfrom the results.
In theDedicated Hostspage, selectCreate.
Select the subscription you would like to use.
SelectmyDedicatedHostsRGas theResource group.
InInstance details, typemyHostfor theNameand selectEast USfor the location.
InHardware profile, selectStandard Es3 family - Type 1for theSize family, selectmyHostGroupfor theHost groupand then select1for theFault domain. Leave the defaults for the rest of the fields.
Leave theAutomatically replace host on failuresettingEnabledto automatically service heal the host in case of any host level failure.
When you're done, selectReview + createand wait for validation.
Once you see theValidation passedmessage, selectCreateto create the host.
Useaz vm host createto create a host. If you set a fault domain count for your host group, you'll be asked to specify the fault domain for your host.
az vm host create \
   --host-group myHostGroup \
   --name myHost \
   --sku DSv3-Type1 \
   --platform-fault-domain 1 \
   --auto-replace true \
   -g myDHResourceGroup
az vm host create \
   --host-group myHostGroup \
   --name myHost \
   --sku DSv3-Type1 \
   --platform-fault-domain 1 \
   --auto-replace true \
   -g myDHResourceGroup
In this example, we useNew-AzHostto create a host and set the fault domain to 1.
$dHost = New-AzHost `
   -HostGroupName $hostGroup.Name `
   -Location $location -Name myHost `
   -ResourceGroupName $rgName `
   -Sku DSv3-Type1 `
   -AutoReplaceOnFailure True `
   -PlatformFaultDomain 1
$dHost = New-AzHost `
   -HostGroupName $hostGroup.Name `
   -Location $location -Name myHost `
   -ResourceGroupName $rgName `
   -Sku DSv3-Type1 `
   -AutoReplaceOnFailure True `
   -PlatformFaultDomain 1
Create a VM
Now create a VM on the host.
If you would like to create a VM with ultra disks support, make sure the host group in which the VM will be placed is ultra SSD enabled. Once you've confirmed, create the VM in the same host group. SeeDeploy an ultra diskfor the steps to attach an ultra disk to a VM.
Portal
CLI
PowerShell
ChooseCreate a resourcein the upper left corner of the Azure portal.
In the search box above the list of Azure Marketplace resources, search for and select the image you want use, then chooseCreate.
In theBasicstab, underProject details, make sure the correct subscription is selected and then selectmyDedicatedHostsRGas theResource group.
UnderInstance details, typemyVMfor theVirtual machine nameand chooseEast USfor yourLocation.
InAvailability optionsselectAvailability zone, select1from the drop-down.
For the size, selectChange size. In the list of available sizes, choose one from the Esv3 series, likeStandard E2s v3. You may need to clear the filter in order to see all of the available sizes.
Complete the rest of the fields on theBasicstab as needed.
If you want to specify which host to use for your VM, then at the top of the page, select theAdvancedtab and in theHostsection, selectmyHostGroupforHost groupandmyHostfor theHost. Otherwise, your VM will automatically be placed on a host with capacity.
Leave the remaining defaults and then select theReview + createbutton at the bottom of the page.
When you see the message that validation has passed, selectCreate.
It will take a few minutes for your VM to be deployed.
Create a virtual machine within a dedicated host usingaz vm create. If you specified an availability zone when creating your host group, you're required to use the same zone when creating the virtual machine. Replace the values like image and host name with your own. If you're creating a Windows VM, remove--generate-ssh-keysto be prompted for a password.
--generate-ssh-keys
az vm create \
   -n myVM \
   --image myImage \
   --host-group myHostGroup \
   --admin-username azureuser \
   --generate-ssh-keys \
   --size Standard_D4s_v3 \
   -g myDHResourceGroup \
   --zone 1
az vm create \
   -n myVM \
   --image myImage \
   --host-group myHostGroup \
   --admin-username azureuser \
   --generate-ssh-keys \
   --size Standard_D4s_v3 \
   -g myDHResourceGroup \
   --zone 1
To place the VM on a specific host, use--hostinstead of specifying the host group with--host-group.
--host
--host-group
Warning
If you create a virtual machine on a host which does not have enough resources, the virtual machine will be created in a FAILED state.
Create a new VM on our host usingNew-AzVMFor this example, because our host group is in zone 1, we need to create the VM in zone 1.
New-AzVM `
   -Credential $cred `
   -ResourceGroupName $rgName `
   -Location $location `
   -Name myVM `
   -HostId $dhost.Id `
   -Image myImage `
   -Zone 1 `
   -Size Standard_D4s_v3
New-AzVM `
   -Credential $cred `
   -ResourceGroupName $rgName `
   -Location $location `
   -Name myVM `
   -HostId $dhost.Id `
   -Image myImage `
   -Zone 1 `
   -Size Standard_D4s_v3
Warning
If you create a virtual machine on a host which does not have enough resources, the virtual machine will be created in a FAILED state.
Create a scale set
You can also create a scale set on your host.
Important
Starting November 2023, VM scale sets created using PowerShell and Azure CLI will default to Flexible Orchestration Mode if no orchestration mode is specified. For more information about this change and what actions you should take, go toBreaking Change for VMSS PowerShell/CLI Customers - Microsoft Community Hub
Portal
CLI
PowerShell
When you deploy a scale set, you specify the host group.
Search forScale setand selectVirtual machine scale setsfrom the list.
SelectAddto create a new scale set.
Complete the fields on theBasicstab as you usually would, but make sure you select a VM size that is from the series you chose for your dedicated host, likeStandard E2s v3.
On theAdvancedtab, forSpreading algorithmselectMax spreading.
InHost group, select the host group from the drop-down. If you recently created the group, it might take a minute to get added to the list.
When you deploy a scale set usingaz vmss create, you specify the host group using--host-group. In this example, we're deploying a Linux image. To deploy a Windows image, replace the value of--imageand remove--generate-ssh-keysto be prompted for a password.
--host-group
--image
--generate-ssh-keys
az vmss create \
  --resource-group myResourceGroup \
  --name myScaleSet \
  --image myImage \
  --orchestration-mode uniform \
  --upgrade-policy-mode automatic \
  --admin-username azureuser \
  --host-group myHostGroup \
  --generate-ssh-keys \
  --size Standard_D4s_v3 \
  -g myDHResourceGroup \
  --zone 1
az vmss create \
  --resource-group myResourceGroup \
  --name myScaleSet \
  --image myImage \
  --orchestration-mode uniform \
  --upgrade-policy-mode automatic \
  --admin-username azureuser \
  --host-group myHostGroup \
  --generate-ssh-keys \
  --size Standard_D4s_v3 \
  -g myDHResourceGroup \
  --zone 1
If you want to manually choose which host to deploy the scale set to, add--hostand the name of the host.
--host
Deploy a scale-set to the host usingNew-AzVMSS. When you deploy a scale set, you specify the host group.
New-AzVmss `
  -ResourceGroupName "myResourceGroup" `
  -Location "EastUS" `
  -VMScaleSetName "myDHScaleSet" `
  -VirtualNetworkName "myVnet" `
  -SubnetName "mySubnet" `
  -PublicIpAddressName "myPublicIPAddress" `
  -LoadBalancerName "myLoadBalancer" `
  -OrchestrationMode 'Uniform' `
  -UpgradePolicyMode "Automatic"`
  -HostGroupId $hostGroup.Id
New-AzVmss `
  -ResourceGroupName "myResourceGroup" `
  -Location "EastUS" `
  -VMScaleSetName "myDHScaleSet" `
  -VirtualNetworkName "myVnet" `
  -SubnetName "mySubnet" `
  -PublicIpAddressName "myPublicIPAddress" `
  -LoadBalancerName "myLoadBalancer" `
  -OrchestrationMode 'Uniform' `
  -UpgradePolicyMode "Automatic"`
  -HostGroupId $hostGroup.Id
If you want to manually choose which host to deploy the scale set to, add--hostand the name of the host.
--host
Reassign an existing VM
You can reassign an existing multitenant VM or dedicated host VM to a different dedicated host, but the VM must first be Stop\Deallocated. Before you move a VM to a dedicated host, make sure that the VM configuration is supported:
The VM size must be in the same size family as the dedicated host. For example, if your dedicated host is DSv3, then the VM size could be Standard_D4s_v3, but it couldn't be a Standard_A4_v2.
The VM size must be in the same size family as the dedicated host. For example, if your dedicated host is DSv3, then the VM size could be Standard_D4s_v3, but it couldn't be a Standard_A4_v2.
The VM needs to be located in same region as the dedicated host.
The VM needs to be located in same region as the dedicated host.
The VM can't be part of a proximity placement group. Remove the VM from the proximity placement group before moving it to a dedicated host. For more information about this topic, seeMove a VM out of a proximity placement group.
The VM can't be part of a proximity placement group. Remove the VM from the proximity placement group before moving it to a dedicated host. For more information about this topic, seeMove a VM out of a proximity placement group.
The VM can't be in an availability set.
The VM can't be in an availability set.
If the VM is in an availability zone, it must be the same availability zone as the host group. The availability zone settings for the VM and the host group must match.
If the VM is in an availability zone, it must be the same availability zone as the host group. The availability zone settings for the VM and the host group must match.
Portal
CLI
PowerShell
Move the VM to a dedicated host using theportal.
Open the page for the VM.
SelectStopto stop\deallocate the VM.
SelectConfigurationfrom the left menu.
Select a host group and a host from the drop-down menus.
When you're done, selectSaveat the top of the page.
After the VM has been added to the host, selectOverviewfrom the left menu.
At the top of the page, selectStartto restart the VM.
Move the existing VM to a dedicated host using the CLI. The VM must be Stop/Deallocated usingaz vm deallocatein order to assign it to a dedicated host.
Replace the values with your own information.
az vm deallocate -n myVM -g myResourceGroup
az vm update - n myVM -g myResourceGroup --host myHost
az vm start -n myVM -g myResourceGroup
az vm deallocate -n myVM -g myResourceGroup
az vm update - n myVM -g myResourceGroup --host myHost
az vm start -n myVM -g myResourceGroup
For automatically placed VMs, only update the host group. For more information about this topic, seeManual vs. automatic placement.
Replace the values with your own information.
az vm deallocate -n myVM -g myResourceGroup
az vm update -n myVM -g myResourceGroup --host-group myHostGroup
az vm start -n myVM -g myResourceGroup
az vm deallocate -n myVM -g myResourceGroup
az vm update -n myVM -g myResourceGroup --host-group myHostGroup
az vm start -n myVM -g myResourceGroup
Replace the values of the variables with your own information.
$vmRGName = "movetohost"
$vmName = "myVMtoHost"
$dhRGName = "myDHResourceGroup"
$dhGroupName = "myHostGroup"
$dhName = "myHost"

$myDH = Get-AzHost `
   -HostGroupName $dhGroupName `
   -ResourceGroupName $dhRGName `
   -Name $dhName

$myVM = Get-AzVM `
   -ResourceGroupName $vmRGName `
   -Name $vmName

$myVM.Host = New-Object Microsoft.Azure.Management.Compute.Models.SubResource

$myVM.Host.Id = "$myDH.Id"

Stop-AzVM `
   -ResourceGroupName $vmRGName `
   -Name $vmName -Force

Update-AzVM `
   -ResourceGroupName $vmRGName `
   -VM $myVM -Debug

Start-AzVM `
   -ResourceGroupName $vmRGName `
   -Name $vmName
$vmRGName = "movetohost"
$vmName = "myVMtoHost"
$dhRGName = "myDHResourceGroup"
$dhGroupName = "myHostGroup"
$dhName = "myHost"

$myDH = Get-AzHost `
   -HostGroupName $dhGroupName `
   -ResourceGroupName $dhRGName `
   -Name $dhName

$myVM = Get-AzVM `
   -ResourceGroupName $vmRGName `
   -Name $vmName

$myVM.Host = New-Object Microsoft.Azure.Management.Compute.Models.SubResource

$myVM.Host.Id = "$myDH.Id"

Stop-AzVM `
   -ResourceGroupName $vmRGName `
   -Name $vmName -Force

Update-AzVM `
   -ResourceGroupName $vmRGName `
   -VM $myVM -Debug

Start-AzVM `
   -ResourceGroupName $vmRGName `
   -Name $vmName
Move a VM from dedicated host to multitenant infrastructure
You can move a VM that is running on a dedicated host to multitenant infrastructure, but the VM must first be Stop\Deallocated.
Make sure that your subscription has sufficient vCPU quota for the VM in the region where
Your multitenant VM will be scheduled in the same region and zone as the dedicated host
Portal
CLI
PowerShell
Move a VM from dedicated host to multitenant infrastructure using theportal.
Open the page for the VM.
SelectStopto stop\deallocate the VM.
SelectConfigurationfrom the left menu.
SelectNoneunder host group drop-down menu.
When you're done, selectSaveat the top of the page.
After the VM has been reconfigured as a multitenant VM, selectOverviewfrom the left menu.
At the top of the page, selectStartto restart the VM.
Move a VM from dedicated host to multitenant infrastructure using the CLI. The VM must be Stop/Deallocated usingaz vm deallocatein order to assign it to reconfigure it as a multitenant VM.
Replace the values with your own information.
az vm deallocate -n myVM -g myResourceGroup
az vm update -n myVM -g myResourceGroup --set host.id=None
az vm start -n myVM -g myResourceGroup
az vm deallocate -n myVM -g myResourceGroup
az vm update -n myVM -g myResourceGroup --set host.id=None
az vm start -n myVM -g myResourceGroup
Move a VM from dedicated host to multitenant infrastructure using the PowerShell.
Replace the values of the variables with your own information.
$vmRGName = "moveoffhost"
$vmName = "myDHVM"
$dhRGName = "myDHResourceGroup"
$dhGroupName = "myHostGroup"
$dhName = "myHost"

$myDH = Get-AzHost `
   -HostGroupName $dhGroupName `
   -ResourceGroupName $dhRGName `
   -Name $dhName

$myVM = Get-AzVM `
   -ResourceGroupName $vmRGName `
   -Name $vmName

Stop-AzVM `
   -ResourceGroupName $vmRGName `
   -Name $vmName -Force

Update-AzVM `
   -ResourceGroupName $vmRGName `
   -VM $myVM `
   -HostId ''

Start-AzVM `
   -ResourceGroupName $vmRGName `
   -Name $vmName
$vmRGName = "moveoffhost"
$vmName = "myDHVM"
$dhRGName = "myDHResourceGroup"
$dhGroupName = "myHostGroup"
$dhName = "myHost"

$myDH = Get-AzHost `
   -HostGroupName $dhGroupName `
   -ResourceGroupName $dhRGName `
   -Name $dhName

$myVM = Get-AzVM `
   -ResourceGroupName $vmRGName `
   -Name $vmName

Stop-AzVM `
   -ResourceGroupName $vmRGName `
   -Name $vmName -Force

Update-AzVM `
   -ResourceGroupName $vmRGName `
   -VM $myVM `
   -HostId ''

Start-AzVM `
   -ResourceGroupName $vmRGName `
   -Name $vmName
Check the status of the host
If you need to know how much capacity is still available on a how, you can check the status.
Portal
CLI
PowerShell
Search for and select the host.
In theOverviewpage for the host, scroll down to see the list of sizes still available for the host. It should look similar to:

You can check the host health status and how many virtual machines you can still deploy to the host usingaz vm host get-instance-view.
az vm host get-instance-view \
   -g myDHResourceGroup \
   --host-group myHostGroup \
   --name myHost
az vm host get-instance-view \
   -g myDHResourceGroup \
   --host-group myHostGroup \
   --name myHost
The output will look similar to the below example:
{
  "autoReplaceOnFailure": true,
  "hostId": "6de80643-0f45-4e94-9a4c-c49d5c777b62",
  "id": "/subscriptions/10101010-1010-1010-1010-101010101010/resourceGroups/myDHResourceGroup/providers/Microsoft.Compute/hostGroups/myHostGroup/hosts/myHost",
  "instanceView": {
    "assetId": "12345678-1234-1234-abcd-abc123456789",
    "availableCapacity": {
      "allocatableVms": [
        {
          "count": 31.0,
          "vmSize": "Standard_D2s_v3"
        },
        {
          "count": 15.0,
          "vmSize": "Standard_D4s_v3"
        },
        {
          "count": 7.0,
          "vmSize": "Standard_D8s_v3"
        },
        {
          "count": 3.0,
          "vmSize": "Standard_D16s_v3"
        },
        {
          "count": 1.0,
          "vmSize": "Standard_D32-8s_v3"
        },
        {
          "count": 1.0,
          "vmSize": "Standard_D32-16s_v3"
        },
        {
          "count": 1.0,
          "vmSize": "Standard_D32s_v3"
        },
        {
          "count": 1.0,
          "vmSize": "Standard_D48s_v3"
        },
        {
          "count": 0.0,
          "vmSize": "Standard_D64-16s_v3"
        },
        {
          "count": 0.0,
          "vmSize": "Standard_D64-32s_v3"
        },
        {
          "count": 0.0,
          "vmSize": "Standard_D64s_v3"
        }
      ]
    },
    "statuses": [
      {
        "code": "ProvisioningState/succeeded",
        "displayStatus": "Provisioning succeeded",
        "level": "Info",
        "message": null,
        "time": "2019-07-24T21:22:40.604754+00:00"
      },
      {
        "code": "HealthState/available",
        "displayStatus": "Host available",
        "level": "Info",
        "message": null,
        "time": null
      }
    ]
  },
  "licenseType": null,
  "location": "eastus2",
  "name": "myHost",
  "platformFaultDomain": 1,
  "provisioningState": "Succeeded",
  "provisioningTime": "2019-07-24T21:22:40.604754+00:00",
  "resourceGroup": "myDHResourceGroup",
  "sku": {
    "capacity": null,
    "name": "DSv3-Type1",
    "tier": null
  },
  "tags": null,
  "type": null,
  "virtualMachines": [
    {
      "id": "/subscriptions/10101010-1010-1010-1010-101010101010/resourceGroups/MYDHRESOURCEGROUP/providers/Microsoft.Compute/virtualMachines/MYVM",
      "resourceGroup": "MYDHRESOURCEGROUP"
    }
  ]
}
{
  "autoReplaceOnFailure": true,
  "hostId": "6de80643-0f45-4e94-9a4c-c49d5c777b62",
  "id": "/subscriptions/10101010-1010-1010-1010-101010101010/resourceGroups/myDHResourceGroup/providers/Microsoft.Compute/hostGroups/myHostGroup/hosts/myHost",
  "instanceView": {
    "assetId": "12345678-1234-1234-abcd-abc123456789",
    "availableCapacity": {
      "allocatableVms": [
        {
          "count": 31.0,
          "vmSize": "Standard_D2s_v3"
        },
        {
          "count": 15.0,
          "vmSize": "Standard_D4s_v3"
        },
        {
          "count": 7.0,
          "vmSize": "Standard_D8s_v3"
        },
        {
          "count": 3.0,
          "vmSize": "Standard_D16s_v3"
        },
        {
          "count": 1.0,
          "vmSize": "Standard_D32-8s_v3"
        },
        {
          "count": 1.0,
          "vmSize": "Standard_D32-16s_v3"
        },
        {
          "count": 1.0,
          "vmSize": "Standard_D32s_v3"
        },
        {
          "count": 1.0,
          "vmSize": "Standard_D48s_v3"
        },
        {
          "count": 0.0,
          "vmSize": "Standard_D64-16s_v3"
        },
        {
          "count": 0.0,
          "vmSize": "Standard_D64-32s_v3"
        },
        {
          "count": 0.0,
          "vmSize": "Standard_D64s_v3"
        }
      ]
    },
    "statuses": [
      {
        "code": "ProvisioningState/succeeded",
        "displayStatus": "Provisioning succeeded",
        "level": "Info",
        "message": null,
        "time": "2019-07-24T21:22:40.604754+00:00"
      },
      {
        "code": "HealthState/available",
        "displayStatus": "Host available",
        "level": "Info",
        "message": null,
        "time": null
      }
    ]
  },
  "licenseType": null,
  "location": "eastus2",
  "name": "myHost",
  "platformFaultDomain": 1,
  "provisioningState": "Succeeded",
  "provisioningTime": "2019-07-24T21:22:40.604754+00:00",
  "resourceGroup": "myDHResourceGroup",
  "sku": {
    "capacity": null,
    "name": "DSv3-Type1",
    "tier": null
  },
  "tags": null,
  "type": null,
  "virtualMachines": [
    {
      "id": "/subscriptions/10101010-1010-1010-1010-101010101010/resourceGroups/MYDHRESOURCEGROUP/providers/Microsoft.Compute/virtualMachines/MYVM",
      "resourceGroup": "MYDHRESOURCEGROUP"
    }
  ]
}
You can check the host health status and how many virtual machines you can still deploy to the host usingGet-AzHostwith the-InstanceViewparameter.
-InstanceView
Get-AzHost `
   -ResourceGroupName $rgName `
   -Name myHost `
   -HostGroupName $hostGroup.Name `
   -InstanceView
Get-AzHost `
   -ResourceGroupName $rgName `
   -Name myHost `
   -HostGroupName $hostGroup.Name `
   -InstanceView
The output will look similar to the below example:
ResourceGroupName      : myDHResourceGroup
PlatformFaultDomain    : 1
AutoReplaceOnFailure   : True
HostId                 : 12345678-1234-1234-abcd-abc123456789
ProvisioningTime       : 7/28/2019 5:31:01 PM
ProvisioningState      : Succeeded
InstanceView           :
  AssetId              : abc45678-abcd-1234-abcd-123456789abc
  AvailableCapacity    :
    AllocatableVMs[0]  :
      VmSize           : Standard_D2s_v3
      Count            : 32
    AllocatableVMs[1]  :
      VmSize           : Standard_D4s_v3
      Count            : 16
    AllocatableVMs[2]  :
      VmSize           : Standard_D8s_v3
      Count            : 8
    AllocatableVMs[3]  :
      VmSize           : Standard_D16s_v3
      Count            : 4
    AllocatableVMs[4]  :
      VmSize           : Standard_D32-8s_v3
      Count            : 2
    AllocatableVMs[5]  :
      VmSize           : Standard_D32-16s_v3
      Count            : 2
    AllocatableVMs[6]  :
      VmSize           : Standard_D32s_v3
      Count            : 2
    AllocatableVMs[7]  :
      VmSize           : Standard_D64-16s_v3
      Count            : 1
    AllocatableVMs[8]  :
      VmSize           : Standard_D64-32s_v3
      Count            : 1
    AllocatableVMs[9]  :
      VmSize           : Standard_D64s_v3
      Count            : 1
  Statuses[0]          :
    Code               : ProvisioningState/succeeded
    Level              : Info
    DisplayStatus      : Provisioning succeeded
    Time               : 7/28/2019 5:31:01 PM
  Statuses[1]          :
    Code               : HealthState/available
    Level              : Info
    DisplayStatus      : Host available
Sku                    :
  Name                 : DSv3-Type1
Id                     : /subscriptions/10101010-1010-1010-1010-101010101010/re
sourceGroups/myDHResourceGroup/providers/Microsoft.Compute/hostGroups/myHostGroup/hosts
/myHost
Name                   : myHost
Location               : eastus
Tags                   : {}
ResourceGroupName      : myDHResourceGroup
PlatformFaultDomain    : 1
AutoReplaceOnFailure   : True
HostId                 : 12345678-1234-1234-abcd-abc123456789
ProvisioningTime       : 7/28/2019 5:31:01 PM
ProvisioningState      : Succeeded
InstanceView           :
  AssetId              : abc45678-abcd-1234-abcd-123456789abc
  AvailableCapacity    :
    AllocatableVMs[0]  :
      VmSize           : Standard_D2s_v3
      Count            : 32
    AllocatableVMs[1]  :
      VmSize           : Standard_D4s_v3
      Count            : 16
    AllocatableVMs[2]  :
      VmSize           : Standard_D8s_v3
      Count            : 8
    AllocatableVMs[3]  :
      VmSize           : Standard_D16s_v3
      Count            : 4
    AllocatableVMs[4]  :
      VmSize           : Standard_D32-8s_v3
      Count            : 2
    AllocatableVMs[5]  :
      VmSize           : Standard_D32-16s_v3
      Count            : 2
    AllocatableVMs[6]  :
      VmSize           : Standard_D32s_v3
      Count            : 2
    AllocatableVMs[7]  :
      VmSize           : Standard_D64-16s_v3
      Count            : 1
    AllocatableVMs[8]  :
      VmSize           : Standard_D64-32s_v3
      Count            : 1
    AllocatableVMs[9]  :
      VmSize           : Standard_D64s_v3
      Count            : 1
  Statuses[0]          :
    Code               : ProvisioningState/succeeded
    Level              : Info
    DisplayStatus      : Provisioning succeeded
    Time               : 7/28/2019 5:31:01 PM
  Statuses[1]          :
    Code               : HealthState/available
    Level              : Info
    DisplayStatus      : Host available
Sku                    :
  Name                 : DSv3-Type1
Id                     : /subscriptions/10101010-1010-1010-1010-101010101010/re
sourceGroups/myDHResourceGroup/providers/Microsoft.Compute/hostGroups/myHostGroup/hosts
/myHost
Name                   : myHost
Location               : eastus
Tags                   : {}
Restart a host
Restarting a host does not completely power off the host. When the host restarts, the underlying VMs will also restart. The host will remain on the same underlying physical hardware and both the host ID and asset ID will remain the same after the restart. The host SKU will also remain the same after the restart.
Portal
CLI
PowerShell
Search for and select the host.
In the top menu bar, select theRestartbutton.
In theEssentialssection of the Host Resource Pane, Host Status will switch toHost undergoing restartduring the restart.
Once the restart has completed, the Host Status will return toHost available.
Restart the host usingaz vm host restart.
az vm host restart \
 --resource-group myResourceGroup \
 --host-group myHostGroup \
 --name myDedicatedHost
az vm host restart \
 --resource-group myResourceGroup \
 --host-group myHostGroup \
 --name myDedicatedHost
To view the status of the restart, you can use theaz vm host get-instance-viewcommand. ThedisplayStatuswill be set toHost undergoing restartduring the restart. Once the restart has completed, the displayStatus will return toHost available.
az vm host get-instance-view --resource-group myResourceGroup --host-group myHostGroup --name myDedicatedHost
az vm host get-instance-view --resource-group myResourceGroup --host-group myHostGroup --name myDedicatedHost
Restart the host using theRestart-AzHostcommand.
Restart-AzHost -ResourceGroupName myResourceGroup -HostGroupName myHostGroup -Name myDedicatedHost
Restart-AzHost -ResourceGroupName myResourceGroup -HostGroupName myHostGroup -Name myDedicatedHost
To view the status of the restart, you can use theGet-AzHostcommandlet using theInstanceViewparameter. ThedisplayStatuswill be set toHost undergoing restartduring the restart. Once the restart has completed, the displayStatus will return toHost available.
$hostRestartStatus = Get-AzHost -ResourceGroupName myResourceGroup -HostGroupName myHostGroup -Name myDedicatedHost -InstanceView;
$hostRestartStatus.InstanceView.Statuses[1].DisplayStatus;
$hostRestartStatus = Get-AzHost -ResourceGroupName myResourceGroup -HostGroupName myHostGroup -Name myDedicatedHost -InstanceView;
$hostRestartStatus.InstanceView.Statuses[1].DisplayStatus;
Resize a host
Moving a host and all associated VMs to newer generation hardware can be done through the host resize feature. Resize simplifies the migration process and avoids having to manually create new hosts and move all VMs individually.
Resize limitations:
Host can only be resized to an ADH within the same VM family. A Dsv3-Type3 host can be resized to Dsv3-Type4 butnotto anEsv3-Type4.
You can only resize to newer generation of hardware. A Dsv3-Type3 host can be resized to Dsv3-Type4 butnotDsv3-Type2.
Resizing changes the 'Host Asset ID'. The 'Host ID' remains the same.
The host and all associated VMs become unavailable during the resize operation.
Warning
The resize operation causes the loss of any non-persistent data such as temp disk data. Save all your work to persistent data storage before triggering resize.
Note
If the source host is already running on the latest hardware, 'Size' page would display an empty list. If you're looking for enhanced performance, consider switching to a different VM family.
Portal
CLI
PowerShell
Search for and select the host.
In the left menu underSettings, selectSize.
Once on the size page from the list of SKUs, select the desired SKU to resize to.
Selecting a target size from the list would enableResizebutton on the bottom on the page.
ClickResize, host's 'Provisioning State' changes from 'Provisioning Succeeded' to 'Updating'
Once the resizing is complete, the host's 'Provisioning State' reverts to 'Provisioning Succeeded'
First list the sizes that you can resize in case you're unsure which to resize to.
Useaz vm host list-resize-options.
az vm host list-resize-options \
 --host-group myHostGroup \
 --host-name myHost \
 --resource-group myResourceGroup
az vm host list-resize-options \
 --host-group myHostGroup \
 --host-name myHost \
 --resource-group myResourceGroup
Resize the host usingaz vm host resize.
az vm host resize \
 --host-group myHostGroup \
 --host-name myHost \
 --resource-group myResourceGroup \
 --sku Dsv3-Type4
az vm host resize \
 --host-group myHostGroup \
 --host-name myHost \
 --resource-group myResourceGroup \
 --sku Dsv3-Type4
When using PowerShell, the resize feature is referred to as a host 'Update'. Use the following commands to update the host:
Update-AzHost
      [-ResourceGroupName] <String>
      [-HostGroupName] <String>
      [-Name] <String>
      [-Sku <String>]
      [-AutoReplaceOnFailure <Boolean>]
      [-LicenseType <DedicatedHostLicenseTypes>]
      [-DefaultProfile <IAzureContextContainer>]
      [-WhatIf]
      [-Confirm]
      [<CommonParameters>]
Update-AzHost
      [-ResourceGroupName] <String>
      [-HostGroupName] <String>
      [-Name] <String>
      [-Sku <String>]
      [-AutoReplaceOnFailure <Boolean>]
      [-LicenseType <DedicatedHostLicenseTypes>]
      [-DefaultProfile <IAzureContextContainer>]
      [-WhatIf]
      [-Confirm]
      [<CommonParameters>]
For more info on Update-AzHost, check out theUpdate-AzHost reference docs.
Redeploy a host [Preview]
If a VM or the underlying host remains unresponsive after following all the potential troubleshooting steps users can trigger service healing of the host and not wait for the platform to initiate the repair. Redeploying a host will move the host and all associated VMs to a different node of the same SKU. None of the host parameters would change except for the âHost asset IDâ, which corresponds to the underlying Node Id.
Warning
Redeploy operation involves service healing hence would result in loss of any non-persistent data such as data stored on ephemeral disks. Save your work before redeploying.
Portal
CLI
PowerShell
Search for and select the host.
In the top menu bar, select theRedeploybutton.
In theEssentialssection of the Host Resource Pane, host's provisioning state will switch toUpdatingduring the redeploy operation.
Once the redeploy operation is completed, host's provisioning state will revert toProvisioning succeeded.
In theEssentialssection of the Host Resource Pane,Host asset IDwould be updated to a new ID
Redeploying the host usingaz vm host redeploy.
az vm host redeploy \
 --resource-group myResourceGroup \
 --host-group myHostGroup \
 --name myDedicatedHost
az vm host redeploy \
 --resource-group myResourceGroup \
 --host-group myHostGroup \
 --name myDedicatedHost
PowerShell support coming soon.
Deleting a host
You're being charged for your dedicated host even when no virtual machines are deployed on the host. You should delete any hosts you're currently not using to save costs.
You can only delete a host when there are no any longer virtual machines using it.
Portal
CLI
PowerShell
Search for and select the host.
In the left menu, selectInstances.
Select and delete each virtual machine.
When all of the VMs have been deleted, go back to theOverviewpage for the host and selectDeletefrom the top menu.
Once the host has been deleted, open the page for the host group and selectDelete host group.
Delete the VMs usingaz vm delete.
az vm delete -n myVM -g myDHResourceGroup
az vm delete -n myVM -g myDHResourceGroup
After deleting the VMs, you can delete the host usingaz vm host delete.
az vm host delete -g myDHResourceGroup --host-group myHostGroup --name myHost
az vm host delete -g myDHResourceGroup --host-group myHostGroup --name myHost
Once you've deleted all of your hosts, you may delete the host group usingaz vm host group delete.
az vm host group delete -g myDHResourceGroup --host-group myHostGroup
az vm host group delete -g myDHResourceGroup --host-group myHostGroup
You can also delete the entire resource group in a single command. The following command will delete all resources created in the group, including all of the VMs, hosts and host groups.
az group delete -n myDHResourceGroup
az group delete -n myDHResourceGroup
Delete the VMs usingRemove-AzVM.
Remove-AzVM -ResourceGroupName $rgName -Name myVM
Remove-AzVM -ResourceGroupName $rgName -Name myVM
After deleting the VMs, you can delete the host usingRemove-AzHost.
Remove-AzHost -ResourceGroupName $rgName -Name myHost
Remove-AzHost -ResourceGroupName $rgName -Name myHost
Once you've deleted all of your hosts, you may delete the host group usingRemove-AzHostGroup.
Remove-AzHost -ResourceGroupName $rgName -Name myHost
Remove-AzHost -ResourceGroupName $rgName -Name myHost
You can also delete the entire resource group in a single command usingRemove-AzResourceGroup. This following command will delete all resources created in the group, including all of the VMs, hosts and host groups.
Remove-AzResourceGroup -Name $rgName
Remove-AzResourceGroup -Name $rgName
Next steps
For more information about this topic, see theDedicated hostsoverview.
For more information about this topic, see theDedicated hostsoverview.
There's sample template, available atAzure Quickstart Templates, which uses both zones and fault domains for maximum resiliency in a region.
There's sample template, available atAzure Quickstart Templates, which uses both zones and fault domains for maximum resiliency in a region.
Feedback
Was this page helpful?
Additional resources