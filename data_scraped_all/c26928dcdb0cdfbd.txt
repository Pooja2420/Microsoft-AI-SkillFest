Note
Access to this page requires authorization. You can trysigning inorchanging directories.
Access to this page requires authorization. You can trychanging directories.
Create and manage Active Directory connections for Azure NetApp Files
Article
2025-02-21
11 contributors
In this article
Several features of Azure NetApp Files require that you have an Active Directory connection. For example, you need to have an Active Directory connection before you can create anSMB volume, aNFSv4.1 Kerberos volume, or adual-protocol volume. This article shows you how to create and manage Active Directory connections for Azure NetApp Files.
Requirements and considerations for Active Directory connections
Important
You must follow guidelines described inUnderstand guidelines for Active Directory Domain Services site design and planning for Azure NetApp Filesfor Active Directory Domain Services (AD DS) or Microsoft Entra Domain Services used with Azure NetApp Files.
Before creating the AD connection, reviewModify Active Directory connections for Azure NetApp Filesto understand the impact of making changes to the AD connection configuration options after the AD connection has been created. Changes to the AD connection configuration options are disruptive to client access and some options cannot be changed at all.
An Azure NetApp Files account must be created in the region where the Azure NetApp Files volumes are to be deployed.
An Azure NetApp Files account must be created in the region where the Azure NetApp Files volumes are to be deployed.
By default, Azure NetApp Files allows only one Active Directory (AD) connection per subscription.You cancreate one Active Directory connection per NetApp account.Before enrolling in this feature, check theActive Directory typefield in your account page.
By default, Azure NetApp Files allows only one Active Directory (AD) connection per subscription.
You cancreate one Active Directory connection per NetApp account.
Before enrolling in this feature, check theActive Directory typefield in your account page.
The Azure NetApp Files AD connection admin account must have the following properties:It must be an AD DS domain user account in the same domain where the Azure NetApp Files computer accounts are created.It must have the permission to create computer accounts (for example, AD domain join) in the AD DS organizational unit path specified in theOrganizational unit path optionof the AD connection.It cannot be aGroup Managed Service Account.
The Azure NetApp Files AD connection admin account must have the following properties:
It must be an AD DS domain user account in the same domain where the Azure NetApp Files computer accounts are created.
It must have the permission to create computer accounts (for example, AD domain join) in the AD DS organizational unit path specified in theOrganizational unit path optionof the AD connection.
It cannot be aGroup Managed Service Account.
The AD connection admin account supports Kerberos AES-128 and Kerberos AES-256 encryption types for authentication with AD DS for Azure NetApp Files computer account creation (for example, AD domain join operations).
The AD connection admin account supports Kerberos AES-128 and Kerberos AES-256 encryption types for authentication with AD DS for Azure NetApp Files computer account creation (for example, AD domain join operations).
To enable the AES encryption on the Azure NetApp Files AD connection admin account, you must use an AD domain user account that is a member of one of the following AD DS groups:Domain AdminsEnterprise AdminsAdministratorsAccount OperatorsMicrosoft Entra Domain Services Administrators _ (Microsoft Entra Domain Services Only)_Alternatively, an AD domain user account withmsDS-SupportedEncryptionTypeswrite permission on the AD connection admin account can also be used to set the Kerberos encryption type property on the AD connection admin account.NoteWhen you modify the setting to enable AES on the AD connection admin account, it is a best practice to use a user account that has write permission to the AD object that is not the Azure NetApp Files AD admin. You can do so with another domain admin account or by delegating control to an account. For more information, seeDelegating Administration by Using OU Objects.If you set both AES-128 and AES-256 Kerberos encryption on the admin account of the AD connection, the Windows client negotiates the highest level of encryption supported by your AD DS. For example, if both AES-128 and AES-256 are supported, and the client supports AES-256, then AES-256 will be used.
To enable the AES encryption on the Azure NetApp Files AD connection admin account, you must use an AD domain user account that is a member of one of the following AD DS groups:
Domain Admins
Enterprise Admins
Administrators
Account Operators
Microsoft Entra Domain Services Administrators _ (Microsoft Entra Domain Services Only)_
Alternatively, an AD domain user account withmsDS-SupportedEncryptionTypeswrite permission on the AD connection admin account can also be used to set the Kerberos encryption type property on the AD connection admin account.
msDS-SupportedEncryptionTypes
Note
When you modify the setting to enable AES on the AD connection admin account, it is a best practice to use a user account that has write permission to the AD object that is not the Azure NetApp Files AD admin. You can do so with another domain admin account or by delegating control to an account. For more information, seeDelegating Administration by Using OU Objects.
If you set both AES-128 and AES-256 Kerberos encryption on the admin account of the AD connection, the Windows client negotiates the highest level of encryption supported by your AD DS. For example, if both AES-128 and AES-256 are supported, and the client supports AES-256, then AES-256 will be used.
To enable AES encryption support for the admin account in the AD connection, run the following Active Directory PowerShell commands:Get-ADUser -Identity <ANF AD connection account username>
Set-ADUser -KerberosEncryptionType <encryption_type>KerberosEncryptionTypeis a multivalued parameter that supports AES-128 and AES-256 values.For more information, refer to theSet-ADUser documentation.
To enable AES encryption support for the admin account in the AD connection, run the following Active Directory PowerShell commands:
Get-ADUser -Identity <ANF AD connection account username>
Set-ADUser -KerberosEncryptionType <encryption_type>
Get-ADUser -Identity <ANF AD connection account username>
Set-ADUser -KerberosEncryptionType <encryption_type>
KerberosEncryptionTypeis a multivalued parameter that supports AES-128 and AES-256 values.
KerberosEncryptionType
For more information, refer to theSet-ADUser documentation.
If you have a requirement to enable and disable certain Kerberos encryption types for Active Directory computer accounts for domain-joined Windows hosts used with Azure NetApp Files, you must use the Group PolicyNetwork Security: Configure Encryption types allowed for Kerberos.Do not set the registry keyHKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System\Kerberos\Parameters\SupportedEncryptionTypes. Doing this will break Kerberos authentication with Azure NetApp Files for the Windows host where this registry key was manually set.NoteThe default policy setting forNetwork Security: Configure Encryption types allowed for KerberosisNot Defined. When this policy setting is set toNot Defined, all encryption types except DES will be available for Kerberos encryption. You have the option to enable support for only certain Kerberos encryption types (for example,AES128_HMAC_SHA1orAES256_HMAC_SHA1). However, the default policy should be sufficient in most cases when enabling AES encryption support with Azure NetApp Files.For more information, refer toNetwork security: Configure encryption types allowed for KerberosorWindows Configurations for Kerberos Supported Encryption Types
If you have a requirement to enable and disable certain Kerberos encryption types for Active Directory computer accounts for domain-joined Windows hosts used with Azure NetApp Files, you must use the Group PolicyNetwork Security: Configure Encryption types allowed for Kerberos.
Network Security: Configure Encryption types allowed for Kerberos
Do not set the registry keyHKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System\Kerberos\Parameters\SupportedEncryptionTypes. Doing this will break Kerberos authentication with Azure NetApp Files for the Windows host where this registry key was manually set.
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System\Kerberos\Parameters\SupportedEncryptionTypes
Note
The default policy setting forNetwork Security: Configure Encryption types allowed for KerberosisNot Defined. When this policy setting is set toNot Defined, all encryption types except DES will be available for Kerberos encryption. You have the option to enable support for only certain Kerberos encryption types (for example,AES128_HMAC_SHA1orAES256_HMAC_SHA1). However, the default policy should be sufficient in most cases when enabling AES encryption support with Azure NetApp Files.
Network Security: Configure Encryption types allowed for Kerberos
Not Defined
Not Defined
AES128_HMAC_SHA1
AES256_HMAC_SHA1
For more information, refer toNetwork security: Configure encryption types allowed for KerberosorWindows Configurations for Kerberos Supported Encryption Types
LDAP queries take effect only in the domain specified in the Active Directory connections (theAD DNS Domain Namefield). This behavior applies to NFS, SMB, and dual-protocol volumes.
LDAP queries take effect only in the domain specified in the Active Directory connections (theAD DNS Domain Namefield). This behavior applies to NFS, SMB, and dual-protocol volumes.
LDAP query time outsBy default, LDAP queries time out if they cannot be completed in a timely fashion. If an LDAP query fails due to a time out, the user and/or group lookup will fail and access to the Azure NetApp Files volume may be denied, depending on the permission settings of the volume.Query time outs can occur in large LDAP environments with many user and group objects, over slow WAN connections, and if an LDAP server is over-utilized with requests. Azure NetApp Files time-out setting for LDAP queries is set to 10 seconds. Consider leveraging the user and group DN features on the Active Directory Connection for the LDAP server to filter searches if you're experiencing LDAP query time-out issues.
LDAP query time outs
By default, LDAP queries time out if they cannot be completed in a timely fashion. If an LDAP query fails due to a time out, the user and/or group lookup will fail and access to the Azure NetApp Files volume may be denied, depending on the permission settings of the volume.
Query time outs can occur in large LDAP environments with many user and group objects, over slow WAN connections, and if an LDAP server is over-utilized with requests. Azure NetApp Files time-out setting for LDAP queries is set to 10 seconds. Consider leveraging the user and group DN features on the Active Directory Connection for the LDAP server to filter searches if you're experiencing LDAP query time-out issues.
NetApp accounts and Active Directory type
You can use the NetApp account overview page to confirm the Active Directory account type. There are three values for AD type:
NA: Existing NetApp account which supports only one AD configuration per subscription and region. The AD configuration is not shared with other NetApp accounts in the subscription.
Multi AD: NetApp account supports one AD configuration in each NetApp account in the subscription. This allows for more than one AD connection per subscription when using multiple NetApp accounts.
Shared AD: NetApp account supports only one AD configuration per subscription and region, but the configuration is shared across NetApp accounts in the subscription and region.
For more information about the relationship between NetApp accounts and subscriptions, seeStorage hierarchy of Azure NetApp Files.
Create an Active Directory connection
From your NetApp account, selectActive Directory connectionsthenJoin.NoteAzure NetApp Files supports only one Active Directory connection within the same region and the same subscription.
From your NetApp account, selectActive Directory connectionsthenJoin.

Note
Azure NetApp Files supports only one Active Directory connection within the same region and the same subscription.
In the Join Active Directory window, provide the following information, based on the Domain Services you want to use:Primary DNS (required)This is the IP address of the primary DNS server that is required for Active Directory domain join operations, SMB authentication, Kerberos, and LDAP operations.Secondary DNSThis is the IP address of the secondary DNS server that is required for Active Directory domain join operations, SMB authentication, Kerberos, and LDAP operations.NoteIt is recommended that you configure a Secondary DNS server. SeeUnderstand guidelines for Active Directory Domain Services site design and planning for Azure NetApp Files. Ensure that your DNS server configuration meets the requirements for Azure NetApp Files. Otherwise, Azure NetApp Files service operations, SMB authentication, Kerberos, or LDAP operations might fail.If you use Microsoft Entra Domain Services, use the IP addresses of the Microsoft Entra Domain Services domain controllers for Primary DNS and Secondary DNS respectively.AD DNS Domain Name (required)This is the fully qualified domain name of the AD DS used with Azure NetApp Files (for example,contoso.com).AD Site Name (required)This is the AD DS site name that Azure NetApp Files USES for domain controller discovery.The default site name for both AD DS and Microsoft Entra Domain Services isDefault-First-Site-Name. Follow thenaming conventions for site namesif you want to rename the site name.NoteSeeUnderstand guidelines for Active Directory Domain Services site design and planning for Azure NetApp Files. Ensure that your AD DS site design and configuration meets the requirements for Azure NetApp Files. Otherwise, Azure NetApp Files service operations, SMB authentication, Kerberos, or LDAP operations might fail.SMB server (computer account) prefix (required)This is the naming prefix for new computer accounts created in AD DS for Azure NetApp Files SMB, dual protocol, and NFSv4.1 Kerberos volumes.For example, if the naming standard that your organization uses for file services isNAS-01,NAS-02, and so on, then you would useNASfor the prefix.Azure NetApp Files will create additional computer accounts in AD DS as needed.ImportantRenaming the SMB server prefix after you create the Active Directory connection is disruptive. You will need to re-mount existing SMB shares after renaming the SMB server prefix.Organizational unit pathThis is the LDAP path for the organizational unit (OU) where SMB server computer accounts will be created. That is,OU=second level, OU=first level. For example, if you want to use an OU calledANFcreated at the root of the domain, the value would beOU=ANF.If no value is provided, Azure NetApp Files uses theCN=Computerscontainer.If you're using Azure NetApp Files with Microsoft Entra Domain Services, the organizational unit path isOU=AADDC ComputersAES EncryptionThis option enables AES encryption authentication support for the admin account of the AD connection.SeeRequirements for Active Directory connectionsfor requirements.LDAP SigningThis option enables LDAP signing. This functionality enables integrity verification for Simple Authentication and Security Layer (SASL) LDAP binds from Azure NetApp Files and the user-specifiedActive Directory Domain Services domain controllers.Azure NetApp Files supports LDAP Channel Binding if both LDAP Signing and LDAP over TLS settings options are enabled in the Active Directory Connection. For more information, seeADV190023 | Microsoft Guidance for Enabling LDAP Channel Binding and LDAP Signing.NoteDNS PTR records for the AD DS computer account(s) must be created in the AD DSOrganizational Unitspecified in the Azure NetApp Files AD connection for LDAP Signing to work.Allow local NFS users with LDAPThis option enables local NFS client users to access to NFS volumes. Setting this option disables extended groups for NFS volumes, which limits the number of supported groups for a user to 16. When enabled, groups beyond the 16 group limit aren't honored in access permissions. For more information, seeAllow local NFS users with LDAP to access a dual-protocol volume.LDAP over TLSThis option enables LDAP over TLS for secure communication between an Azure NetApp Files volume and the Active Directory LDAP server. You can enable LDAP over TLS for NFS, SMB, and dual-protocol volumes of Azure NetApp Files.NoteLDAP over TLS must not be enabled if you're using Microsoft Entra Domain Services. Microsoft Entra Domain Services uses LDAPS (port 636) to secure LDAP traffic instead of LDAP over TLS (port 389).For more information, seeEnable Active Directory Domain Services (AD DS) LDAP authentication for NFS volumes.Server root CA CertificateThis option uploads the CA certificate used with LDAP over TLS.For more information, seeâ¯Enable Active Directory Domain Services (AD DS) LDAP authentication for NFS volumes.â¯LDAP Search Scope,User DN,Group DN, andGroup Membership FilterTheLDAP search scopeoption optimizes Azure NetApp Files storage LDAP queries for use with large AD DS topologies and LDAP with extended groups or Unix security style with an Azure NetApp Files dual-protocol volume.TheUser DNandGroup DNoptions allow you to set the search base in AD DS LDAP. These options limit the search areas for LDAP queries, reducing the search time and helping to reduce LDAP query time outs.TheGroup Membership Filteroption allows you to create a custom search filter for users who are members of specific AD DS groups.SeeConfigure AD DS LDAP with extended groups for NFS volume accessfor information about these options.Preferred server for LDAP clientThePreferred server for LDAP clientoption allows you to submit the IP addresses of up to two AD servers as a comma-separated list. Rather than sequentially contacting all of the discovered AD services for a domain, the LDAP client will contact the specified servers first.Encrypted SMB connections to Domain ControllerEncrypted SMB connections to Domain Controllerspecifies whether encryption should be used for communication between an SMB server and domain controller. When enabled, only SMB3 will be used for encrypted domain controller connections.This feature is currently in preview. If this is your first time using Encrypted SMB connections to domain controller, you must register it:Register-AzProviderFeature -ProviderNamespace Microsoft.NetApp -FeatureName  ANFEncryptedSMBConnectionsToDCCheck the status of the feature registration:NoteTheRegistrationStatemay be in theRegisteringstate for up to 60 minutes before changing toRegistered. Wait until the status isRegisteredbefore continuing.Get-AzProviderFeature -ProviderNamespace Microsoft.NetApp -FeatureName  ANFEncryptedSMBConnectionsToDCYou can also useAzure CLI commandsaz feature registerandaz feature showto register the feature and display the registration status.Backup policy usersThis option grants addition security privileges to AD DS domain users or groups that require elevated backup privileges to support backup, restore, and migration workflows in Azure NetApp Files. The specified AD DS user accounts or groups will have elevated NTFS permissions at the file or folder level.The following privileges apply when you use theBackup policy userssetting:PrivilegeDescriptionSeBackupPrivilegeBack up files and directories, overriding any ACLs.SeRestorePrivilegeRestore files and directories, overriding any ACLs.Set any valid user or group SID as the file owner.SeChangeNotifyPrivilegeBypass traverse checking.Users with this privilege aren't required to have traversed (x) permissions to traverse folders or symlinks.Security privilege usersThis option grants security privilege (SeSecurityPrivilege) to AD DS domain users or groups that require elevated privileges to access Azure NetApp Files volumes. The specified AD DS users or groups will be allowed to perform certain actions on SMB shares that require security privilege not assigned by default to domain users.The following privilege applies when you use theSecurity privilege userssetting:PrivilegeDescriptionSeSecurityPrivilegeManage log operations.This feature is used for installing SQL Server in certain scenarios where a non-administrator AD DS domain account must temporarily be granted elevated security privilege.NoteUsing the Security privilege users feature relies on theSMB Continuous Availability Shares feature. SMB Continuous Availability isnotsupported on custom applications. It is only supported for workloads using Citrix App Layering,FSLogix user profile containers, and Microsoft SQL Server (not Linux SQL Server).ImportantUsing theSecurity privilege usersfeature requires that you submit a waitlist request through theAzure NetApp Files SMB Continuous Availability Shares Public Preview waitlist submission page. Wait for an official confirmation email from the Azure NetApp Files team before using this feature.This feature is optional and supported only with SQL server. The AD DS domain account used for installing SQL server must already exist before you add it to theSecurity privilege usersoption. When you add the SQL Server installer account toSecurity privilege usersoption, the Azure NetApp Files service might validate the account by contacting an AD DS domain controller. This action might fail if Azure NetApp Files cannot contact the AD DS domain controller.For more information aboutSeSecurityPrivilegeand SQL Server, seeSQL Server installation fails if the Setup account doesn't have certain user rights.Administrators privilege usersThis option grants additional security privileges to AD DS domain users or groups that require elevated privileges to access the Azure NetApp Files volumes. The specified accounts will have elevated permissions at the file or folder level.NoteThe domain admins are automatically added to the Administrators privilege users group.NoteThis privilege is useful for data migrations.The following privileges apply when you use theAdministrators privilege userssetting:PrivilegeDescriptionSeBackupPrivilegeBack up files and directories, overriding any ACLs.SeRestorePrivilegeRestore files and directories, overriding any ACLs.Set any valid user or group SID as the file owner.SeChangeNotifyPrivilegeBypass traverse checking.Users with this privilege aren't required to have traverse (x) permissions to traverse folders or symlinks.SeTakeOwnershipPrivilegeTake ownership of files or other objects.SeSecurityPrivilegeManage log operations.SeChangeNotifyPrivilegeBypass traverse checking.Users with this privilege aren't required to have traverse (x) permissions to traverse folders or symlinks.Credentials, including yourusernameandpasswordImportantAlthough Active Directory supports 256-character passwords, Active Directory passwords with Azure NetApp Filescannotexceed 64 characters.
In the Join Active Directory window, provide the following information, based on the Domain Services you want to use:
Primary DNS (required)This is the IP address of the primary DNS server that is required for Active Directory domain join operations, SMB authentication, Kerberos, and LDAP operations.
Primary DNS (required)This is the IP address of the primary DNS server that is required for Active Directory domain join operations, SMB authentication, Kerberos, and LDAP operations.
Secondary DNSThis is the IP address of the secondary DNS server that is required for Active Directory domain join operations, SMB authentication, Kerberos, and LDAP operations.NoteIt is recommended that you configure a Secondary DNS server. SeeUnderstand guidelines for Active Directory Domain Services site design and planning for Azure NetApp Files. Ensure that your DNS server configuration meets the requirements for Azure NetApp Files. Otherwise, Azure NetApp Files service operations, SMB authentication, Kerberos, or LDAP operations might fail.If you use Microsoft Entra Domain Services, use the IP addresses of the Microsoft Entra Domain Services domain controllers for Primary DNS and Secondary DNS respectively.
Secondary DNSThis is the IP address of the secondary DNS server that is required for Active Directory domain join operations, SMB authentication, Kerberos, and LDAP operations.
Note
It is recommended that you configure a Secondary DNS server. SeeUnderstand guidelines for Active Directory Domain Services site design and planning for Azure NetApp Files. Ensure that your DNS server configuration meets the requirements for Azure NetApp Files. Otherwise, Azure NetApp Files service operations, SMB authentication, Kerberos, or LDAP operations might fail.
If you use Microsoft Entra Domain Services, use the IP addresses of the Microsoft Entra Domain Services domain controllers for Primary DNS and Secondary DNS respectively.
AD DNS Domain Name (required)This is the fully qualified domain name of the AD DS used with Azure NetApp Files (for example,contoso.com).
AD DNS Domain Name (required)This is the fully qualified domain name of the AD DS used with Azure NetApp Files (for example,contoso.com).
contoso.com
AD Site Name (required)This is the AD DS site name that Azure NetApp Files USES for domain controller discovery.The default site name for both AD DS and Microsoft Entra Domain Services isDefault-First-Site-Name. Follow thenaming conventions for site namesif you want to rename the site name.NoteSeeUnderstand guidelines for Active Directory Domain Services site design and planning for Azure NetApp Files. Ensure that your AD DS site design and configuration meets the requirements for Azure NetApp Files. Otherwise, Azure NetApp Files service operations, SMB authentication, Kerberos, or LDAP operations might fail.
AD Site Name (required)This is the AD DS site name that Azure NetApp Files USES for domain controller discovery.
The default site name for both AD DS and Microsoft Entra Domain Services isDefault-First-Site-Name. Follow thenaming conventions for site namesif you want to rename the site name.
Default-First-Site-Name
Note
SeeUnderstand guidelines for Active Directory Domain Services site design and planning for Azure NetApp Files. Ensure that your AD DS site design and configuration meets the requirements for Azure NetApp Files. Otherwise, Azure NetApp Files service operations, SMB authentication, Kerberos, or LDAP operations might fail.
SMB server (computer account) prefix (required)This is the naming prefix for new computer accounts created in AD DS for Azure NetApp Files SMB, dual protocol, and NFSv4.1 Kerberos volumes.For example, if the naming standard that your organization uses for file services isNAS-01,NAS-02, and so on, then you would useNASfor the prefix.Azure NetApp Files will create additional computer accounts in AD DS as needed.ImportantRenaming the SMB server prefix after you create the Active Directory connection is disruptive. You will need to re-mount existing SMB shares after renaming the SMB server prefix.
SMB server (computer account) prefix (required)This is the naming prefix for new computer accounts created in AD DS for Azure NetApp Files SMB, dual protocol, and NFSv4.1 Kerberos volumes.
For example, if the naming standard that your organization uses for file services isNAS-01,NAS-02, and so on, then you would useNASfor the prefix.
NAS-01
NAS-02
NAS
Azure NetApp Files will create additional computer accounts in AD DS as needed.
Important
Renaming the SMB server prefix after you create the Active Directory connection is disruptive. You will need to re-mount existing SMB shares after renaming the SMB server prefix.
Organizational unit pathThis is the LDAP path for the organizational unit (OU) where SMB server computer accounts will be created. That is,OU=second level, OU=first level. For example, if you want to use an OU calledANFcreated at the root of the domain, the value would beOU=ANF.If no value is provided, Azure NetApp Files uses theCN=Computerscontainer.If you're using Azure NetApp Files with Microsoft Entra Domain Services, the organizational unit path isOU=AADDC Computers
Organizational unit pathThis is the LDAP path for the organizational unit (OU) where SMB server computer accounts will be created. That is,OU=second level, OU=first level. For example, if you want to use an OU calledANFcreated at the root of the domain, the value would beOU=ANF.
OU=second level, OU=first level
ANF
OU=ANF
If no value is provided, Azure NetApp Files uses theCN=Computerscontainer.
CN=Computers
If you're using Azure NetApp Files with Microsoft Entra Domain Services, the organizational unit path isOU=AADDC Computers
OU=AADDC Computers

AES EncryptionThis option enables AES encryption authentication support for the admin account of the AD connection.SeeRequirements for Active Directory connectionsfor requirements.
AES EncryptionThis option enables AES encryption authentication support for the admin account of the AD connection.

SeeRequirements for Active Directory connectionsfor requirements.
LDAP SigningThis option enables LDAP signing. This functionality enables integrity verification for Simple Authentication and Security Layer (SASL) LDAP binds from Azure NetApp Files and the user-specifiedActive Directory Domain Services domain controllers.Azure NetApp Files supports LDAP Channel Binding if both LDAP Signing and LDAP over TLS settings options are enabled in the Active Directory Connection. For more information, seeADV190023 | Microsoft Guidance for Enabling LDAP Channel Binding and LDAP Signing.NoteDNS PTR records for the AD DS computer account(s) must be created in the AD DSOrganizational Unitspecified in the Azure NetApp Files AD connection for LDAP Signing to work.
LDAP Signing
This option enables LDAP signing. This functionality enables integrity verification for Simple Authentication and Security Layer (SASL) LDAP binds from Azure NetApp Files and the user-specifiedActive Directory Domain Services domain controllers.
Azure NetApp Files supports LDAP Channel Binding if both LDAP Signing and LDAP over TLS settings options are enabled in the Active Directory Connection. For more information, seeADV190023 | Microsoft Guidance for Enabling LDAP Channel Binding and LDAP Signing.
Note
DNS PTR records for the AD DS computer account(s) must be created in the AD DSOrganizational Unitspecified in the Azure NetApp Files AD connection for LDAP Signing to work.

Allow local NFS users with LDAPThis option enables local NFS client users to access to NFS volumes. Setting this option disables extended groups for NFS volumes, which limits the number of supported groups for a user to 16. When enabled, groups beyond the 16 group limit aren't honored in access permissions. For more information, seeAllow local NFS users with LDAP to access a dual-protocol volume.
Allow local NFS users with LDAPThis option enables local NFS client users to access to NFS volumes. Setting this option disables extended groups for NFS volumes, which limits the number of supported groups for a user to 16. When enabled, groups beyond the 16 group limit aren't honored in access permissions. For more information, seeAllow local NFS users with LDAP to access a dual-protocol volume.
LDAP over TLSThis option enables LDAP over TLS for secure communication between an Azure NetApp Files volume and the Active Directory LDAP server. You can enable LDAP over TLS for NFS, SMB, and dual-protocol volumes of Azure NetApp Files.NoteLDAP over TLS must not be enabled if you're using Microsoft Entra Domain Services. Microsoft Entra Domain Services uses LDAPS (port 636) to secure LDAP traffic instead of LDAP over TLS (port 389).For more information, seeEnable Active Directory Domain Services (AD DS) LDAP authentication for NFS volumes.
LDAP over TLS
This option enables LDAP over TLS for secure communication between an Azure NetApp Files volume and the Active Directory LDAP server. You can enable LDAP over TLS for NFS, SMB, and dual-protocol volumes of Azure NetApp Files.
Note
LDAP over TLS must not be enabled if you're using Microsoft Entra Domain Services. Microsoft Entra Domain Services uses LDAPS (port 636) to secure LDAP traffic instead of LDAP over TLS (port 389).
For more information, seeEnable Active Directory Domain Services (AD DS) LDAP authentication for NFS volumes.
Server root CA CertificateThis option uploads the CA certificate used with LDAP over TLS.For more information, seeâ¯Enable Active Directory Domain Services (AD DS) LDAP authentication for NFS volumes.â¯
Server root CA Certificate
This option uploads the CA certificate used with LDAP over TLS.
For more information, seeâ¯Enable Active Directory Domain Services (AD DS) LDAP authentication for NFS volumes.â¯
LDAP Search Scope,User DN,Group DN, andGroup Membership FilterTheLDAP search scopeoption optimizes Azure NetApp Files storage LDAP queries for use with large AD DS topologies and LDAP with extended groups or Unix security style with an Azure NetApp Files dual-protocol volume.TheUser DNandGroup DNoptions allow you to set the search base in AD DS LDAP. These options limit the search areas for LDAP queries, reducing the search time and helping to reduce LDAP query time outs.TheGroup Membership Filteroption allows you to create a custom search filter for users who are members of specific AD DS groups.SeeConfigure AD DS LDAP with extended groups for NFS volume accessfor information about these options.
LDAP Search Scope,User DN,Group DN, andGroup Membership Filter
TheLDAP search scopeoption optimizes Azure NetApp Files storage LDAP queries for use with large AD DS topologies and LDAP with extended groups or Unix security style with an Azure NetApp Files dual-protocol volume.
TheUser DNandGroup DNoptions allow you to set the search base in AD DS LDAP. These options limit the search areas for LDAP queries, reducing the search time and helping to reduce LDAP query time outs.
TheGroup Membership Filteroption allows you to create a custom search filter for users who are members of specific AD DS groups.

SeeConfigure AD DS LDAP with extended groups for NFS volume accessfor information about these options.
Preferred server for LDAP clientThePreferred server for LDAP clientoption allows you to submit the IP addresses of up to two AD servers as a comma-separated list. Rather than sequentially contacting all of the discovered AD services for a domain, the LDAP client will contact the specified servers first.
Preferred server for LDAP client
ThePreferred server for LDAP clientoption allows you to submit the IP addresses of up to two AD servers as a comma-separated list. Rather than sequentially contacting all of the discovered AD services for a domain, the LDAP client will contact the specified servers first.
Encrypted SMB connections to Domain ControllerEncrypted SMB connections to Domain Controllerspecifies whether encryption should be used for communication between an SMB server and domain controller. When enabled, only SMB3 will be used for encrypted domain controller connections.This feature is currently in preview. If this is your first time using Encrypted SMB connections to domain controller, you must register it:Register-AzProviderFeature -ProviderNamespace Microsoft.NetApp -FeatureName  ANFEncryptedSMBConnectionsToDCCheck the status of the feature registration:NoteTheRegistrationStatemay be in theRegisteringstate for up to 60 minutes before changing toRegistered. Wait until the status isRegisteredbefore continuing.Get-AzProviderFeature -ProviderNamespace Microsoft.NetApp -FeatureName  ANFEncryptedSMBConnectionsToDCYou can also useAzure CLI commandsaz feature registerandaz feature showto register the feature and display the registration status.
Encrypted SMB connections to Domain Controller
Encrypted SMB connections to Domain Controllerspecifies whether encryption should be used for communication between an SMB server and domain controller. When enabled, only SMB3 will be used for encrypted domain controller connections.
This feature is currently in preview. If this is your first time using Encrypted SMB connections to domain controller, you must register it:
Register-AzProviderFeature -ProviderNamespace Microsoft.NetApp -FeatureName  ANFEncryptedSMBConnectionsToDC
Register-AzProviderFeature -ProviderNamespace Microsoft.NetApp -FeatureName  ANFEncryptedSMBConnectionsToDC
Check the status of the feature registration:
Note
TheRegistrationStatemay be in theRegisteringstate for up to 60 minutes before changing toRegistered. Wait until the status isRegisteredbefore continuing.
Registering
Registered
Registered
Get-AzProviderFeature -ProviderNamespace Microsoft.NetApp -FeatureName  ANFEncryptedSMBConnectionsToDC
Get-AzProviderFeature -ProviderNamespace Microsoft.NetApp -FeatureName  ANFEncryptedSMBConnectionsToDC
You can also useAzure CLI commandsaz feature registerandaz feature showto register the feature and display the registration status.
az feature register
az feature show
Backup policy usersThis option grants addition security privileges to AD DS domain users or groups that require elevated backup privileges to support backup, restore, and migration workflows in Azure NetApp Files. The specified AD DS user accounts or groups will have elevated NTFS permissions at the file or folder level.The following privileges apply when you use theBackup policy userssetting:PrivilegeDescriptionSeBackupPrivilegeBack up files and directories, overriding any ACLs.SeRestorePrivilegeRestore files and directories, overriding any ACLs.Set any valid user or group SID as the file owner.SeChangeNotifyPrivilegeBypass traverse checking.Users with this privilege aren't required to have traversed (x) permissions to traverse folders or symlinks.
Backup policy usersThis option grants addition security privileges to AD DS domain users or groups that require elevated backup privileges to support backup, restore, and migration workflows in Azure NetApp Files. The specified AD DS user accounts or groups will have elevated NTFS permissions at the file or folder level.

The following privileges apply when you use theBackup policy userssetting:
SeBackupPrivilege
SeRestorePrivilege
SeChangeNotifyPrivilege
x
Security privilege usersThis option grants security privilege (SeSecurityPrivilege) to AD DS domain users or groups that require elevated privileges to access Azure NetApp Files volumes. The specified AD DS users or groups will be allowed to perform certain actions on SMB shares that require security privilege not assigned by default to domain users.The following privilege applies when you use theSecurity privilege userssetting:PrivilegeDescriptionSeSecurityPrivilegeManage log operations.This feature is used for installing SQL Server in certain scenarios where a non-administrator AD DS domain account must temporarily be granted elevated security privilege.NoteUsing the Security privilege users feature relies on theSMB Continuous Availability Shares feature. SMB Continuous Availability isnotsupported on custom applications. It is only supported for workloads using Citrix App Layering,FSLogix user profile containers, and Microsoft SQL Server (not Linux SQL Server).ImportantUsing theSecurity privilege usersfeature requires that you submit a waitlist request through theAzure NetApp Files SMB Continuous Availability Shares Public Preview waitlist submission page. Wait for an official confirmation email from the Azure NetApp Files team before using this feature.This feature is optional and supported only with SQL server. The AD DS domain account used for installing SQL server must already exist before you add it to theSecurity privilege usersoption. When you add the SQL Server installer account toSecurity privilege usersoption, the Azure NetApp Files service might validate the account by contacting an AD DS domain controller. This action might fail if Azure NetApp Files cannot contact the AD DS domain controller.For more information aboutSeSecurityPrivilegeand SQL Server, seeSQL Server installation fails if the Setup account doesn't have certain user rights.
Security privilege usersThis option grants security privilege (SeSecurityPrivilege) to AD DS domain users or groups that require elevated privileges to access Azure NetApp Files volumes. The specified AD DS users or groups will be allowed to perform certain actions on SMB shares that require security privilege not assigned by default to domain users.
SeSecurityPrivilege

The following privilege applies when you use theSecurity privilege userssetting:
SeSecurityPrivilege
This feature is used for installing SQL Server in certain scenarios where a non-administrator AD DS domain account must temporarily be granted elevated security privilege.
Note
Using the Security privilege users feature relies on theSMB Continuous Availability Shares feature. SMB Continuous Availability isnotsupported on custom applications. It is only supported for workloads using Citrix App Layering,FSLogix user profile containers, and Microsoft SQL Server (not Linux SQL Server).
Important
Using theSecurity privilege usersfeature requires that you submit a waitlist request through theAzure NetApp Files SMB Continuous Availability Shares Public Preview waitlist submission page. Wait for an official confirmation email from the Azure NetApp Files team before using this feature.This feature is optional and supported only with SQL server. The AD DS domain account used for installing SQL server must already exist before you add it to theSecurity privilege usersoption. When you add the SQL Server installer account toSecurity privilege usersoption, the Azure NetApp Files service might validate the account by contacting an AD DS domain controller. This action might fail if Azure NetApp Files cannot contact the AD DS domain controller.
For more information aboutSeSecurityPrivilegeand SQL Server, seeSQL Server installation fails if the Setup account doesn't have certain user rights.
SeSecurityPrivilege
Administrators privilege usersThis option grants additional security privileges to AD DS domain users or groups that require elevated privileges to access the Azure NetApp Files volumes. The specified accounts will have elevated permissions at the file or folder level.NoteThe domain admins are automatically added to the Administrators privilege users group.NoteThis privilege is useful for data migrations.The following privileges apply when you use theAdministrators privilege userssetting:PrivilegeDescriptionSeBackupPrivilegeBack up files and directories, overriding any ACLs.SeRestorePrivilegeRestore files and directories, overriding any ACLs.Set any valid user or group SID as the file owner.SeChangeNotifyPrivilegeBypass traverse checking.Users with this privilege aren't required to have traverse (x) permissions to traverse folders or symlinks.SeTakeOwnershipPrivilegeTake ownership of files or other objects.SeSecurityPrivilegeManage log operations.SeChangeNotifyPrivilegeBypass traverse checking.Users with this privilege aren't required to have traverse (x) permissions to traverse folders or symlinks.
Administrators privilege users
This option grants additional security privileges to AD DS domain users or groups that require elevated privileges to access the Azure NetApp Files volumes. The specified accounts will have elevated permissions at the file or folder level.
Note
The domain admins are automatically added to the Administrators privilege users group.

Note
This privilege is useful for data migrations.
The following privileges apply when you use theAdministrators privilege userssetting:
SeBackupPrivilege
SeRestorePrivilege
SeChangeNotifyPrivilege
x
SeTakeOwnershipPrivilege
SeSecurityPrivilege
SeChangeNotifyPrivilege
x
Credentials, including yourusernameandpasswordImportantAlthough Active Directory supports 256-character passwords, Active Directory passwords with Azure NetApp Filescannotexceed 64 characters.
Credentials, including yourusernameandpassword

Important
Although Active Directory supports 256-character passwords, Active Directory passwords with Azure NetApp Filescannotexceed 64 characters.
SelectJoin.The Active Directory connection you created appears.
SelectJoin.
The Active Directory connection you created appears.

Create one Active Directory connection per NetApp account (preview)
With this feature, each NetApp account within an Azure subscription can have its own AD connection. Once configured, the AD connection of the NetApp account is used when you create anSMB volume, aNFSv4.1 Kerberos volume, or adual-protocol volume. That means, Azure NetApp Files supports more than one AD connection per Azure subscription when multiple NetApp accounts are used.
Note
If a subscription has both this and theShared Active Directoryfeature enabled, its existing accounts still share the AD configuration. Any new NetApp accounts created on the subscription can use their own AD configurations. You can confirm your configuration in your account overview page in theAD typefield.
Considerations
The scope of each AD configuration is limited to its parent NetApp account.
Register the feature
The feature to create one AD connection per NetApp account is currently in preview. You need to register the feature before using it for the first time. After registration, the feature is enabled and works in the background.
Register the feature:Register-AzProviderFeature -ProviderNamespace Microsoft.NetApp -FeatureName ANFMultipleActiveDirectory
Register the feature:
Register-AzProviderFeature -ProviderNamespace Microsoft.NetApp -FeatureName ANFMultipleActiveDirectory
Register-AzProviderFeature -ProviderNamespace Microsoft.NetApp -FeatureName ANFMultipleActiveDirectory
Check the status of the feature registration:NoteTheRegistrationStatemay be in theRegisteringstate for up to 60 minutes before changing toRegistered. Wait until the status isRegisteredbefore continuing.Get-AzProviderFeature -ProviderNamespace Microsoft.NetApp -FeatureName ANFMultipleActiveDirectory
Check the status of the feature registration:
Note
TheRegistrationStatemay be in theRegisteringstate for up to 60 minutes before changing toRegistered. Wait until the status isRegisteredbefore continuing.
Registering
Registered
Get-AzProviderFeature -ProviderNamespace Microsoft.NetApp -FeatureName ANFMultipleActiveDirectory
Get-AzProviderFeature -ProviderNamespace Microsoft.NetApp -FeatureName ANFMultipleActiveDirectory
You can also useAzure CLI commandsaz feature registerandaz feature showto register the feature and display the registration status.
az feature register
az feature show
Map multiple NetApp accounts in the same subscription and region to one AD connection (preview)
The Shared AD feature enables all NetApp accounts to share an AD connection created by one of the NetApp accounts that belong to the same subscription and the same region. For example, using this feature, all NetApp accounts in the same subscription and region can use the common AD configuration to create anSMB volume, aNFSv4.1 Kerberos volume, or adual-protocol volume. When you use this feature, the AD connection is visible in all NetApp accounts that are under the same subscription and same region.
With the introduction of the feature tocreate an AD connection per NetApp account, new feature registration for the Shared AD feature are not accepted.
Note
You can register to use one AD connection per NetApp account if you're already enrolled in the preview for Shared AD. If you currently meet the maximum of 10 NetApp accounts per Azure region per subscription, you must initiate asupport requestto increase the limit. You can confirm your configuration in your account overview page in theAD typefield.
Reset Active Directory computer account password
If you accidentally reset the password of the AD computer account on the AD server or the AD server is unreachable, you can safely reset the computer account password to preserve connectivity to your volumes. A reset affects all volumes on the SMB server.
Register the feature
The reset Active Directory computer account password feature is currently in public preview. If you're using this feature for the first time, you need to register the feature first.
Register thereset Active Directory computer account passwordfeature:
Register-AzProviderFeature -ProviderNamespace Microsoft.NetApp -FeatureName ANFResetADAccountForVolume
Register-AzProviderFeature -ProviderNamespace Microsoft.NetApp -FeatureName ANFResetADAccountForVolume
Check the status of the feature registration. TheRegistrationStatemay be in theRegisteringstate for up to 60 minutes before changing toRegistered. Wait until the status isRegisteredbefore continuing.
Registering
Registered
Registered
Get-AzProviderFeature -ProviderNamespace Microsoft.NetApp -FeatureName ANFResetADAccountForVolume
Get-AzProviderFeature -ProviderNamespace Microsoft.NetApp -FeatureName ANFResetADAccountForVolume
You can also useAzure CLI commandsaz feature registerandaz feature showto register the feature and display the registration status.
az feature register
az feature show
Steps
Navigate to the volumeOverviewmenu. SelectReset Active Directory Account.Alternately, navigate to theVolumesmenu. Identify the volume for which you want to reset the Active Directory account and select the three dots (...) at the end of the row. SelectReset Active Directory Account.
...
A warning message that explains the implications of this action will pop up. Typeyesin the text box to proceed.
Next steps
Understand guidelines for Active Directory Domain Services site design and planning for Azure NetApp Files
Modify Active Directory connections
Create an SMB volume
Create a dual-protocol volume
Configure NFSv4.1 Kerberos encryption
Install a new Active Directory forest using Azure CLI
Enable Active Directory Domain Services (AD DS) LDAP authentication for NFS volumes
AD DS LDAP with extended groups for NFS volume access
Feedback
Was this page helpful?
Additional resources