Note
Access to this page requires authorization. You can trysigning inorchanging directories.
Access to this page requires authorization. You can trychanging directories.
Configure Multi-user authorization using Resource Guard in Azure Backup
Article
2024-06-11
6 contributors
In this article
This article describes how to configure Multi-user authorization (MUA) for Azure Backup to add an additional layer of protection to critical operations on your Recovery Services vaults.
This article demonstrates Resource Guard creation in a different tenant that offers maximum protection. It also demonstrates how to  request and approve requests for performing critical operations usingMicrosoft Entra Privileged Identity Managementin the tenant housing the Resource Guard. You can optionally use other mechanisms to manage JIT permissions on the Resource Guard as per your setup.
Note
Multi-user authorization for Azure Backup is available in all public Azure regions.
Multi-user authorization using Resource Guard for Backup vault is now generally available.Learn more.
Before you start
Ensure the Resource Guard and the Recovery Services vault are in the same Azure region.
Ensure the Backup admin doesnothaveContributor,Backup MUA Admin, orBackup MUA Operatorpermissions on the Resource Guard. You can choose to have the Resource Guard in another subscription of the same directory or in another directory to ensure maximum isolation.
Ensure that your subscriptions containing the Recovery Services vault as well as the Resource Guard (in different subscriptions or tenants) are registered to use the providers -Microsoft.RecoveryServicesandMicrosoft.DataProtection. For more information, seeAzure resource providers and types.
Learn about variousMUA usage scenarios.
Create a Resource Guard
TheSecurity admincreates the Resource Guard. We recommend that you create it in adifferent subscriptionor adifferent tenantas the vault. However, it should be in thesame regionas the vault. The Backup admin mustNOThaveContributor,Backup MUA Admin, orBackup MUA Operatoraccess on the Resource Guard or the subscription that contains it.
Choose a client
Azure portal
PowerShell
CLI
To create the Resource Guard in a tenant different from the vault tenant, follow these steps:
In the Azure portal, go to the directory under which you want to create the Resource Guard.
In the Azure portal, go to the directory under which you want to create the Resource Guard.

Search forResource Guardsin the search bar, and then select the corresponding item from the drop-down list.SelectCreateto start creating a Resource Guard.In the create blade, fill in the required details for this Resource Guard.Make sure the Resource Guard is in the same Azure regions as the Recovery Services vault.Also, it's helpful to add a description of how to get or request access to perform actions on associated vaults when needed. This description would also appear in the associated vaults to guide the backup admin on getting the required permissions. You can edit the description later if needed, but having a well-defined description at all times is encouraged.
Search forResource Guardsin the search bar, and then select the corresponding item from the drop-down list.

SelectCreateto start creating a Resource Guard.
In the create blade, fill in the required details for this Resource Guard.Make sure the Resource Guard is in the same Azure regions as the Recovery Services vault.Also, it's helpful to add a description of how to get or request access to perform actions on associated vaults when needed. This description would also appear in the associated vaults to guide the backup admin on getting the required permissions. You can edit the description later if needed, but having a well-defined description at all times is encouraged.
Make sure the Resource Guard is in the same Azure regions as the Recovery Services vault.
Also, it's helpful to add a description of how to get or request access to perform actions on associated vaults when needed. This description would also appear in the associated vaults to guide the backup admin on getting the required permissions. You can edit the description later if needed, but having a well-defined description at all times is encouraged.
On theProtected operationstab, select the operations you need to protect using this resource guard.You can alsoselect the operations for protection after creating the resource guard.
On theProtected operationstab, select the operations you need to protect using this resource guard.
You can alsoselect the operations for protection after creating the resource guard.
Optionally, add any tags to the Resource Guard as per the requirements
Optionally, add any tags to the Resource Guard as per the requirements
SelectReview + Createand follow notifications for status and successful creation of the Resource Guard.
SelectReview + Createand follow notifications for status and successful creation of the Resource Guard.
To create a resource guard, run the following cmdlet:
New-AzDataProtectionResourceGuard -Location âLocationâ -Name âResourceGuardNameâ -ResourceGroupName ârgNameâ
New-AzDataProtectionResourceGuard -Location âLocationâ -Name âResourceGuardNameâ -ResourceGroupName ârgNameâ
To create a resource guard, run the following command:
az dataprotection resource-guard create --location "Location" --tags key1="val1" --resource-group "RgName" --resource-guard-name "ResourceGuardName"
az dataprotection resource-guard create --location "Location" --tags key1="val1" --resource-group "RgName" --resource-guard-name "ResourceGuardName"
Select operations to protect using Resource Guard
Choose the operations you want to protect using the Resource Guard out of all supported critical operations. By default, all supported critical operations are enabled. However, you (as the security admin) can exempt certain operations from falling under the purview of MUA using Resource Guard.
Choose a client
Azure portal
PowerShell
CLI
To exempt operations, follow these steps:
In the Resource Guard created above, go toProperties>Recovery Services vaulttab.
In the Resource Guard created above, go toProperties>Recovery Services vaulttab.
SelectDisablefor operations that you want to exclude from being authorized using the Resource Guard.NoteYou can't disable the protected operations -Disable soft deleteandRemove MUA protection.
SelectDisablefor operations that you want to exclude from being authorized using the Resource Guard.
Note
You can't disable the protected operations -Disable soft deleteandRemove MUA protection.
Optionally, you can also update the description for the Resource Guard using this blade.
Optionally, you can also update the description for the Resource Guard using this blade.
SelectSave.
SelectSave.

To update the operations. These exclude operations from protection by the resource guard, run the following cmdlets:
$resourceGuard = Get-AzDataProtectionResourceGuard -SubscriptionId "xxxxxxxx-xxxx-xxxx-xxxxxxxxxxxx" -ResourceGroupName "rgName" -Name "resGuardName"
$criticalOperations = $resourceGuard.ResourceGuardOperation.VaultCriticalOperation
$operationsToBeExcluded = $criticalOperations | Where-Object { $_ -match "backupSecurityPIN/action" -or $_ -match "backupInstances/delete" }


Update-AzDataProtectionResourceGuard -SubscriptionId "xxxxxxxx-xxxx-xxxx-xxxxxxxxxxxx" -ResourceGroupName "rgName" -Name $resourceGuard.Name -CriticalOperationExclusionList $operationsToBeExcluded
$resourceGuard = Get-AzDataProtectionResourceGuard -SubscriptionId "xxxxxxxx-xxxx-xxxx-xxxxxxxxxxxx" -ResourceGroupName "rgName" -Name "resGuardName"
$criticalOperations = $resourceGuard.ResourceGuardOperation.VaultCriticalOperation
$operationsToBeExcluded = $criticalOperations | Where-Object { $_ -match "backupSecurityPIN/action" -or $_ -match "backupInstances/delete" }


Update-AzDataProtectionResourceGuard -SubscriptionId "xxxxxxxx-xxxx-xxxx-xxxxxxxxxxxx" -ResourceGroupName "rgName" -Name $resourceGuard.Name -CriticalOperationExclusionList $operationsToBeExcluded
The first command fetches the resource guard that needs to be updated.
The second and third commands fetch the critical operations that you want to update.
The fourth command excludes some critical operations from the resource guard.
To update the operations that are to be excluded from being protected by the resource guard, run the following commands:
az dataprotection resource-guard update --name
                                       --resource-group
                                       [--critical-operation-exclusion-list {deleteProtection, getSecurityPIN, updatePolicy, updateProtection}]
                                       [--resource-type {Microsoft.RecoveryServices/vaults}]
                                       [--tags]
                                       [--type]
az dataprotection resource-guard update --name
                                       --resource-group
                                       [--critical-operation-exclusion-list {deleteProtection, getSecurityPIN, updatePolicy, updateProtection}]
                                       [--resource-type {Microsoft.RecoveryServices/vaults}]
                                       [--tags]
                                       [--type]
Example:
az dataprotection resource-guard update --resource-group "RgName" --resource-guard-name "ResourceGuardName" --resource-type "Microsoft.RecoveryServices/vaults" --critical-operation-exclusion-list deleteProtection getSecurityPIN updatePolicy
az dataprotection resource-guard update --resource-group "RgName" --resource-guard-name "ResourceGuardName" --resource-type "Microsoft.RecoveryServices/vaults" --critical-operation-exclusion-list deleteProtection getSecurityPIN updatePolicy
Assign permissions to the Backup admin on the Resource Guard to enable MUA
To enable MUA on a vault, the admin of the vault must haveReaderrole on the Resource Guard or subscription containing the Resource Guard. To assign theReaderrole on the Resource Guard:
In the Resource Guard created above, go to theAccess Control (IAM)blade, and then go toAdd role assignment.
In the Resource Guard created above, go to theAccess Control (IAM)blade, and then go toAdd role assignment.

SelectReaderfrom the list of built-in roles, and selectNext.
SelectReaderfrom the list of built-in roles, and selectNext.

ClickSelect membersand add the Backup adminâs email ID to add them as theReader. As the Backup admin is in another  tenant in this case, they'll be added as guests to the tenant containing the Resource Guard.
ClickSelect membersand add the Backup adminâs email ID to add them as theReader. As the Backup admin is in another  tenant in this case, they'll be added as guests to the tenant containing the Resource Guard.
ClickSelectand then proceed toReview + assignto complete the role assignment.
ClickSelectand then proceed toReview + assignto complete the role assignment.

Enable MUA on a Recovery Services vault
After the Reader role assignment on the Resource Guard is complete, enable multi-user authorization on vaults (as theBackup admin) that you manage.
Choose a client
Azure portal
PowerShell
CLI
To enable MUA on the vaults, follow these steps.
Go to the Recovery Services vault. Go toPropertieson the left navigation panel, then toMulti-User Authorizationand selectUpdate.
Go to the Recovery Services vault. Go toPropertieson the left navigation panel, then toMulti-User Authorizationand selectUpdate.

Now, you're presented with the option to enable MUA and choose a Resource Guard using one of the following ways:You can either specify the URI of the Resource Guard, make sure you specify the URI of a Resource Guard you haveReaderaccess to and that is the same regions as the vault. You can find the URI (Resource Guard ID) of the Resource Guard in itsOverviewscreen:Or, you can select the Resource Guard from the list of Resource Guards you haveReaderaccess to, and those available in the region.ClickSelect Resource GuardSelect the dropdown list, and then choose the directory the Resource Guard is in.SelectAuthenticateto validate your identity and access.After authentication, choose theResource Guardfrom the list displayed.
Now, you're presented with the option to enable MUA and choose a Resource Guard using one of the following ways:
You can either specify the URI of the Resource Guard, make sure you specify the URI of a Resource Guard you haveReaderaccess to and that is the same regions as the vault. You can find the URI (Resource Guard ID) of the Resource Guard in itsOverviewscreen:
You can either specify the URI of the Resource Guard, make sure you specify the URI of a Resource Guard you haveReaderaccess to and that is the same regions as the vault. You can find the URI (Resource Guard ID) of the Resource Guard in itsOverviewscreen:

Or, you can select the Resource Guard from the list of Resource Guards you haveReaderaccess to, and those available in the region.ClickSelect Resource GuardSelect the dropdown list, and then choose the directory the Resource Guard is in.SelectAuthenticateto validate your identity and access.After authentication, choose theResource Guardfrom the list displayed.
Or, you can select the Resource Guard from the list of Resource Guards you haveReaderaccess to, and those available in the region.
ClickSelect Resource Guard
Select the dropdown list, and then choose the directory the Resource Guard is in.
SelectAuthenticateto validate your identity and access.
After authentication, choose theResource Guardfrom the list displayed.

SelectSaveonce done to enable MUA.
SelectSaveonce done to enable MUA.

To enable MUA on a Recovery Services vault, run the following cmdlet:
$token = (Get-AzAccessToken -TenantId "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx").Token
Set-AzRecoveryServicesResourceGuardMapping -VaultId âVaultArmIdâ -ResourceGuardId "ResourceGuardArmId" -Token $token
$token = (Get-AzAccessToken -TenantId "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx").Token
Set-AzRecoveryServicesResourceGuardMapping -VaultId âVaultArmIdâ -ResourceGuardId "ResourceGuardArmId" -Token $token
The first command fetches the access token for the resource guard tenant where the resource guard is present.
The second command creates a mapping between the RSVault $vault and Resource guard.
Note
The token parameter is optional and is only needed to authenticate cross tenant protected operations.
To enable MUA on a Recovery Services vault, run the following command:
az backup vault resource-guard-mapping update --resource-guard-id
                                             [--ids]
                                             [--name]
                                             [--resource-group]
                                             [--tenant-id]
az backup vault resource-guard-mapping update --resource-guard-id
                                             [--ids]
                                             [--name]
                                             [--resource-group]
                                             [--tenant-id]
The tenant ID is required if the resource guard exists in a different tenant.
Example:
az backup vault resource-guard-mapping update --resource-group RgName --name VaultName --resource-guard-id ResourceGuardId
az backup vault resource-guard-mapping update --resource-group RgName --name VaultName --resource-guard-id ResourceGuardId
Protected operations using MUA
Once you have enabled MUA, the operations in scope will be restricted on the vault, if the Backup admin tries to perform them without having the required role (that is,Backup MUA Operatorrole) on the Resource Guard.
Note
We highly recommend that you test your setup after enabling MUA to ensure that protected operations are blocked as expected and to ensure that MUA is correctly configured.
Depicted below is an illustration of what happens when the Backup admin tries to perform such a protected operation (For example, disabling soft delete is depicted here. Other protected operations have a similar experience). The following steps are performed by a Backup admin without required permissions.
To disable soft delete, go to the Recovery Services vault >Properties>Security Settingsand selectUpdate, which brings up the Security Settings.
To disable soft delete, go to the Recovery Services vault >Properties>Security Settingsand selectUpdate, which brings up the Security Settings.
Disable the soft delete using the slider. You're informed that this is a protected operation, and you need to verify their access to the Resource Guard.
Disable the soft delete using the slider. You're informed that this is a protected operation, and you need to verify their access to the Resource Guard.
Select the directory containing the Resource Guard and Authenticate yourself. This step may not be required if the Resource Guard is in the same directory as the vault.
Select the directory containing the Resource Guard and Authenticate yourself. This step may not be required if the Resource Guard is in the same directory as the vault.
Proceed to selectSave. The request fails with an error informing them about not having sufficient permissions on the Resource Guard to let you perform this operation.
Proceed to selectSave. The request fails with an error informing them about not having sufficient permissions on the Resource Guard to let you perform this operation.


Authorize critical (protected) operations using Microsoft Entra Privileged Identity Management
The following sections discuss authorizing these requests using PIM. There are cases where you may need to perform critical operations on your backups and MUA can help you ensure that these are performed only when the right approvals or permissions exist. As discussed earlier, the Backup admin needs to have aBackup MUA Operatorrole on the Resource Guard to perform critical operations that are in the Resource Guard scope. One of the ways to allow just-in-time for such operations is through the use ofMicrosoft Entra Privileged Identity Management.
Note
Though using Microsoft Entra PIM is the recommended approach, you can use manual or custom methods to manage access for the Backup admin on the Resource Guard. For managing access to the Resource Guard manually, use the âAccess control (IAM)â setting on the left navigation bar of the Resource Guard and grant theBackup MUA Operatorrole to the Backup admin.

Create an eligible assignment for the Backup admin (if using Microsoft Entra Privileged Identity Management)
The Security admin can use PIM to create an eligible assignment for the Backup admin and provideBackup MUA Operatorrole to the Resource Guard. This enables the Backup admin to raise a request (for theBackup MUA Operatorrole) when they need to perform a protected operation. To do so, thesecurity adminperforms the following:
In the security tenant (which contains the Resource Guard), go toPrivileged Identity Management(search for this in the search bar in the Azure portal) and then go toAzure Resources(underManageon the left menu).
In the security tenant (which contains the Resource Guard), go toPrivileged Identity Management(search for this in the search bar in the Azure portal) and then go toAzure Resources(underManageon the left menu).
Select the resource (the Resource Guard or the containing subscription/RG) to which you want to assign theBackup MUA Operatorrole.If you donât see the corresponding resource in the list of resources, ensure you add the containing subscription to be managed by PIM.
Select the resource (the Resource Guard or the containing subscription/RG) to which you want to assign theBackup MUA Operatorrole.
If you donât see the corresponding resource in the list of resources, ensure you add the containing subscription to be managed by PIM.
In the selected resource, go toAssignments(underManageon the left menu) and go toAdd assignments.
In the selected resource, go toAssignments(underManageon the left menu) and go toAdd assignments.

In the Add assignments:Select the role asBackup MUA Operator.Go toSelect membersand add the username (or email IDs) of the Backup admin.SelectNext.
In the Add assignments:
Select the role asBackup MUA Operator.
Go toSelect membersand add the username (or email IDs) of the Backup admin.
SelectNext.

In the next screen:Under assignment type, chooseEligible.Specify the duration for which the eligible permission is valid.SelectAssignto finish creating the eligible assignment.
In the next screen:
Under assignment type, chooseEligible.
Specify the duration for which the eligible permission is valid.
SelectAssignto finish creating the eligible assignment.

Set up approvers for activating Backup MUA Operator role
By default, the above setup may not have an approver (and an approval flow requirement) configured in PIM. To ensure that approvers have theBackup MUA Operatorrole for request approval, the Security admin must follow these steps:
Note
If this isn't configured, any requests will be automatically approved without going through the security admins or a designated approverâs review. More details on this can be foundhere
In Microsoft Entra PIM, selectAzure Resourceson the left navigation bar and select your Resource Guard.
In Microsoft Entra PIM, selectAzure Resourceson the left navigation bar and select your Resource Guard.
Go toSettingsand then go to theBackup MUA Operatorrole.
Go toSettingsand then go to theBackup MUA Operatorrole.

SelectEditto add the reviewers who must review and approve the activation request for theBackup MUA Operatorrole in case you find that Approvers show None or display incorrect approver(s).
SelectEditto add the reviewers who must review and approve the activation request for theBackup MUA Operatorrole in case you find that Approvers show None or display incorrect approver(s).
On theActivationtab, selectRequire approval to activateand add the approver(s) who need to approve each request.
On theActivationtab, selectRequire approval to activateand add the approver(s) who need to approve each request.
Select security options, such as multifactor authentication (MFA), Mandating ticket to activateBackup MUA Operatorrole.
Select security options, such as multifactor authentication (MFA), Mandating ticket to activateBackup MUA Operatorrole.
Select the appropriate options on theAssignmentandNotificationtabs as required.
Select the appropriate options on theAssignmentandNotificationtabs as required.

SelectUpdateto complete the setup of approvers to activate theBackup MUA Operatorrole.
SelectUpdateto complete the setup of approvers to activate theBackup MUA Operatorrole.
Request activation of an eligible assignment to perform critical operations
After the security admin creates an eligible assignment, the Backup admin needs to activate the assignment for theBackup MUA Operatorrole to be able to perform protected actions.
To activate the role assignment, follow these steps:
Go toMicrosoft Entra Privileged Identity Management. If the Resource Guard is in another directory, switch to that directory and then go toMicrosoft Entra Privileged Identity Management.
Go toMicrosoft Entra Privileged Identity Management. If the Resource Guard is in another directory, switch to that directory and then go toMicrosoft Entra Privileged Identity Management.
Go toMy roles>Azure resourceson the left menu.
Go toMy roles>Azure resourceson the left menu.
SelectActivateto activate the eligible assignment forBackup MUA Operatorrole.A notification appears notifying that the request is sent for approval.
SelectActivateto activate the eligible assignment forBackup MUA Operatorrole.
A notification appears notifying that the request is sent for approval.

Approve activation of requests to perform critical operations
Once the Backup admin raises a request for activating theBackup MUA Operatorrole, the request is to be reviewed and approved by thesecurity admin.
In the security tenant, go toMicrosoft Entra Privileged Identity Management.
Go toApprove Requests.
UnderAzure resources, the request raised by the Backup admin requesting activation as aBackup MUA Operatorcan be seen.
Review the request. If genuine, select the request and selectApproveto approve it.
The Backup admin is informed by email (or other organizational alerting mechanisms) that their request is now approved.
Once approved, the Backup admin can perform protected operations for the requested period.
Performing a protected operation after approval
Once the Backup adminâs request for theBackup MUA Operatorrole on the Resource Guard is approved, they can perform protected operations on the associated vault. If the Resource Guard is in another directory, the Backup admin would need to authenticate themselves.
Note
If the access was assigned using a JIT mechanism, theBackup MUA Operatorrole is retracted at the end of the approved period. Else, the Security admin manually removes theBackup MUA Operatorrole assigned to the Backup admin to perform the critical operation.
The following screenshot shows an example of disabling soft delete for an MUA-enabled vault.

Disable MUA on a Recovery Services vault
Disabling MUA is a protected operation, so, so, vaults are protected using MUA. If you (the Backup admin) want to disable MUA, you must have the requiredBackup MUA Operatorrole in the Resource Guard.
Choose a client
Azure portal
PowerShell
CLI
To disable MUA on a vault, follow these steps:
The Backup admin requests the Security admin forBackup MUA Operatorrole on the Resource Guard. They can request this to use the methods approved by the organization such as JIT procedures, likeMicrosoft Entra Privileged Identity Management, or other internal tools and procedures.
The Backup admin requests the Security admin forBackup MUA Operatorrole on the Resource Guard. They can request this to use the methods approved by the organization such as JIT procedures, likeMicrosoft Entra Privileged Identity Management, or other internal tools and procedures.
The Security admin approves the request (if they find it worthy of being approved) and informs the Backup admin. Now the Backup admin has theBackup MUA Operatorrole on the Resource Guard.
The Security admin approves the request (if they find it worthy of being approved) and informs the Backup admin. Now the Backup admin has theBackup MUA Operatorrole on the Resource Guard.
The Backup admin goes to the vault >Properties>Multi-user Authorization.
The Backup admin goes to the vault >Properties>Multi-user Authorization.
SelectUpdate.Clear theProtect with Resource Guardcheckbox.Choose the Directory that contains the Resource Guard and verify access using the Authenticate button (if applicable).Afterauthentication, selectSave. With the right access, the request should be successfully completed.
SelectUpdate.
Clear theProtect with Resource Guardcheckbox.
Choose the Directory that contains the Resource Guard and verify access using the Authenticate button (if applicable).
Afterauthentication, selectSave. With the right access, the request should be successfully completed.

To disable MUA on a Recovery Services vault, use the following cmdlet:
$token = (Get-AzAccessToken -TenantId "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx").Token
Remove-AzRecoveryServicesResourceGuardMapping -VaultId âVaultArmIdâ  -Token $token
$token = (Get-AzAccessToken -TenantId "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx").Token
Remove-AzRecoveryServicesResourceGuardMapping -VaultId âVaultArmIdâ  -Token $token
The first command fetches the access token for the resource guard tenant, where the resource guard is present.
The second command deletes the mapping between the Recovery Services vault and the resource guard.
Note
The token parameter is optional and is only needed to authenticate the cross tenant protected operations.
To disable MUA on a Recovery Services vault, run the following command:
az backup vault resource-guard-mapping delete [--ids]
                                             [--name]
                                             [--resource-group]
                                             [--tenant-id]
                                             [--yes]
az backup vault resource-guard-mapping delete [--ids]
                                             [--name]
                                             [--resource-group]
                                             [--tenant-id]
                                             [--yes]
The tenant ID is required if the resource guard exists in a different tenant.
Example:
az backup vault resource-guard-mapping delete --resource-group RgName --name VaultName
az backup vault resource-guard-mapping delete --resource-group RgName --name VaultName
This article describes how to configure Multi-user authorization (MUA) for Azure Backup to add an additional layer of protection to critical operations on your Backup vault.
This article demonstrates Resource Guard creation in a different tenant that offers maximum protection. It also demonstrates how to  request and approve requests for performing critical operations usingMicrosoft Entra Privileged Identity Managementin the tenant housing the Resource Guard. You can optionally use other mechanisms to manage JIT permissions on the Resource Guard as per your setup.
Note
Multi-user authorization using Resource Guard for Backup vault is now generally available.
Multi-user authorization for Azure Backup is available in all public Azure regions.
Before you start
Ensure the Resource Guard and the Backup vault are in the same Azure region.
Ensure the Backup admin doesnothaveContributor,Backup MUA Admin, orBackup MUA Operatorpermissions on the Resource Guard. You can choose to have the Resource Guard in another subscription of the same directory or in another directory to ensure maximum isolation.
Ensure that your subscriptions contain the Backup vault as well as the Resource Guard (in different subscriptions or tenants) are registered to use the provider -Microsoft.DataProtection4. For more information, seeAzure resource providers and types.
Learn about variousMUA usage scenarios.
Create a Resource Guard
TheSecurity admincreates the Resource Guard. We recommend that you create it in adifferent subscriptionor adifferent tenantas the vault. However, it should be in thesame regionas the vault.
The Backup admin mustNOThavecontributor,Backup MUA Admin, orBackup MUA Operatoraccess on the Resource Guard or the subscription that contains it.
To create the Resource Guard in a tenant different from the vault tenant as a Security admin, follow these steps:
In the Azure portal, go to the directory under which you want to create the Resource Guard.
In the Azure portal, go to the directory under which you want to create the Resource Guard.

Search forResource Guardsin the search bar, and then select the corresponding item from the dropdown list.SelectCreateto create a Resource Guard.In the Create blade, fill in the required details for this Resource Guard.Ensure that the Resource Guard is in the same Azure region as the Backup vault.Add a description on how to request access to perform actions on associated vaults when needed. This description appears in the associated vaults to guide the Backup admin on how to get the required permissions.
Search forResource Guardsin the search bar, and then select the corresponding item from the dropdown list.

SelectCreateto create a Resource Guard.
In the Create blade, fill in the required details for this Resource Guard.Ensure that the Resource Guard is in the same Azure region as the Backup vault.Add a description on how to request access to perform actions on associated vaults when needed. This description appears in the associated vaults to guide the Backup admin on how to get the required permissions.
Ensure that the Resource Guard is in the same Azure region as the Backup vault.
Add a description on how to request access to perform actions on associated vaults when needed. This description appears in the associated vaults to guide the Backup admin on how to get the required permissions.
On theProtected operationstab, select the operations you need to protect using this resource guard under theBackup vaulttab.Currently, theProtected operationstab includes only theDelete backup instanceoption to disable.You can alsoselect the operations for protection after creating the resource guard.
On theProtected operationstab, select the operations you need to protect using this resource guard under theBackup vaulttab.
Currently, theProtected operationstab includes only theDelete backup instanceoption to disable.
You can alsoselect the operations for protection after creating the resource guard.

Optionally, add any tags to the Resource Guard as per the requirements.
Optionally, add any tags to the Resource Guard as per the requirements.
SelectReview + Createand then follow the notifications to monitor the status and the successful creation of the Resource Guard.
SelectReview + Createand then follow the notifications to monitor the status and the successful creation of the Resource Guard.
Select operations to protect using Resource Guard
After vault creation, the Security admin can also choose the operations for protection using the Resource Guard among all supported critical operations. By default, all supported critical operations are enabled. However, the Security admin can exempt certain operations from falling under the purview of MUA using Resource Guard.
To select the operations for protection, follow these steps:
In the Resource Guard that you've created, go toProperties>Backup vaulttab.
In the Resource Guard that you've created, go toProperties>Backup vaulttab.
SelectDisablefor the operations that you want to exclude from being authorized.You can't disable theRemove MUA protectionandDisable soft deleteoperations.
SelectDisablefor the operations that you want to exclude from being authorized.
You can't disable theRemove MUA protectionandDisable soft deleteoperations.
Optionally, in theBackup vaultstab, update the description for the Resource Guard.
Optionally, in theBackup vaultstab, update the description for the Resource Guard.
SelectSave.
SelectSave.

Assign permissions to the Backup admin on the Resource Guard to enable MUA
The Backup admin must haveReaderrole on the Resource Guard or subscription that contains the Resource Guard to enable MUA on a vault. The Security admin needs to assign this role to the Backup admin.
To assign theReaderrole on the Resource Guard, follow these steps:
In the Resource Guard created above, go to theAccess Control (IAM)blade, and then go toAdd role assignment.
In the Resource Guard created above, go to theAccess Control (IAM)blade, and then go toAdd role assignment.

SelectReaderfrom the list of built-in roles, and selectNext.
SelectReaderfrom the list of built-in roles, and selectNext.

ClickSelect membersand add the Backup admin's email ID to assign theReaderrole.As the Backup admins are in another  tenant, they'll be added as guests to the tenant that contains the Resource Guard.
ClickSelect membersand add the Backup admin's email ID to assign theReaderrole.
As the Backup admins are in another  tenant, they'll be added as guests to the tenant that contains the Resource Guard.
ClickSelect>Review + assignto complete the role assignment.
ClickSelect>Review + assignto complete the role assignment.

Enable MUA on a Backup vault
Once the Backup admin has the Reader role on the Resource Guard, they can enable multi-user authorization on vaults managed by following these steps:
Go to the Backup vault for which you want to configure MUA.
Go to the Backup vault for which you want to configure MUA.
On the left panel, selectProperties.
On the left panel, selectProperties.
Go toMulti-User Authorizationand selectUpdate.
Go toMulti-User Authorizationand selectUpdate.

To enable MUA and choose a Resource Guard, perform one of the following actions:You can either specify the URI of the Resource Guard. Ensure that you specify the URI of a Resource Guard you haveReaderaccess to and it's in the same region as the vault. You can find the URI (Resource Guard ID) of the Resource Guard on itsOverviewpage.Or, you can select the Resource Guard from the list of Resource Guards you haveReaderaccess to, and those available in the region.ClickSelect Resource Guard.Select the dropdown and select the directory the Resource Guard is in.SelectAuthenticateto validate your identity and access.After authentication, choose theResource Guardfrom the list displayed.
To enable MUA and choose a Resource Guard, perform one of the following actions:
You can either specify the URI of the Resource Guard. Ensure that you specify the URI of a Resource Guard you haveReaderaccess to and it's in the same region as the vault. You can find the URI (Resource Guard ID) of the Resource Guard on itsOverviewpage.
You can either specify the URI of the Resource Guard. Ensure that you specify the URI of a Resource Guard you haveReaderaccess to and it's in the same region as the vault. You can find the URI (Resource Guard ID) of the Resource Guard on itsOverviewpage.

Or, you can select the Resource Guard from the list of Resource Guards you haveReaderaccess to, and those available in the region.ClickSelect Resource Guard.Select the dropdown and select the directory the Resource Guard is in.SelectAuthenticateto validate your identity and access.After authentication, choose theResource Guardfrom the list displayed.
Or, you can select the Resource Guard from the list of Resource Guards you haveReaderaccess to, and those available in the region.
ClickSelect Resource Guard.
Select the dropdown and select the directory the Resource Guard is in.
SelectAuthenticateto validate your identity and access.
After authentication, choose theResource Guardfrom the list displayed.

SelectSaveto enable MUA.
SelectSaveto enable MUA.

Protected operations using MUA
Once the Backup admin enables MUA, the operations in scope will be restricted on the vault, and the operations fail if the Backup admin tries to perform them without having theBackup MUA Operatorrole on the Resource Guard.
Note
We highly recommend you to test your setup after enabling MUA to ensure that:
Protected operations are blocked as expected.
MUA is correctly configured.
To perform a protected operation (disabling MUA), follow these steps:
Go to the vault >Propertiesin the left pane.
Go to the vault >Propertiesin the left pane.
Clear the checkbox to disable MUA.You'll receive a notification that it's a protected operation, and you need to have access to the Resource Guard.
Clear the checkbox to disable MUA.
You'll receive a notification that it's a protected operation, and you need to have access to the Resource Guard.
Select the directory containing the Resource Guard and authenticate yourself.This step may not be required if the Resource Guard is in the same directory as the vault.
Select the directory containing the Resource Guard and authenticate yourself.
This step may not be required if the Resource Guard is in the same directory as the vault.
SelectSave.The request fails with an error that you don't have sufficient permissions on the Resource Guard to perform this operation.
SelectSave.
The request fails with an error that you don't have sufficient permissions on the Resource Guard to perform this operation.


Authorize critical (protected) operations using Microsoft Entra Privileged Identity Management
There are scenarios where you may need to perform critical operations on your backups and you can perform them with the right approvals or permissions with MUA. The following sections explain how to authorize the critical operation requests using Privileged Identity Management (PIM).
The Backup admin must have aBackup MUA Operatorrole on the Resource Guard to perform critical operations in the Resource Guard scope. One of the ways to allow just-in-time (JIT) operations is through the use ofMicrosoft Entra Privileged Identity Management.
Note
We recommend that you use the Microsoft Entra PIM. However, you can also use manual or custom methods to manage access for the Backup admin on the Resource Guard. To manually manage access to the Resource Guard, use theAccess control (IAM)setting on the left pane of the Resource Guard and grant theBackup MUA Operatorrole to the Backup admin.

Create an eligible assignment for the Backup admin using Microsoft Entra Privileged Identity Management
TheSecurity admincan use PIM to create an eligible assignment for the Backup admin as aBackup MUA Operatorto the Resource Guard. This enables the Backup admin to raise a request (for theBackup MUA Operatorrole) when they need to perform a protected operation.
To create an eligible assignment, follow the steps:
Sign in to theAzure portal.
Sign in to theAzure portal.
Go to security tenant of Resource Guard, and in the search, enterPrivileged Identity Management.
Go to security tenant of Resource Guard, and in the search, enterPrivileged Identity Management.
In the left pane, selectManage and go to Azure Resources.
In the left pane, selectManage and go to Azure Resources.
Select the resource (the Resource Guard or the containing subscription/RG) to which you want to assign theBackup MUA Operatorrole.If you don't find any corresponding resources, then add the containing subscription that is managed by PIM.
Select the resource (the Resource Guard or the containing subscription/RG) to which you want to assign theBackup MUA Operatorrole.
If you don't find any corresponding resources, then add the containing subscription that is managed by PIM.
Select the resource and go toManage>Assignments>Add assignments.
Select the resource and go toManage>Assignments>Add assignments.

In the Add assignments:Select the role asBackup MUA Operator.Go toSelect membersand add the username (or email IDs) of the Backup admin.SelectNext.
In the Add assignments:
Select the role asBackup MUA Operator.
Go toSelect membersand add the username (or email IDs) of the Backup admin.
SelectNext.

In Assignment, selectEligibleand specify the validity of the duration of eligible permission.
In Assignment, selectEligibleand specify the validity of the duration of eligible permission.
SelectAssignto complete creating the eligible assignment.
SelectAssignto complete creating the eligible assignment.

Set up approvers for activating Contributor role
By default, the above setup may not have an approver (and an approval flow requirement) configured in PIM. To ensure that approvers have theContributorrole for request approval, the Security admin must follow these steps:
Note
If the approver setup isn't configured, the requests are automatically approved without going through the Security admins or a designated approverâs review.Learn more.
In Microsoft Entra PIM, selectAzure Resourceson the left pane and select your Resource Guard.
In Microsoft Entra PIM, selectAzure Resourceson the left pane and select your Resource Guard.
Go toSettings>Contributorrole.
Go toSettings>Contributorrole.

SelectEditto add the reviewers who must review and approve the activation request for theContributorrole in case you find that Approvers showNoneor display incorrect approver(s).
SelectEditto add the reviewers who must review and approve the activation request for theContributorrole in case you find that Approvers showNoneor display incorrect approver(s).
On theActivationtab, selectRequire approval to activateto add the approver(s) who must approve each request.
On theActivationtab, selectRequire approval to activateto add the approver(s) who must approve each request.
Select security options, such as multifactor authentication (MFA), Mandating ticket to activateContributorrole.
Select security options, such as multifactor authentication (MFA), Mandating ticket to activateContributorrole.
Select the appropriate options onAssignmentandNotificationtabs as per your requirement.
Select the appropriate options onAssignmentandNotificationtabs as per your requirement.

SelectUpdateto complete the setup of approvers to activate theContributorrole.
SelectUpdateto complete the setup of approvers to activate theContributorrole.
Request activation of an eligible assignment to perform critical operations
After the Security admin creates an eligible assignment, the Backup admin needs to activate the role assignment for the Contributor role to perform protected actions.
To activate the role assignment, follow the steps:
Go toMicrosoft Entra Privileged Identity Management. If the Resource Guard is in another directory, switch to that directory and then go toMicrosoft Entra Privileged Identity Management.
Go toMicrosoft Entra Privileged Identity Management. If the Resource Guard is in another directory, switch to that directory and then go toMicrosoft Entra Privileged Identity Management.
Go toMy roles>Azure resourcesin the left pane.
Go toMy roles>Azure resourcesin the left pane.
SelectActivateto activate the eligible assignment forContributorrole.A notification appears notifying that the request is sent for approval.
SelectActivateto activate the eligible assignment forContributorrole.
A notification appears notifying that the request is sent for approval.

Approve activation requests to perform critical operations
Once the Backup admin raises a request for activating the Contributor role, theSecurity adminmust review and approve the request.
To review and approve the request, follow these steps:
In the security tenant, go toMicrosoft Entra Privileged Identity Management.
In the security tenant, go toMicrosoft Entra Privileged Identity Management.
Go toApprove Requests.
Go toApprove Requests.
UnderAzure resources, you can see the request awaiting approval.SelectApproveto review and approve the genuine request.
UnderAzure resources, you can see the request awaiting approval.
SelectApproveto review and approve the genuine request.
After the approval, the Backup admin receives a notification, via email or other internal alerting options,  that the request is approved.  Now, the Backup admin can perform the protected operations for the requested period.
Perform a protected operation after approval
Once the Security admin approves the Backup admin's request for theBackup MUA Operatorrole on the Resource Guard, they can perform protected operations on the associated vault. If the Resource Guard is in another directory, the Backup admin must authenticate themselves.
Note
If the access was assigned using a JIT mechanism, theBackup MUA Operatorrole is retracted at the end of the approved period. Otherwise, the Security admin manually removes theBackup MUA Operatorrole assigned to the Backup admin to perform the critical operation.
The following screenshot shows an example ofdisabling soft deletefor an MUA-enabled vault.

Disable MUA on a Backup vault
Disabling the MUA is a protected operation that must be done by the Backup admin only. To do this, the Backup admin must have the requiredBackup MUA Operatorrole in the Resource Guard. To obtain this permission, the Backup admin must first request the Security admin for theBackup MUA Operatorrole on the Resource Guard using the just-in-time (JIT) procedure, such asMicrosoft Entra Privileged Identity Managementor internal tools.
Then the Security admin approves the request if it's genuine and updates the Backup admin who now hasBackup MUA Operatorrole on the Resource guard. Learn more onhow to get this role.
To disable the MUA, the Backup admins must follow these steps:
Go to vault >Properties>Multi-user Authorization.
Go to vault >Properties>Multi-user Authorization.
SelectUpdateand clear theProtect with Resource Guardcheckbox.
SelectUpdateand clear theProtect with Resource Guardcheckbox.
SelectAuthenticate(if applicable) to choose the Directory that contains the Resource Guard and verify access.
SelectAuthenticate(if applicable) to choose the Directory that contains the Resource Guard and verify access.
SelectSaveto complete the process of disabling the MUA.
SelectSaveto complete the process of disabling the MUA.

Next steps
Learn more about Multi-user authorization using Resource Guard.
Feedback
Was this page helpful?
Additional resources