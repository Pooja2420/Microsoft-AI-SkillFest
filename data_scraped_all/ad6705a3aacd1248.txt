Note
Access to this page requires authorization. You can trysigning inorchanging directories.
Access to this page requires authorization. You can trychanging directories.
Enable diagnostic logging for Azure AI services
Article
2025-01-23
3 contributors
In this article
This guide provides step-by-step instructions to enable diagnostic logging for an Azure AI service. These logs provide rich, frequent data about the operation of a resource that are used for issue identification and debugging. Before you continue, you must have an Azure account with a subscription to at least one Azure AI service, such asAzure AI Speech.
Prerequisites
To enable diagnostic logging, you need to select a location to store your log data. This tutorial uses Azure Storage and Log Analytics.
Azure storage- Retains diagnostic logs for policy audit, static analysis, or backup. The storage account doesn't have to be in the same subscription as the resource emitting logs as long as the user who configures the setting has appropriate Azure role-based access control (RBAC) access to both subscriptions.
Log Analytics- A flexible log search and analytics tool that allows for analysis of raw logs generated by an Azure resource.
Note
Other configuration options are available. To learn more, seeCollect and consume log data from your Azure resources.
"Trace" in diagnostic logging is only available forCustom question answering.
Enable diagnostic log collection
Start by enabling diagnostic logging using the Azure portal.
Note
To enable this feature using PowerShell or the Azure CLI, use the instructions provided inCollect and consume log data from your Azure resources.
Navigate to the Azure portal. Then locate and select an Azure AI services resource. For example, your subscription to Speech Services.
Next, from the left-hand navigation menu, locateMonitoring, and selectDiagnostic settings. This screen contains all previously created diagnostic settings for this resource.
If there is a previously created resource that you'd like to use, you can select it now. Otherwise, select+ Add diagnostic setting.
Enter a name for the setting. Then selectArchive to a storage accountandSend to log Analytics.
When prompted to configure, select the storage account and OMS workspace that you'd like to use to store you diagnostic logs.Note: If you don't have a storage account or OMS workspace, follow the prompts to create one.
SelectAudit,RequestResponse, andAllMetrics. Then set the retention period for your diagnostic log data. If a retention policy is set to zero, events for that log category are stored indefinitely.
SelectSave.
It can take up to two hours before logging data is available to query and analyze, so don't worry if you don't see anything right away.
View and export diagnostic data from Azure Storage
Azure Storage is a robust object storage solution that is optimized for storing large amounts of unstructured data. In this section, you'll learn to query your storage account for total transactions over a 30-day timeframe and export the data to excel.
From the Azure portal, locate the Azure Storage resource that you created in the last section.
From the left-hand navigation menu, locateMonitoringand selectMetrics.
Use the available drop-downs to configure your query. For this example, let's set the time range toLast 30 daysand the metric toTransaction.
When the query is complete, you'll see a visualization of transaction over the last 30 days. To export this data, use theExport to Excelbutton located at the top of the page.
Learn more about what you can do with diagnostic data inAzure Storage.
View logs in Log Analytics
Follow these instructions to explore log analytics data for your resource.
From the Azure portal, locate and selectLog Analyticsfrom the left-hand navigation menu.
Locate and select the resource you created when enabling diagnostics.
UnderGeneral, locate and selectLogs. From this page, you can run queries against your logs.
Sample queries
Here are a few basic Kusto queries you can use to explore your log data.
Run this query for all diagnostic logs from Azure AI services for a specified time period:
AzureDiagnostics
| where ResourceProvider == "MICROSOFT.COGNITIVESERVICES"
AzureDiagnostics
| where ResourceProvider == "MICROSOFT.COGNITIVESERVICES"
Run this query to see the 10 most recent logs:
AzureDiagnostics
| where ResourceProvider == "MICROSOFT.COGNITIVESERVICES"
| take 10
AzureDiagnostics
| where ResourceProvider == "MICROSOFT.COGNITIVESERVICES"
| take 10
Run this query to group operations byResource:
AzureDiagnostics
| where ResourceProvider == "MICROSOFT.COGNITIVESERVICES" |
summarize count() by Resource
AzureDiagnostics
| where ResourceProvider == "MICROSOFT.COGNITIVESERVICES" |
summarize count() by Resource
Run this query to find the average time it takes to perform an operation:
AzureDiagnostics
| where ResourceProvider == "MICROSOFT.COGNITIVESERVICES"
| summarize avg(DurationMs)
by OperationName
AzureDiagnostics
| where ResourceProvider == "MICROSOFT.COGNITIVESERVICES"
| summarize avg(DurationMs)
by OperationName
Run this query to view the volume of operations over time split by OperationName with counts binned for every 10 seconds.
AzureDiagnostics
| where ResourceProvider == "MICROSOFT.COGNITIVESERVICES"
| summarize count()
by bin(TimeGenerated, 10s), OperationName
| render areachart kind=unstacked
AzureDiagnostics
| where ResourceProvider == "MICROSOFT.COGNITIVESERVICES"
| summarize count()
by bin(TimeGenerated, 10s), OperationName
| render areachart kind=unstacked
Next steps
To understand how to enable logging and the metrics and log categories that are supported by the various Azure services, read theOverview of metricsin Microsoft Azure and theOverview of Azure Diagnostic Logs.
Read these articles to learn about event hubs:What is Azure Event Hubs?Get started with Event Hubs
What is Azure Event Hubs?
Get started with Event Hubs
ReadUnderstand log searches in Azure Monitor logs.
Feedback
Was this page helpful?
Additional resources