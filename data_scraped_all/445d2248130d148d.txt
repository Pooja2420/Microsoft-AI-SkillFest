Note
Access to this page requires authorization. You can trysigning inorchanging directories.
Access to this page requires authorization. You can trychanging directories.
Audit compliance of Azure container registries using Azure Policy
Article
2024-09-19
6 contributors
In this article
Azure Policyis a service in Azure that you use to create, assign, and manage policy definitions. These policy definitions enforce different rules and effects over your resources, so those resources stay compliant with your corporate standards and service level agreements.
This article introduces built-in policy definitions for Azure Container Registry. Use these definitions to audit new and existing registries for compliance.
There is no charge for using Azure Policy.
Built-in policy definitions
The following built-in policy definitions are specific to Azure Container Registry:
Create policy assignments
Create policy assignments using theAzure portal,Azure CLI, aResource Manager template, or the Azure Policy SDKs.
Scope a policy assignment to a resource group, a subscription, or anAzure management group. Container registry policy assignments apply to existing and new container registries within the scope.
Enable or disablepolicy enforcementat any time.
Note
After you create or update a policy assignment, it takes some time for the assignment to evaluate resources in the defined scope. See information aboutpolicy evaluation triggers.
Review policy compliance
Access compliance information generated by your policy assignments using the Azure portal, Azure command-line tools, or the Azure Policy SDKs. For details, seeGet compliance data of Azure resources.
When a resource is non-compliant, there are many possible reasons. To determine the reason or to find the change responsible, seeDetermine non-compliance.
Policy compliance in the portal:
SelectAll services, and search forPolicy.
SelectAll services, and search forPolicy.
SelectCompliance.
SelectCompliance.
Use the filters to limit compliance states or to search for policies.
Use the filters to limit compliance states or to search for policies.

Select a policy to review aggregate compliance details and events. If desired, then select a specific registry for resource compliance.
Select a policy to review aggregate compliance details and events. If desired, then select a specific registry for resource compliance.
Policy compliance in the Azure CLI
You can also use the Azure CLI to get compliance data. For example, use theaz policy assignment listcommand in the CLI to get the policy IDs of the Azure Container Registry policies that are applied:
az policy assignment list --query "[?contains(displayName,'Container Registries')].{name:displayName, ID:id}" --output table
az policy assignment list --query "[?contains(displayName,'Container Registries')].{name:displayName, ID:id}" --output table
Sample output:
Name                                                                                   ID
-------------------------------------------------------------------------------------  --------------------------------------------------------------------------------------------------------------------------------
Container Registries should not allow unrestricted network access           /subscriptions/<subscriptionID>/providers/Microsoft.Authorization/policyAssignments/b4faf132dc344b84ba68a441
Container Registries should be encrypted with a Customer-Managed Key (CMK)  /subscriptions/<subscriptionID>/providers/Microsoft.Authorization/policyAssignments/cce1ed4f38a147ad994ab60a
Name                                                                                   ID
-------------------------------------------------------------------------------------  --------------------------------------------------------------------------------------------------------------------------------
Container Registries should not allow unrestricted network access           /subscriptions/<subscriptionID>/providers/Microsoft.Authorization/policyAssignments/b4faf132dc344b84ba68a441
Container Registries should be encrypted with a Customer-Managed Key (CMK)  /subscriptions/<subscriptionID>/providers/Microsoft.Authorization/policyAssignments/cce1ed4f38a147ad994ab60a
Then runaz policy state listto return the JSON-formatted compliance state for all resources under a specific policy ID:
az policy state list \
  --resource <policyID>
az policy state list \
  --resource <policyID>
Or runaz policy state listto return the JSON-formatted compliance state of a specific registry resource, such asmyregistry:
az policy state list \
 --resource myregistry \
 --namespace Microsoft.ContainerRegistry \
 --resource-type registries \
 --resource-group myresourcegroup
az policy state list \
 --resource myregistry \
 --namespace Microsoft.ContainerRegistry \
 --resource-type registries \
 --resource-group myresourcegroup
Next steps
Learn more about Azure Policydefinitionsandeffects.
Learn more about Azure Policydefinitionsandeffects.
Create acustom policy definition.
Create acustom policy definition.
Learn more aboutgovernance capabilitiesin Azure.
Learn more aboutgovernance capabilitiesin Azure.
Feedback
Was this page helpful?
Additional resources