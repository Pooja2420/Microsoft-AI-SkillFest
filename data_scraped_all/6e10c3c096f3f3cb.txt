Note
Access to this page requires authorization. You can trysigning inorchanging directories.
Access to this page requires authorization. You can trychanging directories.
Authentication with Azure Maps
Article
2023-10-12
13 contributors
In this article
Azure Maps supports three authentication methods: Shared Key, Microsoft Entra ID, and Shared Access Signature (SAS) Token. This article explains these authentication methods including details on account controls like disabling local authentication for Azure Policy and Cross-Origin Resource Sharing (CORS).
Note
To improve secure communication with Azure Maps, we now support Transport Layer Security (TLS) 1.2, and we're retiring support for TLS 1.0 and 1.1. If you currently use TLS 1.x, evaluate your TLS 1.2 readiness and develop a migration plan with the testing described inSolving the TLS 1.0 Problem.
Shared Key authentication
For information about viewing your keys in the Azure portal, seeView authentication details.
Primary and secondary keys are automatically generated when creating an Azure Maps Account. You're encouraged to use the primary key as the subscription key when calling Azure Maps with shared key authentication. Shared Key authentication passes a key generated by an Azure Maps account to an Azure Maps service. For each request to Azure Maps services, add thesubscription keyas a parameter to the URL. The secondary key can be used in scenarios like rolling key changes.
Example using thesubscription keyas a parameter in your URL:
https://atlas.microsoft.com/map/tile?subscription-key={Your-Azure-Maps-Subscription-key}&api-version=2024-04-01&tilesetId=microsoft.base.road&zoom=15&x=5236&y=12665&tileSize=256
https://atlas.microsoft.com/map/tile?subscription-key={Your-Azure-Maps-Subscription-key}&api-version=2024-04-01&tilesetId=microsoft.base.road&zoom=15&x=5236&y=12665&tileSize=256
Important
Primary and Secondary keys should be treated as sensitive data. The shared key is used to authenticate all Azure Maps REST API. Users who use a shared key should abstract the API key away, either through environment variables or secure secret storage, where it can be managed centrally.

Microsoft Entra authentication
Azure Subscriptions are provided with a Microsoft Entra tenant to enable fine grained access control. Azure Maps offers authentication for Azure Maps services using Microsoft Entra ID. Microsoft Entra ID provides identity-based authentication for users and applications registered in the Microsoft Entra tenant.
Azure Maps acceptsOAuth 2.0access tokens for Microsoft Entra tenants associated with an Azure subscription that contains an Azure Maps account. Azure Maps also accepts tokens for:
Microsoft Entra users
Partner applications that use permissions delegated by users
Managed identities for Azure resources
Azure Maps generates aunique identifier(client ID) for each Azure Maps account. You can request tokens from Microsoft Entra ID when you combine this client ID with other parameters.
For more information about how to configure Microsoft Entra ID and request tokens for Azure Maps, seeManage authentication in Azure Maps.
For general information about authenticating with Microsoft Entra ID, seeAuthentication vs. authorization.
Managed identities for Azure resources and Azure Maps
Managed identities for Azure resourcesprovide Azure services with an automatically managed application based security principal that can authenticate with Microsoft Entra ID. With Azure role-based access control (Azure RBAC), the managed identity security principal can be authorized to access Azure Maps services. Some examples of managed identities include: Azure App Service, Azure Functions, and Azure Virtual Machines. For a list of managed identities, seeAzure services that can use managed identities to access other services. For more information on managed identities, seeManage authentication in Azure Maps.

Configure application Microsoft Entra authentication
Applications authenticate with the Microsoft Entra tenant using one or more supported scenarios provided by Microsoft Entra ID. Each Microsoft Entra application scenario represents different requirements based on business needs. Some applications might require user sign-in experiences and other applications may require an application sign-in experience. For more information, seeAuthentication flows and application scenarios.
After the application receives an access token, the SDK and/or application sends an HTTPS request with the following set of required HTTP headers in addition to other REST API HTTP headers:
Note
x-ms-client-idis the Azure Maps account-based GUID that appears on the Azure Maps authentication page.
x-ms-client-id
Here's an example of an Azure Maps Route request that uses a Microsoft Entra ID OAuth Bearer token:
GET /route/directions/json?api-version=1.0&query=52.50931,13.42936:52.50274,13.43872
Host: atlas.microsoft.com
x-ms-client-id: 30d7ccâ¦.9f55
Authorization: Bearer eyJ0eâ¦HNIVN
GET /route/directions/json?api-version=1.0&query=52.50931,13.42936:52.50274,13.43872
Host: atlas.microsoft.com
x-ms-client-id: 30d7ccâ¦.9f55
Authorization: Bearer eyJ0eâ¦HNIVN
For information about viewing your client ID, seeView authentication details.
Tip
Getting the Client ID programmatically
When using PowerShell, the Client ID is stored as theUniqueIdProperty in theIMapsAccountobject. You retrieve this property usingGet-AzMapsAccount, for example:
UniqueId
IMapsAccount
Get-AzMapsAccount
$maps = Get-AzMapsAccount -Name {Azure-Maps_Account-Name} -ResourceGroupName {Resource-Group-Name} -SubscriptionId {SubscriptionId}
$ClientId = $maps.UniqueId
$maps = Get-AzMapsAccount -Name {Azure-Maps_Account-Name} -ResourceGroupName {Resource-Group-Name} -SubscriptionId {SubscriptionId}
$ClientId = $maps.UniqueId
When using the Azure CLI use theaz maps account showcommand with the--queryparameter, for example:
az maps account show
--query
$ClientId = az maps account show --name {Azure-Maps_Account-Name} --resource-group {Resource-Group-Name} --subscription {SubscriptionId} --query properties.uniqueId
$ClientId = az maps account show --name {Azure-Maps_Account-Name} --resource-group {Resource-Group-Name} --subscription {SubscriptionId} --query properties.uniqueId
Authorization with role-based access control
Prerequisites
If you're new to Azure RBAC,Azure role-based access control (Azure RBAC)overview provides Principal types are granted a set of permissions, also known as a role definition. A role definition provides permissions to REST API actions. Azure Maps supports access to all principal types forAzure role-based access control (Azure RBAC)including: individual Microsoft Entra users, groups, applications, Azure resources, and Azure managed identities. Applying access to one or more Azure Maps accounts is known as a scope. A role assignment is created when a principal, role definition, and scope are applied.
Overview
The next sections discuss concepts and components of Azure Maps integration with Azure RBAC. As part of the process to set up your Azure Maps account, a Microsoft Entra directory is associated to the Azure subscription, which the Azure Maps account resides.
When you configure Azure RBAC, you choose a security principal and apply it to a role assignment. To learn how to add role assignments on the Azure portal, seeAssign Azure roles using the Azure portal.
Picking a role definition
The following role definition types exist to support application scenarios.
Some Azure Maps services require elevated privileges to perform write or delete actions on Azure Maps REST APIs. Azure Maps Data Contributor role is required for services, which provide write or delete actions. The following table describes what services Azure Maps Data Contributor is applicable when using write or delete actions. When only read actions are required, the Azure Maps Data Reader role can be used in place of the Azure Maps Data Contributor role.
1Azure Maps Creator, and the Data registry and Spatial services are now deprecated and will be retired on 9/30/25.
For information about viewing your Azure RBAC settings, seeHow to configure Azure RBAC for Azure Maps.
One aspect of application security is the principle of least privilege, the practice of limiting access rights to the rights required for the current job. Limiting access rights is accomplished by creating custom role definitions that support use cases requiring further granularity to access control. To create a custom role definition, select specific data actions to include or exclude for the definition.
The custom role definition can then be used in a role assignment for any security principal. To learn more about Azure custom role definitions, seeAzure custom roles.
Here are some example scenarios where custom roles can improve application security.
Microsoft.Maps/accounts/services/render/read
Microsoft.Maps/accounts/services/search/read
Microsoft.Maps/accounts/services/data/read
Microsoft.Maps/accounts/services/render/read
Microsoft.Maps/accounts/services/data/read
Microsoft.Maps/accounts/services/data/write
Microsoft.Maps/accounts/services/data/delete
Understand scope
Role assignments are defined within the Azure resource hierarchy, from the top-levelmanagement groupto the lowest level like an Azure Maps account.
Assigning a role assignment to a resource group can enable access to multiple Azure Maps accounts or resources in the group.
Tip
Microsoft's general recommendation is to assign access to the Azure Maps account scope because it preventsunintended access to other Azure Maps accountsexisting in the same Azure subscription.
Disable local authentication
Azure Maps accounts support the standard Azure property in theManagement APIforMicrosoft.Maps/accountscalleddisableLocalAuth. Whentrue, all authentication to the Azure Maps data-plane REST API is disabled, exceptMicrosoft Entra authentication. This is configured using Azure Policy to control distribution and management of shared keys and SAS tokens. For more information, seeWhat is Azure Policy?.
Microsoft.Maps/accounts
disableLocalAuth
Disabling local authentication doesn't take effect immediately. Allow a few minutes for the service to block future authentication requests. To re-enable local authentication, set the property tofalseand after a few minutes local authentication resumes.
{
  // omitted other properties for brevity.
  "properties": {
    "disableLocalAuth": true
  }
}
{
  // omitted other properties for brevity.
  "properties": {
    "disableLocalAuth": true
  }
}
Shared access signature token authentication
Shared access signature (SAS) tokens are authentication tokens created using the JSON Web Token (JWT) format. These tokens are cryptographically signed to authenticate an application with the Azure Maps REST API. These SAS tokens are created by integrating auser-assigned managed identitywith an Azure Maps account in your Azure subscription. The user-assigned managed identity is given authorization to the Azure Maps account through Azure RBAC using either built-in or custom role definitions.
Functional key differences of SAS token from Microsoft Entra access tokens:
Lifetime of a token for a max expiration of one day (24 hours).
Azure location and geography access control per token.
Rate limits per token for an approximate of 1 to 500 requests per second.
Private keys of the token are the primary and secondary keys of an Azure Maps account resource.
Service Principal object for authorization is supplied by a user-assigned managed identity.
SAS tokens are immutable. Once they're created, they remain valid until they expire and their settings such as allowed regions, rate limits, and user-assigned managed identity can't be altered. For more information on SAS token revocation and modifications to access control, seeunderstanding access control.
Understand SAS token rate limits
When setting a maximum rate limit on the token (maxRatePerSecond), any rates exceeding this limit aren't billed to the account, enabling you to establish a cap on billable transactions. However, the application receives client error responses with429 (TooManyRequests)for all transactions once that limit is reached. It's the application's responsibility to manage retries and distribution of SAS tokens. There's no restriction on the number of SAS tokens that can be created for an account. To modify an existing token's limit, a new SAS token must be generated. The old SAS token remains valid until it expires.
maxRatePerSecond
429 (TooManyRequests)
Estimated Example:
Actual rate limits vary based on Azure Maps ability to enforce consistency within a span of time. However, this allows for preventive control of billing cost.
For example, a single SAS token with amaxRatePerSecondof 10 can be used to limit the throughput in theEast USlocation. If that same token is used inWest US 2, a new counter is created to limit the throughput to 10 in that location, independent of theEast USlocation. Suggestions to control costs and improve predictability:
maxRatePerSecond
East US
West US 2
East US
Create SAS tokenswith designated allowed Azure locations for targeted geography.
Use geographic data-plane REST API endpoints,https://us.atlas.microsoft.comorhttps://eu.atlas.microsoft.com.
https://us.atlas.microsoft.com
https://eu.atlas.microsoft.com
Consider the application topology where the endpointhttps://us.atlas.microsoft.comroutes to the same US locations that the Azure Maps services are hosted, such asEast US,West Central US, orWest US 2. The same idea applies to other geographical endpoints such ashttps://eu.atlas.microsoft.combetweenWest EuropeandNorth Europe. To prevent unexpected authorization denials, use a SAS token that uses the same Azure locations that the application consumes. The endpoint location is defined using the Azure Maps Management REST API.
https://us.atlas.microsoft.com
East US
West Central US
West US 2
https://eu.atlas.microsoft.com
West Europe
North Europe
As described inAzure Maps rate limits, the rate limits for individual service offerings are enforced collectively at the account level.
Consider the case ofSearch service - Non-Batch Reverse, with its limit of 250 queries per second (QPS) for the following tables. Each table represents estimated total successful transactions from example usage.
The first table shows one token that has a maximum request per second of 500, and actual usage of the application is 500 request per second for a duration of 60 seconds.Search service - Non-Batch Reversehas a rate limit of 250, meaning of the total 30,000 requests made in the 60 seconds; 15,000 of those requests are billable transactions. The remaining requests result in status code429 (TooManyRequests).
429 (TooManyRequests)
For example, if two SAS tokens are created and use the same location as an Azure Maps account, each token shares the default rate limit of 250 QPS. If both tokens are used simultaneously with the same throughput, each token would grant 7,500 successful transactions.
Understand SAS token access control
SAS tokens use RBAC to control access to the REST API. When you create a SAS token, the prerequisite managed identity on the Map Account is assigned an Azure RBAC role that grants access to specific REST API actions. SeePicking a role definitionto determine which APIs the application allows.
To assign temporary access and remove it before the SAS token expires, revoke the token. Another reason to revoke access is if the token was distributed unintentionally with theAzure Maps Data Contributorrole, which can allow unauthorized data read/write on Azure Maps REST APIs, leading to sensitive data exposure or unexpected costs.
There are two options to revoke access for SAS tokens:
Regenerate the key that was used by the SAS token or secondaryKey of the map account.
Remove the role assignment for the managed identity on the associated map account.
Warning
Deleting a managed identity used by a SAS token or revoking access control of the managed identity can result in instances of your application using the SAS token and managed identity to return401 Unauthorizedor403 Forbiddenfrom Azure Maps REST APIs, leading to potential application disruptions.
401 Unauthorized
403 Forbidden
To avoid disruption:
Add a second managed identity to the Map Account and grant the new managed identity the correct role assignment.
Create a SAS token usingsecondaryKey, or a different managed identity than the previous one, as thesigningKeyand distribute the new SAS token to the application.
secondaryKey
signingKey
Regenerate the primary key, remove the managed identity from the account, and remove the role assignment for the managed identity.
Create SAS tokens
To create SAS tokens, you must haveContributorrole access to both manage Azure Maps accounts and user-assigned identities in the Azure subscription.
Contributor
Important
Existing Azure Maps accounts created in the Azure locationglobaldon't support managed identities.
global
First, you shouldCreate a user-assigned managed identityin the same location as the Azure Maps account.
Tip
You should use the same location for both the managed identity and the Azure Maps account.
Once a managed identity is created, you can create or update the Azure Maps account and attach it. For more information, seeManage your Azure Maps account.
Once the account is successfully created or updated with the managed identity; assign role-based access control for the managed identity to an Azure Maps data role at the account scope. This enables the managed identity to be given access to the Azure Maps REST API for your map account.
Next, create a SAS token using the Azure Management SDK tooling, List SAS operation on Account Management API, or the Azure portal Shared Access Signature page of the Map account resource.
SAS token parameters:
primaryKey
primaryKey
secondaryKey
<GUID>
[ "eastus", "westus2", "westcentralus" ]
null
us.atlas.microsoft.com
eu.atlas.microsoft.com
429 (TooManyRequests)
2021-05-24T10:42:03.1567373Z
2021-05-24T11:42:03.1567373Z
Configuring application with SAS token
After the application receives a SAS token, the Azure Maps SDK and/or applications send an HTTPS request with the following required HTTP header in addition to other REST API HTTP headers:
Note
jwt-sasis the authentication scheme to denote using SAS token. Don't includex-ms-client-idor other Authorization headers orsubscription-keyquery string parameter.
jwt-sas
x-ms-client-id
subscription-key
Cross origin resource sharing (CORS)
CORSis an HTTP protocol that enables a web application running under one domain to access resources in another domain. Web browsers implement a security restriction known assame-origin policythat prevents a web page from calling APIs in a different domain; CORS provides a secure way to allow one domain (the origin domain) to call APIs in another domain. Using the Azure Maps account resource, you can configure which origins are allowed to access the Azure Maps REST API from your applications.
Important
CORS isn't an authorization mechanism. Requests made to a map account using REST API, when CORS is enabled, also needs a valid map account authentication scheme such as Shared Key, Microsoft Entra ID, or SAS token.
CORS is supported for all map account pricing tiers, data-plane endpoints, and locations.
Prerequisites
To prevent malicious code execution on the client, modern browsers block requests from web applications to resources running in a separate domain.
If you're unfamiliar with CORS, seeCross-origin resource sharing (CORS), it lets anAccess-Control-Allow-Originheader declare which origins are allowed to call endpoints of an Azure Maps account. CORS protocol isn't specific to Azure Maps.
Access-Control-Allow-Origin
CORS requests
A CORS request from an origin domain may consist of two separate requests:
A preflight request, which queries the CORS restrictions imposed by the service. The preflight request is required unless the request is standard method GET, HEAD, POST, or requests that containAuthorizationrequest header.
A preflight request, which queries the CORS restrictions imposed by the service. The preflight request is required unless the request is standard method GET, HEAD, POST, or requests that containAuthorizationrequest header.
Authorization
The actual request, made against the desired resource.
The actual request, made against the desired resource.
Preflight request
The preflight request is a security measure but also ensures that the server understands the method and headers sent in the actual request, verifies the source of the request, and queries the CORS restrictions established for the map account. The web browser (or other user agent) sends an OPTIONS request that includes the request headers, method, and origin domain. The map account service tries to fetch any CORS rules if account authentication is possible through the CORS preflight protocol.
If authentication isn't possible, the maps service evaluates a preconfigured set of CORS rules that specify which origin domains, request methods, and request headers may be specified on an actual request against the maps service. By default, a maps account is configured to allow all origins to enable seamless integration into web browsers.
The service responds to the preflight request with the required Access-Control headers if the following criteria are met:
The OPTIONS request contains the required CORS headers (the Origin and Access-Control-Request-Method headers)
Authentication was successful and A CORS rule is enabled for the account that matches the preflight request.
Authentication was skipped due to requiredAuthorizationrequest headers that can't be specified on preflight request.
Authorization
When preflight request is successful, the service responds with status code200 (OK), and includes the required Access-Control headers in the response.
200 (OK)
The service rejects preflight requests if the following conditions occur:
If the OPTIONS request doesnât contain the required CORS headers (the Origin and Access-Control-Request-Method headers), the service responds with status code400 (Bad request).
400 (Bad request)
If authentication was successful on preflight request and no CORS rule matches the preflight request, the service responds with status code403 (Forbidden). This may occur if the CORS rule is configured to accept an origin that doesn't match the current browser client origin request header.
403 (Forbidden)
Note
A preflight request is evaluated against the service and not against the requested resource. The account owner must have enabled CORS by setting the appropriate account properties in order for the request to succeed.
Actual request
Once the preflight request is accepted and the response is returned, the browser dispatches the actual request against the map service. The browser denies the actual request immediately if the preflight request is rejected.
The actual request is treated as a normal request against the map service. The presence of theOriginheader indicates that the request is a CORS request and the service then validates against the CORS rules. If a match is found, the Access-Control headers are added to the response and sent back to the client. If a match isn't found, the response returns a403 (Forbidden)indicating a CORS origin error.
Origin
403 (Forbidden)
Enable CORS policy
When a Map account is created or updated, its properties define the permitted origins. A CORS rule can be set on the Azure Maps account properties through the Azure Maps Management SDK, Azure Maps Management REST API, and portal. After setting the CORS rule for the service, authorized requests from different domains are evaluated to ensure compliance with the specified rule. For example:
{
  "location": "eastus",
  "sku": {
    "name": "G2"
  },
  "kind": "Gen2",
  "properties": {
    "cors": {
      "corsRules": [
        {
          "allowedOrigins": [
            "https://www.azure.com",
            "https://www.microsoft.com"
          ]
        }
      ]
    }
  }
}
{
  "location": "eastus",
  "sku": {
    "name": "G2"
  },
  "kind": "Gen2",
  "properties": {
    "cors": {
      "corsRules": [
        {
          "allowedOrigins": [
            "https://www.azure.com",
            "https://www.microsoft.com"
          ]
        }
      ]
    }
  }
}
Only one CORS rule with its list of allowed origins can be specified. Each origin allows the HTTP request to be made to Azure Maps REST API in the web browser of the specified origin.
Remove CORS policy
You can remove CORS:
Manually in the Azure portal
Programmatically using:The Azure Maps SDKAzure Maps management REST APIAnARM template
The Azure Maps SDK
Azure Maps management REST API
AnARM template
Tip
If you use the Azure Maps management REST API, usePUTorPATCHwith an emptycorsRulelist in the request body.
PUT
PATCH
corsRule
{
  "location": "eastus",
  "sku": {
    "name": "G2"
  },
  "kind": "Gen2",
  "properties": {
        "cors": {
          "corsRules": []
        }
    }
  }
}
{
  "location": "eastus",
  "sku": {
    "name": "G2"
  },
  "kind": "Gen2",
  "properties": {
        "cors": {
          "corsRules": []
        }
    }
  }
}
Understand billing transactions
Azure Maps doesn't count billing transactions for:
5xx HTTP Status Codes
401 (Unauthorized)
403 (Forbidden)
408 (Timeout)
429 (TooManyRequests)
CORS preflight requests
For more information on billing transactions and other Azure Maps pricing information, seeAzure Maps pricing.
Next steps
To learn more about security best practices, see:
Authentication and authorization best practices
To learn more about authenticating an application with Microsoft Entra ID and Azure Maps, see:
Manage authentication in Azure Maps
To learn more about authenticating the Azure Maps Control with Microsoft Entra ID, see:
Use the Azure Maps Map Control
Feedback
Was this page helpful?
Additional resources