Note
Access to this page requires authorization. You can trysigning inorchanging directories.
Access to this page requires authorization. You can trychanging directories.
Create a virtual network peering - Resource Manager, different subscriptions and Microsoft Entra tenants
Article
2024-07-01
24 contributors
In this article
In this tutorial, you learn to create a virtual network peering between virtual networks created through Resource Manager. The virtual networks exist in different subscriptions that might belong to different Microsoft Entra tenants. Peering two virtual networks enables resources in different virtual networks to communicate with each other with the same bandwidth and latency as though the resources were in the same virtual network. Learn more aboutVirtual network peering.
Depending on whether, the virtual networks are in the same, or different subscriptions the steps to create a virtual network peering are different. Steps to peer networks created with the classic deployment model are different. For more information about deployment models, seeAzure deployment model.
Learn how to create a virtual network peering in other scenarios by selecting the scenario from the following table:
A virtual network peering can't be created between two virtual networks deployed through the classic deployment model. If you need to connect virtual networks that were both created through the classic deployment model, you can use an AzureVPN Gatewayto connect the virtual networks.
This tutorial peers virtual networks in the same region. You can also peer virtual networks in differentsupported regions. Familiarize yourself with thepeering requirements and constraintsbefore peering virtual networks.
Prerequisites
Portal
PowerShell
Azure CLI
An Azure account or accounts with two active subscriptions.Create an account for free.
An Azure account or accounts with two active subscriptions.Create an account for free.
An Azure account with permissions in both subscriptions or an account in each subscription with the proper permissions to create a virtual network peering. For a list of permissions, seeVirtual network peering permissions.To separate the duty of managing the network belonging to each tenant, add the user from each tenant as a guest in the opposite tenant and assign them the Network Contributor role to the virtual network. This procedure applies if the virtual networks are in different subscriptions and Active Directory tenants.To establish a network peering when you don't intend to separate the duty of managing the network belonging to each tenant, add the user from tenant A as a guest in the opposite tenant. Then, assign them the Network Contributor role to initiate and connect the network peering from each subscription. With these permissions, the user is able to establish the network peering from each subscription.For more information about guest users, seeAdd Microsoft Entra B2B collaboration users in the Azure portal.Each user must accept the guest user invitation from the opposite Microsoft Entra tenant.
An Azure account with permissions in both subscriptions or an account in each subscription with the proper permissions to create a virtual network peering. For a list of permissions, seeVirtual network peering permissions.
To separate the duty of managing the network belonging to each tenant, add the user from each tenant as a guest in the opposite tenant and assign them the Network Contributor role to the virtual network. This procedure applies if the virtual networks are in different subscriptions and Active Directory tenants.
To separate the duty of managing the network belonging to each tenant, add the user from each tenant as a guest in the opposite tenant and assign them the Network Contributor role to the virtual network. This procedure applies if the virtual networks are in different subscriptions and Active Directory tenants.
To establish a network peering when you don't intend to separate the duty of managing the network belonging to each tenant, add the user from tenant A as a guest in the opposite tenant. Then, assign them the Network Contributor role to initiate and connect the network peering from each subscription. With these permissions, the user is able to establish the network peering from each subscription.
To establish a network peering when you don't intend to separate the duty of managing the network belonging to each tenant, add the user from tenant A as a guest in the opposite tenant. Then, assign them the Network Contributor role to initiate and connect the network peering from each subscription. With these permissions, the user is able to establish the network peering from each subscription.
For more information about guest users, seeAdd Microsoft Entra B2B collaboration users in the Azure portal.
For more information about guest users, seeAdd Microsoft Entra B2B collaboration users in the Azure portal.
Each user must accept the guest user invitation from the opposite Microsoft Entra tenant.
Each user must accept the guest user invitation from the opposite Microsoft Entra tenant.
Sign-in to theAzure portal.
Sign-in to theAzure portal.
An Azure account or accounts with two active subscriptions.Create an account for free.
An Azure account or accounts with two active subscriptions.Create an account for free.
An Azure account with permissions in both subscriptions or an account in each subscription with the proper permissions to create a virtual network peering. For a list of permissions, seeVirtual network peering permissions.To separate the duty of managing the network belonging to each tenant, add the user from each tenant as a guest in the opposite tenant and assign them the Network Contributor role to the virtual network. This procedure applies if the virtual networks are in different subscriptions and Active Directory tenants.To establish a network peering when you don't intend to separate the duty of managing the network belonging to each tenant, add the user from tenant A as a guest in the opposite tenant. Then, assign them the Network Contributor role to initiate and connect the network peering from each subscription. With these permissions, the user is able to establish the network peering from each subscription.For more information about guest users, seeAdd Microsoft Entra B2B collaboration users in the Azure portal.Each user must accept the guest user invitation from the opposite Microsoft Entra tenant.
An Azure account with permissions in both subscriptions or an account in each subscription with the proper permissions to create a virtual network peering. For a list of permissions, seeVirtual network peering permissions.
To separate the duty of managing the network belonging to each tenant, add the user from each tenant as a guest in the opposite tenant and assign them the Network Contributor role to the virtual network. This procedure applies if the virtual networks are in different subscriptions and Active Directory tenants.
To separate the duty of managing the network belonging to each tenant, add the user from each tenant as a guest in the opposite tenant and assign them the Network Contributor role to the virtual network. This procedure applies if the virtual networks are in different subscriptions and Active Directory tenants.
To establish a network peering when you don't intend to separate the duty of managing the network belonging to each tenant, add the user from tenant A as a guest in the opposite tenant. Then, assign them the Network Contributor role to initiate and connect the network peering from each subscription. With these permissions, the user is able to establish the network peering from each subscription.
To establish a network peering when you don't intend to separate the duty of managing the network belonging to each tenant, add the user from tenant A as a guest in the opposite tenant. Then, assign them the Network Contributor role to initiate and connect the network peering from each subscription. With these permissions, the user is able to establish the network peering from each subscription.
For more information about guest users, seeAdd Microsoft Entra B2B collaboration users in the Azure portal.
For more information about guest users, seeAdd Microsoft Entra B2B collaboration users in the Azure portal.
Each user must accept the guest user invitation from the opposite Microsoft Entra tenant.
Each user must accept the guest user invitation from the opposite Microsoft Entra tenant.
Azure PowerShell installed locally or Azure Cloud Shell.
Azure PowerShell installed locally or Azure Cloud Shell.
Sign in to Azure PowerShell and select the subscription with which you want to use this feature. For more information, seeSign in with Azure PowerShell.
Sign in to Azure PowerShell and select the subscription with which you want to use this feature. For more information, seeSign in with Azure PowerShell.
Ensure yourAz.Networkmodule is 4.3.0 or later. To verify the installed module, use the commandGet-InstalledModule -Name "Az.Network". If the module requires an update, use the commandUpdate-Module -Name Az.Networkif necessary.
Ensure yourAz.Networkmodule is 4.3.0 or later. To verify the installed module, use the commandGet-InstalledModule -Name "Az.Network". If the module requires an update, use the commandUpdate-Module -Name Az.Networkif necessary.
Az.Network
Get-InstalledModule -Name "Az.Network"
Update-Module -Name Az.Network
If you choose to install and use PowerShell locally, this article requires the Azure PowerShell module version 5.4.1 or later. RunGet-Module -ListAvailable Azto find the installed version. If you need to upgrade, seeInstall Azure PowerShell module. If you're running PowerShell locally, you also need to runConnect-AzAccountto create a connection with Azure.
Get-Module -ListAvailable Az
Connect-AzAccount
An Azure account or accounts with two active subscriptions.Create an account for free.
An Azure account or accounts with two active subscriptions.Create an account for free.
An Azure account with permissions in both subscriptions or an account in each subscription with the proper permissions to create a virtual network peering. For a list of permissions, seeVirtual network peering permissions.To separate the duty of managing the network belonging to each tenant, add the user from each tenant as a guest in the opposite tenant and assign them the Network Contributor role to the virtual network. This procedure applies if the virtual networks are in different subscriptions and Active Directory tenants.To establish a network peering when you don't intend to separate the duty of managing the network belonging to each tenant, add the user from tenant A as a guest in the opposite tenant. Then, assign them the Network Contributor role to initiate and connect the network peering from each subscription. With these permissions, the user is able to establish the network peering from each subscription.For more information about guest users, seeAdd Microsoft Entra B2B collaboration users in the Azure portal.Each user must accept the guest user invitation from the opposite Microsoft Entra tenant.
An Azure account with permissions in both subscriptions or an account in each subscription with the proper permissions to create a virtual network peering. For a list of permissions, seeVirtual network peering permissions.
To separate the duty of managing the network belonging to each tenant, add the user from each tenant as a guest in the opposite tenant and assign them the Network Contributor role to the virtual network. This procedure applies if the virtual networks are in different subscriptions and Active Directory tenants.
To separate the duty of managing the network belonging to each tenant, add the user from each tenant as a guest in the opposite tenant and assign them the Network Contributor role to the virtual network. This procedure applies if the virtual networks are in different subscriptions and Active Directory tenants.
To establish a network peering when you don't intend to separate the duty of managing the network belonging to each tenant, add the user from tenant A as a guest in the opposite tenant. Then, assign them the Network Contributor role to initiate and connect the network peering from each subscription. With these permissions, the user is able to establish the network peering from each subscription.
To establish a network peering when you don't intend to separate the duty of managing the network belonging to each tenant, add the user from tenant A as a guest in the opposite tenant. Then, assign them the Network Contributor role to initiate and connect the network peering from each subscription. With these permissions, the user is able to establish the network peering from each subscription.
For more information about guest users, seeAdd Microsoft Entra B2B collaboration users in the Azure portal.
For more information about guest users, seeAdd Microsoft Entra B2B collaboration users in the Azure portal.
Each user must accept the guest user invitation from the opposite Microsoft Entra tenant.
Each user must accept the guest user invitation from the opposite Microsoft Entra tenant.
Use the Bash environment inAzure Cloud Shell. For more information, seeGet started with Azure Cloud Shell.
Use the Bash environment inAzure Cloud Shell. For more information, seeGet started with Azure Cloud Shell.

If you prefer to run CLI reference commands locally,installthe Azure CLI. If you're running on Windows or macOS, consider running Azure CLI in a Docker container. For more information, seeHow to run the Azure CLI in a Docker container.If you're using a local installation, sign in to the Azure CLI by using theaz logincommand. To finish the authentication process, follow the steps displayed in your terminal. For other sign-in options, seeAuthenticate to Azure using Azure CLI.When you're prompted, install the Azure CLI extension on first use. For more information about extensions, seeUse and manage extensions with the Azure CLI.Runaz versionto find the version and dependent libraries that are installed. To upgrade to the latest version, runaz upgrade.
If you prefer to run CLI reference commands locally,installthe Azure CLI. If you're running on Windows or macOS, consider running Azure CLI in a Docker container. For more information, seeHow to run the Azure CLI in a Docker container.
If you're using a local installation, sign in to the Azure CLI by using theaz logincommand. To finish the authentication process, follow the steps displayed in your terminal. For other sign-in options, seeAuthenticate to Azure using Azure CLI.
If you're using a local installation, sign in to the Azure CLI by using theaz logincommand. To finish the authentication process, follow the steps displayed in your terminal. For other sign-in options, seeAuthenticate to Azure using Azure CLI.
When you're prompted, install the Azure CLI extension on first use. For more information about extensions, seeUse and manage extensions with the Azure CLI.
When you're prompted, install the Azure CLI extension on first use. For more information about extensions, seeUse and manage extensions with the Azure CLI.
Runaz versionto find the version and dependent libraries that are installed. To upgrade to the latest version, runaz upgrade.
Runaz versionto find the version and dependent libraries that are installed. To upgrade to the latest version, runaz upgrade.
This how-to article requires version 2.31.0 or later of the Azure CLI. If using Azure Cloud Shell, the latest version is already installed.
In the following steps, learn how to peer virtual networks in different subscriptions and Microsoft Entra tenants.
You can use the same account that has permissions in both subscriptions or you can use separate accounts for each subscription to set up the peering. An account with permissions in both subscriptions can complete all of the steps without signing out and signing in to portal and assigning permissions.
The following resources and account examples are used in the steps in this article:
Create virtual network - vnet-1
Note
If you are using a single account to complete the steps, you can skip the steps for logging out of the portal and assigning another user permissions to the virtual networks.
Portal
PowerShell
Azure CLI

The following procedure creates a virtual network with a resource subnet.
In the portal, search for and selectVirtual networks.
In the portal, search for and selectVirtual networks.
On theVirtual networkspage, select+ Create.
On theVirtual networkspage, select+ Create.
On theBasicstab ofCreate virtual network, enter or select the following information:SettingValueProject detailsSubscriptionSelect your subscription.Resource groupSelectCreate new.Entertest-rgin Name.SelectOK.Instance detailsNameEntervnet-1.RegionSelectEast US 2.
On theBasicstab ofCreate virtual network, enter or select the following information:

SelectNextto proceed to theSecuritytab.
SelectNextto proceed to theSecuritytab.
SelectNextto proceed to theIP Addressestab.
SelectNextto proceed to theIP Addressestab.
In the address space box inSubnets, select thedefaultsubnet.
In the address space box inSubnets, select thedefaultsubnet.
InEdit subnet, enter or select the following information:SettingValueSubnet purposeLeave the defaultDefault.NameEntersubnet-1.
InEdit subnet, enter or select the following information:
Leave the rest of the settings as their defaults. SelectSave.
Leave the rest of the settings as their defaults. SelectSave.

SelectSave.
SelectSave.
SelectReview + createat the bottom of the screen, and when validation passes, selectCreate.
SelectReview + createat the bottom of the screen, and when validation passes, selectCreate.
Sign in to subscription-1
UseConnect-AzAccountto sign in tosubscription-1.
Connect-AzAccount
Connect-AzAccount
If you're using one account for both subscriptions, sign in to that account and change the subscription context tosubscription-1withSet-AzContext.
Set-AzContext -Subscription subscription-1
Set-AzContext -Subscription subscription-1
Create a resource group - test-rg
An Azure resource group is a logical container where Azure resources are deployed and managed.
Create a resource group withNew-AzResourceGroup:
$rsg = @{
    Name = 'test-rg'
    Location = 'eastus2'
}
New-AzResourceGroup @rsg
$rsg = @{
    Name = 'test-rg'
    Location = 'eastus2'
}
New-AzResourceGroup @rsg
Create the virtual network
Create a virtual network withNew-AzVirtualNetwork. This example creates a subnet-1 virtual network namedvnet-1in theWest US 3location:
$vnet = @{
    Name = 'vnet-1'
    ResourceGroupName = 'test-rg'
    Location = 'eastus2'
    AddressPrefix = '10.0.0.0/16'
}
$virtualNetwork = New-AzVirtualNetwork @vnet
$vnet = @{
    Name = 'vnet-1'
    ResourceGroupName = 'test-rg'
    Location = 'eastus2'
    AddressPrefix = '10.0.0.0/16'
}
$virtualNetwork = New-AzVirtualNetwork @vnet
Add a subnet
Azure deploys resources to a subnet within a virtual network, so you need to create a subnet. Create a subnet configuration namedsubnet-1withAdd-AzVirtualNetworkSubnetConfig:
$subnet = @{
    Name = 'subnet-1'
    VirtualNetwork = $virtualNetwork
    AddressPrefix = '10.0.0.0/24'
}
$subnetConfig = Add-AzVirtualNetworkSubnetConfig @subnet
$subnet = @{
    Name = 'subnet-1'
    VirtualNetwork = $virtualNetwork
    AddressPrefix = '10.0.0.0/24'
}
$subnetConfig = Add-AzVirtualNetworkSubnetConfig @subnet
Associate the subnet to the virtual network
You can write the subnet configuration to the virtual network withSet-AzVirtualNetwork. This command creates the subnet:
$virtualNetwork | Set-AzVirtualNetwork
$virtualNetwork | Set-AzVirtualNetwork
Sign in to subscription-1
Useaz sign-into sign in tosubscription-1.
az login
az login
If you're using one account for both subscriptions, sign in to that account and change the subscription context tosubscription-1withaz account set.
az account set --subscription "subscription-1"
az account set --subscription "subscription-1"
Create a resource group - test-rg
An Azure resource group is a logical container where Azure resources are deployed and managed.
Create a resource group withaz group create:
az group create \
    --name test-rg \
    --location eastus2
az group create \
    --name test-rg \
    --location eastus2
Create the virtual network
Create a virtual network and subnet withaz network vnet create. This example creates a subnet-1 virtual network namedvnet-1in theWest US 3location.
az network vnet create \
    --resource-group test-rg\
    --location eastus2 \
    --name vnet-1 \
    --address-prefixes 10.0.0.0/16 \
    --subnet-name subnet-1 \
    --subnet-prefixes 10.0.0.0/24
az network vnet create \
    --resource-group test-rg\
    --location eastus2 \
    --name vnet-1 \
    --address-prefixes 10.0.0.0/16 \
    --subnet-name subnet-1 \
    --subnet-prefixes 10.0.0.0/24
Assign permissions for user-2
A user account in the other subscription that you want to peer with must be added to the network you previously created. If you're using a single account for both subscriptions, you can skip this section.
Portal
PowerShell
Azure CLI
Remain signed in to the portal asuser-1.
Remain signed in to the portal asuser-1.
In the search box a the top of the portal, enterVirtual network. SelectVirtual networksin the search results.
In the search box a the top of the portal, enterVirtual network. SelectVirtual networksin the search results.
Selectvnet-1.
Selectvnet-1.
SelectAccess control (IAM).
SelectAccess control (IAM).
Select+ Add->Add role assignment.
Select+ Add->Add role assignment.
InAdd role assignmentin theRoletab, selectNetwork Contributor.
InAdd role assignmentin theRoletab, selectNetwork Contributor.
SelectNext.
SelectNext.
In theMemberstab, select+ Select members.
In theMemberstab, select+ Select members.
InSelect membersin the search box, enteruser-2.
InSelect membersin the search box, enteruser-2.
SelectSelect.
SelectSelect.
SelectReview + assign.
SelectReview + assign.
SelectReview + assign.
SelectReview + assign.
UseGet-AzVirtualNetworkto obtain the resource ID forvnet-1. Assignuser-2fromsubscription-2tovnet-1withNew-AzRoleAssignment.
UseGet-AzADUserto obtain the object ID foruser-2.
user-2is used in this example for the user account. Replace this value with the display name for the user fromsubscription-2that you wish to assign permissions tovnet-1. You can skip this step if you're using the same account for both subscriptions.
$id = @{
    Name = 'vnet-1'
    ResourceGroupName = 'test-rg'
}
$vnet = Get-AzVirtualNetwork @id

$obj = Get-AzADUser -DisplayName 'user-2'

$role = @{
    ObjectId = $obj.id
    RoleDefinitionName = 'Network Contributor'
    Scope = $vnet.id
}
New-AzRoleAssignment @role
$id = @{
    Name = 'vnet-1'
    ResourceGroupName = 'test-rg'
}
$vnet = Get-AzVirtualNetwork @id

$obj = Get-AzADUser -DisplayName 'user-2'

$role = @{
    ObjectId = $obj.id
    RoleDefinitionName = 'Network Contributor'
    Scope = $vnet.id
}
New-AzRoleAssignment @role
Useaz network vnet showto obtain the resource ID forvnet-1. Assignuser-2fromsubscription-2tovnet-1withaz role assignment create.
Useaz ad user listto obtain the object ID foruser-2.
user-2is used in this example for the user account. Replace this value with the display name for the user fromsubscription-2that you wish to assign permissions tovnet-1. You can skip this step if you're using the same account for both subscriptions.
az ad user list --display-name user-2
az ad user list --display-name user-2
[
  {
    "businessPhones": [],
    "displayName": "user-2",
    "givenName": null,
    "id": "aaaaaaaa-0000-1111-2222-bbbbbbbbbbbb",
    "jobTitle": null,
    "mail": "user-2@fabrikam.com",
    "mobilePhone": null,
    "officeLocation": null,
    "preferredLanguage": null,
    "surname": null,
    "userPrincipalName": "user-2_fabrikam.com#EXT#@contoso.onmicrosoft.com"
  }
]
[
  {
    "businessPhones": [],
    "displayName": "user-2",
    "givenName": null,
    "id": "aaaaaaaa-0000-1111-2222-bbbbbbbbbbbb",
    "jobTitle": null,
    "mail": "user-2@fabrikam.com",
    "mobilePhone": null,
    "officeLocation": null,
    "preferredLanguage": null,
    "surname": null,
    "userPrincipalName": "user-2_fabrikam.com#EXT#@contoso.onmicrosoft.com"
  }
]
Make note of the object ID ofuser-2in fieldid. In this example, itsaaaaaaaa-0000-1111-2222-bbbbbbbbbbbb.
vnetid=$(az network vnet show \
    --name vnet-1 \
    --resource-group test-rg \
    --query id \
    --output tsv)

az role assignment create \
      --assignee aaaaaaaa-0000-1111-2222-bbbbbbbbbbbb \
      --role "Network Contributor" \
      --scope $vnetid
vnetid=$(az network vnet show \
    --name vnet-1 \
    --resource-group test-rg \
    --query id \
    --output tsv)

az role assignment create \
      --assignee aaaaaaaa-0000-1111-2222-bbbbbbbbbbbb \
      --role "Network Contributor" \
      --scope $vnetid
Replace the example guid in--assigneewith the real object ID foruser-2.
--assignee
Obtain resource ID of vnet-1
Portal
PowerShell
Azure CLI
Remain signed in to the portal asuser-1.
Remain signed in to the portal asuser-1.
In the search box a the top of the portal, enterVirtual network. SelectVirtual networksin the search results.
In the search box a the top of the portal, enterVirtual network. SelectVirtual networksin the search results.
Selectvnet-1.
Selectvnet-1.
InSettings, selectProperties.
InSettings, selectProperties.
Copy the information in theResource IDfield and save for the later steps. The resource ID is similar to the following example:/subscriptions/<Subscription Id>/resourceGroups/test-rg/providers/Microsoft.Network/virtualNetworks/vnet-1.
Copy the information in theResource IDfield and save for the later steps. The resource ID is similar to the following example:/subscriptions/<Subscription Id>/resourceGroups/test-rg/providers/Microsoft.Network/virtualNetworks/vnet-1.
/subscriptions/<Subscription Id>/resourceGroups/test-rg/providers/Microsoft.Network/virtualNetworks/vnet-1
Sign out of the portal asuser-1.
Sign out of the portal asuser-1.
The resource ID ofvnet-1is required to set up the peering connection fromvnet-2tovnet-1. UseGet-AzVirtualNetworkto obtain the resource ID forvnet-1.
$id = @{
    Name = 'vnet-1'
    ResourceGroupName = 'test-rg'
}
$vnetA = Get-AzVirtualNetwork @id

$vnetA.id
$id = @{
    Name = 'vnet-1'
    ResourceGroupName = 'test-rg'
}
$vnetA = Get-AzVirtualNetwork @id

$vnetA.id
The resource ID ofvnet-1is required to set up the peering connection fromvnet-2tovnet-1. Useaz network vnet showto obtain the resource ID forvnet-1.
vnetidA=$(az network vnet show \
    --name vnet-1 \
    --resource-group test-rg \
    --query id \
    --output tsv)

echo $vnetidA
vnetidA=$(az network vnet show \
    --name vnet-1 \
    --resource-group test-rg \
    --query id \
    --output tsv)

echo $vnetidA
Create virtual network - vnet-2
In this section, you sign in asuser-2and create a virtual network for the peering connection tovnet-1.
Portal
PowerShell
Azure CLI
Create a second virtual network with the following values by repeating the steps in theprevious section.
Sign in to subscription-2
UseConnect-AzAccountto sign in tosubscription-2.
Connect-AzAccount
Connect-AzAccount
If you're using one account for both subscriptions, sign in to that account and change the subscription context tosubscription-2withSet-AzContext.
Set-AzContext -Subscription subscription-2
Set-AzContext -Subscription subscription-2
Create a resource group - test-rg-2
An Azure resource group is a logical container where Azure resources are deployed and managed.
Create a resource group withNew-AzResourceGroup:
$rsg = @{
    Name = 'test-rg-2'
    Location = 'eastus2'
}
New-AzResourceGroup @rsg
$rsg = @{
    Name = 'test-rg-2'
    Location = 'eastus2'
}
New-AzResourceGroup @rsg
Create the virtual network
Create a virtual network withNew-AzVirtualNetwork. This example creates a subnet-1 virtual network namedvnet-2in theWest US 3location:
$vnet = @{
    Name = 'vnet-2'
    ResourceGroupName = 'test-rg-2'
    Location = 'eastus2'
    AddressPrefix = '10.1.0.0/16'
}
$virtualNetwork = New-AzVirtualNetwork @vnet
$vnet = @{
    Name = 'vnet-2'
    ResourceGroupName = 'test-rg-2'
    Location = 'eastus2'
    AddressPrefix = '10.1.0.0/16'
}
$virtualNetwork = New-AzVirtualNetwork @vnet
Add a subnet
Azure deploys resources to a subnet within a virtual network, so you need to create a subnet. Create a subnet configuration namedsubnet-1withAdd-AzVirtualNetworkSubnetConfig:
$subnet = @{
    Name = 'subnet-1'
    VirtualNetwork = $virtualNetwork
    AddressPrefix = '10.1.0.0/24'
}
$subnetConfig = Add-AzVirtualNetworkSubnetConfig @subnet
$subnet = @{
    Name = 'subnet-1'
    VirtualNetwork = $virtualNetwork
    AddressPrefix = '10.1.0.0/24'
}
$subnetConfig = Add-AzVirtualNetworkSubnetConfig @subnet
Associate the subnet to the virtual network
You can write the subnet configuration to the virtual network withSet-AzVirtualNetwork. This command creates the subnet:
$virtualNetwork | Set-AzVirtualNetwork
$virtualNetwork | Set-AzVirtualNetwork
Sign in to subscription-2
Useaz sign-into sign in tosubscription-1.
az login
az login
If you're using one account for both subscriptions, sign in to that account and change the subscription context tosubscription-2withaz account set.
az account set --subscription "subscription-2"
az account set --subscription "subscription-2"
Create a resource group - test-rg-2
An Azure resource group is a logical container where Azure resources are deployed and managed.
Create a resource group withaz group create:
az group create \
    --name test-rg-2 \
    --location eastus2
az group create \
    --name test-rg-2 \
    --location eastus2
Create the virtual network
Create a virtual network and subnet withaz network vnet create. This example creates a subnet-1 virtual network namedvnet-2in theWest US 3location.
az network vnet create \
    --resource-group test-rg-2\
    --location eastus2 \
    --name vnet-2 \
    --address-prefixes 10.1.0.0/16 \
    --subnet-name subnet-1 \
    --subnet-prefixes 10.1.0.0/24
az network vnet create \
    --resource-group test-rg-2\
    --location eastus2 \
    --name vnet-2 \
    --address-prefixes 10.1.0.0/16 \
    --subnet-name subnet-1 \
    --subnet-prefixes 10.1.0.0/24
Assign permissions for user-1
A user account in the other subscription that you want to peer with must be added to the network you previously created. If you're using a single account for both subscriptions, you can skip this section.
Portal
PowerShell
Azure CLI
Remain signed in to the portal asuser-2.
Remain signed in to the portal asuser-2.
In the search box a the top of the portal, enterVirtual network. SelectVirtual networksin the search results.
In the search box a the top of the portal, enterVirtual network. SelectVirtual networksin the search results.
Selectvnet-2.
Selectvnet-2.
SelectAccess control (IAM).
SelectAccess control (IAM).
Select+ Add->Add role assignment.
Select+ Add->Add role assignment.
InAdd role assignmentin theRoletab, selectNetwork Contributor.
InAdd role assignmentin theRoletab, selectNetwork Contributor.
SelectNext.
SelectNext.
In theMemberstab, select+ Select members.
In theMemberstab, select+ Select members.
InSelect membersin the search box, enteruser-1.
InSelect membersin the search box, enteruser-1.
SelectSelect.
SelectSelect.
SelectReview + assign.
SelectReview + assign.
SelectReview + assign.
SelectReview + assign.
UseGet-AzVirtualNetworkto obtain the resource ID forvnet-1. Assignuser-1fromsubscription-1tovnet-2withNew-AzRoleAssignment.
UseGet-AzADUserto obtain the object ID foruser-1.
user-1is used in this example for the user account. Replace this value with the display name for the user fromsubscription-1that you wish to assign permissions tovnet-2. You can skip this step if you're using the same account for both subscriptions.
$id = @{
    Name = 'vnet-2'
    ResourceGroupName = 'test-rg-2'
}
$vnet = Get-AzVirtualNetwork @id

$obj = Get-AzADUser -DisplayName 'user-1'

$role = @{
    ObjectId = $obj.id
    RoleDefinitionName = 'Network Contributor'
    Scope = $vnet.id
}
New-AzRoleAssignment @role
$id = @{
    Name = 'vnet-2'
    ResourceGroupName = 'test-rg-2'
}
$vnet = Get-AzVirtualNetwork @id

$obj = Get-AzADUser -DisplayName 'user-1'

$role = @{
    ObjectId = $obj.id
    RoleDefinitionName = 'Network Contributor'
    Scope = $vnet.id
}
New-AzRoleAssignment @role
Useaz network vnet showto obtain the resource ID forvnet-2. Assignuser-1fromsubscription-1tovnet-2withaz role assignment create.
Useaz ad user listto obtain the object ID foruser-1.
user-1is used in this example for the user account. Replace this value with the display name for the user fromsubscription-1that you wish to assign permissions tovnet-2. You can skip this step if you're using the same account for both subscriptions.
az ad user list --display-name user-1
az ad user list --display-name user-1
[
  {
    "businessPhones": [],
    "displayName": "user-1",
    "givenName": null,
    "id": "bbbbbbbb-1111-2222-3333-cccccccccccc",
    "jobTitle": null,
    "mail": "user-1@contoso.com",
    "mobilePhone": null,
    "officeLocation": null,
    "preferredLanguage": null,
    "surname": null,
    "userPrincipalName": "user-1_contoso.com#EXT#@fabrikam.onmicrosoft.com"
  }
]
[
  {
    "businessPhones": [],
    "displayName": "user-1",
    "givenName": null,
    "id": "bbbbbbbb-1111-2222-3333-cccccccccccc",
    "jobTitle": null,
    "mail": "user-1@contoso.com",
    "mobilePhone": null,
    "officeLocation": null,
    "preferredLanguage": null,
    "surname": null,
    "userPrincipalName": "user-1_contoso.com#EXT#@fabrikam.onmicrosoft.com"
  }
]
Make note of the object ID ofuser-1in fieldid. In this example, it'sbbbbbbbb-1111-2222-3333-cccccccccccc.
vnetid=$(az network vnet show \
    --name vnet-2 \
    --resource-group test-rg-2 \
    --query id \
    --output tsv)

az role assignment create \
      --assignee bbbbbbbb-1111-2222-3333-cccccccccccc \
      --role "Network Contributor" \
      --scope $vnetid
vnetid=$(az network vnet show \
    --name vnet-2 \
    --resource-group test-rg-2 \
    --query id \
    --output tsv)

az role assignment create \
      --assignee bbbbbbbb-1111-2222-3333-cccccccccccc \
      --role "Network Contributor" \
      --scope $vnetid
Obtain resource ID of vnet-2
The resource ID ofvnet-2is required to set up the peering connection fromvnet-1tovnet-2. Use the following steps to obtain the resource ID ofvnet-2.
Portal
PowerShell
Azure CLI
Remain signed in to the portal asuser-2.
Remain signed in to the portal asuser-2.
In the search box a the top of the portal, enterVirtual network. SelectVirtual networksin the search results.
In the search box a the top of the portal, enterVirtual network. SelectVirtual networksin the search results.
Selectvnet-2.
Selectvnet-2.
InSettings, selectProperties.
InSettings, selectProperties.
Copy the information in theResource IDfield and save for the later steps. The resource ID is similar to the following example:/subscriptions/<Subscription Id>/resourceGroups/test-rg-2/providers/Microsoft.Network/virtualNetworks/vnet-2.
Copy the information in theResource IDfield and save for the later steps. The resource ID is similar to the following example:/subscriptions/<Subscription Id>/resourceGroups/test-rg-2/providers/Microsoft.Network/virtualNetworks/vnet-2.
/subscriptions/<Subscription Id>/resourceGroups/test-rg-2/providers/Microsoft.Network/virtualNetworks/vnet-2
Sign out of the portal asuser-2.
Sign out of the portal asuser-2.
The resource ID ofvnet-2is required to set up the peering connection fromvnet-1tovnet-2. UseGet-AzVirtualNetworkto obtain the resource ID forvnet-2.
$id = @{
    Name = 'vnet-2'
    ResourceGroupName = 'test-rg-2'
}
$vnetB = Get-AzVirtualNetwork @id

$vnetB.id
$id = @{
    Name = 'vnet-2'
    ResourceGroupName = 'test-rg-2'
}
$vnetB = Get-AzVirtualNetwork @id

$vnetB.id
The resource ID ofvnet-2is required to set up the peering connection fromvnet-1tovnet-2. Useaz network vnet showto obtain the resource ID forvnet-2.
vnetidB=$(az network vnet show \
    --name vnet-2 \
    --resource-group test-rg-2 \
    --query id \
    --output tsv)

echo $vnetidB
vnetidB=$(az network vnet show \
    --name vnet-2 \
    --resource-group test-rg-2 \
    --query id \
    --output tsv)

echo $vnetidB
Create peering connection - vnet-1 to vnet-2
You need theResource IDforvnet-2from the previous steps to set up the peering connection.
Portal
PowerShell
Azure CLI
Sign in to theAzure portalasuser-1. If you're using one account for both subscriptions, change tosubscription-1in the portal.
Sign in to theAzure portalasuser-1. If you're using one account for both subscriptions, change tosubscription-1in the portal.
In the search box a the top of the portal, enterVirtual network. SelectVirtual networksin the search results.
In the search box a the top of the portal, enterVirtual network. SelectVirtual networksin the search results.
Selectvnet-1.
Selectvnet-1.
SelectPeerings.
SelectPeerings.
Select+ Add.
Select+ Add.
Enter or select the following information inAdd peering:SettingValueRemote virtual network summaryPeering link namevnet-2-to-vnet-1Virtual network deployment modelResource ManagerI know my resource IDSelect the boxResource IDEnter the Resource ID for vnet-2DirectorySelect the Microsoft Entra ID directory that corresponds withvnet-2anduser-2Remote virtual network peering settingsAllow 'the peered virtual network' to access 'vnet-1'Leave the default ofEnabledAllow 'the peered virtual network' to receive forwarded traffic from 'vnet-1'Select the boxLocal virtual network summaryPeering link namevnet-1-to-vnet-2Local virtual network peering settingsAllow 'vnet-1' to access 'the peered virtual network'Leave the default ofEnabledAllow 'vnet-1' to receive forwarded traffic from 'the peered virtual network'Select the box
Enter or select the following information inAdd peering:
SelectAdd.
SelectAdd.

Sign out of the portal asuser-1.
Sign out of the portal asuser-1.
Sign in to subscription-1
UseConnect-AzAccountto sign in tosubscription-1.
Connect-AzAccount
Connect-AzAccount
If you're using one account for both subscriptions, sign in to that account and change the subscription context tosubscription-1withSet-AzContext.
Set-AzContext -Subscription subscription-1
Set-AzContext -Subscription subscription-1
Sign in to subscription-2
Authenticate tosubscription-2so that the peering can be set up.
UseConnect-AzAccountto sign in tosubscription-2.
Connect-AzAccount
Connect-AzAccount
Change to subscription-1 (optional)
You might have to switch back tosubscription-1to continue with the actions insubscription-1.
Change context tosubscription-1.
Set-AzContext -Subscription subscription-1
Set-AzContext -Subscription subscription-1
Create peering connection
UseAdd-AzVirtualNetworkPeeringto create a peering connection betweenvnet-1andvnet-2.
$netA = @{
    Name = 'vnet-1'
    ResourceGroupName = 'test-rg'
}
$vnetA = Get-AzVirtualNetwork @netA

$peer = @{
    Name = 'vnet-1-to-vnet-2'
    VirtualNetwork = $vnetA
    RemoteVirtualNetworkId = '/subscriptions/<subscription-2-Id>/resourceGroups/test-rg-2/providers/Microsoft.Network/virtualNetworks/vnet-2'
}
Add-AzVirtualNetworkPeering @peer
$netA = @{
    Name = 'vnet-1'
    ResourceGroupName = 'test-rg'
}
$vnetA = Get-AzVirtualNetwork @netA

$peer = @{
    Name = 'vnet-1-to-vnet-2'
    VirtualNetwork = $vnetA
    RemoteVirtualNetworkId = '/subscriptions/<subscription-2-Id>/resourceGroups/test-rg-2/providers/Microsoft.Network/virtualNetworks/vnet-2'
}
Add-AzVirtualNetworkPeering @peer
UseGet-AzVirtualNetworkPeeringto obtain the status of the peering connections fromvnet-1tovnet-2.
$status = @{
    ResourceGroupName =  'test-rg'
    VirtualNetworkName = 'vnet-1'
}
Get-AzVirtualNetworkPeering @status | Format-Table VirtualNetworkName, PeeringState
$status = @{
    ResourceGroupName =  'test-rg'
    VirtualNetworkName = 'vnet-1'
}
Get-AzVirtualNetworkPeering @status | Format-Table VirtualNetworkName, PeeringState
PS /home/azureuser> Get-AzVirtualNetworkPeering @status | Format-Table VirtualNetworkName, PeeringState

VirtualNetworkName PeeringState
------------------ ------------
vnet-1            Initiated
PS /home/azureuser> Get-AzVirtualNetworkPeering @status | Format-Table VirtualNetworkName, PeeringState

VirtualNetworkName PeeringState
------------------ ------------
vnet-1            Initiated
Sign in to subscription-1
Useaz sign-into sign in tosubscription-1.
az login
az login
If you're using one account for both subscriptions, sign in to that account and change the subscription context tosubscription-1withaz account set.
az account set --subscription "subscription-1"
az account set --subscription "subscription-1"
Sign in to subscription-2
Authenticate tosubscription-2so that the peering can be set up.
Useaz sign-into sign in tosubscription-2.
az login
az login
Change to subscription-1 (optional)
You might have to switch back tosubscription-1to continue with the actions insubscription-1.
Change context tosubscription-1.
az account set --subscription "subscription-1"
az account set --subscription "subscription-1"
Create peering connection
Useaz network vnet peering createto create a peering connection betweenvnet-1andvnet-2.
az network vnet peering create \
    --name vnet-1-to-vnet-2 \
    --resource-group test-rg \
    --vnet-name vnet-1 \
    --remote-vnet /subscriptions/<subscription-2-Id>/resourceGroups/test-rg-2/providers/Microsoft.Network/VirtualNetworks/vnet-2 \
    --allow-vnet-access
az network vnet peering create \
    --name vnet-1-to-vnet-2 \
    --resource-group test-rg \
    --vnet-name vnet-1 \
    --remote-vnet /subscriptions/<subscription-2-Id>/resourceGroups/test-rg-2/providers/Microsoft.Network/VirtualNetworks/vnet-2 \
    --allow-vnet-access
Useaz network vnet peering listto obtain the status of the peering connections fromvnet-1tovnet-2.
az network vnet peering list \
    --resource-group test-rg \
    --vnet-name vnet-1 \
    --output table
az network vnet peering list \
    --resource-group test-rg \
    --vnet-name vnet-1 \
    --output table
The peering connection shows inPeeringsin aInitiatedstate. To complete the peer, a corresponding connection must be set up invnet-2.
Create peering connection - vnet-2 to vnet-1
You need theResource IDsforvnet-1from the previous steps to set up the peering connection.
Portal
PowerShell
Azure CLI
Sign in to theAzure portalasuser-2. If you're using one account for both subscriptions, change tosubscription-2in the portal.
Sign in to theAzure portalasuser-2. If you're using one account for both subscriptions, change tosubscription-2in the portal.
In the search box a the top of the portal, enterVirtual network. SelectVirtual networksin the search results.
In the search box a the top of the portal, enterVirtual network. SelectVirtual networksin the search results.
Selectvnet-2.
Selectvnet-2.
SelectPeerings.
SelectPeerings.
Select+ Add.
Select+ Add.
Enter or select the following information inAdd peering:SettingValueRemote virtual network summaryPeering link namevnet-1-to-vnet-2Virtual network deployment modelResource ManagerI know my resource IDSelect the boxResource IDEnter the Resource ID for vnet-2DirectorySelect the Microsoft Entra ID directory that corresponds withvnet-1anduser-1Remote virtual network peering settingsAllow 'the peered virtual network' to access 'vnet-1'Leave the default ofEnabledAllow 'the peered virtual network' to receive forwarded traffic from 'vnet-1'Select the boxLocal virtual network summaryPeering link namevnet-1-to-vnet-2Local virtual network peering settingsAllow 'vnet-1' to access 'the peered virtual network'Leave the default ofEnabledAllow 'vnet-1' to receive forwarded traffic from 'the peered virtual network'Select the box
Enter or select the following information inAdd peering:
SelectAdd.
SelectAdd.
In the pull-down box, select theDirectorythat corresponds withvnet-1anduser-1.
In the pull-down box, select theDirectorythat corresponds withvnet-1anduser-1.
SelectAuthenticate.
SelectAuthenticate.

SelectAdd.
SelectAdd.
Sign in to subscription-2
UseConnect-AzAccountto sign in tosubscription-2.
Connect-AzAccount
Connect-AzAccount
If you're using one account for both subscriptions, sign in to that account and change the subscription context tosubscription-2withSet-AzContext.
Set-AzContext -Subscription subscription-2
Set-AzContext -Subscription subscription-2
Sign in to subscription-1
Authenticate tosubscription-1so that the peering can be set up.
UseConnect-AzAccountto sign in tosubscription-1.
Connect-AzAccount
Connect-AzAccount
Change to subscription-2 (optional)
You might have to switch back tosubscription-2to continue with the actions insubscription-2.
Change context tosubscription-2.
Set-AzContext -Subscription subscription-2
Set-AzContext -Subscription subscription-2
Create peering connection
UseAdd-AzVirtualNetworkPeeringto create a peering connection betweenvnet-2andvnet-1.
$netB = @{
    Name = 'vnet-2'
    ResourceGroupName = 'test-rg-2'
}
$vnetB = Get-AzVirtualNetwork @netB

$peer = @{
    Name = 'vnet-2-to-vnet-1'
    VirtualNetwork = $vnetB
    RemoteVirtualNetworkId = '/subscriptions/<subscription-1-Id>/resourceGroups/test-rg/providers/Microsoft.Network/virtualNetworks/vnet-1'
}
Add-AzVirtualNetworkPeering @peer
$netB = @{
    Name = 'vnet-2'
    ResourceGroupName = 'test-rg-2'
}
$vnetB = Get-AzVirtualNetwork @netB

$peer = @{
    Name = 'vnet-2-to-vnet-1'
    VirtualNetwork = $vnetB
    RemoteVirtualNetworkId = '/subscriptions/<subscription-1-Id>/resourceGroups/test-rg/providers/Microsoft.Network/virtualNetworks/vnet-1'
}
Add-AzVirtualNetworkPeering @peer
UserGet-AzVirtualNetworkPeeringto obtain the status of the peering connections fromvnet-2tovnet-1.
$status = @{
    ResourceGroupName =  'test-rg-2'
    VirtualNetworkName = 'vnet-2'
}
Get-AzVirtualNetworkPeering @status | Format-Table VirtualNetworkName, PeeringState
$status = @{
    ResourceGroupName =  'test-rg-2'
    VirtualNetworkName = 'vnet-2'
}
Get-AzVirtualNetworkPeering @status | Format-Table VirtualNetworkName, PeeringState
PS /home/azureuser> Get-AzVirtualNetworkPeering @status | Format-Table VirtualNetworkName, PeeringState

VirtualNetworkName PeeringState
------------------ ------------
vnet-2            Connected
PS /home/azureuser> Get-AzVirtualNetworkPeering @status | Format-Table VirtualNetworkName, PeeringState

VirtualNetworkName PeeringState
------------------ ------------
vnet-2            Connected
Sign in to subscription-2
Useaz sign-into sign in tosubscription-2.
az login
az login
If you're using one account for both subscriptions, sign in to that account and change the subscription context tosubscription-2withaz account set.
az account set --subscription "subscription-2"
az account set --subscription "subscription-2"
Sign in to subscription-1
Authenticate tosubscription-1so that the peering can be set up.
Useaz sign-into sign in tosubscription-1.
az login
az login
Change to subscription-2 (optional)
You might have to switch back tosubscription-2to continue with the actions insubscription-2.
Change context tosubscription-2.
az account set --subscription "subscription-2"
az account set --subscription "subscription-2"
Create peering connection
Useaz network vnet peering createto create a peering connection betweenvnet-2andvnet-1.
az network vnet peering create \
    --name vnet-2-to-vnet-1 \
    --resource-group test-rg-2 \
    --vnet-name vnet-2 \
    --remote-vnet /subscriptions/<subscription-1-Id>/resourceGroups/test-rg/providers/Microsoft.Network/VirtualNetworks/vnet-1 \
    --allow-vnet-access
az network vnet peering create \
    --name vnet-2-to-vnet-1 \
    --resource-group test-rg-2 \
    --vnet-name vnet-2 \
    --remote-vnet /subscriptions/<subscription-1-Id>/resourceGroups/test-rg/providers/Microsoft.Network/VirtualNetworks/vnet-1 \
    --allow-vnet-access
Useaz network vnet peering listto obtain the status of the peering connections fromvnet-2tovnet-1.
az network vnet peering list \
    --resource-group test-rg-2 \
    --vnet-name vnet-2 \
    --output table
az network vnet peering list \
    --resource-group test-rg-2 \
    --vnet-name vnet-2 \
    --output table
The peering is successfully established after you seeConnectedin thePeering statuscolumn for both virtual networks in the peering. Any Azure resources you create in either virtual network are now able to communicate with each other through their IP addresses. If you're using Azure name resolution for the virtual networks, the resources in the virtual networks aren't able to resolve names across the virtual networks. If you want to resolve names across virtual networks in a peering, you must create your own DNS (Domain Name System) server or use Azure DNS.
Important
If you update the address space in one of the members of the peer, you must resync the connection to reflect the address space changes. For more information, seeUpdate the address space for a peered virtual network using the Azure portal
For more information about using your own DNS for name resolution, see,Name resolution using your own DNS server.
For more information about Azure DNS, seeWhat is Azure DNS?.
Next steps
Thoroughly familiarize yourself with importantvirtual network peering constraints and behaviorsbefore creating a virtual network peering for production use.
Thoroughly familiarize yourself with importantvirtual network peering constraints and behaviorsbefore creating a virtual network peering for production use.
Learn about allvirtual network peering settings.
Learn about allvirtual network peering settings.
Learn how tocreate a hub and spoke network topologywith virtual network peering.
Learn how tocreate a hub and spoke network topologywith virtual network peering.
Feedback
Was this page helpful?
Additional resources