Note
Access to this page requires authorization. You can trysigning inorchanging directories.
Access to this page requires authorization. You can trychanging directories.
Create and assign an autoscale scaling plan for Azure Virtual Desktop
Article
2024-11-21
5 contributors
In this article
Important
Dynamic autoscaling for pooled host pools with session host configuration is currently in PREVIEW. See theSupplemental Terms of Use for Microsoft Azure Previewsfor legal terms that apply to Azure features that are in beta, preview, or otherwise not yet released into general availability.
Autoscale lets you scale your session host virtual machines (VMs) in a host pool up or down according to schedule to optimize deployment costs.
When using autoscale, you can choose from two different scaling methods: power management or dynamic. To learn more about autoscale, seeAutoscale scaling plans and example scenarios in Azure Virtual Desktop.
Note
You can't use autoscale andscale session hosts using Azure Automation and Azure Logic Appson the same host pool. You must use one or the other.
Power management autoscaling is available in Azure and Azure Government.
Dynamic autoscaling is only available in Azure and isn't supported in Azure Government.
For best results, we recommend using autoscale with session hosts you deployed with Azure Virtual Desktop Azure Resource Manager templates or first-party tools from Microsoft.
Prerequisites
To use a power management scaling plan, make sure you follow these guidelines:
Scaling plan configuration data must be stored in the same region as the host pool configuration. Deploying session host VMs is supported in all Azure regions.
Scaling plan configuration data must be stored in the same region as the host pool configuration. Deploying session host VMs is supported in all Azure regions.
When using autoscale for pooled host pools, you must have a configuredMaxSessionLimitparameter for that host pool. Don't use the default value. You can configure this value in the host pool settings in the Azure portal or run theNew-AzWvdHostPoolorUpdate-AzWvdHostPoolPowerShell cmdlets.
When using autoscale for pooled host pools, you must have a configuredMaxSessionLimitparameter for that host pool. Don't use the default value. You can configure this value in the host pool settings in the Azure portal or run theNew-AzWvdHostPoolorUpdate-AzWvdHostPoolPowerShell cmdlets.
You must grant Azure Virtual Desktop access to manage the power state of your session host VMs. You must have theMicrosoft.Authorization/roleAssignments/writepermission on your subscriptions in order to assign the role-based access control (RBAC) role for the Azure Virtual Desktop service principal on those subscriptions. This is part ofUser Access AdministratorandOwnerbuilt in roles.
You must grant Azure Virtual Desktop access to manage the power state of your session host VMs. You must have theMicrosoft.Authorization/roleAssignments/writepermission on your subscriptions in order to assign the role-based access control (RBAC) role for the Azure Virtual Desktop service principal on those subscriptions. This is part ofUser Access AdministratorandOwnerbuilt in roles.
Microsoft.Authorization/roleAssignments/write
If you want to use personal desktop autoscale with hibernation, you'll need to enable the hibernation feature for VMs in your personal host pool. FSLogix and app attach currently don't support hibernate. Don't enable hibernate if you're using FSLogix or app attach for your personal host pools. For more information on using hibernation, including how hibernation works, limitations, and prerequisites, seeHibernation for Azure virtual machines.
If you want to use personal desktop autoscale with hibernation, you'll need to enable the hibernation feature for VMs in your personal host pool. FSLogix and app attach currently don't support hibernate. Don't enable hibernate if you're using FSLogix or app attach for your personal host pools. For more information on using hibernation, including how hibernation works, limitations, and prerequisites, seeHibernation for Azure virtual machines.
If you're using PowerShell to create and assign your scaling plan, you need moduleAz.DesktopVirtualizationversion 4.2.0 or later.
If you're using PowerShell to create and assign your scaling plan, you need moduleAz.DesktopVirtualizationversion 4.2.0 or later.
If you'reconfiguring a time limit policy, you'll need:For Intune: a Microsoft Entra ID account that is assigned the Policy and Profile manager built-in RBAC role and a group containing the devices you want to configure.For Group Policy: a domain account that has permission to create or edit Group Policy objects and a security group or organizational unit (OU) containing the devices you want to configure.
If you'reconfiguring a time limit policy, you'll need:
For Intune: a Microsoft Entra ID account that is assigned the Policy and Profile manager built-in RBAC role and a group containing the devices you want to configure.
For Group Policy: a domain account that has permission to create or edit Group Policy objects and a security group or organizational unit (OU) containing the devices you want to configure.
To use a dynamic scaling plan (preview):
Dynamic autoscaling can only be used forpooled host pools with session host configuration. If you want to apply an autoscaling plan to a standard host pool without session host configuration, you need to use the power management scaling method, which is already generally available.
Dynamic autoscaling can only be used forpooled host pools with session host configuration. If you want to apply an autoscaling plan to a standard host pool without session host configuration, you need to use the power management scaling method, which is already generally available.
You can't use dynamic scaling in conjunction with any other scaling script on the same host pool. You must use one or the other.
You can't use dynamic scaling in conjunction with any other scaling script on the same host pool. You must use one or the other.
Scaling plan configuration data must be stored in the same region as the host pool configuration. You can deploy session hosts in any Azure region.
Scaling plan configuration data must be stored in the same region as the host pool configuration. You can deploy session hosts in any Azure region.
When using autoscale for pooled host pools, you must have a set a custom max session limit for load balancing of that host pool. Don't use the default value. For more information, seeConfigure host pool load balancing.
When using autoscale for pooled host pools, you must have a set a custom max session limit for load balancing of that host pool. Don't use the default value. For more information, seeConfigure host pool load balancing.
You must grant Azure Virtual Desktop access to manage the power state of your session host VMs. You must have theMicrosoft.Authorization/roleAssignments/writepermission on your subscriptions in order to assign the role-based access control (RBAC) role for the Azure Virtual Desktop service principal on those subscriptions. This is part ofUser Access AdministratorandOwnerbuilt in roles.
You must grant Azure Virtual Desktop access to manage the power state of your session host VMs. You must have theMicrosoft.Authorization/roleAssignments/writepermission on your subscriptions in order to assign the role-based access control (RBAC) role for the Azure Virtual Desktop service principal on those subscriptions. This is part ofUser Access AdministratorandOwnerbuilt in roles.
Microsoft.Authorization/roleAssignments/write
Dynamic autoscaling currently requires access to the public Azure Storage endpointwvdhpustgr0prod.blob.core.windows.netto deploy the RDAgent when creating session hosts. Until this is migrated to arequired endpoint for Azure Virtual Desktop, session hosts that can't access wvdhpustgr0prod.blob.core.windows.net will fail with a "CustomerVmNoAccessToDeploymentPackageException" error.
Dynamic autoscaling currently requires access to the public Azure Storage endpointwvdhpustgr0prod.blob.core.windows.netto deploy the RDAgent when creating session hosts. Until this is migrated to arequired endpoint for Azure Virtual Desktop, session hosts that can't access wvdhpustgr0prod.blob.core.windows.net will fail with a "CustomerVmNoAccessToDeploymentPackageException" error.
wvdhpustgr0prod.blob.core.windows.net
If you're using PowerShell to create and assign your scaling plan, you need moduleAz.DesktopVirtualizationversion 4.2.0 or later.
If you're using PowerShell to create and assign your scaling plan, you need moduleAz.DesktopVirtualizationversion 4.2.0 or later.
Assign permissions to the Azure Virtual Desktop service principal
Before creating your first scaling plan, you'll need to assign theDesktop Virtualization Power On Off ContributorRBAC role to the Azure Virtual Desktop service principal with your Azure subscription as the assignable scope. Assigning this role at any level lower than your subscription, such as the resource group, host pool, or VM, will prevent autoscale from working properly.
You need to add each Azure subscription as an assignable scope that contains host pools and session host VMs you want to use with autoscale. This role and assignment allows Azure Virtual Desktop to manage the power state of any VMs in those subscriptions. It also lets the service apply actions on both host pools and VMs when there are no active user sessions.
To learn how to assign theDesktop Virtualization Power On Off Contributorrole to the Azure Virtual Desktop service principal, seeAssign Azure RBAC roles or Microsoft Entra roles to the Azure Virtual Desktop service principals.
Assign permissions to the Azure Virtual Desktop service principal
Before creating your first scaling plan, you'll need to assign theDesktop Virtualization Power On Off ContributorandDesktop Virtualization Virtual Machine ContributorRBAC roles to the Azure Virtual Desktop service principal with your Azure subscription as the assignable scope. Assigning these roles at any level lower than your subscription, such as the resource group, host pool, or VM, will prevent autoscale from working properly. You'll need to add each Azure subscription as an assignable scope that contains host pools and session host VMs you want to use with autoscale. These roles and assignments allow Azure Virtual Desktop to manage the power state of any VMs and to create, delete, update, start, and stop any VMs in those subscriptions. They also let the service apply actions on both host pools and VMs when there are no active user sessions.
To learn how to assign theDesktop Virtualization Power On Off Contributorrole to the Azure Virtual Desktop service principal, seeAssign Azure RBAC roles or Microsoft Entra roles to the Azure Virtual Desktop service principals.
Create a scaling plan
Azure portal
Azure PowerShell
Now that you assigned theDesktop Virtualization Power On Off Contributorrole to the service principal on your subscriptions, you can create a scaling plan. To create a scaling plan using the portal:
Sign in to theAzure portal.
Sign in to theAzure portal.
In the search bar, typeAzure Virtual Desktopand select the matching service entry.
In the search bar, typeAzure Virtual Desktopand select the matching service entry.
SelectScaling Plans, then selectCreate.
SelectScaling Plans, then selectCreate.
In theBasicstab, complete the following information:ParameterValue/DescriptionSubscriptionSelect the subscription you want to create the host pool in from the drop-down list.Resource groupSelect an existing resource group or selectCreate newand enter a name.Scaling plan nameEnter a name for the scaling plan. Optionally, you can also add a "friendly" name that is displayed to your users and a description for your plan.LocationSelect the Azure region where you want to create your scaling plan.Time zoneSelect the time zone you'll use with your plan.Host pool typeSelect the type of host pool that you want your scaling plan to apply to.Exclusion tagEnter a tag name for VMs you don't want to include in scaling operations. For example, you might want to tag VMs that are set to drain mode so that autoscale doesn't override drain mode during maintenance using the exclusion tag "excludeFromScaling". If you've set "excludeFromScaling" as the tag name field on any of the VMs in the host pool, autoscale won't start, stop, or change the drain mode of those particular VMs.Scaling methodThis option appears if you selectedPooledforHost pool type.  SelectPower management autoscaling.NoteThough an exclusion tag will exclude the tagged VM from power management scaling operations, tagged VMs will still be considered as part of the calculation of the minimum percentage of hosts.Make sure not to include any sensitive information in the exclusion tags such as user principal names or other personally identifiable information.
In theBasicstab, complete the following information:
Note
Though an exclusion tag will exclude the tagged VM from power management scaling operations, tagged VMs will still be considered as part of the calculation of the minimum percentage of hosts.
Make sure not to include any sensitive information in the exclusion tags such as user principal names or other personally identifiable information.
SelectNext, which should take you to theSchedulestab. Schedules let you define when autoscale turns VMs on and off throughout the day. The schedule parameters are different based on theHost pool typeyou chose for the scaling plan.Pooled host poolsIn each phase of the schedule, autoscale only turns off VMs when in doing so the used host pool capacity won't exceed the capacity threshold. The default values you see when you try to create a schedule are the suggested values for weekdays, but you can change them as needed.To create or change a schedule:In theSchedulestab, selectAdd scheduleand complete the following information:ParameterValue/DescriptionSchedule nameEnter a name for your schedule.Repeat onSelect which days your schedule will repeat on.In theRamp uptab, fill out the following fields:ParameterValue/DescriptionStart timeSelect a time from the drop-down menu to start preparing VMs for peak business hours.Load balancing algorithmWe recommend selectingbreadth-first algorithm. Breadth-first load balancing distributes users across existing VMs to keep access times fast. The load balancing preference you select here overrides the one you selected for your original host pool settings.Minimum percentage of hostsEnter the percentage of session hosts you want to always remain on in this phase. If the percentage you enter isn't a whole number, it's rounded up to the nearest whole number. For example, in a host pool of seven session hosts, if you set the minimum percentage of hosts during ramp-up hours to10%, one VM will always stay on during ramp-up hours, and it won't be turned off by autoscale.Capacity thresholdEnter the percentage of available host pool capacity that will trigger a scaling action to take place. For example, if two session hosts in the host pool with a max session limit of 20 are turned on, the available host pool capacity is 40. If you set the capacity threshold to75%and the session hosts have more than 30 user sessions, autoscale will turn on a third session host. This will then change the available host pool capacity from 40 to 60.In thePeak hourstab, fill out the following fields:ParameterValue/DescriptionStart timeEnter a start time for when your usage rate is highest during the day. Make sure the time is in the same time zone you specified for your scaling plan. This time is also the end time for the ramp-up phase.Load balancingSelect breadth-first or depth-first load balancing. Breadth-first load balancing distributes new user sessions across all available session hosts in the host pool. Depth-first load balancing distributes new sessions to any available session host with the highest number of connections that hasn't reached its session limit yet.For more information about load-balancing types, seeConfigure the Azure Virtual Desktop load-balancing method.NoteYou can't change the capacity threshold here. Instead, the setting you entered inRamp-upwill carry over to this setting.ForRamp-down, you'll enter values into similar fields toRamp-up, but this time it will be for when your host pool usage drops off. This will include the following fields:Start timeLoad-balancing algorithmMinimum percentage of hosts (%)Capacity threshold (%)Force logoff usersImportantIf you've enabled autoscale to force users to sign out during ramp-down, the feature will choose the session host with the lowest number of user sessions (active and disconnected) to shut down. Autoscale will put the session host in drain mode, send those user sessions a notification telling them they'll be signed out, and then sign out those users after the specified wait time is over. After autoscale signs out those user sessions, it then deallocates the VM.If you haven't enabled forced sign out during ramp-down, you then need to choose whether you want to shut down âVMs have no active or disconnected sessionsâ or âVMs have no active sessionsâ during ramp-down.Whether youâve enabled autoscale to force users to sign out during ramp-down or not, thecapacity thresholdand theminimum percentage of hostsare still respected, autoscale will only shut down VMs if all existing user sessions (active and disconnected) in the host pool can be consolidated to fewer VMs without exceeding the capacity threshold.You can also configure a time limit policy that will apply to all phases to sign out all disconnected users to reduce theused host pool capacity. For more information, seeConfigure a time limit policy.Likewise,Off-peak hoursworks the same way asPeak hours:Start time, which is also the end of the ramp-down period.Load-balancing algorithm. We recommend choosingdepth-firstto gradually reduce the number of session hosts based on sessions on each VM.Just like peak hours, you can't configure the capacity threshold here. Instead, the value you entered inRamp-downcarries over.ImportantIf you have any days unselected in your schedule, the last off-peak parameters on the selected days will be carried over for the unselected days until the next ramp-up phase. For example, if you only have one schedule for Monday to Friday, then your configuration for the Friday off-peak phase will be carried over until the Monday ramp-up phase.Personal host poolsIn each phase of the schedule, define whether VMs should be deallocated based on the user session state.To create or change a schedule:In theSchedulestab, selectAdd scheduleand complete the following information:ParameterValue/DescriptionSchedule nameEnter a name for your schedule.Repeat onSelect which days your schedule will repeat on.In theRamp uptab, fill out the following fields:ParameterValue/DescriptionStart timeSelect the time you want the ramp-up phase to start from the drop-down menu.Start VM on ConnectSelect whether you want Start VM on Connect to be enabled during ramp up.We highly recommend that you enable Start VM on Connect if you choose not to start your VMs during the ramp-up phase.VMs to startSelect whether you want only personal desktops that have a user assigned to them at the start time to be started, you want all personal desktops in the host pool (regardless of user assignment) to be started, or you want no personal desktops in the pool to be started.Disconnect settingsForWhen disconnected for (min), specify the number of minutes a user session has to be disconnected before performing a specific action. This number can be anywhere between 0 and 360.ForPerform, specify what action the service should take after a user session has been disconnected for the specified time. The options are to either deallocate (shut down) the VMs, hibernate the personal desktop, or do nothing.Sign out settingsForWhen logged off for (min), specify the number of minutes a user session has to be logged off before performing a specific action. This number can be anywhere between 0 and 360.ForPerform, specify what action the service should take after a user session has been logged off for the specified time. The options are to either deallocate (shut down) the VMs, hibernate the personal desktop, or do nothing.In thePeak hours,Ramp-down, andOff-peak hourstabs, fill out the following fields:ParameterValue/DescriptionStart timeEnter a start time for each phase. This time is also the end time for the previous phase.Start VM on ConnectSelect whether you want Start VM on Connect to be enabled during that phase.Disconnect settingsForWhen disconnected for (min), specify the number of minutes a user session has to be disconnected before performing a specific action. This number can be anywhere between 0 and 360.ForPerform, specify what action the service should take after a user session has been disconnected for the specified time. The options are to either deallocate (shut down) the VMs, hibernate the personal desktop, or do nothing.Sign out settingsForWhen logged off for (min), specify the number of minutes a user session has to be logged off before performing a specific action. This number can be anywhere between 0 and 360.ForPerform, specify what action the service should take after a user session has been logged off for the specified time. The options are to either deallocate (shut down) the VMs, hibernate the personal desktop, or do nothing.ImportantIf you have any days unselected in your schedule, the last off-peak parameters on the selected days will be carried over for the unselected days until the next ramp-up phase. For example, if you only have one schedule for Monday to Friday, then your configuration for the Friday off-peak phase will be carried over until the Monday ramp-up phase.
SelectNext, which should take you to theSchedulestab. Schedules let you define when autoscale turns VMs on and off throughout the day. The schedule parameters are different based on theHost pool typeyou chose for the scaling plan.
In each phase of the schedule, autoscale only turns off VMs when in doing so the used host pool capacity won't exceed the capacity threshold. The default values you see when you try to create a schedule are the suggested values for weekdays, but you can change them as needed.
To create or change a schedule:
In theSchedulestab, selectAdd scheduleand complete the following information:ParameterValue/DescriptionSchedule nameEnter a name for your schedule.Repeat onSelect which days your schedule will repeat on.
In theSchedulestab, selectAdd scheduleand complete the following information:
In theRamp uptab, fill out the following fields:ParameterValue/DescriptionStart timeSelect a time from the drop-down menu to start preparing VMs for peak business hours.Load balancing algorithmWe recommend selectingbreadth-first algorithm. Breadth-first load balancing distributes users across existing VMs to keep access times fast. The load balancing preference you select here overrides the one you selected for your original host pool settings.Minimum percentage of hostsEnter the percentage of session hosts you want to always remain on in this phase. If the percentage you enter isn't a whole number, it's rounded up to the nearest whole number. For example, in a host pool of seven session hosts, if you set the minimum percentage of hosts during ramp-up hours to10%, one VM will always stay on during ramp-up hours, and it won't be turned off by autoscale.Capacity thresholdEnter the percentage of available host pool capacity that will trigger a scaling action to take place. For example, if two session hosts in the host pool with a max session limit of 20 are turned on, the available host pool capacity is 40. If you set the capacity threshold to75%and the session hosts have more than 30 user sessions, autoscale will turn on a third session host. This will then change the available host pool capacity from 40 to 60.
In theRamp uptab, fill out the following fields:
In thePeak hourstab, fill out the following fields:ParameterValue/DescriptionStart timeEnter a start time for when your usage rate is highest during the day. Make sure the time is in the same time zone you specified for your scaling plan. This time is also the end time for the ramp-up phase.Load balancingSelect breadth-first or depth-first load balancing. Breadth-first load balancing distributes new user sessions across all available session hosts in the host pool. Depth-first load balancing distributes new sessions to any available session host with the highest number of connections that hasn't reached its session limit yet.For more information about load-balancing types, seeConfigure the Azure Virtual Desktop load-balancing method.NoteYou can't change the capacity threshold here. Instead, the setting you entered inRamp-upwill carry over to this setting.
In thePeak hourstab, fill out the following fields:
Note
You can't change the capacity threshold here. Instead, the setting you entered inRamp-upwill carry over to this setting.
ForRamp-down, you'll enter values into similar fields toRamp-up, but this time it will be for when your host pool usage drops off. This will include the following fields:Start timeLoad-balancing algorithmMinimum percentage of hosts (%)Capacity threshold (%)Force logoff usersImportantIf you've enabled autoscale to force users to sign out during ramp-down, the feature will choose the session host with the lowest number of user sessions (active and disconnected) to shut down. Autoscale will put the session host in drain mode, send those user sessions a notification telling them they'll be signed out, and then sign out those users after the specified wait time is over. After autoscale signs out those user sessions, it then deallocates the VM.If you haven't enabled forced sign out during ramp-down, you then need to choose whether you want to shut down âVMs have no active or disconnected sessionsâ or âVMs have no active sessionsâ during ramp-down.Whether youâve enabled autoscale to force users to sign out during ramp-down or not, thecapacity thresholdand theminimum percentage of hostsare still respected, autoscale will only shut down VMs if all existing user sessions (active and disconnected) in the host pool can be consolidated to fewer VMs without exceeding the capacity threshold.You can also configure a time limit policy that will apply to all phases to sign out all disconnected users to reduce theused host pool capacity. For more information, seeConfigure a time limit policy.
ForRamp-down, you'll enter values into similar fields toRamp-up, but this time it will be for when your host pool usage drops off. This will include the following fields:
Start time
Load-balancing algorithm
Minimum percentage of hosts (%)
Capacity threshold (%)
Force logoff users
Important
If you've enabled autoscale to force users to sign out during ramp-down, the feature will choose the session host with the lowest number of user sessions (active and disconnected) to shut down. Autoscale will put the session host in drain mode, send those user sessions a notification telling them they'll be signed out, and then sign out those users after the specified wait time is over. After autoscale signs out those user sessions, it then deallocates the VM.
If you've enabled autoscale to force users to sign out during ramp-down, the feature will choose the session host with the lowest number of user sessions (active and disconnected) to shut down. Autoscale will put the session host in drain mode, send those user sessions a notification telling them they'll be signed out, and then sign out those users after the specified wait time is over. After autoscale signs out those user sessions, it then deallocates the VM.
If you haven't enabled forced sign out during ramp-down, you then need to choose whether you want to shut down âVMs have no active or disconnected sessionsâ or âVMs have no active sessionsâ during ramp-down.
If you haven't enabled forced sign out during ramp-down, you then need to choose whether you want to shut down âVMs have no active or disconnected sessionsâ or âVMs have no active sessionsâ during ramp-down.
Whether youâve enabled autoscale to force users to sign out during ramp-down or not, thecapacity thresholdand theminimum percentage of hostsare still respected, autoscale will only shut down VMs if all existing user sessions (active and disconnected) in the host pool can be consolidated to fewer VMs without exceeding the capacity threshold.
Whether youâve enabled autoscale to force users to sign out during ramp-down or not, thecapacity thresholdand theminimum percentage of hostsare still respected, autoscale will only shut down VMs if all existing user sessions (active and disconnected) in the host pool can be consolidated to fewer VMs without exceeding the capacity threshold.
You can also configure a time limit policy that will apply to all phases to sign out all disconnected users to reduce theused host pool capacity. For more information, seeConfigure a time limit policy.
You can also configure a time limit policy that will apply to all phases to sign out all disconnected users to reduce theused host pool capacity. For more information, seeConfigure a time limit policy.
Likewise,Off-peak hoursworks the same way asPeak hours:Start time, which is also the end of the ramp-down period.Load-balancing algorithm. We recommend choosingdepth-firstto gradually reduce the number of session hosts based on sessions on each VM.Just like peak hours, you can't configure the capacity threshold here. Instead, the value you entered inRamp-downcarries over.ImportantIf you have any days unselected in your schedule, the last off-peak parameters on the selected days will be carried over for the unselected days until the next ramp-up phase. For example, if you only have one schedule for Monday to Friday, then your configuration for the Friday off-peak phase will be carried over until the Monday ramp-up phase.
Likewise,Off-peak hoursworks the same way asPeak hours:
Start time, which is also the end of the ramp-down period.
Load-balancing algorithm. We recommend choosingdepth-firstto gradually reduce the number of session hosts based on sessions on each VM.
Just like peak hours, you can't configure the capacity threshold here. Instead, the value you entered inRamp-downcarries over.
Important
If you have any days unselected in your schedule, the last off-peak parameters on the selected days will be carried over for the unselected days until the next ramp-up phase. For example, if you only have one schedule for Monday to Friday, then your configuration for the Friday off-peak phase will be carried over until the Monday ramp-up phase.
In each phase of the schedule, define whether VMs should be deallocated based on the user session state.
To create or change a schedule:
In theSchedulestab, selectAdd scheduleand complete the following information:ParameterValue/DescriptionSchedule nameEnter a name for your schedule.Repeat onSelect which days your schedule will repeat on.
In theSchedulestab, selectAdd scheduleand complete the following information:
In theRamp uptab, fill out the following fields:ParameterValue/DescriptionStart timeSelect the time you want the ramp-up phase to start from the drop-down menu.Start VM on ConnectSelect whether you want Start VM on Connect to be enabled during ramp up.We highly recommend that you enable Start VM on Connect if you choose not to start your VMs during the ramp-up phase.VMs to startSelect whether you want only personal desktops that have a user assigned to them at the start time to be started, you want all personal desktops in the host pool (regardless of user assignment) to be started, or you want no personal desktops in the pool to be started.Disconnect settingsForWhen disconnected for (min), specify the number of minutes a user session has to be disconnected before performing a specific action. This number can be anywhere between 0 and 360.ForPerform, specify what action the service should take after a user session has been disconnected for the specified time. The options are to either deallocate (shut down) the VMs, hibernate the personal desktop, or do nothing.Sign out settingsForWhen logged off for (min), specify the number of minutes a user session has to be logged off before performing a specific action. This number can be anywhere between 0 and 360.ForPerform, specify what action the service should take after a user session has been logged off for the specified time. The options are to either deallocate (shut down) the VMs, hibernate the personal desktop, or do nothing.
In theRamp uptab, fill out the following fields:
In thePeak hours,Ramp-down, andOff-peak hourstabs, fill out the following fields:ParameterValue/DescriptionStart timeEnter a start time for each phase. This time is also the end time for the previous phase.Start VM on ConnectSelect whether you want Start VM on Connect to be enabled during that phase.Disconnect settingsForWhen disconnected for (min), specify the number of minutes a user session has to be disconnected before performing a specific action. This number can be anywhere between 0 and 360.ForPerform, specify what action the service should take after a user session has been disconnected for the specified time. The options are to either deallocate (shut down) the VMs, hibernate the personal desktop, or do nothing.Sign out settingsForWhen logged off for (min), specify the number of minutes a user session has to be logged off before performing a specific action. This number can be anywhere between 0 and 360.ForPerform, specify what action the service should take after a user session has been logged off for the specified time. The options are to either deallocate (shut down) the VMs, hibernate the personal desktop, or do nothing.ImportantIf you have any days unselected in your schedule, the last off-peak parameters on the selected days will be carried over for the unselected days until the next ramp-up phase. For example, if you only have one schedule for Monday to Friday, then your configuration for the Friday off-peak phase will be carried over until the Monday ramp-up phase.
In thePeak hours,Ramp-down, andOff-peak hourstabs, fill out the following fields:
Important
If you have any days unselected in your schedule, the last off-peak parameters on the selected days will be carried over for the unselected days until the next ramp-up phase. For example, if you only have one schedule for Monday to Friday, then your configuration for the Friday off-peak phase will be carried over until the Monday ramp-up phase.
SelectNextto take you to theHost pool assignmentstab. Select the check box next to each host pool you want to include. If you don't want to enable autoscale, unselect all check boxes. You can always return to this setting later and change it. You can only assign the scaling plan to host pools that match the host pool type specified in the plan.NoteWhen you create or update a scaling plan that's already assigned to host pools, its changes are applied immediately.
SelectNextto take you to theHost pool assignmentstab. Select the check box next to each host pool you want to include. If you don't want to enable autoscale, unselect all check boxes. You can always return to this setting later and change it. You can only assign the scaling plan to host pools that match the host pool type specified in the plan.
Note
When you create or update a scaling plan that's already assigned to host pools, its changes are applied immediately.
After that, you'll need to entertags. Tags are name and value pairs that categorize resources for consolidated billing. You can apply the same tag to multiple resources and resource groups. To learn more about tagging resources, seeUse tags to organize your Azure resources.NoteIf you change resource settings on other tabs after creating tags, your tags will be automatically updated.
After that, you'll need to entertags. Tags are name and value pairs that categorize resources for consolidated billing. You can apply the same tag to multiple resources and resource groups. To learn more about tagging resources, seeUse tags to organize your Azure resources.
Note
If you change resource settings on other tabs after creating tags, your tags will be automatically updated.
Once you're done, go to theReview + createtab and selectCreateto create and assign your scaling plan to the host pools you selected.
Once you're done, go to theReview + createtab and selectCreateto create and assign your scaling plan to the host pools you selected.
Here's how to create a scaling plan using the Az.DesktopVirtualization PowerShell module. The following examples show you how to create a scaling plan and scaling plan schedule. Be sure to change the<placeholder>values for your own.
<placeholder>
OpenAzure Cloud Shellin the Azure portal with thePowerShellterminal type, or run PowerShell on your local device.If you're using Cloud Shell, make sure yourAzure context is set to the subscription that you want to use.If you're using PowerShell locally, firstsign in with Azure PowerShell, and then make sure yourAzure context is set to the subscription that you want to use.
OpenAzure Cloud Shellin the Azure portal with thePowerShellterminal type, or run PowerShell on your local device.
If you're using Cloud Shell, make sure yourAzure context is set to the subscription that you want to use.
If you're using Cloud Shell, make sure yourAzure context is set to the subscription that you want to use.
If you're using PowerShell locally, firstsign in with Azure PowerShell, and then make sure yourAzure context is set to the subscription that you want to use.
If you're using PowerShell locally, firstsign in with Azure PowerShell, and then make sure yourAzure context is set to the subscription that you want to use.
Create a scaling plan for your pooled or personal host pools using theNew-AzWvdScalingPlancmdlet:$scalingPlanParams = @{
    ResourceGroupName = '<resourceGroup>'
    Name = '<scalingPlanName>'
    Location = '<AzureRegion>'
    Description = '<Scaling plan description>'
    FriendlyName = '<Scaling plan friendly name>'
    HostPoolType = '<Pooled or personal>'
    TimeZone = '<Time zone, such as Pacific Standard Time>'
    HostPoolReference = @(@{'hostPoolArmPath' = '/subscriptions/aaaa0a0a-bb1b-cc2c-dd3d-eeeeee4e4e4e/resourceGroups/<resourceGroup/providers/Microsoft.DesktopVirtualization/hostPools/<hostPoolName>'; 'scalingPlanEnabled' = $true;})
}

$scalingPlan = New-AzWvdScalingPlan @scalingPlanParams
Create a scaling plan for your pooled or personal host pools using theNew-AzWvdScalingPlancmdlet:
$scalingPlanParams = @{
    ResourceGroupName = '<resourceGroup>'
    Name = '<scalingPlanName>'
    Location = '<AzureRegion>'
    Description = '<Scaling plan description>'
    FriendlyName = '<Scaling plan friendly name>'
    HostPoolType = '<Pooled or personal>'
    TimeZone = '<Time zone, such as Pacific Standard Time>'
    HostPoolReference = @(@{'hostPoolArmPath' = '/subscriptions/aaaa0a0a-bb1b-cc2c-dd3d-eeeeee4e4e4e/resourceGroups/<resourceGroup/providers/Microsoft.DesktopVirtualization/hostPools/<hostPoolName>'; 'scalingPlanEnabled' = $true;})
}

$scalingPlan = New-AzWvdScalingPlan @scalingPlanParams
$scalingPlanParams = @{
    ResourceGroupName = '<resourceGroup>'
    Name = '<scalingPlanName>'
    Location = '<AzureRegion>'
    Description = '<Scaling plan description>'
    FriendlyName = '<Scaling plan friendly name>'
    HostPoolType = '<Pooled or personal>'
    TimeZone = '<Time zone, such as Pacific Standard Time>'
    HostPoolReference = @(@{'hostPoolArmPath' = '/subscriptions/aaaa0a0a-bb1b-cc2c-dd3d-eeeeee4e4e4e/resourceGroups/<resourceGroup/providers/Microsoft.DesktopVirtualization/hostPools/<hostPoolName>'; 'scalingPlanEnabled' = $true;})
}

$scalingPlan = New-AzWvdScalingPlan @scalingPlanParams
Create a scaling plan schedule.For pooled host pools, use theNew-AzWvdScalingPlanPooledSchedulecmdlet. This example creates a pooled scaling plan that runs on Monday through Friday, ramps up at 6:30 AM, starts peak hours at 8:30 AM, ramps down at 4:00 PM, and starts off-peak hours at 10:45 PM.$scalingPlanPooledScheduleParams = @{
    ResourceGroupName = 'resourceGroup'
    ScalingPlanName = 'scalingPlanPooled'
    ScalingPlanScheduleName = 'pooledSchedule1'
    DaysOfWeek = 'Monday','Tuesday','Wednesday','Thursday','Friday'
    RampUpStartTimeHour = '6'
    RampUpStartTimeMinute = '30'
    RampUpLoadBalancingAlgorithm = 'BreadthFirst'
    RampUpMinimumHostsPct = '20'
    RampUpCapacityThresholdPct = '20'
    PeakStartTimeHour = '8'
    PeakStartTimeMinute = '30'
    PeakLoadBalancingAlgorithm = 'DepthFirst'
    RampDownStartTimeHour = '16'
    RampDownStartTimeMinute = '0'
    RampDownLoadBalancingAlgorithm = 'BreadthFirst'
    RampDownMinimumHostsPct = '20'
    RampDownCapacityThresholdPct = '20'
    RampDownForceLogoffUser = $true
    RampDownWaitTimeMinute = '30'
    RampDownNotificationMessage = 'Log out now, please.'
    RampDownStopHostsWhen = 'ZeroSessions'
    OffPeakStartTimeHour = '22'
    OffPeakStartTimeMinute = '45'
    OffPeakLoadBalancingAlgorithm = 'DepthFirst'
}

$scalingPlanPooledSchedule = New-AzWvdScalingPlanPooledSchedule @scalingPlanPooledScheduleParamsFor personal host pools, use theNew-AzWvdScalingPlanPersonalSchedulecmdlet. The following example creates a personal scaling plan that runs on Monday, Tuesday, and Wednesday, ramps up at 6:00 AM, starts peak hours at 8:15 AM, ramps down at 4:30 PM, and starts off-peak hours at 6:45 PM.$scalingPlanPersonalScheduleParams = @{
    ResourceGroupName = 'resourceGroup'
    ScalingPlanName = 'scalingPlanPersonal'
    ScalingPlanScheduleName = 'personalSchedule1'
    DaysOfWeek = 'Monday','Tuesday','Wednesday'
    RampUpStartTimeHour = '6'
    RampUpStartTimeMinute = '0'
    RampUpAutoStartHost = 'WithAssignedUser'
    RampUpStartVMOnConnect = 'Enable'
    RampUpMinutesToWaitOnDisconnect = '30'
    RampUpActionOnDisconnect = 'Deallocate'
    RampUpMinutesToWaitOnLogoff = '3'
    RampUpActionOnLogoff = 'Deallocate'
    PeakStartTimeHour = '8'
    PeakStartTimeMinute = '15'
    PeakStartVMOnConnect = 'Enable'
    PeakMinutesToWaitOnDisconnect = '10'
    PeakActionOnDisconnect = 'Hibernate'
    PeakMinutesToWaitOnLogoff = '15'
    PeakActionOnLogoff = 'Deallocate'
    RampDownStartTimeHour = '16'
    RampDownStartTimeMinute = '30'
    RampDownStartVMOnConnect = 'Disable'
    RampDownMinutesToWaitOnDisconnect = '10'
    RampDownActionOnDisconnect = 'None'
    RampDownMinutesToWaitOnLogoff = '15'
    RampDownActionOnLogoff = 'Hibernate'
    OffPeakStartTimeHour = '18'
    OffPeakStartTimeMinute = '45'
    OffPeakStartVMOnConnect = 'Disable'
    OffPeakMinutesToWaitOnDisconnect = '10'
    OffPeakActionOnDisconnect = 'Deallocate'
    OffPeakMinutesToWaitOnLogoff = '15'
    OffPeakActionOnLogoff = 'Deallocate'
}

$scalingPlanPersonalSchedule = New-AzWvdScalingPlanPersonalSchedule @scalingPlanPersonalScheduleParamsNoteWe recommended thatRampUpStartVMOnConnectis enabled for the ramp up phase of the schedule if you opt out of having autoscale start session host VMs. For more information, seeStart VM on Connect.
Create a scaling plan schedule.
For pooled host pools, use theNew-AzWvdScalingPlanPooledSchedulecmdlet. This example creates a pooled scaling plan that runs on Monday through Friday, ramps up at 6:30 AM, starts peak hours at 8:30 AM, ramps down at 4:00 PM, and starts off-peak hours at 10:45 PM.$scalingPlanPooledScheduleParams = @{
    ResourceGroupName = 'resourceGroup'
    ScalingPlanName = 'scalingPlanPooled'
    ScalingPlanScheduleName = 'pooledSchedule1'
    DaysOfWeek = 'Monday','Tuesday','Wednesday','Thursday','Friday'
    RampUpStartTimeHour = '6'
    RampUpStartTimeMinute = '30'
    RampUpLoadBalancingAlgorithm = 'BreadthFirst'
    RampUpMinimumHostsPct = '20'
    RampUpCapacityThresholdPct = '20'
    PeakStartTimeHour = '8'
    PeakStartTimeMinute = '30'
    PeakLoadBalancingAlgorithm = 'DepthFirst'
    RampDownStartTimeHour = '16'
    RampDownStartTimeMinute = '0'
    RampDownLoadBalancingAlgorithm = 'BreadthFirst'
    RampDownMinimumHostsPct = '20'
    RampDownCapacityThresholdPct = '20'
    RampDownForceLogoffUser = $true
    RampDownWaitTimeMinute = '30'
    RampDownNotificationMessage = 'Log out now, please.'
    RampDownStopHostsWhen = 'ZeroSessions'
    OffPeakStartTimeHour = '22'
    OffPeakStartTimeMinute = '45'
    OffPeakLoadBalancingAlgorithm = 'DepthFirst'
}

$scalingPlanPooledSchedule = New-AzWvdScalingPlanPooledSchedule @scalingPlanPooledScheduleParams
For pooled host pools, use theNew-AzWvdScalingPlanPooledSchedulecmdlet. This example creates a pooled scaling plan that runs on Monday through Friday, ramps up at 6:30 AM, starts peak hours at 8:30 AM, ramps down at 4:00 PM, and starts off-peak hours at 10:45 PM.
$scalingPlanPooledScheduleParams = @{
    ResourceGroupName = 'resourceGroup'
    ScalingPlanName = 'scalingPlanPooled'
    ScalingPlanScheduleName = 'pooledSchedule1'
    DaysOfWeek = 'Monday','Tuesday','Wednesday','Thursday','Friday'
    RampUpStartTimeHour = '6'
    RampUpStartTimeMinute = '30'
    RampUpLoadBalancingAlgorithm = 'BreadthFirst'
    RampUpMinimumHostsPct = '20'
    RampUpCapacityThresholdPct = '20'
    PeakStartTimeHour = '8'
    PeakStartTimeMinute = '30'
    PeakLoadBalancingAlgorithm = 'DepthFirst'
    RampDownStartTimeHour = '16'
    RampDownStartTimeMinute = '0'
    RampDownLoadBalancingAlgorithm = 'BreadthFirst'
    RampDownMinimumHostsPct = '20'
    RampDownCapacityThresholdPct = '20'
    RampDownForceLogoffUser = $true
    RampDownWaitTimeMinute = '30'
    RampDownNotificationMessage = 'Log out now, please.'
    RampDownStopHostsWhen = 'ZeroSessions'
    OffPeakStartTimeHour = '22'
    OffPeakStartTimeMinute = '45'
    OffPeakLoadBalancingAlgorithm = 'DepthFirst'
}

$scalingPlanPooledSchedule = New-AzWvdScalingPlanPooledSchedule @scalingPlanPooledScheduleParams
$scalingPlanPooledScheduleParams = @{
    ResourceGroupName = 'resourceGroup'
    ScalingPlanName = 'scalingPlanPooled'
    ScalingPlanScheduleName = 'pooledSchedule1'
    DaysOfWeek = 'Monday','Tuesday','Wednesday','Thursday','Friday'
    RampUpStartTimeHour = '6'
    RampUpStartTimeMinute = '30'
    RampUpLoadBalancingAlgorithm = 'BreadthFirst'
    RampUpMinimumHostsPct = '20'
    RampUpCapacityThresholdPct = '20'
    PeakStartTimeHour = '8'
    PeakStartTimeMinute = '30'
    PeakLoadBalancingAlgorithm = 'DepthFirst'
    RampDownStartTimeHour = '16'
    RampDownStartTimeMinute = '0'
    RampDownLoadBalancingAlgorithm = 'BreadthFirst'
    RampDownMinimumHostsPct = '20'
    RampDownCapacityThresholdPct = '20'
    RampDownForceLogoffUser = $true
    RampDownWaitTimeMinute = '30'
    RampDownNotificationMessage = 'Log out now, please.'
    RampDownStopHostsWhen = 'ZeroSessions'
    OffPeakStartTimeHour = '22'
    OffPeakStartTimeMinute = '45'
    OffPeakLoadBalancingAlgorithm = 'DepthFirst'
}

$scalingPlanPooledSchedule = New-AzWvdScalingPlanPooledSchedule @scalingPlanPooledScheduleParams
For personal host pools, use theNew-AzWvdScalingPlanPersonalSchedulecmdlet. The following example creates a personal scaling plan that runs on Monday, Tuesday, and Wednesday, ramps up at 6:00 AM, starts peak hours at 8:15 AM, ramps down at 4:30 PM, and starts off-peak hours at 6:45 PM.$scalingPlanPersonalScheduleParams = @{
    ResourceGroupName = 'resourceGroup'
    ScalingPlanName = 'scalingPlanPersonal'
    ScalingPlanScheduleName = 'personalSchedule1'
    DaysOfWeek = 'Monday','Tuesday','Wednesday'
    RampUpStartTimeHour = '6'
    RampUpStartTimeMinute = '0'
    RampUpAutoStartHost = 'WithAssignedUser'
    RampUpStartVMOnConnect = 'Enable'
    RampUpMinutesToWaitOnDisconnect = '30'
    RampUpActionOnDisconnect = 'Deallocate'
    RampUpMinutesToWaitOnLogoff = '3'
    RampUpActionOnLogoff = 'Deallocate'
    PeakStartTimeHour = '8'
    PeakStartTimeMinute = '15'
    PeakStartVMOnConnect = 'Enable'
    PeakMinutesToWaitOnDisconnect = '10'
    PeakActionOnDisconnect = 'Hibernate'
    PeakMinutesToWaitOnLogoff = '15'
    PeakActionOnLogoff = 'Deallocate'
    RampDownStartTimeHour = '16'
    RampDownStartTimeMinute = '30'
    RampDownStartVMOnConnect = 'Disable'
    RampDownMinutesToWaitOnDisconnect = '10'
    RampDownActionOnDisconnect = 'None'
    RampDownMinutesToWaitOnLogoff = '15'
    RampDownActionOnLogoff = 'Hibernate'
    OffPeakStartTimeHour = '18'
    OffPeakStartTimeMinute = '45'
    OffPeakStartVMOnConnect = 'Disable'
    OffPeakMinutesToWaitOnDisconnect = '10'
    OffPeakActionOnDisconnect = 'Deallocate'
    OffPeakMinutesToWaitOnLogoff = '15'
    OffPeakActionOnLogoff = 'Deallocate'
}

$scalingPlanPersonalSchedule = New-AzWvdScalingPlanPersonalSchedule @scalingPlanPersonalScheduleParamsNoteWe recommended thatRampUpStartVMOnConnectis enabled for the ramp up phase of the schedule if you opt out of having autoscale start session host VMs. For more information, seeStart VM on Connect.
For personal host pools, use theNew-AzWvdScalingPlanPersonalSchedulecmdlet. The following example creates a personal scaling plan that runs on Monday, Tuesday, and Wednesday, ramps up at 6:00 AM, starts peak hours at 8:15 AM, ramps down at 4:30 PM, and starts off-peak hours at 6:45 PM.
$scalingPlanPersonalScheduleParams = @{
    ResourceGroupName = 'resourceGroup'
    ScalingPlanName = 'scalingPlanPersonal'
    ScalingPlanScheduleName = 'personalSchedule1'
    DaysOfWeek = 'Monday','Tuesday','Wednesday'
    RampUpStartTimeHour = '6'
    RampUpStartTimeMinute = '0'
    RampUpAutoStartHost = 'WithAssignedUser'
    RampUpStartVMOnConnect = 'Enable'
    RampUpMinutesToWaitOnDisconnect = '30'
    RampUpActionOnDisconnect = 'Deallocate'
    RampUpMinutesToWaitOnLogoff = '3'
    RampUpActionOnLogoff = 'Deallocate'
    PeakStartTimeHour = '8'
    PeakStartTimeMinute = '15'
    PeakStartVMOnConnect = 'Enable'
    PeakMinutesToWaitOnDisconnect = '10'
    PeakActionOnDisconnect = 'Hibernate'
    PeakMinutesToWaitOnLogoff = '15'
    PeakActionOnLogoff = 'Deallocate'
    RampDownStartTimeHour = '16'
    RampDownStartTimeMinute = '30'
    RampDownStartVMOnConnect = 'Disable'
    RampDownMinutesToWaitOnDisconnect = '10'
    RampDownActionOnDisconnect = 'None'
    RampDownMinutesToWaitOnLogoff = '15'
    RampDownActionOnLogoff = 'Hibernate'
    OffPeakStartTimeHour = '18'
    OffPeakStartTimeMinute = '45'
    OffPeakStartVMOnConnect = 'Disable'
    OffPeakMinutesToWaitOnDisconnect = '10'
    OffPeakActionOnDisconnect = 'Deallocate'
    OffPeakMinutesToWaitOnLogoff = '15'
    OffPeakActionOnLogoff = 'Deallocate'
}

$scalingPlanPersonalSchedule = New-AzWvdScalingPlanPersonalSchedule @scalingPlanPersonalScheduleParams
$scalingPlanPersonalScheduleParams = @{
    ResourceGroupName = 'resourceGroup'
    ScalingPlanName = 'scalingPlanPersonal'
    ScalingPlanScheduleName = 'personalSchedule1'
    DaysOfWeek = 'Monday','Tuesday','Wednesday'
    RampUpStartTimeHour = '6'
    RampUpStartTimeMinute = '0'
    RampUpAutoStartHost = 'WithAssignedUser'
    RampUpStartVMOnConnect = 'Enable'
    RampUpMinutesToWaitOnDisconnect = '30'
    RampUpActionOnDisconnect = 'Deallocate'
    RampUpMinutesToWaitOnLogoff = '3'
    RampUpActionOnLogoff = 'Deallocate'
    PeakStartTimeHour = '8'
    PeakStartTimeMinute = '15'
    PeakStartVMOnConnect = 'Enable'
    PeakMinutesToWaitOnDisconnect = '10'
    PeakActionOnDisconnect = 'Hibernate'
    PeakMinutesToWaitOnLogoff = '15'
    PeakActionOnLogoff = 'Deallocate'
    RampDownStartTimeHour = '16'
    RampDownStartTimeMinute = '30'
    RampDownStartVMOnConnect = 'Disable'
    RampDownMinutesToWaitOnDisconnect = '10'
    RampDownActionOnDisconnect = 'None'
    RampDownMinutesToWaitOnLogoff = '15'
    RampDownActionOnLogoff = 'Hibernate'
    OffPeakStartTimeHour = '18'
    OffPeakStartTimeMinute = '45'
    OffPeakStartVMOnConnect = 'Disable'
    OffPeakMinutesToWaitOnDisconnect = '10'
    OffPeakActionOnDisconnect = 'Deallocate'
    OffPeakMinutesToWaitOnLogoff = '15'
    OffPeakActionOnLogoff = 'Deallocate'
}

$scalingPlanPersonalSchedule = New-AzWvdScalingPlanPersonalSchedule @scalingPlanPersonalScheduleParams
Note
We recommended thatRampUpStartVMOnConnectis enabled for the ramp up phase of the schedule if you opt out of having autoscale start session host VMs. For more information, seeStart VM on Connect.
RampUpStartVMOnConnect
UseGet-AzWvdScalingPlanto get the host pool(s) that your scaling plan is assigned to.$params = @{
    ResourceGroupName = 'resourceGroup'
    Name = 'scalingPlanPersonal'
}

(Get-AzWvdScalingPlan @params).HostPoolReference | FL HostPoolArmPath,ScalingPlanEnabled
UseGet-AzWvdScalingPlanto get the host pool(s) that your scaling plan is assigned to.
$params = @{
    ResourceGroupName = 'resourceGroup'
    Name = 'scalingPlanPersonal'
}

(Get-AzWvdScalingPlan @params).HostPoolReference | FL HostPoolArmPath,ScalingPlanEnabled
$params = @{
    ResourceGroupName = 'resourceGroup'
    Name = 'scalingPlanPersonal'
}

(Get-AzWvdScalingPlan @params).HostPoolReference | FL HostPoolArmPath,ScalingPlanEnabled
You have now created a new scaling plan, one or more schedules, assigned it to your pooled or personal host pools, and enabled autoscale.
Now that you've assigned theDesktop Virtualization Power On Off ContributorandDesktop Virtualization Virtual Machine Contributorroles to the service principal on your subscriptions, you can create a dynamic scaling plan.
During the preview, you can only create a scaling plan for dynamic autoscaling using the Azure portal. To create a dynamic scaling plan using the Azure portal:
Sign in to theAzure portal.
Sign in to theAzure portal.
In the search bar, typeAzure Virtual Desktopand select the matching service entry.
In the search bar, typeAzure Virtual Desktopand select the matching service entry.
SelectScaling Plans, then selectCreate.
SelectScaling Plans, then selectCreate.
In theBasicstab, complete the following information:ParameterValue/DescriptionSubscriptionSelect the subscription you want to create the host pool in from the drop-down list.Resource groupSelect an existing resource group or selectCreate newand enter a name.Scaling plan nameEnter a name for the scaling plan. Optionally, you can also add a "friendly" name that will be displayed to your users and a description for your plan.LocationSelect the Azure region where you want to create your scaling plan.Time zoneSelect the time zone you'll use with your plan.Host pool typeSelectPooled.Exclusion tagEnter a tag name for VMs you don't want to include in scaling operations. For example, you might want to tag VMs that are set to drain mode so that autoscale doesn't override drain mode during maintenance using the exclusion tag "excludeFromScaling". If you've set "excludeFromScaling" as the tag name field on any of the VMs in the host pool, autoscale won't start, stop, or change the drain mode of those particular VMs.Scaling methodSelectDynamic autoscaling.NoteThough an exclusion tag will exclude the tagged VM from power management scaling operations, tagged VMs will still be considered as part of the calculation of the minimum percentage of hosts.Make sure not to include any sensitive information in the exclusion tags such as user principal names or other personally identifiable information.Once you complete this tab, selectNext: Schedules.
In theBasicstab, complete the following information:
Note
Though an exclusion tag will exclude the tagged VM from power management scaling operations, tagged VMs will still be considered as part of the calculation of the minimum percentage of hosts.
Make sure not to include any sensitive information in the exclusion tags such as user principal names or other personally identifiable information.
Once you complete this tab, selectNext: Schedules.
In theSchedulestab, selectAdd scheduleand complete the following information.In theGeneraltab, fill out the following fields:ParameterValue/DescriptionSchedule nameEnter a name for your schedule.Repeat onSelect which days your schedule will repeat on.Minimum percentage of active hosts (%)Enter the percentage of minimum number of running session host VMs based on the minimum host pool size that is always available. For example, if the minimum percentage of active hosts (%) is specified as 10 and the minimum host pool size is specified as 10, autoscale will ensure one session host is always available to take user connections.Minimum host pool sizeEnter the number of session host VMs to always be part of the host pool. These session hosts can either be in a running state or a stopped state.Maximum host pool sizeEnter the maximum number of running session host VMs that can be available.SelectNext.In theRamp uptab, fill out the following fields:ParameterValue/DescriptionStart timeSelect a time from the drop-down menu to start preparing VMs for peak business hours.Load balancing algorithmWe recommend selectingbreadth-first algorithm. Breadth-first load balancing distributes users across existing VMs to keep access times fast. The load balancing preference you select here overrides the one you selected for your original host pool settings.Capacity thresholdEnter the percentage of available host pool capacity that will trigger a scaling action to take place. For example, if capacity threshold is specified as 60% and your total host pool capacity is 100 sessions, autoscale will turn on additional session hosts once the host pool exceeds a load of 60 sessions.You can modify the virtual machine limit parameters that you filled out in theGeneraltab. We recommend having higherMinimum percentage of active hosts (%)andMinimum host pool sizein the ramp-up phase, which will be carried over to the peak phase.SelectNext.In thePeak hourstab, fill out the following fields:ParameterValue/DescriptionStart timeEnter a start time for when your usage rate is highest during the day. Make sure the time is in the same time zone you specified for your scaling plan. This time is also the end time for the ramp-up phase.Load balancing algorithmSelect breadth-first or depth-first load balancing. Breadth-first load balancing distributes new user sessions across all available session hosts in the host pool. Depth-first load balancing distributes new sessions to any available session host with the highest number of connections that hasn't reached its session limit yet.For more information about load-balancing types, seeConfigure the Azure Virtual Desktop load-balancing method.NoteYou can't change the capacity threshold here. Instead, the setting you entered inRamp-upcarries over to this setting.In theRamp-downtab, enter values into similar fields toRamp-up, but this time it will be for when your host pool usage drops off. This includes the following fields:Start timeLoad-balancing algorithmCapacity threshold (%)Force logoff usersMinimum percentage of active hosts (%)Minimum host pool sizeMaximum host pool sizeImportantIf you've enabled autoscale to force users to sign out during ramp-down, the feature will choose the session host with the lowest number of user sessions (active and disconnected) to shut down or delete. Autoscale will put the session host in drain mode, send those user sessions a notification telling them they'll be signed out, and then sign out those users after the specified wait time is over. After autoscale signs out those user sessions, it then deallocates or deletes the VM.If you haven't enabled forced sign out during ramp-down, you then need to choose whether you want to shut down âVMs have no active or disconnected sessionsâ or âVMs have no active sessionsâ during ramp-down.Whether youâve enabled autoscale to force users to sign out during ramp-down or not, thecapacity thresholdand theminimum percentage of hostsare still respected, autoscale will only shut down/delete VMs if all existing user sessions (active and disconnected) in the host pool can be consolidated to fewer VMs without exceeding the capacity threshold.Likewise,Off-peak hoursworks the same way asPeak hours:Start time, which is also the end of the ramp-down period.Load-balancing algorithm. We recommend choosingdepth-firstto gradually reduce the number of session hosts based on sessions on each VM.Just like peak hours, you can't configure the capacity threshold here. Instead, the value you entered inRamp-downcarries over.ImportantIf you have any days unselected in your schedule, the last off-peak parameters on the selected days will be carried over for the unselected days until the next ramp-up phase. For example, if you only have one schedule for Monday to Friday, then your configuration for the Friday off-peak phase will be carried over until the Monday ramp-up phase.
In theSchedulestab, selectAdd scheduleand complete the following information.
In theGeneraltab, fill out the following fields:ParameterValue/DescriptionSchedule nameEnter a name for your schedule.Repeat onSelect which days your schedule will repeat on.Minimum percentage of active hosts (%)Enter the percentage of minimum number of running session host VMs based on the minimum host pool size that is always available. For example, if the minimum percentage of active hosts (%) is specified as 10 and the minimum host pool size is specified as 10, autoscale will ensure one session host is always available to take user connections.Minimum host pool sizeEnter the number of session host VMs to always be part of the host pool. These session hosts can either be in a running state or a stopped state.Maximum host pool sizeEnter the maximum number of running session host VMs that can be available.SelectNext.
In theGeneraltab, fill out the following fields:
SelectNext.
In theRamp uptab, fill out the following fields:ParameterValue/DescriptionStart timeSelect a time from the drop-down menu to start preparing VMs for peak business hours.Load balancing algorithmWe recommend selectingbreadth-first algorithm. Breadth-first load balancing distributes users across existing VMs to keep access times fast. The load balancing preference you select here overrides the one you selected for your original host pool settings.Capacity thresholdEnter the percentage of available host pool capacity that will trigger a scaling action to take place. For example, if capacity threshold is specified as 60% and your total host pool capacity is 100 sessions, autoscale will turn on additional session hosts once the host pool exceeds a load of 60 sessions.You can modify the virtual machine limit parameters that you filled out in theGeneraltab. We recommend having higherMinimum percentage of active hosts (%)andMinimum host pool sizein the ramp-up phase, which will be carried over to the peak phase.SelectNext.
In theRamp uptab, fill out the following fields:
You can modify the virtual machine limit parameters that you filled out in theGeneraltab. We recommend having higherMinimum percentage of active hosts (%)andMinimum host pool sizein the ramp-up phase, which will be carried over to the peak phase.
SelectNext.
In thePeak hourstab, fill out the following fields:ParameterValue/DescriptionStart timeEnter a start time for when your usage rate is highest during the day. Make sure the time is in the same time zone you specified for your scaling plan. This time is also the end time for the ramp-up phase.Load balancing algorithmSelect breadth-first or depth-first load balancing. Breadth-first load balancing distributes new user sessions across all available session hosts in the host pool. Depth-first load balancing distributes new sessions to any available session host with the highest number of connections that hasn't reached its session limit yet.For more information about load-balancing types, seeConfigure the Azure Virtual Desktop load-balancing method.NoteYou can't change the capacity threshold here. Instead, the setting you entered inRamp-upcarries over to this setting.
In thePeak hourstab, fill out the following fields:
Note
You can't change the capacity threshold here. Instead, the setting you entered inRamp-upcarries over to this setting.
In theRamp-downtab, enter values into similar fields toRamp-up, but this time it will be for when your host pool usage drops off. This includes the following fields:Start timeLoad-balancing algorithmCapacity threshold (%)Force logoff usersMinimum percentage of active hosts (%)Minimum host pool sizeMaximum host pool sizeImportantIf you've enabled autoscale to force users to sign out during ramp-down, the feature will choose the session host with the lowest number of user sessions (active and disconnected) to shut down or delete. Autoscale will put the session host in drain mode, send those user sessions a notification telling them they'll be signed out, and then sign out those users after the specified wait time is over. After autoscale signs out those user sessions, it then deallocates or deletes the VM.If you haven't enabled forced sign out during ramp-down, you then need to choose whether you want to shut down âVMs have no active or disconnected sessionsâ or âVMs have no active sessionsâ during ramp-down.Whether youâve enabled autoscale to force users to sign out during ramp-down or not, thecapacity thresholdand theminimum percentage of hostsare still respected, autoscale will only shut down/delete VMs if all existing user sessions (active and disconnected) in the host pool can be consolidated to fewer VMs without exceeding the capacity threshold.
In theRamp-downtab, enter values into similar fields toRamp-up, but this time it will be for when your host pool usage drops off. This includes the following fields:
Start time
Load-balancing algorithm
Capacity threshold (%)
Force logoff users
Minimum percentage of active hosts (%)
Minimum host pool size
Maximum host pool size
Important
If you've enabled autoscale to force users to sign out during ramp-down, the feature will choose the session host with the lowest number of user sessions (active and disconnected) to shut down or delete. Autoscale will put the session host in drain mode, send those user sessions a notification telling them they'll be signed out, and then sign out those users after the specified wait time is over. After autoscale signs out those user sessions, it then deallocates or deletes the VM.
If you've enabled autoscale to force users to sign out during ramp-down, the feature will choose the session host with the lowest number of user sessions (active and disconnected) to shut down or delete. Autoscale will put the session host in drain mode, send those user sessions a notification telling them they'll be signed out, and then sign out those users after the specified wait time is over. After autoscale signs out those user sessions, it then deallocates or deletes the VM.
If you haven't enabled forced sign out during ramp-down, you then need to choose whether you want to shut down âVMs have no active or disconnected sessionsâ or âVMs have no active sessionsâ during ramp-down.
If you haven't enabled forced sign out during ramp-down, you then need to choose whether you want to shut down âVMs have no active or disconnected sessionsâ or âVMs have no active sessionsâ during ramp-down.
Whether youâve enabled autoscale to force users to sign out during ramp-down or not, thecapacity thresholdand theminimum percentage of hostsare still respected, autoscale will only shut down/delete VMs if all existing user sessions (active and disconnected) in the host pool can be consolidated to fewer VMs without exceeding the capacity threshold.
Whether youâve enabled autoscale to force users to sign out during ramp-down or not, thecapacity thresholdand theminimum percentage of hostsare still respected, autoscale will only shut down/delete VMs if all existing user sessions (active and disconnected) in the host pool can be consolidated to fewer VMs without exceeding the capacity threshold.
Likewise,Off-peak hoursworks the same way asPeak hours:Start time, which is also the end of the ramp-down period.Load-balancing algorithm. We recommend choosingdepth-firstto gradually reduce the number of session hosts based on sessions on each VM.Just like peak hours, you can't configure the capacity threshold here. Instead, the value you entered inRamp-downcarries over.ImportantIf you have any days unselected in your schedule, the last off-peak parameters on the selected days will be carried over for the unselected days until the next ramp-up phase. For example, if you only have one schedule for Monday to Friday, then your configuration for the Friday off-peak phase will be carried over until the Monday ramp-up phase.
Likewise,Off-peak hoursworks the same way asPeak hours:
Start time, which is also the end of the ramp-down period.
Load-balancing algorithm. We recommend choosingdepth-firstto gradually reduce the number of session hosts based on sessions on each VM.
Just like peak hours, you can't configure the capacity threshold here. Instead, the value you entered inRamp-downcarries over.
Important
If you have any days unselected in your schedule, the last off-peak parameters on the selected days will be carried over for the unselected days until the next ramp-up phase. For example, if you only have one schedule for Monday to Friday, then your configuration for the Friday off-peak phase will be carried over until the Monday ramp-up phase.
SelectNextto take you to theHost pool assignmentstab. Select the check box next to each host pool you want to include. If you don't want to enable autoscale, unselect all check boxes. You can always return to this setting later and change it. You can only assign the dynamic scaling plan to pooled host pools with session host configuration.NoteWhen you create or update a scaling plan that's already assigned to host pools, its changes are applied immediately.
SelectNextto take you to theHost pool assignmentstab. Select the check box next to each host pool you want to include. If you don't want to enable autoscale, unselect all check boxes. You can always return to this setting later and change it. You can only assign the dynamic scaling plan to pooled host pools with session host configuration.
Note
When you create or update a scaling plan that's already assigned to host pools, its changes are applied immediately.
After that, you'll need to entertags. Tags are name and value pairs that categorize resources for consolidated billing. You can apply the same tag to multiple resources and resource groups. To learn more about tagging resources, seeUse tags to organize your Azure resources.NoteIf you change resource settings on other tabs after creating tags, your tags will be automatically updated.
After that, you'll need to entertags. Tags are name and value pairs that categorize resources for consolidated billing. You can apply the same tag to multiple resources and resource groups. To learn more about tagging resources, seeUse tags to organize your Azure resources.
Note
If you change resource settings on other tabs after creating tags, your tags will be automatically updated.
Once you're done, go to theReview + createtab and selectCreateto create and assign your scaling plan to the host pools you selected.
Once you're done, go to theReview + createtab and selectCreateto create and assign your scaling plan to the host pools you selected.
Configure a time limit policy
You can configure a time limit policy that signs out all disconnected users once a set time is reached to reduce theused host pool capacityusing Microsoft Intune or Group Policy. Select the relevant tab for your scenario.
Microsoft Intune
Group Policy
To configure a time limit policy using Intune:
Sign in to theMicrosoft Intune admin center.
Sign in to theMicrosoft Intune admin center.
Create or edit a configuration profileforWindows 10 and laterdevices, with theSession Time Limitsprofile type.
Create or edit a configuration profileforWindows 10 and laterdevices, with theSession Time Limitsprofile type.
In the settings picker, browse toAdministrative templates>Windows Components>Remote Desktop Services>Remote Desktop Session Host>Session Time Limits.
In the settings picker, browse toAdministrative templates>Windows Components>Remote Desktop Services>Remote Desktop Session Host>Session Time Limits.
Check the box forSet time limit for disconnected sessions, then close the settings picker.
Check the box forSet time limit for disconnected sessions, then close the settings picker.
Expand theAdministrative templatescategory, then toggle the switch forSet time limit for disconnected sessionstoEnabled, then select a time value from the drop-down list.
Expand theAdministrative templatescategory, then toggle the switch forSet time limit for disconnected sessionstoEnabled, then select a time value from the drop-down list.
SelectNext.
SelectNext.
Optional: On theScope tagstab, select a scope tag to filter the profile. For more information about scope tags, seeUse role-based access control (RBAC) and scope tags for distributed IT.
Optional: On theScope tagstab, select a scope tag to filter the profile. For more information about scope tags, seeUse role-based access control (RBAC) and scope tags for distributed IT.
On theAssignmentstab, select the group containing the computers providing a remote session you want to configure, then selectNext.
On theAssignmentstab, select the group containing the computers providing a remote session you want to configure, then selectNext.
On theReview + createtab, review the settings, then selectCreate.
On theReview + createtab, review the settings, then selectCreate.
Once the policy applies to the computers providing a remote session, restart them for the settings to take effect.
Once the policy applies to the computers providing a remote session, restart them for the settings to take effect.
To configure a time limit policy using Group Policy:
Open theGroup Policy Managementconsole on a device you use to manage the Active Directory domain.
Open theGroup Policy Managementconsole on a device you use to manage the Active Directory domain.
Create or edit a policy that targets the computers providing a remote session you want to configure.
Create or edit a policy that targets the computers providing a remote session you want to configure.
Navigate toComputer Configuration>Policies>Administrative Templates>Windows Components>Remote Desktop Services>Remote Desktop Session Host>Session Time Limits.
Navigate toComputer Configuration>Policies>Administrative Templates>Windows Components>Remote Desktop Services>Remote Desktop Session Host>Session Time Limits.
Double-click the policy settingSet time limit for disconnected sessionsto open it.
Double-click the policy settingSet time limit for disconnected sessionsto open it.
SelectEnabled, select a time value from the drop-down list, then selectOK.
SelectEnabled, select a time value from the drop-down list, then selectOK.
Ensure the policy is applied to the computers providing a remote session, then restart them for the settings to take effect.
Ensure the policy is applied to the computers providing a remote session, then restart them for the settings to take effect.
Edit an existing scaling plan
Select the relevant tab for your scenario.
Azure portal
Azure PowerShell
To edit an existing scaling plan using the Azure portal:
Sign in to theAzure portal.
Sign in to theAzure portal.
In the search bar, typeAzure Virtual Desktopand select the matching service entry.
In the search bar, typeAzure Virtual Desktopand select the matching service entry.
SelectScaling plans, then select the name of the scaling plan you want to edit. The overview blade of the scaling plan should open.
SelectScaling plans, then select the name of the scaling plan you want to edit. The overview blade of the scaling plan should open.
To change the scaling plan host pool assignments, under theManageheading selectHost pool assignmentsand then select+ Assign. Select the host pools you want to assign the scaling plan to and selectAssign. The host pools must be in the same Azure region as the scaling plan and the scaling plan's host pool type must match the type of host pools you're trying to assign it to.TipIf you've enabled the scaling plan during deployment, then you'll also have the option to disable the plan for the selected host pool in theScaling planmenu by unselecting theEnable autoscalecheckbox, as shown in the following screenshot.
To change the scaling plan host pool assignments, under theManageheading selectHost pool assignmentsand then select+ Assign. Select the host pools you want to assign the scaling plan to and selectAssign. The host pools must be in the same Azure region as the scaling plan and the scaling plan's host pool type must match the type of host pools you're trying to assign it to.
Tip
If you've enabled the scaling plan during deployment, then you'll also have the option to disable the plan for the selected host pool in theScaling planmenu by unselecting theEnable autoscalecheckbox, as shown in the following screenshot.

To edit schedules, under theManageheading, selectSchedules.
To edit schedules, under theManageheading, selectSchedules.
To edit the plan's friendly name, description, time zone, or exclusion tags, go to thePropertiestab.
To edit the plan's friendly name, description, time zone, or exclusion tags, go to thePropertiestab.
Here's how to update a scaling plan using the Az.DesktopVirtualization PowerShell module. The following examples show you how to update a scaling plan and scaling plan schedule.
Update a scaling plan usingUpdate-AzWvdScalingPlan. This example updates the scaling plan's timezone.$scalingPlanParams = @{
    ResourceGroupName = 'resourceGroup'
    Name = 'scalingPlanPersonal'
    Timezone = 'Eastern Standard Time'
}

Update-AzWvdScalingPlan @scalingPlanParams
Update a scaling plan usingUpdate-AzWvdScalingPlan. This example updates the scaling plan's timezone.
$scalingPlanParams = @{
    ResourceGroupName = 'resourceGroup'
    Name = 'scalingPlanPersonal'
    Timezone = 'Eastern Standard Time'
}

Update-AzWvdScalingPlan @scalingPlanParams
$scalingPlanParams = @{
    ResourceGroupName = 'resourceGroup'
    Name = 'scalingPlanPersonal'
    Timezone = 'Eastern Standard Time'
}

Update-AzWvdScalingPlan @scalingPlanParams
Update a scaling plan schedule usingUpdate-AzWvdScalingPlanPersonalSchedule. This example updates the ramp up start time.$scalingPlanPersonalScheduleParams = @{
    ResourceGroupName = 'resourceGroup'
    ScalingPlanName = 'scalingPlanPersonal'
    ScalingPlanScheduleName = 'personalSchedule1'
    RampUpStartTimeHour = '5'
    RampUpStartTimeMinute = '30'
}

Update-AzWvdScalingPlanPersonalSchedule @scalingPlanPersonalScheduleParams
Update a scaling plan schedule usingUpdate-AzWvdScalingPlanPersonalSchedule. This example updates the ramp up start time.
$scalingPlanPersonalScheduleParams = @{
    ResourceGroupName = 'resourceGroup'
    ScalingPlanName = 'scalingPlanPersonal'
    ScalingPlanScheduleName = 'personalSchedule1'
    RampUpStartTimeHour = '5'
    RampUpStartTimeMinute = '30'
}

Update-AzWvdScalingPlanPersonalSchedule @scalingPlanPersonalScheduleParams
$scalingPlanPersonalScheduleParams = @{
    ResourceGroupName = 'resourceGroup'
    ScalingPlanName = 'scalingPlanPersonal'
    ScalingPlanScheduleName = 'personalSchedule1'
    RampUpStartTimeHour = '5'
    RampUpStartTimeMinute = '30'
}

Update-AzWvdScalingPlanPersonalSchedule @scalingPlanPersonalScheduleParams
Update a pooled scaling plan schedule usingUpdate-AzWvdScalingPlanPooledSchedule. This example updates the peak hours start time.$scalingPlanPooledScheduleParams = @{
    ResourceGroupName = 'resourceGroup'
    ScalingPlanName = 'scalingPlanPooled'
    ScalingPlanScheduleName = 'pooledSchedule1'
    PeakStartTimeHour = '9'
    PeakStartTimeMinute = '15'
}

Update-AzWvdScalingPlanPooledSchedule @scalingPlanPooledScheduleParams
Update a pooled scaling plan schedule usingUpdate-AzWvdScalingPlanPooledSchedule. This example updates the peak hours start time.
$scalingPlanPooledScheduleParams = @{
    ResourceGroupName = 'resourceGroup'
    ScalingPlanName = 'scalingPlanPooled'
    ScalingPlanScheduleName = 'pooledSchedule1'
    PeakStartTimeHour = '9'
    PeakStartTimeMinute = '15'
}

Update-AzWvdScalingPlanPooledSchedule @scalingPlanPooledScheduleParams
$scalingPlanPooledScheduleParams = @{
    ResourceGroupName = 'resourceGroup'
    ScalingPlanName = 'scalingPlanPooled'
    ScalingPlanScheduleName = 'pooledSchedule1'
    PeakStartTimeHour = '9'
    PeakStartTimeMinute = '15'
}

Update-AzWvdScalingPlanPooledSchedule @scalingPlanPooledScheduleParams
Assign a scaling plan to existing host pools usingUpdate-AzWvdScalingPlan. The following example assigns a personal scaling plan to two existing personal host pools.$scalingPlanParams = @{
    ResourceGroupName = 'resourceGroup'
    Name = 'scalingPlanPersonal'
    HostPoolReference = @(
        @{
           'hostPoolArmPath' = '/subscriptions/aaaa0a0a-bb1b-cc2c-dd3d-eeeeee4e4e4e/resourceGroups/resourceGroup/providers/Microsoft.DesktopVirtualization/hostPools/scalingPlanPersonal';
            'scalingPlanEnabled' = $true;
        },
        @{
           'hostPoolArmPath' = '/subscriptions/aaaa0a0a-bb1b-cc2c-dd3d-eeeeee4e4e4e/resourceGroups/resourceGroup/providers/Microsoft.DesktopVirtualization/hostPools/scalingPlanPersonal2';
            'scalingPlanEnabled' = $true;
        }
    )
}

$scalingPlan = Update-AzWvdScalingPlan @scalingPlanParams
Assign a scaling plan to existing host pools usingUpdate-AzWvdScalingPlan. The following example assigns a personal scaling plan to two existing personal host pools.
$scalingPlanParams = @{
    ResourceGroupName = 'resourceGroup'
    Name = 'scalingPlanPersonal'
    HostPoolReference = @(
        @{
           'hostPoolArmPath' = '/subscriptions/aaaa0a0a-bb1b-cc2c-dd3d-eeeeee4e4e4e/resourceGroups/resourceGroup/providers/Microsoft.DesktopVirtualization/hostPools/scalingPlanPersonal';
            'scalingPlanEnabled' = $true;
        },
        @{
           'hostPoolArmPath' = '/subscriptions/aaaa0a0a-bb1b-cc2c-dd3d-eeeeee4e4e4e/resourceGroups/resourceGroup/providers/Microsoft.DesktopVirtualization/hostPools/scalingPlanPersonal2';
            'scalingPlanEnabled' = $true;
        }
    )
}

$scalingPlan = Update-AzWvdScalingPlan @scalingPlanParams
$scalingPlanParams = @{
    ResourceGroupName = 'resourceGroup'
    Name = 'scalingPlanPersonal'
    HostPoolReference = @(
        @{
           'hostPoolArmPath' = '/subscriptions/aaaa0a0a-bb1b-cc2c-dd3d-eeeeee4e4e4e/resourceGroups/resourceGroup/providers/Microsoft.DesktopVirtualization/hostPools/scalingPlanPersonal';
            'scalingPlanEnabled' = $true;
        },
        @{
           'hostPoolArmPath' = '/subscriptions/aaaa0a0a-bb1b-cc2c-dd3d-eeeeee4e4e4e/resourceGroups/resourceGroup/providers/Microsoft.DesktopVirtualization/hostPools/scalingPlanPersonal2';
            'scalingPlanEnabled' = $true;
        }
    )
}

$scalingPlan = Update-AzWvdScalingPlan @scalingPlanParams
UseGet-AzWvdScalingPlanto get the host pool(s) that your scaling plan is assigned to.$params = @{
    ResourceGroupName = 'resourceGroup'
    Name = 'scalingPlanPersonal'
}

(Get-AzWvdScalingPlan @params).HostPoolReference | FL HostPoolArmPath,ScalingPlanEnabled
UseGet-AzWvdScalingPlanto get the host pool(s) that your scaling plan is assigned to.
$params = @{
    ResourceGroupName = 'resourceGroup'
    Name = 'scalingPlanPersonal'
}

(Get-AzWvdScalingPlan @params).HostPoolReference | FL HostPoolArmPath,ScalingPlanEnabled
$params = @{
    ResourceGroupName = 'resourceGroup'
    Name = 'scalingPlanPersonal'
}

(Get-AzWvdScalingPlan @params).HostPoolReference | FL HostPoolArmPath,ScalingPlanEnabled
To edit an existing scaling plan using the Azure portal:
Sign in to theAzure portal.
Sign in to theAzure portal.
In the search bar, typeAzure Virtual Desktopand select the matching service entry.
In the search bar, typeAzure Virtual Desktopand select the matching service entry.
SelectScaling plans, then select the name of the scaling plan you want to edit. The overview blade of the scaling plan should open.
SelectScaling plans, then select the name of the scaling plan you want to edit. The overview blade of the scaling plan should open.
To change the scaling plan host pool assignments, under theManageheading selectHost pool assignmentsand then select+ Assign. Select the host pools you want to assign the scaling plan to and selectAssign. The host pools must be in the same Azure region as the scaling plan and the scaling plan's host pool type must match the type of host pools you're trying to assign it to.TipIf you've enabled the scaling plan during deployment, then you'll also have the option to disable the plan for the selected host pool in theScaling planmenu by unselecting theEnable autoscalecheckbox, as shown in the following screenshot.
To change the scaling plan host pool assignments, under theManageheading selectHost pool assignmentsand then select+ Assign. Select the host pools you want to assign the scaling plan to and selectAssign. The host pools must be in the same Azure region as the scaling plan and the scaling plan's host pool type must match the type of host pools you're trying to assign it to.
Tip
If you've enabled the scaling plan during deployment, then you'll also have the option to disable the plan for the selected host pool in theScaling planmenu by unselecting theEnable autoscalecheckbox, as shown in the following screenshot.

To edit schedules, under theManageheading, selectSchedules.
To edit schedules, under theManageheading, selectSchedules.
To edit the plan's friendly name, description, time zone, or exclusion tags, go to thePropertiestab.
To edit the plan's friendly name, description, time zone, or exclusion tags, go to thePropertiestab.
Next steps
Now that you created your scaling plan, here are some things you can do:
Monitor Autoscale operations with Insights
If you'd like to learn more about terms used in this article, check out ourautoscale glossary. For examples of how autoscale works, seeAutoscale example scenarios. You can also look at ourAutoscale FAQif you have other questions.
Feedback
Was this page helpful?
Additional resources