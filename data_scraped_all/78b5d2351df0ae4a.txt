Note
Access to this page requires authorization. You can trysigning inorchanging directories.
Access to this page requires authorization. You can trychanging directories.
Discover and govern Azure SQL Database in Microsoft Purview
Article
2025-02-03
10 contributors
In this article
This article outlines the process to register an Azure SQL database source in Microsoft Purview. It includes instructions to authenticate and interact with the SQL database.
Supported capabilities
When you're scanning Azure SQL Database, Microsoft Purview supports extracting technical metadata from these sources:
Server
Database
Schemas
Tables, including columns
Views, including columns (with lineage extraction enabled, as part of scanning)
Stored procedures (with lineage extraction enabled)*
Stored procedure runs (with lineage extraction enabled)*
When you're setting up a scan, you can further scope it after providing the database name by selecting tables and views as needed.
* Stored procedure lineage extraction scan has some limitations. Refer to the Known limitations section on this page for details.
Forclassifications,sensitivity labels,policies,data lineage, andlive view, see thelist of supported capabilities.
Known limitations
Forstored procedures (SP) lineage extraction:
SP lineage extraction scan isn't supported if your logical server in Azure disables public access or doesn't allow Azure services to access it.
SP lineage extraction scan isn't supported if your logical server in Azure disables public access or doesn't allow Azure services to access it.
SP lineage extraction scan is currently not supported if your stored procedures contain an INSERT or a DROP query.
SP lineage extraction scan is currently not supported if your stored procedures contain an INSERT or a DROP query.
SP lineage extraction scan isn't supported if your Microsoft Purview account disables public access.SP lineage extraction scan is scheduled to run every six hours by default. The frequency can't be changed.Lineage is captured only when the stored procedure execution transfers data from one table to another. And it's not supported for temporary tables.Lineage extraction isn't supported for functions or triggers.Due to the following limitations, you could see duplicate assets in the catalog if you have scenarios such as:The object names in assets and fully qualified names follow the case used in stored procedure statements, which might not align with the object case in original data source.When SQL views are referenced in stored procedures, they're currently captured as SQL tables.
SP lineage extraction scan isn't supported if your Microsoft Purview account disables public access.
SP lineage extraction scan is scheduled to run every six hours by default. The frequency can't be changed.
Lineage is captured only when the stored procedure execution transfers data from one table to another. And it's not supported for temporary tables.
Lineage extraction isn't supported for functions or triggers.
Due to the following limitations, you could see duplicate assets in the catalog if you have scenarios such as:The object names in assets and fully qualified names follow the case used in stored procedure statements, which might not align with the object case in original data source.When SQL views are referenced in stored procedures, they're currently captured as SQL tables.
The object names in assets and fully qualified names follow the case used in stored procedure statements, which might not align with the object case in original data source.
When SQL views are referenced in stored procedures, they're currently captured as SQL tables.
For scanned assets:
For a full scan, instead of INT data type, DECIMAL is displayed as a data type for SQL asset properties.
For a full scan, instead of INT data type, DECIMAL is displayed as a data type for SQL asset properties.
For NCHAR data type, column length is displayed in bytes and not as character count.
For NCHAR data type, column length is displayed in bytes and not as character count.
Note
Lineage is also supported if Azure SQL tables or views are used as a source/sink inAzure Data Factory Copy and Data Flow activities.
Prerequisites
An Azure account with an active subscription.Create an account for free.
An Azure account with an active subscription.Create an account for free.
An activeMicrosoft Purview account.
An activeMicrosoft Purview account.
Data Source Administrator and Data Reader permissions, so you can register a source and manage it in the Microsoft Purview governance portal. For details, seeAccess control in the Microsoft Purview governance portal.
Data Source Administrator and Data Reader permissions, so you can register a source and manage it in the Microsoft Purview governance portal. For details, seeAccess control in the Microsoft Purview governance portal.
Register the data source
Before you scan, it's important to register the data source in Microsoft Purview:
Open the Microsoft Purview governance portal by:Browsing directly tohttps://web.purview.azure.comand selecting your Microsoft Purview account.Opening theAzure portal, searching for and selecting the Microsoft Purview account. Select thethe Microsoft Purview governance portalbutton.
Open the Microsoft Purview governance portal by:
Browsing directly tohttps://web.purview.azure.comand selecting your Microsoft Purview account.
Opening theAzure portal, searching for and selecting the Microsoft Purview account. Select thethe Microsoft Purview governance portalbutton.
Navigate to theData Map.
Navigate to theData Map.

Create thecollection hierarchyby going toCollectionsand then selectingAdd a collection. Assign permissions to individual subcollections as required.
Create thecollection hierarchyby going toCollectionsand then selectingAdd a collection. Assign permissions to individual subcollections as required.

Go to the appropriate collection underSources, and then select theRegistericon to register a new SQL database.
Go to the appropriate collection underSources, and then select theRegistericon to register a new SQL database.

Select theAzure SQL Databasedata source, and then selectContinue.
Select theAzure SQL Databasedata source, and then selectContinue.
ForName, provide a suitable name for the data source. Select relevant names forAzure subscription,Server name, andSelect a collection, and then selectApply.
ForName, provide a suitable name for the data source. Select relevant names forAzure subscription,Server name, andSelect a collection, and then selectApply.

Confirm that the SQL database appears under the selected collection.
Confirm that the SQL database appears under the selected collection.

Update firewall settings
If your database server has a firewall enabled, you need to update the firewall to allow access in one of the following ways:
Allow Azure connections through the firewall. This is a straightforward option to route traffic through Azure networking, without needing to manage virtual machines.
Install a self-hosted integration runtime on a machine in your network and give it access through the firewall. If you have a private virtual network set up within Azure, or have any other closed network set up, using a self-hosted integration runtime on a machine within that network will allow you to fully manage traffic flow and utilize your existing network.
Use a managed virtual network. Setting up a managed virtual network with your Microsoft Purview account allows you to connect to Azure SQL by using the Azure integration runtime in a closed network.
For more information about the firewall, see theAzure SQL Database firewall documentation.
Allow Azure connections
Enabling Azure connections allows Microsoft Purview to connect to the server without requiring you to update the firewall itself.
Go to your database account.
On theOverviewpage, select the server name.
SelectSecurity>Networking.
ForAllow Azure services and resources to access this server, selectYes.

For more information about allowing connections from inside Azure, see thehow-to guide.
Install a self-hosted integration runtime
You can install a self-hosted integration runtime on a machine to connect with a resource in a private network:
Choose the right integration runtime for your scenario
Create and install your integration runtime:To use a self-hosted integration runtime:Follow the article to create and configure a self-hosted integration runtime.To use a kubernetes supported self-hosted integration runtime:Follow the article to create and configure a kubernetes supported integration runtime.
To use a self-hosted integration runtime:Follow the article to create and configure a self-hosted integration runtime.
To use a kubernetes supported self-hosted integration runtime:Follow the article to create and configure a kubernetes supported integration runtime.
Check your database server's networking configuration to confirm that a private endpoint is accessible to the machine that contains the self-hosted integration runtime. Add the IP address of the machine if it doesn't already have access.
If your logical server is behind a private endpoint or in a virtual network, you can use aningestion private endpointto ensure end-to-end network isolation.
Configure authentication for a scan
To scan your data source, you need to configure an authentication method in Azure SQL Database.
Important
If you're using aself-hosted integration runtimeto connect to your resource, system-assigned and user-assigned managed identities won't work. You need to use service principal authentication or SQL authentication.
Microsoft Purview supports the following options:
System-assigned managed identity (SAMI)(recommended). This is an identity that is associated directly with your Microsoft Purview account. It allows you to authenticate directly with other Azure resources without needing to manage a go-between user or credential set.The SAMI is created when your Microsoft Purview resource is created. The SAMI is managed by Azure and uses your Microsoft Purview account's name. The SAMI can't currently be used with a self-hosted integration runtime for Azure SQL.For more information, see themanaged identity overview.
System-assigned managed identity (SAMI)(recommended). This is an identity that is associated directly with your Microsoft Purview account. It allows you to authenticate directly with other Azure resources without needing to manage a go-between user or credential set.
The SAMI is created when your Microsoft Purview resource is created. The SAMI is managed by Azure and uses your Microsoft Purview account's name. The SAMI can't currently be used with a self-hosted integration runtime for Azure SQL.
For more information, see themanaged identity overview.
User-assigned managed identity (UAMI)(preview). Similar to a SAMI, a UAMI is a credential resource that allows Microsoft Purview to authenticate against Microsoft Entra ID.The UAMI is managed by users in Azure, rather than by Azure itself, which gives you more control over security. The UAMI can't currently be used with a self-hosted integration runtime for Azure SQL.For more information, see theguide for user-assigned managed identities.
User-assigned managed identity (UAMI)(preview). Similar to a SAMI, a UAMI is a credential resource that allows Microsoft Purview to authenticate against Microsoft Entra ID.
The UAMI is managed by users in Azure, rather than by Azure itself, which gives you more control over security. The UAMI can't currently be used with a self-hosted integration runtime for Azure SQL.
For more information, see theguide for user-assigned managed identities.
Service principal. A service principal is an application that can be assigned permissions like any other group or user, without being associated directly with a person. Authentication for service principals has an expiration date, so it can be useful for temporary projects.For more information, see theservice principal documentation.
Service principal. A service principal is an application that can be assigned permissions like any other group or user, without being associated directly with a person. Authentication for service principals has an expiration date, so it can be useful for temporary projects.
For more information, see theservice principal documentation.
SQL authentication. Connect to the SQL database with a username and password. For more information, see theSQL authentication documentation.If you need to create a login, followthis guide to query a SQL database. Usethis guide to create a login by using T-SQL.NoteBe sure to select theAzure SQL Databaseoption on the page.
SQL authentication. Connect to the SQL database with a username and password. For more information, see theSQL authentication documentation.
If you need to create a login, followthis guide to query a SQL database. Usethis guide to create a login by using T-SQL.
Note
Be sure to select theAzure SQL Databaseoption on the page.
For steps to authenticate with your SQL database, select your chosen method of authentication from the following tabs.
SQL authentication
Managed identity
Service principal
Note
Only the server-level principal login (created by the provisioning process) or members of theloginmanagerdatabase role in the master database can create new logins. The Microsoft Purview account should be able to scan the resources about 15 minutes after it gets permissions.
loginmanager
You need a SQL login with at leastdb_datareaderpermissions to be able to access the information that Microsoft Purview needs to scan the database. You can follow the instructions inCREATE LOGINto create a login for Azure SQL Database. Save the username and password for the next steps.
You need a SQL login with at leastdb_datareaderpermissions to be able to access the information that Microsoft Purview needs to scan the database. You can follow the instructions inCREATE LOGINto create a login for Azure SQL Database. Save the username and password for the next steps.
db_datareader
Go to your key vault in the Azure portal.
Go to your key vault in the Azure portal.
SelectSettings>Secrets, and then select+ Generate/Import.
SelectSettings>Secrets, and then select+ Generate/Import.

ForNameandValue, use the username and password (respectively) from your SQL database.
ForNameandValue, use the username and password (respectively) from your SQL database.
SelectCreate.
SelectCreate.
If your key vault isn't connected to Microsoft Purview yet,create a new key vault connection.
If your key vault isn't connected to Microsoft Purview yet,create a new key vault connection.
Create a new credentialby using the key to set up your scan.
Create a new credentialby using the key to set up your scan.


Important
If you're using aself-hosted integration runtimeto connect to your resource, system-assigned and user-assigned managed identities won't work. You need to use SQL authentication or service principal authentication.

Configure Microsoft Entra authentication in the database account
The managed identity needs permission to get metadata for the database, schemas, and tables. It must also be authorized to query the tables to sample for classification.
If you haven't already,configure Microsoft Entra authentication with Azure SQL.
If you haven't already,configure Microsoft Entra authentication with Azure SQL.
Create a Microsoft Entra user in Azure SQL Database with the exact managed identity from Microsoft Purview. Follow the steps inCreate the service principal user in Azure SQL Database.
Create a Microsoft Entra user in Azure SQL Database with the exact managed identity from Microsoft Purview. Follow the steps inCreate the service principal user in Azure SQL Database.
Assign proper permission (for example:db_datareader) to the identity. Here's example SQL syntax to create the user and grant permission:CREATE USER [Username] FROM EXTERNAL PROVIDER
GO

EXEC sp_addrolemember 'db_datareader', [Username]
GONoteThe[Username]value is your managed identity name from Microsoft Purview. You canread more about fixed-database roles and their capabilities.
Assign proper permission (for example:db_datareader) to the identity. Here's example SQL syntax to create the user and grant permission:
db_datareader
CREATE USER [Username] FROM EXTERNAL PROVIDER
GO

EXEC sp_addrolemember 'db_datareader', [Username]
GO
CREATE USER [Username] FROM EXTERNAL PROVIDER
GO

EXEC sp_addrolemember 'db_datareader', [Username]
GO
Note
The[Username]value is your managed identity name from Microsoft Purview. You canread more about fixed-database roles and their capabilities.
[Username]
Configure portal authentication
It's important to give your Microsoft Purview account's system-assigned managed identity oruser-assigned managed identitythe permission to scan the SQL database. You can add the SAMI or UAMI at the subscription, resource group, or resource level, depending on the breadth of the scan.
Note
To add a managed identity on an Azure resource, you need to be an owner of the subscription.
From theAzure portal, find the subscription, resource group, or resource (for example, a SQL database) that the catalog should scan.
From theAzure portal, find the subscription, resource group, or resource (for example, a SQL database) that the catalog should scan.
SelectAccess control (IAM)on the left menu, and then select+ Add>Add role assignment.
SelectAccess control (IAM)on the left menu, and then select+ Add>Add role assignment.

SetRoletoReader. In theSelectbox, enter your Microsoft Purview account name or UAMI. Then, selectSaveto give this role assignment to your Microsoft Purview account.
SetRoletoReader. In theSelectbox, enter your Microsoft Purview account name or UAMI. Then, selectSaveto give this role assignment to your Microsoft Purview account.

Create a new service principal
If you don't have a service principal, you can follow theservice principal guideto create one.
Note
To create a service principal, you must register an application in your Microsoft Entra tenant. If you don't have the required access, your Microsoft Entra Application Administrator can perform this operation.
Grant the service principal access to your SQL database
The service principal needs permission to get metadata for the database, schemas, and tables. It must also be authorized to query the tables to sample for classification.
If you haven't already,configure Microsoft Entra authentication with Azure SQL.
If you haven't already,configure Microsoft Entra authentication with Azure SQL.
Create a Microsoft Entra user in Azure SQL Database with your service principal. Follow the steps inCreate the service principal user in Azure SQL Database.
Create a Microsoft Entra user in Azure SQL Database with your service principal. Follow the steps inCreate the service principal user in Azure SQL Database.
Assign proper permission (for example:db_datareader) to the identity. Here's example SQL syntax to create the user and grant permission:CREATE USER [Username] FROM EXTERNAL PROVIDER
GO

EXEC sp_addrolemember 'db_datareader', [Username]
GONoteThe[Username]value is your own service principal's name. You canread more about fixed-database roles and their capabilities.
Assign proper permission (for example:db_datareader) to the identity. Here's example SQL syntax to create the user and grant permission:
db_datareader
CREATE USER [Username] FROM EXTERNAL PROVIDER
GO

EXEC sp_addrolemember 'db_datareader', [Username]
GO
CREATE USER [Username] FROM EXTERNAL PROVIDER
GO

EXEC sp_addrolemember 'db_datareader', [Username]
GO
Note
The[Username]value is your own service principal's name. You canread more about fixed-database roles and their capabilities.
[Username]
Create the credential
Go to your key vault in the Azure portal.
Go to your key vault in the Azure portal.
SelectSettings>Secrets, and then select+ Generate/Import.
SelectSettings>Secrets, and then select+ Generate/Import.

ForName, give the secret a name of your choice.
ForName, give the secret a name of your choice.
ForValue, use the service principal's secret value. If you've already created a secret for your service principal, you can find its value inClient credentialson your secret's overview page.If you need to create a secret, you can follow the steps in theservice principal guide.
ForValue, use the service principal's secret value. If you've already created a secret for your service principal, you can find its value inClient credentialson your secret's overview page.
If you need to create a secret, you can follow the steps in theservice principal guide.

SelectCreateto create the secret.
SelectCreateto create the secret.
If your key vault isn't connected to Microsoft Purview yet,create a new key vault connection.
If your key vault isn't connected to Microsoft Purview yet,create a new key vault connection.
Create a new credential.
Create a new credential.

ForService Principal ID, use the application (client) ID of your service principal.
ForService Principal ID, use the application (client) ID of your service principal.

ForSecret name, use the name of the secret that you created in previous steps.
ForSecret name, use the name of the secret that you created in previous steps.

Create the scan
Open your Microsoft Purview account and selectOpen Microsoft Purview governance portal.
Open your Microsoft Purview account and selectOpen Microsoft Purview governance portal.
Go toData map>Sourcesto view the collection hierarchy.
Go toData map>Sourcesto view the collection hierarchy.
Select theNew Scanicon under the SQL database that you registered earlier.
Select theNew Scanicon under the SQL database that you registered earlier.

To learn more about stored procedure data lineage in Azure SQL Database, see theExtract lineage (preview)section of this article.
For scanning steps, select your method of authentication from the following tabs.
SQL authentication
Managed identity
Service principal
ForName, provide a name for the scan.
ForName, provide a name for the scan.
ForDatabase selection method, selectEnter manually.
ForDatabase selection method, selectEnter manually.
ForDatabase nameandCredential, enter the values that you created earlier.
ForDatabase nameandCredential, enter the values that you created earlier.

ForSelect a connection, choose the appropriate collection for the scan.
ForSelect a connection, choose the appropriate collection for the scan.
SelectTest connectionto validate the connection. After the connection is successful, selectContinue.
SelectTest connectionto validate the connection. After the connection is successful, selectContinue.
ForName, provide a name for the scan.
ForName, provide a name for the scan.
Select the SAMI or UAMI underCredential, and choose the appropriate collection for the scan.
Select the SAMI or UAMI underCredential, and choose the appropriate collection for the scan.

SelectTest connection. After the connection is successful, selectContinue.
SelectTest connection. After the connection is successful, selectContinue.

ForName, provide a name for the scan.
ForName, provide a name for the scan.
Choose the appropriate collection for the scan, and select the credential that you created earlier underCredential.
Choose the appropriate collection for the scan, and select the credential that you created earlier underCredential.

SelectTest connection. After the connection is successful, selectContinue.
SelectTest connection. After the connection is successful, selectContinue.
Scope and run the scan
You can scope your scan to specific database objects by choosing the appropriate items in the list.
You can scope your scan to specific database objects by choosing the appropriate items in the list.

Select a scan rule set. You can use the system default, choose from existing custom rule sets, or create a new rule set inline. SelectContinuewhen you're finished.If you selectNew scan rule set, a pane opens so that you can enter the source type, the name of the rule set, and a description. SelectContinuewhen you're finished.ForSelect classification rules, choose the classification rules that you want to include in the scan rule set, and then selectCreate.The new scan rule set then appears in the list of available rule sets.
Select a scan rule set. You can use the system default, choose from existing custom rule sets, or create a new rule set inline. SelectContinuewhen you're finished.

If you selectNew scan rule set, a pane opens so that you can enter the source type, the name of the rule set, and a description. SelectContinuewhen you're finished.

ForSelect classification rules, choose the classification rules that you want to include in the scan rule set, and then selectCreate.

The new scan rule set then appears in the list of available rule sets.

Choose your scan trigger. You can set up a schedule or run the scan once.
Choose your scan trigger. You can set up a schedule or run the scan once.
Review your scan, and then selectSave and run.
Review your scan, and then selectSave and run.
View a scan
To check the status of a scan, go to the data source in the collection, and then selectView details.

The scan details indicate the progress of the scan inLast run status, along with the number of assets scanned and classified.Last run statusis updated toIn progressand thenCompletedafter the entire scan has run successfully.

Manage a scan
After you run a scan, you can use the run history to manage it:
UnderRecent scans, select a scan.
UnderRecent scans, select a scan.

In the run history, you have options for running the scan again, editing it, or deleting it.If you selectRun scan nowto rerun the scan, you can then choose eitherIncremental scanorFull scan.
In the run history, you have options for running the scan again, editing it, or deleting it.

If you selectRun scan nowto rerun the scan, you can then choose eitherIncremental scanorFull scan.

Troubleshoot scanning
If you have problems with scanning, try these tips:
Confirm that you followed allprerequisites.
Check the network by confirmingfirewall,Azure connections, orintegration runtimesettings.
Confirm thatauthenticationis properly set up.
For more information, reviewTroubleshoot your connections in Microsoft Purview.
Set up policies
The following types of Microsoft Purview policies are supported on this data resource:
Data owner policies- a set of policy statements that allow you to grant users and groups access to data sources.
Self-service policies- policy that allows users to request access to data sources registered to Microsoft Purview.
Protection policies- denies access to data tagged with sensitivity labels to all users except those specified by the policy.
DevOps policies- grants access to database system metadata across multiple sources. They simplify access provisioning for IT operations and security auditing personnel. They only grant access, and don't deny access.
Access policy prerequisites on Azure SQL Database
Create a new Azure SQL Database instance, or use an existing one, in one of the currently available regions for this feature. You can followthis guide to create an Azure SQL Database instance.
AllMicrosoft Purview regionsare supported.
Enforcement of Microsoft Purview policies is available only in the following regions for Azure SQL Database:
Public cloud:
East US
East US2
South Central US
West Central US
West US3
Canada Central
Brazil South
West Europe
North Europe
France Central
UK South
South Africa North
Central India
South East Asia
East Asia
Australia East
Sovereign clouds:
USGov Virginia
China North 3
For the logical server associated with Azure SQL Database to honor policies from Microsoft Purview, you need to configure a Microsoft Entra admin. In the Azure portal, go to the logical server that hosts the Azure SQL Database instance. On the side menu, selectMicrosoft Entra ID. Set an admin name to any Microsoft Entra user or group that you prefer, and then selectSave.
Then, on the side menu, selectIdentity. UnderSystem assigned managed identity, turn the status toOn, and then selectSave.

Configure the Microsoft Purview account for policies
Before a policy can be created in Microsoft Purview for a data resource, you must register that data resource in Microsoft Purview Studio. You will find the instructions related to registering the data resource later in this guide.
Note
Microsoft Purview policies rely on the data resource ARM path. If a data resource is moved to a new resource group or subscription it will need to be de-registered and then registered again in Microsoft Purview.
Once a resource is registered, but before a policy can be created in Microsoft Purview for that resource, you must configure permissions. A set of permissions are needed to enable theData policy enforcement. This applies to data sources, resource groups, or subscriptions. To enableData policy enforcement, you must havebothspecific Identity and Access Management (IAM) privileges on the resource as well as specific Microsoft Purview privileges:
You must haveeither oneof the following IAM role combinations on the resource's Azure Resource Manager path or any parent of it (that is, using IAM permission inheritance):IAM OwnerBoth IAM Contributor and IAM User Access AdministratorTo configure Azure role-based access control (RBAC) permissions, followthis guide. The following screenshot shows how to access theAccess Controlsection in the Azure portal for the data resource to add a role assignment.NoteTheIAM Ownerrole for a data resource can be inherited from a parent resource group, a subscription, or a subscription management group. Check which Microsoft Entra users, groups, and service principals hold or are inheriting theIAM Ownerrole for the resource.
You must haveeither oneof the following IAM role combinations on the resource's Azure Resource Manager path or any parent of it (that is, using IAM permission inheritance):
IAM Owner
Both IAM Contributor and IAM User Access Administrator
To configure Azure role-based access control (RBAC) permissions, followthis guide. The following screenshot shows how to access theAccess Controlsection in the Azure portal for the data resource to add a role assignment.

Note
TheIAM Ownerrole for a data resource can be inherited from a parent resource group, a subscription, or a subscription management group. Check which Microsoft Entra users, groups, and service principals hold or are inheriting theIAM Ownerrole for the resource.
You also need to have the Microsoft PurviewData source adminrole for the collection or a parent collection (if inheritance is enabled). For more information, see theguide on managing Microsoft Purview role assignments.The following screenshot shows how to assign theData source adminrole at the root collection level.
You also need to have the Microsoft PurviewData source adminrole for the collection or a parent collection (if inheritance is enabled). For more information, see theguide on managing Microsoft Purview role assignments.
The following screenshot shows how to assign theData source adminrole at the root collection level.

To create, update or delete policies, you need to get thePolicy authorrole in Microsoft Purview atroot collection level:
ThePolicy authorrole can create, update, and delete DevOps and Data Owner policies.
ThePolicy authorrole can delete self-service access policies.
For more information about managing Microsoft Purview role assignments, seeCreate and manage collections in the Microsoft Purview Data Map.
Note
Policy author role must be configured at the root collection level.
In addition, to easily search Microsoft Entra users or groups when creating or updating the subject of a policy, you can greatly benefit from getting theDirectory Readerspermission in Microsoft Entra ID. This is a common permission for users in an Azure tenant. Without the Directory Reader permission, the Policy Author will have to type the complete username or email for all the principals included in the subject of a data policy.
Data Owner policies allow for checks and balances if you assign the Microsoft PurviewPolicy authorandData source adminroles to different people in the organization. Before a Data owner policy takes effect, a second person (Data source admin) must review it and explicitly approve it by publishing it. This does not apply to DevOps or Self-service access policies as publishing is automatic for them when those policies are created or updated.
To publish a Data owner policy you need to get theData source adminrole in Microsoft Purview atroot collection level.
For more information about managing Microsoft Purview role assignments, seeCreate and manage collections in the Microsoft Purview Data Map.
Note
To publish Data owner policies, the Data source admin role  must be configured at the root collection level.
After a resource has been enabled forData policy enforcement, any Microsoft Purview user with thePolicy authorrole at the root collection level can provision access to that data source from Microsoft Purview.
Note
Any Microsoft Purview rootCollection admincan assign new users to rootPolicy authorroles. AnyCollection admincan assign new users to aData source adminrole under the collection. Minimize and carefully vet the users who hold Microsoft PurviewCollection admin,Data source admin, orPolicy authorroles.
If a Microsoft Purview account with published policies is deleted, such policies will stop being enforced within an amount of time that depends on the specific data source. This change can have implications on both security and data access availability. The Contributor and Owner roles in IAM can delete Microsoft Purview accounts. You can check these permissions by going to theAccess control (IAM)section for your Microsoft Purview account and selectingRole Assignments. You can also use a lock to prevent the Microsoft Purview account from being deleted throughResource Manager locks.
Register the data source and enable Data policy enforcement
The Azure SQL Database resource needs to be registered with Microsoft Purview before you can create access policies. To register your resources, follow the "Prerequisites" and "Register the data source" sections inEnable Data policy enforcement on your Microsoft Purview sources.
After you register the data source, you need to enableData policy enforcement. This is a prerequisite before you can create policies on the data source.Data policy enforcementcan affect the security of your data, because it delegates to certain Microsoft Purview roles that manage access to the data sources. Go through the security practices inEnable Data policy enforcement on your Microsoft Purview sources.
After your data source has theData policy enforcementoption set toEnabled, it will look like this screenshot:

Return to the Azure portal for Azure SQL Database to verify it's now governed by Microsoft Purview:
Sign in to the Azure portal throughthis link.
Sign in to the Azure portal throughthis link.
Select the Azure SQL Server that you want to configure.
Select the Azure SQL Server that you want to configure.
Go toMicrosoft Entra IDon the left pane.
Go toMicrosoft Entra IDon the left pane.
Scroll down toMicrosoft Purview access policies.
Scroll down toMicrosoft Purview access policies.
Select the button toCheck for Microsoft Purview Governance. Wait while the request is processed, which could take a few minutes.
Select the button toCheck for Microsoft Purview Governance. Wait while the request is processed, which could take a few minutes.

Confirm that the Microsoft Purview Governance Status showsGoverned. Note thatit could take a few minutesafter you enableData policy enforcementin Microsoft Purview for the correct status to be reflected.
Confirm that the Microsoft Purview Governance Status showsGoverned. Note thatit could take a few minutesafter you enableData policy enforcementin Microsoft Purview for the correct status to be reflected.
Note
If you disable data policy enforcement for this Azure SQL Database data source in Microsoft Purview, selectCheck for Microsoft Purview Governancefor the Microsoft Purview Governance Status to be updated toNot Governed. This step must be done for the impacted data source each time data policy enforcement status is changed for an existing or new access policy in Microsoft Purview. Before you enableData policy enforcementfor the data source in another Microsoft Purview account, ensure that the Purview Governance Status shows asNot Governed. Then repeat the steps above with the new Microsoft Purview account.
Create an access policy
To create an access policy for Azure SQL Database, follow these guides:
Provision access to system health, performance, and audit information in Azure SQL Database. Use this guide to apply a DevOps policy on a single SQL database.
Provision read/modify access on a single Azure SQL Database. Use this guide to provision access on a single SQL database account in your subscription.
Self-service access policies for Azure SQL Database. Use this guide to allow data consumers to request access to data assets by using a self-service workflow.
To create policies that cover all data sources inside a resource group or Azure subscription, seeDiscover and govern multiple Azure sources in Microsoft Purview.
Protection policy
Protection access control policies (protection policies) enable organizations to automatically protect sensitive data across data sources. Microsoft Purview already scans data assets and identifies sensitive data elements, and this feature allows you to automatically restrict access to that data using sensitivity labels from Microsoft Purview Information Protection. Learn how tocreate a protection policy.
Extract lineage (preview)

Microsoft Purview supports lineage for views and stored procedures from Azure SQL Database. While lineage for views is supported as part of scanning, you'll need to turn on theLineage extractiontoggle to extract stored procedure lineage when you're setting up a scan.
Note
Lineage isn't supported using a self-hosted integration runtime or managed VNET runtime and an Azure SQL private endpoint. You need to enable Azure services to access the server under network settings for your Azure SQL Database, and your Microsoft Purview account needs to allow public access.Learn more about the known limitations in lineage extraction scan.
Lineage for SQL DB views
SQL DB metadata scan includes lineage extraction for views. Only new scans include the view lineage extraction. Lineage is extracted at all scan levels (L1/L2/L3). In case of an incremental scan, whatever metadata is scanned as part of incremental scan, the corresponding static lineage for tables/views will be extracted.

Prerequisites for setting up a scan with SP lineage extraction
Follow the steps in theConfigure authentication for a scansection of this article to authorize Microsoft Purview to scan your SQL database.
Follow the steps in theConfigure authentication for a scansection of this article to authorize Microsoft Purview to scan your SQL database.
Sign in to Azure SQL Database with your Microsoft Entra account, and assigndb_ownerpermissions to the Microsoft Purview managed identity.NoteThe 'db_owner' permissions is needed because lineage is based on XEvent sessions. So Microsoft Purview needs the permission to manage the XEvent sessions in SQL.Use the following example SQL syntax to create a user and grant permission. Replace<purview-account>with your account name.Create user <purview-account> FROM EXTERNAL PROVIDER
GO
EXEC sp_addrolemember 'db_owner', <purview-account> 
GO
Sign in to Azure SQL Database with your Microsoft Entra account, and assigndb_ownerpermissions to the Microsoft Purview managed identity.
db_owner
Note
The 'db_owner' permissions is needed because lineage is based on XEvent sessions. So Microsoft Purview needs the permission to manage the XEvent sessions in SQL.
Use the following example SQL syntax to create a user and grant permission. Replace<purview-account>with your account name.
<purview-account>
Create user <purview-account> FROM EXTERNAL PROVIDER
GO
EXEC sp_addrolemember 'db_owner', <purview-account> 
GO
Create user <purview-account> FROM EXTERNAL PROVIDER
GO
EXEC sp_addrolemember 'db_owner', <purview-account> 
GO
Run the following command on your SQL database to create a master key:Create master key
Go
Run the following command on your SQL database to create a master key:
Create master key
Go
Create master key
Go
Ensure thatAllow Azure services and resources to access this serveris enabled under networking/firewall for your Azure SQL resource.
Ensure thatAllow Azure services and resources to access this serveris enabled under networking/firewall for your Azure SQL resource.
Create a scan with lineage extraction turned on
On the pane for setting up a scan, turn on theEnable lineage extractiontoggle.
On the pane for setting up a scan, turn on theEnable lineage extractiontoggle.

Select your method of authentication by following the steps in theCreate the scansection of this article.
Select your method of authentication by following the steps in theCreate the scansection of this article.
After you successfully set up the scan, a new scan type calledLineage extractionwill run incremental scansevery six hoursto extract lineage from Azure SQL Database. Lineage is extracted based on the stored procedure runs in the SQL database.
After you successfully set up the scan, a new scan type calledLineage extractionwill run incremental scansevery six hoursto extract lineage from Azure SQL Database. Lineage is extracted based on the stored procedure runs in the SQL database.

Search Azure SQL Database assets and view runtime lineage
You canbrowse through the Unified Catalogorsearch the Unified Catalogto view asset details for Azure SQL Database. The following steps describe how to view runtime lineage details:
Go to theLineagetab for the asset. When applicable, the asset lineage appears here.When applicable, you can further drill down to see the lineage at SQL statement level within a stored procedure, along with column level lineage. When using Self-hosted Integration Runtime for scan, retrieving the lineage drilldown information during scan is supported since version 5.25.8374.1.For information about supported Azure SQL Database lineage scenarios, refer to theSupported capabilitiessection of this article. For more information about lineage in general, seeData lineage in Microsoft PurviewandMicrosoft Purview lineage user guide.
Go to theLineagetab for the asset. When applicable, the asset lineage appears here.

When applicable, you can further drill down to see the lineage at SQL statement level within a stored procedure, along with column level lineage. When using Self-hosted Integration Runtime for scan, retrieving the lineage drilldown information during scan is supported since version 5.25.8374.1.

For information about supported Azure SQL Database lineage scenarios, refer to theSupported capabilitiessection of this article. For more information about lineage in general, seeData lineage in Microsoft PurviewandMicrosoft Purview lineage user guide.
Go to the stored procedure asset. On thePropertiestab, go toRelated assetsto get the latest run details of stored procedures.
Go to the stored procedure asset. On thePropertiestab, go toRelated assetsto get the latest run details of stored procedures.

Select the stored procedure hyperlink next toRunsto see theAzure SQL Stored Procedure Runoverview. Go to thePropertiestab to see enhanced runtime information from the stored procedure, such asexecutedTime,rowCount, andClient Connection.
Select the stored procedure hyperlink next toRunsto see theAzure SQL Stored Procedure Runoverview. Go to thePropertiestab to see enhanced runtime information from the stored procedure, such asexecutedTime,rowCount, andClient Connection.

Troubleshoot lineage extraction for Stored Procedures
The following tips can help you solve problems related to lineage:
If no lineage is captured after a successfulLineage extractionrun, it's possible that no stored procedures have run at least once since you set up the scan.
Lineage is captured for stored procedure runs that happen after a successful scan is set up. Lineage from past stored procedure runs isn't captured.
If your database is processing heavy workloads with lots of stored procedure runs, lineage extraction filters only the most recent runs. Stored procedure runs early in the six-hour window, or the run instances that create heavy query load, won't be extracted. Contact support if you're missing lineage from any stored procedure runs.
If a stored procedure contains drop or create statements, they aren't currently captured in lineage
Next steps
To learn more about Microsoft Purview and your data, use these guides:
Concepts for Microsoft Purview Data owner policies
Concepts for Microsoft Purview DevOps policies
Understand the Microsoft Purview Data Estate Insights application
Microsoft Purview lineage user guide
Search the Microsoft Purview Unified Catalog
Feedback
Was this page helpful?
Additional resources