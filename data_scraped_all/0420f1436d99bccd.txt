Note
Access to this page requires authorization. You can trysigning inorchanging directories.
Access to this page requires authorization. You can trychanging directories.
Move a virtual machine from Regional to Zonal availability zone using Azure PowerShell and CLI
Article
2025-01-15
5 contributors
In this article
This article details using Azure PowerShell and CLI cmdlets to move Azure single instance VMs from regional to zonal availability zones. Anavailability zoneis a physically separate zone in an Azure region. Use availability zones to protect your apps and data from an unlikely failure or loss of an entire data center.
To use an availability zone, create your virtual machine in asupported Azure region.
Prerequisites
Verify the following requirements before you start the move process:
Microsoft.Authorization
Review PowerShell and CLI requirements
Most move resources operations are the same whether using the Azure portal or PowerShell or CLI, with a couple of exceptions.
Note
For more information on the commands and their syntaxes, refer tothis page.
Sample values
We use these values in our script examples:
Sign in to Azure
Sign in to your Azure subscription with theConnect-AzAccountcommand and follow the on-screen directions.
Connect-AzAccount
Set subscription ID:
Set-AzContext -SubscriptionId " <subscription-id> "
Set-AzContext -SubscriptionId " <subscription-id> "
Connect to subscription ID:
Connect-AzAccount âSubscription "<subscription-id>"
Connect-AzAccount âSubscription "<subscription-id>"
Set up the move collection
The MoveCollection object stores metadata and configuration information about the resources you want to move. To set up a move collection, do the following:
Create a resource group for the move collection.
Register the service provider to the subscription, so that the MoveCollection resource can be created.
Create the MoveCollection object with managed identity. For the MoveCollection object to access the subscription in which the Resource Mover service is located, it needs asystem-assigned managed identity(formerly known as Managed Service Identity (MSI)) that's trusted by the subscription.
Grant access to the Resource Mover subscription for the managed identity.
Create the resource group
Use the following cmdlet to create a resource group for the move collection metadata and configuration information withNew-AzResourceGroup. A resource group is a logical container into which Azure resources are deployed and managed.
PowerShell
CLI
New-AzResourceGroup -Name "RegionToZone-DemoMCRG" -Location "EastUS"
New-AzResourceGroup -Name "RegionToZone-DemoMCRG" -Location "EastUS"
Output:
The output shows that the managed disk is in the same availability zone as the VM:
ResourceGroupName : RegionToZone-DemoMCRG
Location          : eastus
ProvisioningState : Succeeded
Tags              :
                    Name     Value
                    =======  ========
                    Created  20230908

ResourceId        : /subscriptions/<Subscription-id>/resourceGroups/RegionToZone-DemoMCRG
ResourceGroupName : RegionToZone-DemoMCRG
Location          : eastus
ProvisioningState : Succeeded
Tags              :
                    Name     Value
                    =======  ========
                    Created  20230908

ResourceId        : /subscriptions/<Subscription-id>/resourceGroups/RegionToZone-DemoMCRG
az group create --location eastus2 --name clidemo-RG
az group create --location eastus2 --name clidemo-RG
Output:
{
  "id": "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/clidemo-RG",
  "location": "eastus",
  "managedBy": null,
  "name": "clidemo-RG",
  "properties": {
    "provisioningState": "Succeeded"
  },
  "tags": {
    "Created": "20230921"
  },
  "type": "Microsoft.Resources/resourceGroups"
}
{
  "id": "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/clidemo-RG",
  "location": "eastus",
  "managedBy": null,
  "name": "clidemo-RG",
  "properties": {
    "provisioningState": "Succeeded"
  },
  "tags": {
    "Created": "20230921"
  },
  "type": "Microsoft.Resources/resourceGroups"
}
Register the resource provider
Register the resource provider Microsoft.Migrate, so that the MoveCollection resource can be created, as follows:Register-AzResourceProvider -ProviderNamespace Microsoft.Migrate
Register the resource provider Microsoft.Migrate, so that the MoveCollection resource can be created, as follows:
Register-AzResourceProvider -ProviderNamespace Microsoft.Migrate
Register-AzResourceProvider -ProviderNamespace Microsoft.Migrate
Wait for registration:While(((Get-AzResourceProvider -ProviderNamespace Microsoft.Migrate)| where {$_.RegistrationState -eq "Registered" -and $_.ResourceTypes.ResourceTypeName -eq "moveCollections"}|measure).Count -eq 0)
{
    Start-Sleep -Seconds 5
    Write-Output "Waiting for registration to complete."
}
Wait for registration:
While(((Get-AzResourceProvider -ProviderNamespace Microsoft.Migrate)| where {$_.RegistrationState -eq "Registered" -and $_.ResourceTypes.ResourceTypeName -eq "moveCollections"}|measure).Count -eq 0)
{
    Start-Sleep -Seconds 5
    Write-Output "Waiting for registration to complete."
}
While(((Get-AzResourceProvider -ProviderNamespace Microsoft.Migrate)| where {$_.RegistrationState -eq "Registered" -and $_.ResourceTypes.ResourceTypeName -eq "moveCollections"}|measure).Count -eq 0)
{
    Start-Sleep -Seconds 5
    Write-Output "Waiting for registration to complete."
}
Create a MoveCollection object
Create a MoveCollection object, and assign a managed identity to it, as follows:
PowerShell
CLI
New-AzResourceMoverMoveCollection -Name "RegionToZone-DemoMC"  -ResourceGroupName "RegionToZone-DemoMCRG" -MoveRegion "eastus" -Location "eastus2euap" -IdentityType "SystemAssigned" -MoveType "RegionToZone"
New-AzResourceMoverMoveCollection -Name "RegionToZone-DemoMC"  -ResourceGroupName "RegionToZone-DemoMCRG" -MoveRegion "eastus" -Location "eastus2euap" -IdentityType "SystemAssigned" -MoveType "RegionToZone"
Output:
Etag                                   Location    Name
----                                   --------    ----
"3a00c441-0000-3400-0000-64fac1b30000" eastus2euap RegionToZone-DemoMC
Etag                                   Location    Name
----                                   --------    ----
"3a00c441-0000-3400-0000-64fac1b30000" eastus2euap RegionToZone-DemoMC
az resource-mover move-collection create --identity type=SystemAssigned --location eastus2 --move-region uksouth --name cliDemo-zonalMC --resource-group clidemo-RG --move-type RegionToZone
az resource-mover move-collection create --identity type=SystemAssigned --location eastus2 --move-region uksouth --name cliDemo-zonalMC --resource-group clidemo-RG --move-type RegionToZone
Output:
{
  "etag": "\"1c00c55a-0000-0200-0000-650c15c40000\"",
  "id": "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/clidemo-RG/providers/Microsoft.Migrate/moveCollections/cliDemo-zonalMC",
  "identity": {
    "principalId": "aaaaaaaa-bbbb-cccc-1111-222222222222",
    "tenantId": "72f988bf-86f1-41af-91ab-2d7cd011db47",
    "type": "SystemAssigned"
  },
  "location": "eastus2",
  "name": "cliDemo-zonalMC",
  "properties": {
    "moveRegion": "uksouth",
    "moveType": "RegionToZone",
    "provisioningState": "Succeeded",
    "version": "V2"
  },
  "resourceGroup": "clidemo-RG",
  "systemData": {
    "createdAt": "2023-09-21T10:06:58.5788527Z",
    "createdBy": "yashjain@microsoft.com",
    "createdByType": "User",
    "lastModifiedAt": "2023-09-21T10:06:58.5788527Z",
    "lastModifiedBy": "yashjain@microsoft.com",
    "lastModifiedByType": "User"
  },
  "type": "Microsoft.Migrate/moveCollections"
}
{
  "etag": "\"1c00c55a-0000-0200-0000-650c15c40000\"",
  "id": "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/clidemo-RG/providers/Microsoft.Migrate/moveCollections/cliDemo-zonalMC",
  "identity": {
    "principalId": "aaaaaaaa-bbbb-cccc-1111-222222222222",
    "tenantId": "72f988bf-86f1-41af-91ab-2d7cd011db47",
    "type": "SystemAssigned"
  },
  "location": "eastus2",
  "name": "cliDemo-zonalMC",
  "properties": {
    "moveRegion": "uksouth",
    "moveType": "RegionToZone",
    "provisioningState": "Succeeded",
    "version": "V2"
  },
  "resourceGroup": "clidemo-RG",
  "systemData": {
    "createdAt": "2023-09-21T10:06:58.5788527Z",
    "createdBy": "yashjain@microsoft.com",
    "createdByType": "User",
    "lastModifiedAt": "2023-09-21T10:06:58.5788527Z",
    "lastModifiedBy": "yashjain@microsoft.com",
    "lastModifiedByType": "User"
  },
  "type": "Microsoft.Migrate/moveCollections"
}
Note
For Regional to zonal move, theMoveTypeparameter should be set asRegionToZoneandMoveRegionparameter should be set as the location where resources undergoing zonal move reside. Ensure that the parametersSourceRegionandTargetRegionare not required and should be set tonull.
MoveType
MoveRegion
SourceRegion
TargetRegion
Grant access to the managed identity
Grant the managed identity access to the Resource Mover subscription as follows. You must be the subscription owner.
Retrieve identity details from the MoveCollection object.$moveCollection = Get-AzResourceMoverMoveCollection -Name "RegionToZone-DemoMC" -ResourceGroupName "RegionToZone-DemoMCRG"
$identityPrincipalId = $moveCollection.IdentityPrincipalId
Retrieve identity details from the MoveCollection object.
$moveCollection = Get-AzResourceMoverMoveCollection -Name "RegionToZone-DemoMC" -ResourceGroupName "RegionToZone-DemoMCRG"
$identityPrincipalId = $moveCollection.IdentityPrincipalId
$moveCollection = Get-AzResourceMoverMoveCollection -Name "RegionToZone-DemoMC" -ResourceGroupName "RegionToZone-DemoMCRG"
$identityPrincipalId = $moveCollection.IdentityPrincipalId
Assign the required roles to the identity so Azure Resource Mover can access your subscription to help move resources. Review the list ofrequired permissionsfor the move.PowerShellCLINew-AzRoleAssignment -ObjectId $identityPrincipalId -RoleDefinitionName Contributor -Scope "/subscriptions/<subscription-id>"
New-AzRoleAssignment -ObjectId $identityPrincipalId -RoleDefinitionName "User Access Administrator" -Scope "/subscriptions/<subscription-id>"az role assignment create --assignee-object-id aaaaaaaa-0000-1111-2222-bbbbbbbbbbbb --assignee-principal-type ServicePrincipal --role Contributor --scope /subscriptions/<Subscription-id>
az role assignment create --assignee-object-id aaaaaaaa-0000-1111-2222-bbbbbbbbbbbb --assignee-principal-type ServicePrincipal --role "User Access Administrator" --scope /subscriptions/<Subscription-id>
Assign the required roles to the identity so Azure Resource Mover can access your subscription to help move resources. Review the list ofrequired permissionsfor the move.
PowerShell
CLI
New-AzRoleAssignment -ObjectId $identityPrincipalId -RoleDefinitionName Contributor -Scope "/subscriptions/<subscription-id>"
New-AzRoleAssignment -ObjectId $identityPrincipalId -RoleDefinitionName "User Access Administrator" -Scope "/subscriptions/<subscription-id>"
New-AzRoleAssignment -ObjectId $identityPrincipalId -RoleDefinitionName Contributor -Scope "/subscriptions/<subscription-id>"
New-AzRoleAssignment -ObjectId $identityPrincipalId -RoleDefinitionName "User Access Administrator" -Scope "/subscriptions/<subscription-id>"
az role assignment create --assignee-object-id aaaaaaaa-0000-1111-2222-bbbbbbbbbbbb --assignee-principal-type ServicePrincipal --role Contributor --scope /subscriptions/<Subscription-id>
az role assignment create --assignee-object-id aaaaaaaa-0000-1111-2222-bbbbbbbbbbbb --assignee-principal-type ServicePrincipal --role "User Access Administrator" --scope /subscriptions/<Subscription-id>
az role assignment create --assignee-object-id aaaaaaaa-0000-1111-2222-bbbbbbbbbbbb --assignee-principal-type ServicePrincipal --role Contributor --scope /subscriptions/<Subscription-id>
az role assignment create --assignee-object-id aaaaaaaa-0000-1111-2222-bbbbbbbbbbbb --assignee-principal-type ServicePrincipal --role "User Access Administrator" --scope /subscriptions/<Subscription-id>
Add regional VMs to the move collection
Retrieve the IDs for existing source resources that you want to move. Create the destination resource settings object, then add resources to the move collection.
Note
Resources added to a move collection must be in the same subscription but can be in different resource groups.
Create target resource setting object as follows:$targetResourceSettingsObj = New-Object Microsoft.Azure.PowerShell.Cmdlets.ResourceMover.Models.Api20230801.VirtualMachineResourceSettings
$targetResourceSettingsObj.ResourceType = "Microsoft.Compute/virtualMachines"
$targetResourceSettingsObj.TargetResourceName = "RegionToZone-demoTargetVm"
$targetResourceSettingsObj.TargetAvailabilityZone = "2"OutputResourceType                      TargetResourceGroupName TargetResourceName        TargetAvailabilitySetId TargetAvailabilityZone TargetVMSize UserManagedIdentity
------------                      ----------------------- ------------------        ----------------------- ---------------------- ------------ -------------------
Microsoft.Compute/virtualMachines                         RegionToZone-demoTargetVm                         2
Create target resource setting object as follows:
$targetResourceSettingsObj = New-Object Microsoft.Azure.PowerShell.Cmdlets.ResourceMover.Models.Api20230801.VirtualMachineResourceSettings
$targetResourceSettingsObj.ResourceType = "Microsoft.Compute/virtualMachines"
$targetResourceSettingsObj.TargetResourceName = "RegionToZone-demoTargetVm"
$targetResourceSettingsObj.TargetAvailabilityZone = "2"
$targetResourceSettingsObj = New-Object Microsoft.Azure.PowerShell.Cmdlets.ResourceMover.Models.Api20230801.VirtualMachineResourceSettings
$targetResourceSettingsObj.ResourceType = "Microsoft.Compute/virtualMachines"
$targetResourceSettingsObj.TargetResourceName = "RegionToZone-demoTargetVm"
$targetResourceSettingsObj.TargetAvailabilityZone = "2"
Output
ResourceType                      TargetResourceGroupName TargetResourceName        TargetAvailabilitySetId TargetAvailabilityZone TargetVMSize UserManagedIdentity
------------                      ----------------------- ------------------        ----------------------- ---------------------- ------------ -------------------
Microsoft.Compute/virtualMachines                         RegionToZone-demoTargetVm                         2
ResourceType                      TargetResourceGroupName TargetResourceName        TargetAvailabilitySetId TargetAvailabilityZone TargetVMSize UserManagedIdentity
------------                      ----------------------- ------------------        ----------------------- ---------------------- ------------ -------------------
Microsoft.Compute/virtualMachines                         RegionToZone-demoTargetVm                         2
Add resourcesPowerShellCLIAdd-AzResourceMoverMoveResource -ResourceGroupName "RegionToZone-DemoMCRG" -MoveCollectionName "RegionToZone-DemoMC" -SourceId "/subscriptions/<Subscription-id>/resourcegroups/PS-demo-RegionToZone-RG/providers/Microsoft.Compute/virtualMachines/RegionToZone-demoSourceVm" -Name "demoVM-MoveResource" -ResourceSetting $targetResourceSettingsObjOutputDependsOn                         : {}
DependsOnOverride                 : {}
ErrorsPropertiesCode              :
ErrorsPropertiesDetail            :
ErrorsPropertiesMessage           :
ErrorsPropertiesTarget            :
ExistingTargetId                  :
Id                                : /subscriptions/<Subscription-id>/resourceGroups/RegionToZone-DemoMCRG/providers/Microsoft.Migrate/moveCollections/Re
                                    gionToZone-DemoMC/moveResources/demoVM-MoveResource
IsResolveRequired                 : False
JobStatusJobName                  :
JobStatusJobProgress              :
MoveStatusErrorsPropertiesCode    : DependencyComputationPending
MoveStatusErrorsPropertiesDetail  : {}
MoveStatusErrorsPropertiesMessage : The dependency computation is not completed for resource - /subscriptions/<Subscription-id>/resourcegroups/PS-demo-R
                                    egionToZone-RG/providers/Microsoft.Compute/virtualMachines/RegionToZone-demoSourceVm'.
                                        Possible Causes: Dependency computation is pending for resource.
                                        Recommended Action: Validate dependencies to compute the dependencies.

MoveStatusErrorsPropertiesTarget  :
MoveStatusMoveState               : MovePending
Name                              : demoVM-MoveResource
ProvisioningState                 : Succeeded
ResourceSetting                   : Microsoft.Azure.PowerShell.Cmdlets.ResourceMover.Models.Api20230801.VirtualMachineResourceSettings
SourceId                          : /subscriptions/<Subscription-id>/resourcegroups/PS-demo-RegionToZone-RG/providers/Microsoft.Compute/virtualMachines/
                                    RegionToZone-demoSourceVm
SourceResourceSetting             : Microsoft.Azure.PowerShell.Cmdlets.ResourceMover.Models.Api20230801.VirtualMachineResourceSettings
SystemDataCreatedAt               : 9/8/2023 6:48:11 AM
SystemDataCreatedBy               : xxxxx@microsoft.com
SystemDataCreatedByType           : User
SystemDataLastModifiedAt          : 9/8/2023 6:48:11 AM
SystemDataLastModifiedBy          : xxxxx@microsoft.com
SystemDataLastModifiedByType      : User
TargetId                          :
Type                              :az resource-mover move-resource add --resource-group clidemo-RG --move-collection-name cliDemo-zonalMC --name vm-demoMR --source-id "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/regionToZone-bugBash/providers/Microsoft.Compute/virtualMachines/regionToZone-test-LRS" --resource-settings '{ "resourceType": "Microsoft.Compute/virtualMachines", "targetResourceName": "regionToZone-test-LRS", "targetAvailabilityZone": "2", "targetVmSize": "Standard_B2s" }'Output{
  "id": "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/clidemo-RG/providers/Microsoft.Migrate/moveCollections/cliDemo-zonalMC/moveResources/vm-demoMR",
  "name": "vm-demoMR",
  "properties": {
    "dependsOn": [],
    "dependsOnOverrides": [],
    "isResolveRequired": false,
    "moveStatus": {
      "errors": {
        "properties": {
          "code": "DependencyComputationPending",
          "details": [],
          "message": "The dependency computation is not completed for resource - /subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/regionToZone-bugBash/providers/Microsoft.Compute/virtualMachines/regionToZone-test-LRS'.\n    Possible Causes: Dependency computation is pending for resource.\n    Recommended Action: Validate dependencies to compute the dependencies.\n    "
        }
      },
      "moveState": "MovePending"
    },
    "provisioningState": "Succeeded",
    "resourceSettings": {
      "resourceType": "Microsoft.Compute/virtualMachines",
      "targetAvailabilityZone": "2",
      "targetResourceName": "regionToZone-test-LRS",
      "targetVmSize": "Standard_B2s"
    },
    "sourceId": "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/regionToZone-bugBash/providers/Microsoft.Compute/virtualMachines/regionToZone-test-LRS",
    "sourceResourceSettings": {
      "resourceType": "Microsoft.Compute/virtualMachines",
      "tags": {
        "azsecpack": "nonprod",
        "platformsettings.host_environment.service.platform_optedin_for_rootcerts": "true"
      },
      "targetResourceName": "regionToZone-test-LRS",
      "targetVmSize": "Standard_B2s",
      "userManagedIdentities": [
        "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/AzSecPackAutoConfigRG/providers/Microsoft.ManagedIdentity/userAssignedIdentities/AzSecPackAutoConfigUA-uksouth"
      ]
    }
  },
  "resourceGroup": "clidemo-RG",
  "systemData": {
    "createdAt": "2023-09-21T10:35:03.2036685Z",
    "createdBy": "yashjain@microsoft.com",
    "createdByType": "User",
    "lastModifiedAt": "2023-09-21T10:35:03.2036685Z",
    "lastModifiedBy": "yashjain@microsoft.com",
    "lastModifiedByType": "User"
  }
}
Add resources
PowerShell
CLI
Add-AzResourceMoverMoveResource -ResourceGroupName "RegionToZone-DemoMCRG" -MoveCollectionName "RegionToZone-DemoMC" -SourceId "/subscriptions/<Subscription-id>/resourcegroups/PS-demo-RegionToZone-RG/providers/Microsoft.Compute/virtualMachines/RegionToZone-demoSourceVm" -Name "demoVM-MoveResource" -ResourceSetting $targetResourceSettingsObj
Add-AzResourceMoverMoveResource -ResourceGroupName "RegionToZone-DemoMCRG" -MoveCollectionName "RegionToZone-DemoMC" -SourceId "/subscriptions/<Subscription-id>/resourcegroups/PS-demo-RegionToZone-RG/providers/Microsoft.Compute/virtualMachines/RegionToZone-demoSourceVm" -Name "demoVM-MoveResource" -ResourceSetting $targetResourceSettingsObj
Output
DependsOn                         : {}
DependsOnOverride                 : {}
ErrorsPropertiesCode              :
ErrorsPropertiesDetail            :
ErrorsPropertiesMessage           :
ErrorsPropertiesTarget            :
ExistingTargetId                  :
Id                                : /subscriptions/<Subscription-id>/resourceGroups/RegionToZone-DemoMCRG/providers/Microsoft.Migrate/moveCollections/Re
                                    gionToZone-DemoMC/moveResources/demoVM-MoveResource
IsResolveRequired                 : False
JobStatusJobName                  :
JobStatusJobProgress              :
MoveStatusErrorsPropertiesCode    : DependencyComputationPending
MoveStatusErrorsPropertiesDetail  : {}
MoveStatusErrorsPropertiesMessage : The dependency computation is not completed for resource - /subscriptions/<Subscription-id>/resourcegroups/PS-demo-R
                                    egionToZone-RG/providers/Microsoft.Compute/virtualMachines/RegionToZone-demoSourceVm'.
                                        Possible Causes: Dependency computation is pending for resource.
                                        Recommended Action: Validate dependencies to compute the dependencies.

MoveStatusErrorsPropertiesTarget  :
MoveStatusMoveState               : MovePending
Name                              : demoVM-MoveResource
ProvisioningState                 : Succeeded
ResourceSetting                   : Microsoft.Azure.PowerShell.Cmdlets.ResourceMover.Models.Api20230801.VirtualMachineResourceSettings
SourceId                          : /subscriptions/<Subscription-id>/resourcegroups/PS-demo-RegionToZone-RG/providers/Microsoft.Compute/virtualMachines/
                                    RegionToZone-demoSourceVm
SourceResourceSetting             : Microsoft.Azure.PowerShell.Cmdlets.ResourceMover.Models.Api20230801.VirtualMachineResourceSettings
SystemDataCreatedAt               : 9/8/2023 6:48:11 AM
SystemDataCreatedBy               : xxxxx@microsoft.com
SystemDataCreatedByType           : User
SystemDataLastModifiedAt          : 9/8/2023 6:48:11 AM
SystemDataLastModifiedBy          : xxxxx@microsoft.com
SystemDataLastModifiedByType      : User
TargetId                          :
Type                              :
DependsOn                         : {}
DependsOnOverride                 : {}
ErrorsPropertiesCode              :
ErrorsPropertiesDetail            :
ErrorsPropertiesMessage           :
ErrorsPropertiesTarget            :
ExistingTargetId                  :
Id                                : /subscriptions/<Subscription-id>/resourceGroups/RegionToZone-DemoMCRG/providers/Microsoft.Migrate/moveCollections/Re
                                    gionToZone-DemoMC/moveResources/demoVM-MoveResource
IsResolveRequired                 : False
JobStatusJobName                  :
JobStatusJobProgress              :
MoveStatusErrorsPropertiesCode    : DependencyComputationPending
MoveStatusErrorsPropertiesDetail  : {}
MoveStatusErrorsPropertiesMessage : The dependency computation is not completed for resource - /subscriptions/<Subscription-id>/resourcegroups/PS-demo-R
                                    egionToZone-RG/providers/Microsoft.Compute/virtualMachines/RegionToZone-demoSourceVm'.
                                        Possible Causes: Dependency computation is pending for resource.
                                        Recommended Action: Validate dependencies to compute the dependencies.

MoveStatusErrorsPropertiesTarget  :
MoveStatusMoveState               : MovePending
Name                              : demoVM-MoveResource
ProvisioningState                 : Succeeded
ResourceSetting                   : Microsoft.Azure.PowerShell.Cmdlets.ResourceMover.Models.Api20230801.VirtualMachineResourceSettings
SourceId                          : /subscriptions/<Subscription-id>/resourcegroups/PS-demo-RegionToZone-RG/providers/Microsoft.Compute/virtualMachines/
                                    RegionToZone-demoSourceVm
SourceResourceSetting             : Microsoft.Azure.PowerShell.Cmdlets.ResourceMover.Models.Api20230801.VirtualMachineResourceSettings
SystemDataCreatedAt               : 9/8/2023 6:48:11 AM
SystemDataCreatedBy               : xxxxx@microsoft.com
SystemDataCreatedByType           : User
SystemDataLastModifiedAt          : 9/8/2023 6:48:11 AM
SystemDataLastModifiedBy          : xxxxx@microsoft.com
SystemDataLastModifiedByType      : User
TargetId                          :
Type                              :
az resource-mover move-resource add --resource-group clidemo-RG --move-collection-name cliDemo-zonalMC --name vm-demoMR --source-id "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/regionToZone-bugBash/providers/Microsoft.Compute/virtualMachines/regionToZone-test-LRS" --resource-settings '{ "resourceType": "Microsoft.Compute/virtualMachines", "targetResourceName": "regionToZone-test-LRS", "targetAvailabilityZone": "2", "targetVmSize": "Standard_B2s" }'
az resource-mover move-resource add --resource-group clidemo-RG --move-collection-name cliDemo-zonalMC --name vm-demoMR --source-id "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/regionToZone-bugBash/providers/Microsoft.Compute/virtualMachines/regionToZone-test-LRS" --resource-settings '{ "resourceType": "Microsoft.Compute/virtualMachines", "targetResourceName": "regionToZone-test-LRS", "targetAvailabilityZone": "2", "targetVmSize": "Standard_B2s" }'
Output
{
  "id": "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/clidemo-RG/providers/Microsoft.Migrate/moveCollections/cliDemo-zonalMC/moveResources/vm-demoMR",
  "name": "vm-demoMR",
  "properties": {
    "dependsOn": [],
    "dependsOnOverrides": [],
    "isResolveRequired": false,
    "moveStatus": {
      "errors": {
        "properties": {
          "code": "DependencyComputationPending",
          "details": [],
          "message": "The dependency computation is not completed for resource - /subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/regionToZone-bugBash/providers/Microsoft.Compute/virtualMachines/regionToZone-test-LRS'.\n    Possible Causes: Dependency computation is pending for resource.\n    Recommended Action: Validate dependencies to compute the dependencies.\n    "
        }
      },
      "moveState": "MovePending"
    },
    "provisioningState": "Succeeded",
    "resourceSettings": {
      "resourceType": "Microsoft.Compute/virtualMachines",
      "targetAvailabilityZone": "2",
      "targetResourceName": "regionToZone-test-LRS",
      "targetVmSize": "Standard_B2s"
    },
    "sourceId": "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/regionToZone-bugBash/providers/Microsoft.Compute/virtualMachines/regionToZone-test-LRS",
    "sourceResourceSettings": {
      "resourceType": "Microsoft.Compute/virtualMachines",
      "tags": {
        "azsecpack": "nonprod",
        "platformsettings.host_environment.service.platform_optedin_for_rootcerts": "true"
      },
      "targetResourceName": "regionToZone-test-LRS",
      "targetVmSize": "Standard_B2s",
      "userManagedIdentities": [
        "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/AzSecPackAutoConfigRG/providers/Microsoft.ManagedIdentity/userAssignedIdentities/AzSecPackAutoConfigUA-uksouth"
      ]
    }
  },
  "resourceGroup": "clidemo-RG",
  "systemData": {
    "createdAt": "2023-09-21T10:35:03.2036685Z",
    "createdBy": "yashjain@microsoft.com",
    "createdByType": "User",
    "lastModifiedAt": "2023-09-21T10:35:03.2036685Z",
    "lastModifiedBy": "yashjain@microsoft.com",
    "lastModifiedByType": "User"
  }
}
{
  "id": "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/clidemo-RG/providers/Microsoft.Migrate/moveCollections/cliDemo-zonalMC/moveResources/vm-demoMR",
  "name": "vm-demoMR",
  "properties": {
    "dependsOn": [],
    "dependsOnOverrides": [],
    "isResolveRequired": false,
    "moveStatus": {
      "errors": {
        "properties": {
          "code": "DependencyComputationPending",
          "details": [],
          "message": "The dependency computation is not completed for resource - /subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/regionToZone-bugBash/providers/Microsoft.Compute/virtualMachines/regionToZone-test-LRS'.\n    Possible Causes: Dependency computation is pending for resource.\n    Recommended Action: Validate dependencies to compute the dependencies.\n    "
        }
      },
      "moveState": "MovePending"
    },
    "provisioningState": "Succeeded",
    "resourceSettings": {
      "resourceType": "Microsoft.Compute/virtualMachines",
      "targetAvailabilityZone": "2",
      "targetResourceName": "regionToZone-test-LRS",
      "targetVmSize": "Standard_B2s"
    },
    "sourceId": "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/regionToZone-bugBash/providers/Microsoft.Compute/virtualMachines/regionToZone-test-LRS",
    "sourceResourceSettings": {
      "resourceType": "Microsoft.Compute/virtualMachines",
      "tags": {
        "azsecpack": "nonprod",
        "platformsettings.host_environment.service.platform_optedin_for_rootcerts": "true"
      },
      "targetResourceName": "regionToZone-test-LRS",
      "targetVmSize": "Standard_B2s",
      "userManagedIdentities": [
        "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/AzSecPackAutoConfigRG/providers/Microsoft.ManagedIdentity/userAssignedIdentities/AzSecPackAutoConfigUA-uksouth"
      ]
    }
  },
  "resourceGroup": "clidemo-RG",
  "systemData": {
    "createdAt": "2023-09-21T10:35:03.2036685Z",
    "createdBy": "yashjain@microsoft.com",
    "createdByType": "User",
    "lastModifiedAt": "2023-09-21T10:35:03.2036685Z",
    "lastModifiedBy": "yashjain@microsoft.com",
    "lastModifiedByType": "User"
  }
}
Modify settings
You can modify destination settings when moving Azure VMs and associated resources. We recommend that you only change destination settings before you validate the move collection.
Settings that you can modify are:
Virtual machine settings:Resource group, VM name, VM availability zone, VM SKU, VM key vault, and Disk encryption set.
Networking resource settings:For Network interfaces, virtual networks (VNets/), and network security groups/network interfaces, you can either:Use an existing networking resource in the destination region.Create a new resource with a different name.
Use an existing networking resource in the destination region.
Create a new resource with a different name.
Public IP/Load Balancer:SKU and Zone
Modify settings as follows:
Retrieve the move resource for which you want to edit properties. For example, to retrieve a VM run:$moveResourceObj = Get-AzResourceMoverMoveResource -MoveCollectionName " RegionToZone-DemoMCRG " -ResourceGroupName " RegionToZone-DemoMC " -Name "PSDemoVM"
Retrieve the move resource for which you want to edit properties. For example, to retrieve a VM run:
$moveResourceObj = Get-AzResourceMoverMoveResource -MoveCollectionName " RegionToZone-DemoMCRG " -ResourceGroupName " RegionToZone-DemoMC " -Name "PSDemoVM"
$moveResourceObj = Get-AzResourceMoverMoveResource -MoveCollectionName " RegionToZone-DemoMCRG " -ResourceGroupName " RegionToZone-DemoMC " -Name "PSDemoVM"
Copy the resource setting to a target resource setting object.$TargetResourceSettingObj = $moveResourceObj.ResourceSetting
Copy the resource setting to a target resource setting object.
$TargetResourceSettingObj = $moveResourceObj.ResourceSetting
$TargetResourceSettingObj = $moveResourceObj.ResourceSetting
Set the parameter in the target resource setting object. For example, to change the name of the destination VM:$TargetResourceSettingObj.TargetResourceName="PSDemoVM-target"
Set the parameter in the target resource setting object. For example, to change the name of the destination VM:
$TargetResourceSettingObj.TargetResourceName="PSDemoVM-target"
$TargetResourceSettingObj.TargetResourceName="PSDemoVM-target"
Update the move resource destination settings. In this example, we change the name of the VM from PSDemoVM to PSDemoVMTarget.Update-AzResourceMoverMoveResource -ResourceGroupName " RegionToZone-DemoMCRG " -MoveCollectionName " RegionToZone-DemoMC -SourceId "/subscriptions/<Subscription-d>/resourceGroups/PSDemoRM/providers/Microsoft.Compute/virtualMachines/PSDemoVM" -Name "PSDemoVM" -ResourceSetting $TargetResourceSettingObj
Update the move resource destination settings. In this example, we change the name of the VM from PSDemoVM to PSDemoVMTarget.
Update-AzResourceMoverMoveResource -ResourceGroupName " RegionToZone-DemoMCRG " -MoveCollectionName " RegionToZone-DemoMC -SourceId "/subscriptions/<Subscription-d>/resourceGroups/PSDemoRM/providers/Microsoft.Compute/virtualMachines/PSDemoVM" -Name "PSDemoVM" -ResourceSetting $TargetResourceSettingObj
Update-AzResourceMoverMoveResource -ResourceGroupName " RegionToZone-DemoMCRG " -MoveCollectionName " RegionToZone-DemoMC -SourceId "/subscriptions/<Subscription-d>/resourceGroups/PSDemoRM/providers/Microsoft.Compute/virtualMachines/PSDemoVM" -Name "PSDemoVM" -ResourceSetting $TargetResourceSettingObj
Resolve dependencies
Check whether the regional VMs you added have any dependencies on other resources, and add as needed.
Resolve dependencies as follows:PowerShellCLIResolve-AzResourceMoverMoveCollectionDependency -ResourceGroupName "RegionToZone-DemoMCRG" -MoveCollectionName "RegionToZone-DemoMC"Output (when dependencies exist)AdditionalInfo :
Code           :
Detail         :
EndTime        : 
EndTime        : 9/8/2023 6:52:14 AM

Id             : /subscriptions/<Subscription-id>/resourceGroups/RegionToZone-DemoMCRG/providers/Microsoft.Migrate/moveCollections/RegionToZone-DemoMC/operations/aaaa0a0a-bb1b-cc2c-dd3d-eeeeee4e4e4e
Message        :
Name           : aaaa0a0a-bb1b-cc2c-dd3d-eeeeee4e4e4e
Property       : Microsoft.Azure.PowerShell.Cmdlets.ResourceMover.Models.Any
StartTime      : 9/8/2023 6:51:50 AM
Status         : Succeededaz resource-mover move-collection resolve-dependency --name cliDemo-zonalMC --resource-group clidemo-RGOutput (when dependencies exist){
  "endTime": "9/21/2023 10:46:30 AM",
  "id": "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/clidemo-RG/providers/Microsoft.Migrate/moveCollections/cliDemo-zonalMC/operations/9bd337d0-90d5-4537-bdab-a7c0cd33e6d5",
  "name": "9bd337d0-90d5-4537-bdab-a7c0cd33e6d5",
  "resourceGroup": "clidemo-RG",
  "startTime": "9/21/2023 10:46:17 AM",
  "status": "Succeeded"
}
Resolve dependencies as follows:
PowerShell
CLI
Resolve-AzResourceMoverMoveCollectionDependency -ResourceGroupName "RegionToZone-DemoMCRG" -MoveCollectionName "RegionToZone-DemoMC"
Resolve-AzResourceMoverMoveCollectionDependency -ResourceGroupName "RegionToZone-DemoMCRG" -MoveCollectionName "RegionToZone-DemoMC"
Output (when dependencies exist)
AdditionalInfo :
Code           :
Detail         :
EndTime        : 
EndTime        : 9/8/2023 6:52:14 AM

Id             : /subscriptions/<Subscription-id>/resourceGroups/RegionToZone-DemoMCRG/providers/Microsoft.Migrate/moveCollections/RegionToZone-DemoMC/operations/aaaa0a0a-bb1b-cc2c-dd3d-eeeeee4e4e4e
Message        :
Name           : aaaa0a0a-bb1b-cc2c-dd3d-eeeeee4e4e4e
Property       : Microsoft.Azure.PowerShell.Cmdlets.ResourceMover.Models.Any
StartTime      : 9/8/2023 6:51:50 AM
Status         : Succeeded
AdditionalInfo :
Code           :
Detail         :
EndTime        : 
EndTime        : 9/8/2023 6:52:14 AM

Id             : /subscriptions/<Subscription-id>/resourceGroups/RegionToZone-DemoMCRG/providers/Microsoft.Migrate/moveCollections/RegionToZone-DemoMC/operations/aaaa0a0a-bb1b-cc2c-dd3d-eeeeee4e4e4e
Message        :
Name           : aaaa0a0a-bb1b-cc2c-dd3d-eeeeee4e4e4e
Property       : Microsoft.Azure.PowerShell.Cmdlets.ResourceMover.Models.Any
StartTime      : 9/8/2023 6:51:50 AM
Status         : Succeeded
az resource-mover move-collection resolve-dependency --name cliDemo-zonalMC --resource-group clidemo-RG
az resource-mover move-collection resolve-dependency --name cliDemo-zonalMC --resource-group clidemo-RG
Output (when dependencies exist)
{
  "endTime": "9/21/2023 10:46:30 AM",
  "id": "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/clidemo-RG/providers/Microsoft.Migrate/moveCollections/cliDemo-zonalMC/operations/9bd337d0-90d5-4537-bdab-a7c0cd33e6d5",
  "name": "9bd337d0-90d5-4537-bdab-a7c0cd33e6d5",
  "resourceGroup": "clidemo-RG",
  "startTime": "9/21/2023 10:46:17 AM",
  "status": "Succeeded"
}
{
  "endTime": "9/21/2023 10:46:30 AM",
  "id": "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/clidemo-RG/providers/Microsoft.Migrate/moveCollections/cliDemo-zonalMC/operations/9bd337d0-90d5-4537-bdab-a7c0cd33e6d5",
  "name": "9bd337d0-90d5-4537-bdab-a7c0cd33e6d5",
  "resourceGroup": "clidemo-RG",
  "startTime": "9/21/2023 10:46:17 AM",
  "status": "Succeeded"
}
To get a list of resources added to the move collection:PowerShellCLI$list = Get-AzResourceMoverMoveResource -ResourceGroupName "RegionToZone-DemoMCRG" -MoveCollectionName "RegionToZone-DemoMC"$list.NameOutput:demoVM-MoveResource
mr_regiontozone-demosourcevm661_d6f18900-3b87-4fb5-9bdf-12da2f9fb185
mr_regiontozone-demosourcevm-vnet_d8536bf5-2d5f-4778-9650-32d0570bc41a
mr_regiontozone-demosourcevm-ip_6af03f1f-eae8-4541-83f5-97a2506cfc3e
mr_regiontozone-demosourcevm-nsg_98d68420-d7ff-4e2d-b758-25a6df80fca7
mr_nrms-timkbo3hy3nnmregiontozone-demosourcevm-vnet_f474c880-4823-4ed3-b761-96df6500f6a3az resource-mover move-resource list --move-collection-name cliDemo-zonalMC --resource-group clidemo-RG
To get a list of resources added to the move collection:
PowerShell
CLI
$list = Get-AzResourceMoverMoveResource -ResourceGroupName "RegionToZone-DemoMCRG" -MoveCollectionName "RegionToZone-DemoMC"
$list = Get-AzResourceMoverMoveResource -ResourceGroupName "RegionToZone-DemoMCRG" -MoveCollectionName "RegionToZone-DemoMC"
$list.Name
$list.Name
Output:
demoVM-MoveResource
mr_regiontozone-demosourcevm661_d6f18900-3b87-4fb5-9bdf-12da2f9fb185
mr_regiontozone-demosourcevm-vnet_d8536bf5-2d5f-4778-9650-32d0570bc41a
mr_regiontozone-demosourcevm-ip_6af03f1f-eae8-4541-83f5-97a2506cfc3e
mr_regiontozone-demosourcevm-nsg_98d68420-d7ff-4e2d-b758-25a6df80fca7
mr_nrms-timkbo3hy3nnmregiontozone-demosourcevm-vnet_f474c880-4823-4ed3-b761-96df6500f6a3
demoVM-MoveResource
mr_regiontozone-demosourcevm661_d6f18900-3b87-4fb5-9bdf-12da2f9fb185
mr_regiontozone-demosourcevm-vnet_d8536bf5-2d5f-4778-9650-32d0570bc41a
mr_regiontozone-demosourcevm-ip_6af03f1f-eae8-4541-83f5-97a2506cfc3e
mr_regiontozone-demosourcevm-nsg_98d68420-d7ff-4e2d-b758-25a6df80fca7
mr_nrms-timkbo3hy3nnmregiontozone-demosourcevm-vnet_f474c880-4823-4ed3-b761-96df6500f6a3
az resource-mover move-resource list --move-collection-name cliDemo-zonalMC --resource-group clidemo-RG
az resource-mover move-resource list --move-collection-name cliDemo-zonalMC --resource-group clidemo-RG
To remove resources from the resource collection, follow theseinstructions.
To remove resources from the resource collection, follow theseinstructions.
Availability Zones VM SKU, Quota and Capacity validations
Azure provides recommendations when the selected Availability Zone doesn't have the virtual machine SKU, or when there is not enough Quota or Capacity available. Here are some examples of these recommendations and the actions that should be taken if the virtual machine SKU is not available.
When the source virtual machine sizeStandard_DC1ds_v3isn't available in the selected availability zone1.
Standard_DC1ds_v3
1
Recommended Action: Choose a different virtual machine size in the same availability zone or select a different availability zone with corresponding recommended VM size.
Recommendations:
SKU: Standard_DC1ds_v3, Zones: [ 2 ]
SKU: Standard_DC2ds_v3, Zones: [ 2 ]
SKU: Standard_DC4ds_v3, Zones: [ 2 ]
SKU: Standard_DC1s_v3, Zones: [ 2 ]
SKU: Standard_D2ds_v5, Zones: [ 2, 3 ]
SKU: Standard_D2as_v4, Zones: [ 1, 2, 3 ]
SKU: Standard_D2s_v3, Zones: [ 1, 2, 3 ]
SKU: Standard_D2as_v5, Zones: [ 1, 2, 3 ]
SKU: Standard_D2s_v5, Zones: [ 2, 3 ]
Capacity recommendations
Capacity recommendations for the current selection virtual machine sizeStandard_DC1ds_v3in the selected availability zone1.
Standard_DC1ds_v3
1
Recommended Action:To increase the likelihood of a successful deployment, Azure has identified other recommended virtual machine sizes and zones. To deploy seamlessly, choose a different VM size in the same availability zone or a different availability zone with corresponding virtual machine size.
Recommendations:
SKU: Standard_DC1ds_v3, Zones: [ 2 ]
SKU: Standard_DC2ds_v3, Zones: [ 2 ]
SKU: Standard_DC4ds_v3, Zones: [ 2 ]
SKU: Standard_DC1s_v3, Zones: [ 2 ]
SKU: Standard_D2ds_v5, Zones: [ 2, 3 ]
SKU: Standard_D2as_v4, Zones: [ 1, 2, 3 ]
SKU: Standard_D2s_v3, Zones: [ 1, 2, 3 ]
SKU: Standard_D2as_v5, Zones: [ 1, 2, 3 ]
SKU: Standard_D2s_v5, Zones: [ 2, 3 ]
Address the recommendations
To address the situations where the VM SKU is not found or there is a capacity issue, update the move resource and then run resolve again. Here is an example for reference:
Update virtual machine move resource object to new Zone or SKU as per the recommendations.$targetResourceSettingsObj.TargetVmSize = "Standard_DC1ds_v3"
$targetResourceSettingsObj.TargetAvailabilityZone = "3"
Update virtual machine move resource object to new Zone or SKU as per the recommendations.
$targetResourceSettingsObj.TargetVmSize = "Standard_DC1ds_v3"
$targetResourceSettingsObj.TargetAvailabilityZone = "3"
$targetResourceSettingsObj.TargetVmSize = "Standard_DC1ds_v3"
$targetResourceSettingsObj.TargetAvailabilityZone = "3"
Update virtual machine move resourceAdd-AzResourceMoverMoveResource -ResourceGroupName "RegionToZone-DemoMCRG" -MoveCollectionName "RegionToZone-DemoMC" -SourceId "/subscriptions/<Subscription ID>/resourceGroups/<Resource Group Name>/providers/Microsoft.Compute/virtualMachines/vmtwo" -Name "demoVM-MoveResource2" -ResourceSetting $targetResourceSettingsObj
Update virtual machine move resource
Add-AzResourceMoverMoveResource -ResourceGroupName "RegionToZone-DemoMCRG" -MoveCollectionName "RegionToZone-DemoMC" -SourceId "/subscriptions/<Subscription ID>/resourceGroups/<Resource Group Name>/providers/Microsoft.Compute/virtualMachines/vmtwo" -Name "demoVM-MoveResource2" -ResourceSetting $targetResourceSettingsObj
Add-AzResourceMoverMoveResource -ResourceGroupName "RegionToZone-DemoMCRG" -MoveCollectionName "RegionToZone-DemoMC" -SourceId "/subscriptions/<Subscription ID>/resourceGroups/<Resource Group Name>/providers/Microsoft.Compute/virtualMachines/vmtwo" -Name "demoVM-MoveResource2" -ResourceSetting $targetResourceSettingsObj
Run resolve againResolve-AzResourceMoverMoveCollectionDependency -ResourceGroupName "RegionToZone-DemoMCRG" -MoveCollectionName "RegionToZone-DemoMC"
Run resolve again
Resolve-AzResourceMoverMoveCollectionDependency -ResourceGroupName "RegionToZone-DemoMCRG" -MoveCollectionName "RegionToZone-DemoMC"
Resolve-AzResourceMoverMoveCollectionDependency -ResourceGroupName "RegionToZone-DemoMCRG" -MoveCollectionName "RegionToZone-DemoMC"
Insufficient Quota
Selected virtual machine can't be moved to availability zone due to insufficient quota.
Recommended Action:In-sufficient quota found. Refer to link and contactsupport.
Initiate move of VM resources
PowerShell
CLI
Invoke-AzResourceMoverInitiateMove -ResourceGroupName "RegionToZone-DemoMCRG" -MoveCollectionName "RegionToZone-DemoMC" -MoveResource $("demoVM-MoveResource") <remove-MoveResourceInputType "MoveResourceId">
Invoke-AzResourceMoverInitiateMove -ResourceGroupName "RegionToZone-DemoMCRG" -MoveCollectionName "RegionToZone-DemoMC" -MoveResource $("demoVM-MoveResource") <remove-MoveResourceInputType "MoveResourceId">
Output
AdditionalInfo :
Code           :
Detail         :
EndTime        : 9/8/2023 7:07:58 AM
Id             : /subscriptions/<Subscription-id>/resourceGroups/RegionToZone-DemoMCRG/providers/Microsoft.Migrate/moveCollections/RegionToZone-DemoMC/o
                 perations/d3e06ac3-a961-4045-8301-aee7f6911160
Message        :
Name           : d3e06ac3-a961-4045-8301-aee7f6911160
Property       : Microsoft.Azure.PowerShell.Cmdlets.ResourceMover.Models.Any
StartTime      : 9/8/2023 7:01:31 AM
Status         : Succeeded
AdditionalInfo :
Code           :
Detail         :
EndTime        : 9/8/2023 7:07:58 AM
Id             : /subscriptions/<Subscription-id>/resourceGroups/RegionToZone-DemoMCRG/providers/Microsoft.Migrate/moveCollections/RegionToZone-DemoMC/o
                 perations/d3e06ac3-a961-4045-8301-aee7f6911160
Message        :
Name           : d3e06ac3-a961-4045-8301-aee7f6911160
Property       : Microsoft.Azure.PowerShell.Cmdlets.ResourceMover.Models.Any
StartTime      : 9/8/2023 7:01:31 AM
Status         : Succeeded
az resource-mover move-collection initiate-move --move-resources "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/clidemo-RG/providers/Microsoft.Migrate/moveCollections/cliDemo-zonalMC/moveResources/vm-demoMR" --validate-only false --name cliDemo-zonalMC --resource-group clidemo-RG
az resource-mover move-collection initiate-move --move-resources "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/clidemo-RG/providers/Microsoft.Migrate/moveCollections/cliDemo-zonalMC/moveResources/vm-demoMR" --validate-only false --name cliDemo-zonalMC --resource-group clidemo-RG
Output
{
  "endTime": "9/21/2023 11:35:43 AM",
  "id": "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/clidemo-RG/providers/Microsoft.Migrate/moveCollections/cliDemo-zonalMC/operations/e1086818-b38b-4332-ac69-171a2958390c",
  "name": "e1086818-b38b-4332-ac69-171a2958390c",
  "resourceGroup": "clidemo-RG",
  "startTime": "9/21/2023 11:31:28 AM",
  "status": "Succeeded"
}
{
  "endTime": "9/21/2023 11:35:43 AM",
  "id": "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/clidemo-RG/providers/Microsoft.Migrate/moveCollections/cliDemo-zonalMC/operations/e1086818-b38b-4332-ac69-171a2958390c",
  "name": "e1086818-b38b-4332-ac69-171a2958390c",
  "resourceGroup": "clidemo-RG",
  "startTime": "9/21/2023 11:31:28 AM",
  "status": "Succeeded"
}
Commit
After the initial move, you must commit the move or discard it.Commitcompletes the move to the target region.
Commit the move as follows:
PowerShell
CLI
Invoke-AzResourceMoverCommit "RegionToZone-DemoMCRG" -MoveCollectionName "RegionToZone-DemoMC" -MoveResource $("demoVM-MoveResource")
Invoke-AzResourceMoverCommit "RegionToZone-DemoMCRG" -MoveCollectionName "RegionToZone-DemoMC" -MoveResource $("demoVM-MoveResource")
Output:
AdditionalInfo : 
Code           : 
Detail         : 
EndTime        : 9/22/2023 5:26:55 AM 
Id             : /subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/RegionToZone-DemoMCRG/providers/Microsoft.Migrate/moveCollections/RegionToZone-DemoMC/operations/35dd1d93-ba70-4dc9-a17f-7d8ba48678d8 
Message        : 
Name           : 35dd1d93-ba70-4dc9-a17f-7d8ba48678d8 
Property       : Microsoft.Azure.PowerShell.Cmdlets.ResourceMover.Models.Any 
StartTime      : 9/22/2023 5:26:54 AM 
Status         : Succeeded
AdditionalInfo : 
Code           : 
Detail         : 
EndTime        : 9/22/2023 5:26:55 AM 
Id             : /subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/RegionToZone-DemoMCRG/providers/Microsoft.Migrate/moveCollections/RegionToZone-DemoMC/operations/35dd1d93-ba70-4dc9-a17f-7d8ba48678d8 
Message        : 
Name           : 35dd1d93-ba70-4dc9-a17f-7d8ba48678d8 
Property       : Microsoft.Azure.PowerShell.Cmdlets.ResourceMover.Models.Any 
StartTime      : 9/22/2023 5:26:54 AM 
Status         : Succeeded
az resource-mover move-collection commit --move-resources "/subscriptions/<Subscription-id>/resourceGroups/clidemo-RG/providers/Microsoft.Migrate/moveCollections/cliDemo-zonalMC/moveResources/vm-demoMR" --validate-only false --name cliDemo-zonalMC --resource-group clidemo-RG
az resource-mover move-collection commit --move-resources "/subscriptions/<Subscription-id>/resourceGroups/clidemo-RG/providers/Microsoft.Migrate/moveCollections/cliDemo-zonalMC/moveResources/vm-demoMR" --validate-only false --name cliDemo-zonalMC --resource-group clidemo-RG
Output:
{
  "endTime": "9/21/2023 11:47:14 AM",
  "id": "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/clidemo-RG/providers/Microsoft.Migrate/moveCollections/cliDemo-zonalMC/operations/34c0d405-672f-431a-8879-582c48940b4a",
  "name": "34c0d405-672f-431a-8879-582c48940b4a",
  "resourceGroup": "clidemo-RG",
  "startTime": "9/21/2023 11:45:13 AM",
  "status": "Succeeded"
}
{
  "endTime": "9/21/2023 11:47:14 AM",
  "id": "/subscriptions/e80eb9fa-c996-4435-aa32-5af6f3d3077c/resourceGroups/clidemo-RG/providers/Microsoft.Migrate/moveCollections/cliDemo-zonalMC/operations/34c0d405-672f-431a-8879-582c48940b4a",
  "name": "34c0d405-672f-431a-8879-582c48940b4a",
  "resourceGroup": "clidemo-RG",
  "startTime": "9/21/2023 11:45:13 AM",
  "status": "Succeeded"
}
Remove a resource
You can remove a single resource or multiple resources from aMoveCollectionusing the following cmdlets:
MoveCollection
Get a list of the move resources that are added to the move collection:$list = Get-AzResourceMoverMoveResource -ResourceGroupName "<MoveCollectionResourceGroupName>" -MoveCollectionName "<MoveCollectionName>"
Get a list of the move resources that are added to the move collection:$list = Get-AzResourceMoverMoveResource -ResourceGroupName "<MoveCollectionResourceGroupName>" -MoveCollectionName "<MoveCollectionName>"
$list = Get-AzResourceMoverMoveResource -ResourceGroupName "<MoveCollectionResourceGroupName>" -MoveCollectionName "<MoveCollectionName>"
Remove the move resources you found:Invoke-AzResourceMoverBulkRemove -ResourceGroupName "<MoveCollectionResourceGroupName>" -MoveCollectionName "<MoveCollectionName>" -MoveResource $($list.Name)
Remove the move resources you found:Invoke-AzResourceMoverBulkRemove -ResourceGroupName "<MoveCollectionResourceGroupName>" -MoveCollectionName "<MoveCollectionName>" -MoveResource $($list.Name)
Invoke-AzResourceMoverBulkRemove -ResourceGroupName "<MoveCollectionResourceGroupName>" -MoveCollectionName "<MoveCollectionName>" -MoveResource $($list.Name)
Remove the move collection:Remove-AzResourceMoverMoveCollection -ResourceGroupName "<MoveCollectionResourceGroupName>" -MoveCollectionName "<MoveCollectionName>"
Remove the move collection:Remove-AzResourceMoverMoveCollection -ResourceGroupName "<MoveCollectionResourceGroupName>" -MoveCollectionName "<MoveCollectionName>"
Remove-AzResourceMoverMoveCollection -ResourceGroupName "<MoveCollectionResourceGroupName>" -MoveCollectionName "<MoveCollectionName>"
Note
If you observe managed identities authorization issues, re-enable the managed identities access by followingthese stepsagain.
Delete source regional VMs
After you commit the move and verify that the resources work as expected in the target region, you can delete each source resource using:
Azure portal
PowerShell
Azure CLI
Next steps
Learn how to move single instance Azure VMs from regional to zonal configuration viaportal.
Feedback
Was this page helpful?
Additional resources