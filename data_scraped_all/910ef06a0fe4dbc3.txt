Note
Access to this page requires authorization. You can trysigning inorchanging directories.
Access to this page requires authorization. You can trychanging directories.
Configure and install the information protection scanner
Article
2024-06-28
9 contributors
In this article
Note
There's a new version of the information protection scanner. For more information, seeUpgrade the Microsoft Purview Information Protection scanner.
This article describes how to configure and install the Microsoft Purview Information Protection scanner, formerly namedAzure Information Protection unified labeling scanner, or the on-premises scanner.
Tip
While most customers will perform these procedures in the admin portal, you may need to work in PowerShell only.
For example, if you are working in an environment without access to the admin portal, such asAzure China 21Vianet, follow the instructions inUse PowerShell to configure the scanner.
Overview
Before you start, verify that your system complies with therequired prerequisites.
Then, use the following steps to configure and install the scanner:
Configure the scanner settings
Configure the scanner settings
Install the scanner
Install the scanner
Get a Microsoft Entra token for the scanner
Get a Microsoft Entra token for the scanner
Configure the scanner to apply classification and protection
Configure the scanner to apply classification and protection
Next, perform the following configuration procedures as needed for your system:
If you don't have access to the scanner pages in the Microsoft Purview portal, configure any scanner settings in PowerShell only. For more information, seeUse PowerShell to configure the scannerandSupported PowerShell cmdlets.
Configure the scanner settings
Before you install the scanner, or upgrade it from an older general availability version, configure or verify your scanner settings. For this configuration, you can use either theMicrosoft Purview portal.
To configure your scanner in the Microsoft Purview portal:
Sign in using one of the following roles:
Compliance Administrator
Compliance Data Administrator
Security Administrator
Organization Management
Sign in to the Microsoft Purview portal>Settingscard >Information Protection>Information protection scanner.
Sign in to the Microsoft Purview portal>Settingscard >Information Protection>Information protection scanner.
Create a scanner cluster. This cluster defines your scanner and is used to identify the scanner instance, such as during installation, upgrades, and other processes.
Create a scanner cluster. This cluster defines your scanner and is used to identify the scanner instance, such as during installation, upgrades, and other processes.
Create a content scan jobto define the repositories you want to scan.
Create a content scan jobto define the repositories you want to scan.
Create a scanner cluster
To create a scanner cluster in the Microsoft Purview portal:
From the tabs on theInformation protection scannerpage, selectClusters.
From the tabs on theInformation protection scannerpage, selectClusters.
On theClusterstab, selectAdd.
On theClusterstab, selectAdd.
On theNew clusterpane, enter a meaningful name for the scanner, and an optional description.The cluster name is used to identify the scanner's configurations and repositories. For example, you might enterEuropeto identify the geographical locations of the data repositories you want to scan.You'll use this name later on to identify where you want to install or upgrade your scanner.
On theNew clusterpane, enter a meaningful name for the scanner, and an optional description.
The cluster name is used to identify the scanner's configurations and repositories. For example, you might enterEuropeto identify the geographical locations of the data repositories you want to scan.
You'll use this name later on to identify where you want to install or upgrade your scanner.
SelectSaveto save your changes.
SelectSaveto save your changes.
Create a content scan job
Deep dive into your content to scan specific repositories for sensitive content.
To create your content scan job on the Microsoft Purview portal:
From the tabs on theInformation protection scannerpage, selectContent scan jobs.
From the tabs on theInformation protection scannerpage, selectContent scan jobs.
On theContent scan jobspane, selectAdd.
On theContent scan jobspane, selectAdd.
For this initial configuration, configure the following settings, and then selectSave.SettingDescriptionContent scan job settings-Schedule: Keep the default ofManual-Info types to be discovered: Change toPolicy onlyDLP policyIf you're using a data loss prevention policy, setEnable DLP rulestoOn. For more information, seeUse a DLP policy.Sensitivity policy-Enforce sensitivity labeling policy: SelectOff-Label files based on content: Keep the default ofOn-Default label: Keep the default ofPolicy default-Relabel files: Keep the default ofOffConfigure file settings-Preserve "Date modified", "Last modified" and "Modified by": Keep the default ofOn-File types to scan: Keep the default file types forExclude-Default owner: Keep the default ofScanner Account-Set repository owner: Use this option only whenusing a DLP policy.
For this initial configuration, configure the following settings, and then selectSave.
Open the content scan job that was saved, and select theRepositoriestab to specify the data stores to be scanned.Specify UNC paths and SharePoint Server URLs for SharePoint on-premises document libraries and folders.NoteSharePoint Server 2019, SharePoint Server 2016, and SharePoint Server 2013 are supported for SharePoint. SharePoint Server 2010 is also supported when you haveextended support for this version of SharePoint.To add your first data store, while on theRepositoriestab:On theRepositoriespane, selectAdd:On theRepositorypane, specify the path for the data repository, and then selectSave.For a network share, use\\Server\Folder.For a SharePoint library, usehttp://sharepoint.contoso.com/Shared%20Documents/Folder.For a local path:C:\FolderFor a UNC path:\\Server\FolderNoteWildcards are not supported and WebDav locations are not supported.
Scanning of OneDrive locations as repositories is not supported.If you add a SharePoint path forShared Documents:SpecifyShared Documentsin the path when you want to scan all documents and all folders from Shared Documents.
For example:http://sp2013/SharedDocumentsSpecifyDocumentsin the path when you want to scan all documents and all folders from a subfolder under Shared Documents.
For example:http://sp2013/Documents/SalesReportsOr, specify only theFQDNof your SharePoint, for examplehttp://sp2013todiscover and scan all SharePoint sites and subsites under a specific URLand subtitles under this URL. Grant scannerSite Collector Auditorrights to enable this.For the remaining settings on this pane, don't change them for this initial configuration, but keep them asContent scan job default. The default setting means that the data repository inherits the settings from the content scan job.Use the following syntax when adding SharePoint paths:PathSyntaxRoot pathhttp://<SharePoint server name>Scans all sites, including any site collections allowed for the scanner user.Requiresadditional permissionsto automatically discover root contentSpecific SharePoint subsite or collectionOne of the following:-http://<SharePoint server name>/<subsite name>-http://SharePoint server name>/<site collection name>/<site name>Requiresadditional permissionsto automatically discover site collection contentSpecific SharePoint libraryOne of the following:-http://<SharePoint server name>/<library name>-http://SharePoint server name>/.../<library name>Specific SharePoint folderhttp://<SharePoint server name>/.../<folder name>
Open the content scan job that was saved, and select theRepositoriestab to specify the data stores to be scanned.
Specify UNC paths and SharePoint Server URLs for SharePoint on-premises document libraries and folders.
Note
SharePoint Server 2019, SharePoint Server 2016, and SharePoint Server 2013 are supported for SharePoint. SharePoint Server 2010 is also supported when you haveextended support for this version of SharePoint.
To add your first data store, while on theRepositoriestab:
On theRepositoriespane, selectAdd:
On theRepositoriespane, selectAdd:
On theRepositorypane, specify the path for the data repository, and then selectSave.For a network share, use\\Server\Folder.For a SharePoint library, usehttp://sharepoint.contoso.com/Shared%20Documents/Folder.For a local path:C:\FolderFor a UNC path:\\Server\Folder
On theRepositorypane, specify the path for the data repository, and then selectSave.
For a network share, use\\Server\Folder.
\\Server\Folder
For a SharePoint library, usehttp://sharepoint.contoso.com/Shared%20Documents/Folder.
http://sharepoint.contoso.com/Shared%20Documents/Folder
For a local path:C:\Folder
C:\Folder
For a UNC path:\\Server\Folder
\\Server\Folder
Note
Wildcards are not supported and WebDav locations are not supported.
Scanning of OneDrive locations as repositories is not supported.
If you add a SharePoint path forShared Documents:
SpecifyShared Documentsin the path when you want to scan all documents and all folders from Shared Documents.
For example:http://sp2013/SharedDocuments
http://sp2013/SharedDocuments
SpecifyDocumentsin the path when you want to scan all documents and all folders from a subfolder under Shared Documents.
For example:http://sp2013/Documents/SalesReports
http://sp2013/Documents/SalesReports
Or, specify only theFQDNof your SharePoint, for examplehttp://sp2013todiscover and scan all SharePoint sites and subsites under a specific URLand subtitles under this URL. Grant scannerSite Collector Auditorrights to enable this.
http://sp2013
For the remaining settings on this pane, don't change them for this initial configuration, but keep them asContent scan job default. The default setting means that the data repository inherits the settings from the content scan job.
Use the following syntax when adding SharePoint paths:
http://<SharePoint server name>
http://<SharePoint server name>/<subsite name>
http://SharePoint server name>/<site collection name>/<site name>
http://<SharePoint server name>/<library name>
http://SharePoint server name>/.../<library name>
http://<SharePoint server name>/.../<folder name>
Repeat the previous steps to add as many repositories as needed.
Repeat the previous steps to add as many repositories as needed.
You're now ready to install the scanner with the content scanner job that you've created. Continue withInstall the scanner.
Install the scanner
After you'veconfigured the scanner, perform the following steps to install the scanner. This procedure is performed fully in PowerShell.
Sign in to the Windows Server computer that will run the scanner. Use an account that has local administrator rights and that has permissions to write to the SQL Server master database.ImportantYou must have the information protection client installed on your machine before installing the scanner.For more information, seePrerequisites for installing and deploying the information protection scanner.
Sign in to the Windows Server computer that will run the scanner. Use an account that has local administrator rights and that has permissions to write to the SQL Server master database.
Important
You must have the information protection client installed on your machine before installing the scanner.
For more information, seePrerequisites for installing and deploying the information protection scanner.
Open a Windows PowerShell session with theRun as an administratoroption.
Open a Windows PowerShell session with theRun as an administratoroption.
Run theInstall-Scannercmdlet, specifying your SQL Server instance on which to create a database for the information protection scanner, and the scanner cluster name that youspecified in the preceding section:Install-Scanner -SqlServerInstance <name> -Cluster <cluster name>Examples, using the scanner cluster name ofEurope:For a default instance:Install-Scanner -SqlServerInstance SQLSERVER1 -Cluster EuropeFor a named instance:Install-Scanner -SqlServerInstance SQLSERVER1\SCANNER -Cluster EuropeFor SQL Server Express:Install-Scanner -SqlServerInstance SQLSERVER1\SQLEXPRESS -Cluster EuropeWhen you're prompted, provide the Active Directory credentials for the scanner service account.Use the following syntax:\<domain\user name>. For example:contoso\scanneraccount
Run theInstall-Scannercmdlet, specifying your SQL Server instance on which to create a database for the information protection scanner, and the scanner cluster name that youspecified in the preceding section:
Install-Scanner -SqlServerInstance <name> -Cluster <cluster name>
Install-Scanner -SqlServerInstance <name> -Cluster <cluster name>
Examples, using the scanner cluster name ofEurope:
For a default instance:Install-Scanner -SqlServerInstance SQLSERVER1 -Cluster Europe
For a default instance:Install-Scanner -SqlServerInstance SQLSERVER1 -Cluster Europe
Install-Scanner -SqlServerInstance SQLSERVER1 -Cluster Europe
For a named instance:Install-Scanner -SqlServerInstance SQLSERVER1\SCANNER -Cluster Europe
For a named instance:Install-Scanner -SqlServerInstance SQLSERVER1\SCANNER -Cluster Europe
Install-Scanner -SqlServerInstance SQLSERVER1\SCANNER -Cluster Europe
For SQL Server Express:Install-Scanner -SqlServerInstance SQLSERVER1\SQLEXPRESS -Cluster Europe
For SQL Server Express:Install-Scanner -SqlServerInstance SQLSERVER1\SQLEXPRESS -Cluster Europe
Install-Scanner -SqlServerInstance SQLSERVER1\SQLEXPRESS -Cluster Europe
When you're prompted, provide the Active Directory credentials for the scanner service account.
Use the following syntax:\<domain\user name>. For example:contoso\scanneraccount
\<domain\user name>
contoso\scanneraccount
Verify that the service is now installed by usingAdministrative Tools>Services.The installed service is namedMicrosoft Purview Information Protection Scannerand is configured to run by using the scanner service account that you created.
Verify that the service is now installed by usingAdministrative Tools>Services.
The installed service is namedMicrosoft Purview Information Protection Scannerand is configured to run by using the scanner service account that you created.
Now that you've installed the scanner, you need toget a Microsoft Entra token for the scannerservice account to authenticate, so that the scanner can run unattended.

Get a Microsoft Entra token for the scanner
A Microsoft Entra token allows the scanner to authenticate to the Microsoft Purview Information Protection Scanner service, enabling the scanner to run unattended.
For more information, seeRun information protection labeling cmdlets unattended.
To get a Microsoft Entra token:
Navigate to the Azure Portal and proceed to theMicrosoft Entra IDBlade.
Navigate to the Azure Portal and proceed to theMicrosoft Entra IDBlade.
In the Microsoft Entra ID side pane, clickApp Registrations.
In the Microsoft Entra ID side pane, clickApp Registrations.
At the top, go ahead and click+ New registration.
At the top, go ahead and click+ New registration.
In the Name section type inInformationProtectionScanner.
In the Name section type inInformationProtectionScanner.
LeaveSupported account typesas default.
LeaveSupported account typesas default.
For the Redirect URI, leave the type as Web but type inhttp://localhostfor the entry portion and clickRegister.
For the Redirect URI, leave the type as Web but type inhttp://localhostfor the entry portion and clickRegister.
On the Overview page of this application, note down in your text editor of choice the following IDs:Application (client) IDandDirectory (tenant) ID. You will need this later when setting up the Set-AIPAuthentication command.
On the Overview page of this application, note down in your text editor of choice the following IDs:Application (client) IDandDirectory (tenant) ID. You will need this later when setting up the Set-AIPAuthentication command.
On the side pane, navigate toCertificates and Secrets.
On the side pane, navigate toCertificates and Secrets.
Click on+ New client secret.
Click on+ New client secret.
In the dialog box that shows up, enter a description for your secret and set it to ExpireIn 1 yearand then Add the secret.
In the dialog box that shows up, enter a description for your secret and set it to ExpireIn 1 yearand then Add the secret.
You should see now under the client secrets section that there is an entry with theSecret Value. Go ahead and copy this value and store it in the file where you saved the Client ID and Tenant ID. This is the only time you will be able to see the secret value, it will not be recoverable if you don't copy it at this time.
You should see now under the client secrets section that there is an entry with theSecret Value. Go ahead and copy this value and store it in the file where you saved the Client ID and Tenant ID. This is the only time you will be able to see the secret value, it will not be recoverable if you don't copy it at this time.
On the side pane, navigate toAPI Permissions.
On the side pane, navigate toAPI Permissions.
Go ahead and selectAdd a permission.
Go ahead and selectAdd a permission.
When the screen shows, selectAzure Rights Management Service. Then selectApplication Permissions.
When the screen shows, selectAzure Rights Management Service. Then selectApplication Permissions.
Click the drop down forContentand put checkmarks down forContent.DelegatedReaderandContent.DelegatedWriter. Then at the bottom of the screen, clickAdd Permissions.
Click the drop down forContentand put checkmarks down forContent.DelegatedReaderandContent.DelegatedWriter. Then at the bottom of the screen, clickAdd Permissions.
Navigate back theAPI Permissionssection and add another permission.
Navigate back theAPI Permissionssection and add another permission.
This time, for the Select an API section, click onAPIs my organization uses. In the search bar, type inMicrosoft Information Protection Sync Serviceand select it.
This time, for the Select an API section, click onAPIs my organization uses. In the search bar, type inMicrosoft Information Protection Sync Serviceand select it.
SelectApplication Permissionsand then in theUnified Policydrop down, checkmark the permissionUnifiedPolicy.Tenant.Read. Then at the bottom of the screen, clickAdd Permissions.
SelectApplication Permissionsand then in theUnified Policydrop down, checkmark the permissionUnifiedPolicy.Tenant.Read. Then at the bottom of the screen, clickAdd Permissions.
Back on theAPI Permissionsscreen, clickGrant Admin Consentand look for the operation being successful (signified by a green checkmark).
Back on theAPI Permissionsscreen, clickGrant Admin Consentand look for the operation being successful (signified by a green checkmark).
From the Windows Server computer, if your scanner service account has been granted theLog on locallyright for the installation, sign in with this account and start a PowerShell session.RunSet-Authentication, specifying the values that you copied from the previous step:Set-Authentication -AppId <ID of the registered app> -AppSecret <client secret sting> -TenantId <your tenant ID> -DelegatedUser <Azure AD account>For example:$pscreds = Get-Credential CONTOSO\scanner
Set-Authentication -AppId "77c3c1c3-abf9-404e-8b2b-4652836c8c66" -AppSecret "OAkk+rnuYc/u+]ah2kNxVbtrDGbS47L4" -DelegatedUser scanner@contoso.com -TenantId "9c11c87a-ac8b-46a3-8d5c-f4d0b72ee29a" -OnBehalfOf $pscreds
Acquired application access token on behalf of CONTOSO\scanner.
From the Windows Server computer, if your scanner service account has been granted theLog on locallyright for the installation, sign in with this account and start a PowerShell session.
RunSet-Authentication, specifying the values that you copied from the previous step:
Set-Authentication -AppId <ID of the registered app> -AppSecret <client secret sting> -TenantId <your tenant ID> -DelegatedUser <Azure AD account>
Set-Authentication -AppId <ID of the registered app> -AppSecret <client secret sting> -TenantId <your tenant ID> -DelegatedUser <Azure AD account>
For example:
$pscreds = Get-Credential CONTOSO\scanner
Set-Authentication -AppId "77c3c1c3-abf9-404e-8b2b-4652836c8c66" -AppSecret "OAkk+rnuYc/u+]ah2kNxVbtrDGbS47L4" -DelegatedUser scanner@contoso.com -TenantId "9c11c87a-ac8b-46a3-8d5c-f4d0b72ee29a" -OnBehalfOf $pscreds
Acquired application access token on behalf of CONTOSO\scanner.
$pscreds = Get-Credential CONTOSO\scanner
Set-Authentication -AppId "77c3c1c3-abf9-404e-8b2b-4652836c8c66" -AppSecret "OAkk+rnuYc/u+]ah2kNxVbtrDGbS47L4" -DelegatedUser scanner@contoso.com -TenantId "9c11c87a-ac8b-46a3-8d5c-f4d0b72ee29a" -OnBehalfOf $pscreds
Acquired application access token on behalf of CONTOSO\scanner.
Tip
If your scanner service account cannot be granted theLog on locallyright for the installation, use theOnBehalfOfparameter withSet-Authentication, as described in as described inRun information protection labeling cmdlets unattended.
The scanner now has a token to authenticate to Microsoft Entra ID. This token is valid for one year, two years, or never, according to your configuration of theWeb app /APIclient secret in Microsoft Entra ID. When the token expires, you must repeat this procedure.
Continue using one of the following steps, depending on whether you're using the Microsoft Purview portal to configure your scanner, or PowerShell only:
Admin portal only
PowerShell only
You're now ready to run your first scan in discovery mode. For more information, seeRun a discovery cycle and view reports for the scanner.
Once you've run your initial discovery scan, continue withConfigure the scanner to apply classification and protection.
If you are configuring and installing your scanner using PowerShell instead of the scanner pages in the Microsoft Purview portal, continue with step 5 inUse PowerShell to configure the scanner.
Then:
Run a discovery cycle and view reports for the scanner
Use PowerShell to configure the scanner to apply classification and protection
Use PowerShell to configure a DLP policy with the scanner
For more information, seeRun information protection labeling cmdlets unattended.
Configure the scanner to apply classification and protection
The default settings configure the scanner to run once, and in reporting-only mode. To change these settings, edit the content scan job.
Tip
If you're working in PowerShell only, seeConfigure the scanner to apply classification and protection - PowerShell only.
To configure the scanner to apply classification and protection in the Microsoft Purview portal::
In the Microsoft Purview portal, on theContent scan jobstab, select a specific content scan job to edit it.
In the Microsoft Purview portal, on theContent scan jobstab, select a specific content scan job to edit it.
Select the content scan job, change the following, and then selectSave:From theContent scan jobsection: Change theScheduletoAlwaysFrom theEnforce sensitivity labeling policysection: Change the radio button toOn
Select the content scan job, change the following, and then selectSave:
From theContent scan jobsection: Change theScheduletoAlways
From theEnforce sensitivity labeling policysection: Change the radio button toOn
Make sure a node for the content scan job is online, then start the content scan job again by selectingScan now. TheScan nowbutton only appears when a node for the selected content scan job is online.
Make sure a node for the content scan job is online, then start the content scan job again by selectingScan now. TheScan nowbutton only appears when a node for the selected content scan job is online.
The scanner is now scheduled to run continuously. When the scanner works its way through all configured files, it automatically starts a new cycle so that any new and changed files are discovered.
Use a DLP policy
Using a data loss prevention policy enables the scanner to detect potential data leaks by matching DLP rules to files stored in file shares and SharePoint Server.
Enable DLP rules in your content scan jobto reduce the exposure of any files that match your DLP policies. When your DLP rules are enabled, the scanner may reduce file access to data owners only, or reduce exposure to network-wide groups, such asEveryone,Authenticated Users, orDomain Users.
Enable DLP rules in your content scan jobto reduce the exposure of any files that match your DLP policies. When your DLP rules are enabled, the scanner may reduce file access to data owners only, or reduce exposure to network-wide groups, such asEveryone,Authenticated Users, orDomain Users.
In the Microsoft Purview portal, determine whether you are just testing your DLP policy or whether you want your rules enforced and your file permissions changed according to those rules. For more information, seeCreate and Deploy data loss prevention policies
In the Microsoft Purview portal, determine whether you are just testing your DLP policy or whether you want your rules enforced and your file permissions changed according to those rules. For more information, seeCreate and Deploy data loss prevention policies
DLP policies are configured in the Microsoft Purview portal. For more information about DLP licensing, seeGet started with the data loss prevention on-premises scanner.
Tip
Scanning your files, even when just testing the DLP policy, also creates file permission reports. Query these reports to investigate specific file exposures or explore the exposure of a specific user to scanned files.
To use PowerShell only, seeUse a DLP policy with the scanner - PowerShell only.
To use a DLP policy with the scanner in the Microsoft Purview portal:
In the Microsoft Purview portal, navigate to theContent scan jobstab and select a specific content scan job. For more information, seeCreate a content scan job.
In the Microsoft Purview portal, navigate to theContent scan jobstab and select a specific content scan job. For more information, seeCreate a content scan job.
UnderEnable DLP policy rules, set the radio button toOn.ImportantDo not setEnable DLP rulestoOnunless you actually have a DLP policy configured in Microsoft 365.Turning this feature on without a DLP policy will cause the scanner to generate errors.
UnderEnable DLP policy rules, set the radio button toOn.
Important
Do not setEnable DLP rulestoOnunless you actually have a DLP policy configured in Microsoft 365.
Turning this feature on without a DLP policy will cause the scanner to generate errors.
(Optional) Set theSet repository ownertoOn, and define a specific user as the repository owner.This option enables the scanner to reduce the exposure of any files found in this repository, which match the DLP policy, to the repository owner defined.
(Optional) Set theSet repository ownertoOn, and define a specific user as the repository owner.
This option enables the scanner to reduce the exposure of any files found in this repository, which match the DLP policy, to the repository owner defined.
DLP policies andmake privateactions
If you are using a DLP policy with amake privateaction, and are also planning to use the scanner to automatically label your files, we recommend that you also define the unified labeling client'sUseCopyAndPreserveNTFSOwneradvanced setting.
This setting ensures that the original owners retain access to their files.
For more information, seeCreate a content scan jobandAutomatically apply a sensitivity label to Microsoft 365 data.
Change which file types to protect
By default the scanner protects Office file types and PDF files only.
Use PowerShell commands to change this behavior as needed, such as to configure the scanner to protect all file types, just as the client does, or to protect additional, specific file types.
For a label policy that applies to the user account downloading labels for the scanner, specify a PowerShell advanced setting namedPFileSupportedExtensions.
For a scanner that has access to the internet, this user account is the account that you specify for theDelegatedUserparameter with the Set-Authentication command.
Example 1:  PowerShell command for the scanner to protect all file types, where your label policy is named "Scanner":
Set-LabelPolicy -Identity Scanner -AdvancedSettings @{PFileSupportedExtensions="*"}
Set-LabelPolicy -Identity Scanner -AdvancedSettings @{PFileSupportedExtensions="*"}
Example 2: PowerShell command for the scanner to protect .xml files and .tiff files in addition to Office files and PDF files, where your label policy is named "Scanner":
Set-LabelPolicy -Identity Scanner -AdvancedSettings @{PFileSupportedExtensions=ConvertTo-Json(".xml", ".tiff")}
Set-LabelPolicy -Identity Scanner -AdvancedSettings @{PFileSupportedExtensions=ConvertTo-Json(".xml", ".tiff")}
For more information, seeChange which file types to protect.
Upgrade your scanner
If you've previously installed the scanner and want to upgrade, use the instructions described inUpgrade the Microsoft Purview Information Protection scanner.
Then,configureanduse your scanneras usual, skipping the steps to install your scanner.
Edit data repository settings in bulk
Use theExportandImportbuttons to make changes for your scanner across several repositories.
This way, you don't need to make the same changes several times, manually, in the Microsoft Purview portal.
For example, if you've a new file type on several SharePoint data repositories, you may want to update the settings for those repositories in bulk.
To make changes in bulk across repositories in the Microsoft Purview portal:
In the Microsoft Purview portal, select a specific content scan job and navigate to theRepositoriestab within the pane. Select theExportoption.
In the Microsoft Purview portal, select a specific content scan job and navigate to theRepositoriestab within the pane. Select theExportoption.
Manually edit the exported file to make your change.
Manually edit the exported file to make your change.
Use theImportoption on the same page to import the updates back across your repositories.
Use theImportoption on the same page to import the updates back across your repositories.
Use the scanner with alternative configurations
The scanner usually looks for conditions specified for your labels in order to classify and protect your content as needed.
In the following scenarios, the scanner is also able to scan your content and manage labels, without any conditions configured:
Apply a default label to all files in a data repository
Remove existing labels from all files in a data repository
Identify all custom conditions and known sensitive information types
Apply a default label to all files in a data repository
In this configuration, all unlabeled files in the repository are labeled with the default label specified for the repository or the content scan job. Files are labeled without inspection.
Configure the following settings:
Remove existing labels from all files in a data repository
In this configuration, all existing labels are removed, including protection, if protection was applied with the label. Protection applied independently of a label is retained.
Configure the following settings:
Identify all custom conditions and known sensitive information types
This configuration enables you to find sensitive information that you might not realize you had, at the expense of scanning rates for the scanner.
Set theInfo types to be discoveredtoAll.
To identify conditions and information types for labeling, the scanner uses any custom sensitive information types specified, and the list of built-in sensitive information types that are available to select, as defined in your labeling management center.
Optimize scanner performance
Note
If you're looking to improve the responsiveness of the scanner computer rather than the scanner performance, use an advanced client setting tolimit the number of threads used by the scanner.
Use the following options and guidance to help you optimize scanner performance:
Additional factors that affect performance
Additional factors that affect the scanner performance include:
(?:expression)
(expression)
Use PowerShell to configure the scanner
This section describes the steps required to configure and install the scanner when you don't have access to the scanner pages in the Microsoft Purview portal, and must use PowerShell only.
Important
Some steps require Powershell whether or not you are able to access the scanner pages in the Microsoft Purview portal, and are identical. For these steps, see the earlier instructions in this article as indicated.
Some steps require Powershell whether or not you are able to access the scanner pages in the Microsoft Purview portal, and are identical. For these steps, see the earlier instructions in this article as indicated.
If you're working with the scanner for Azure China 21Vianet, additional steps are required in addition to the instructions detailed here. For more information, seeMicrosoft Purview Information Protection for Office 365 operated by 21Vianet.
If you're working with the scanner for Azure China 21Vianet, additional steps are required in addition to the instructions detailed here. For more information, seeMicrosoft Purview Information Protection for Office 365 operated by 21Vianet.
For more information, seeSupported PowerShell cmdlets.
To configure and install your scanner:
Start with PowerShell closed. If you've previously installed the information protection client and scanner, make sure that theMicrosoft Purview Information Protection Scannerservice is stopped.
Start with PowerShell closed. If you've previously installed the information protection client and scanner, make sure that theMicrosoft Purview Information Protection Scannerservice is stopped.
Open a Windows PowerShell session with theRun as an administratoroption.
Open a Windows PowerShell session with theRun as an administratoroption.
Run theInstall-Scannercommand to install your scanner on your SQL server instance, with theClusterparameter to define your cluster name.This step is identical whether or not you're able to access the scanner pages in the Microsoft Purview portal. For more information, see the earlier instructions in this article:Install the scanner
Run theInstall-Scannercommand to install your scanner on your SQL server instance, with theClusterparameter to define your cluster name.
This step is identical whether or not you're able to access the scanner pages in the Microsoft Purview portal. For more information, see the earlier instructions in this article:Install the scanner
Get an Azure token to use with your scanner, and then reauthenticate.This step is identical whether or not you're able to access the scanner pages in the Microsoft Purview portal. For more information, see the earlier instructions in this article:Get a Microsoft Entra token for the scanner.
Get an Azure token to use with your scanner, and then reauthenticate.
This step is identical whether or not you're able to access the scanner pages in the Microsoft Purview portal. For more information, see the earlier instructions in this article:Get a Microsoft Entra token for the scanner.
Run theSet-ScannerConfigurationcmdlet to set the scanner to function in offline mode. Run:Set-ScannerConfiguration -OnlineConfiguration Off
Run theSet-ScannerConfigurationcmdlet to set the scanner to function in offline mode. Run:
Set-ScannerConfiguration -OnlineConfiguration Off
Set-ScannerConfiguration -OnlineConfiguration Off
Run theSet-ScannerContentScancmdlet to create a default content scan job.The only required parameter in theSet-ScannerContentScancmdlet isEnforce. However, you might want to define other settings for your content scan job at this time. For example:Set-ScannerContentScan -Schedule Manual -DiscoverInformationTypes PolicyOnly -Enforce Off -DefaultLabelType PolicyDefault -RelabelFiles Off -PreserveFileDetails On -IncludeFileTypes '' -ExcludeFileTypes '.msg,.tmp' -DefaultOwner <account running the scanner>The syntax above configures the following settings while you continue the configuration:Keeps the scanner run scheduling tomanualSets the information types to be discovered based on the sensitivity label policyDoesnotenforce a sensitivity label policyAutomatically labels files based on content, using the default label defined for the sensitivity label policyDoesnotallow for relabeling filesPreserves file details while scanning and auto-labeling, includingdate modified,last modified, andmodified byvaluesSets the scanner to exclude .msg and .tmp files when runningSets the default owner to the account you want to use when running the scanner
Run theSet-ScannerContentScancmdlet to create a default content scan job.
The only required parameter in theSet-ScannerContentScancmdlet isEnforce. However, you might want to define other settings for your content scan job at this time. For example:
Set-ScannerContentScan -Schedule Manual -DiscoverInformationTypes PolicyOnly -Enforce Off -DefaultLabelType PolicyDefault -RelabelFiles Off -PreserveFileDetails On -IncludeFileTypes '' -ExcludeFileTypes '.msg,.tmp' -DefaultOwner <account running the scanner>
Set-ScannerContentScan -Schedule Manual -DiscoverInformationTypes PolicyOnly -Enforce Off -DefaultLabelType PolicyDefault -RelabelFiles Off -PreserveFileDetails On -IncludeFileTypes '' -ExcludeFileTypes '.msg,.tmp' -DefaultOwner <account running the scanner>
The syntax above configures the following settings while you continue the configuration:
Keeps the scanner run scheduling tomanual
Sets the information types to be discovered based on the sensitivity label policy
Doesnotenforce a sensitivity label policy
Automatically labels files based on content, using the default label defined for the sensitivity label policy
Doesnotallow for relabeling files
Preserves file details while scanning and auto-labeling, includingdate modified,last modified, andmodified byvalues
Sets the scanner to exclude .msg and .tmp files when running
Sets the default owner to the account you want to use when running the scanner
Use theAdd-ScannerRepositorycmdlet to define the repositories you want to scan in your content scan job. For example, run:Add-ScannerRepository -OverrideContentScanJob Off -Path 'c:\repoToScan'Use one of the following syntaxes, depending on the type of repository you're adding:For a network share, use\\Server\Folder.For a SharePoint library, usehttp://sharepoint.contoso.com/Shared%20Documents/Folder.For a local path:C:\FolderFor a UNC path:\\Server\FolderNoteWildcards are not supported and WebDav locations are not supported.To modify the repository later on, use theSet-ScannerRepositorycmdlet instead.If you add a SharePoint path forShared Documents:SpecifyShared Documentsin the path when you want to scan all documents and all folders from Shared Documents.
For example:http://sp2013/SharedDocumentsSpecifyDocumentsin the path when you want to scan all documents and all folders from a subfolder under Shared Documents.
For example:http://sp2013/Documents/SalesReportsOr, specify only theFQDNof your SharePoint, for examplehttp://sp2013todiscover and scan all SharePoint sites and subsites under a specific URLand subtitles under this URL. Grant scannerSite Collector Auditorrights to enable this.Use the following syntax when adding SharePoint paths:PathSyntaxRoot pathhttp://<SharePoint server name>Scans all sites, including any site collections allowed for the scanner user.Specific SharePoint subsite or collectionOne of the following:-http://<SharePoint server name>/<subsite name>-http://SharePoint server name>/<site collection name>/<site name>Specific SharePoint libraryOne of the following:-http://<SharePoint server name>/<library name>-http://SharePoint server name>/.../<library name>Specific SharePoint folderhttp://<SharePoint server name>/.../<folder name>
Use theAdd-ScannerRepositorycmdlet to define the repositories you want to scan in your content scan job. For example, run:
Add-ScannerRepository -OverrideContentScanJob Off -Path 'c:\repoToScan'
Add-ScannerRepository -OverrideContentScanJob Off -Path 'c:\repoToScan'
Use one of the following syntaxes, depending on the type of repository you're adding:
For a network share, use\\Server\Folder.
\\Server\Folder
For a SharePoint library, usehttp://sharepoint.contoso.com/Shared%20Documents/Folder.
http://sharepoint.contoso.com/Shared%20Documents/Folder
For a local path:C:\Folder
C:\Folder
For a UNC path:\\Server\Folder
\\Server\Folder
Note
Wildcards are not supported and WebDav locations are not supported.
To modify the repository later on, use theSet-ScannerRepositorycmdlet instead.
If you add a SharePoint path forShared Documents:
SpecifyShared Documentsin the path when you want to scan all documents and all folders from Shared Documents.
For example:http://sp2013/SharedDocuments
http://sp2013/SharedDocuments
SpecifyDocumentsin the path when you want to scan all documents and all folders from a subfolder under Shared Documents.
For example:http://sp2013/Documents/SalesReports
http://sp2013/Documents/SalesReports
Or, specify only theFQDNof your SharePoint, for examplehttp://sp2013todiscover and scan all SharePoint sites and subsites under a specific URLand subtitles under this URL. Grant scannerSite Collector Auditorrights to enable this.
http://sp2013
Use the following syntax when adding SharePoint paths:
http://<SharePoint server name>
http://<SharePoint server name>/<subsite name>
http://SharePoint server name>/<site collection name>/<site name>
http://<SharePoint server name>/<library name>
http://SharePoint server name>/.../<library name>
http://<SharePoint server name>/.../<folder name>
Continue with the following steps as needed:
Configuration for customers in China
Run a discovery cycle and view reports for the scanner
Use PowerShell to configure the scanner to apply classification and protection
Use PowerShell to configure a DLP policy with the scanner
Use PowerShell to configure the scanner to apply classification and protection
Run theSet-ScannerContentScancmdlet to update your content scan job to set your scheduling to always and enforce your sensitivity policy.Set-ScannerContentScan -Schedule Always -Enforce OnTipYou may want to change other settings on this pane, such as whether file attributes are changed and whether the scanner can relabel files. For more information about the settings available, see the fullSet-ScannerContentScan documentation.
Run theSet-ScannerContentScancmdlet to update your content scan job to set your scheduling to always and enforce your sensitivity policy.
Set-ScannerContentScan -Schedule Always -Enforce On
Set-ScannerContentScan -Schedule Always -Enforce On
Tip
You may want to change other settings on this pane, such as whether file attributes are changed and whether the scanner can relabel files. For more information about the settings available, see the fullSet-ScannerContentScan documentation.
Run theStart-Scancmdlet to run your content scan job:Start-Scan
Run theStart-Scancmdlet to run your content scan job:
Start-Scan
Start-Scan
The scanner is now scheduled to run continuously. When the scanner works its way through all configured files, it automatically starts a new cycle so that any new and changed files are discovered.
Use PowerShell to configure a DLP policy with the scanner
Run theSet-ScannerContentScancmdlet again with the-EnableDLPparameter set toOn, and with a specific repository owner defined.
For example:
Set-ScannerContentScan -EnableDLP On -RepositoryOwner 'domain\user'
Set-ScannerContentScan -EnableDLP On -RepositoryOwner 'domain\user'
Supported PowerShell cmdlets
This section lists PowerShell cmdlets supported for the information protection scanner and instructions for configuring and installing the scanner with PowerShell only.
Supported cmdlets for the scanner include:
Add-ScannerRepository
Add-ScannerRepository
Clear-Authentication
Clear-Authentication
Export-DebugLogs
Export-DebugLogs
Get-FileStatus
Get-FileStatus
Get-ScannerConfiguration
Get-ScannerConfiguration
Get-ScannerContentScan
Get-ScannerContentScan
Get-ScannerRepository
Get-ScannerRepository
Get-ScanStatus
Get-ScanStatus
Import-ScannerConfiguration
Import-ScannerConfiguration
Install-Scanner
Install-Scanner
New-CustomPermissions
New-CustomPermissions
Remove-FileLabel
Remove-FileLabel
Remove-ScannerContentScan
Remove-ScannerContentScan
Remove-ScannerRepository
Remove-ScannerRepository
Set-Authentication
Set-Authentication
Set-FileLabel
Set-FileLabel
Set-ScannerConfiguration
Set-ScannerConfiguration
Set-ScannerContentScan
Set-ScannerContentScan
Set-ScannerDatabase
Set-ScannerDatabase
Set-ScannerRepository
Set-ScannerRepository
Start-Scan
Start-Scan
Start-ScannerDiagnostics
Start-ScannerDiagnostics
Stop-Scan
Stop-Scan
Uninstall-Scanner
Uninstall-Scanner
Update-ScannerDatabase
Update-ScannerDatabase
Next steps
Once you've installed and configured your scanner, startscanning your files.
Feedback
Was this page helpful?
Additional resources